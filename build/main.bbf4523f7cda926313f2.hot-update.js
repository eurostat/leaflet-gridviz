"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdateleaflet_gridviz"]("main",{

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var proj4__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! proj4 */ \"./node_modules/proj4/lib/index.js\");\n/* harmony import */ var gridviz__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! gridviz */ \"./node_modules/gridviz/src/index.js\");\nObject(function webpackMissingModule() { var e = new Error(\"Cannot find module './L.CanvasLayer.js'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }());\n\r\n\r\n\r\n\r\n// define our projection\r\nproj4__WEBPACK_IMPORTED_MODULE_0__[\"default\"].defs('EPSG:3035', '+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs')\r\n\r\n/** An extension of L.CanvasLayer (leaflet-canvas-layer) for integrating gridviz into Leaflet\r\n *  @description \r\n *  methods\tdescription\r\n    needRedraw - will schedule next frame call for drawLayer\r\n    delegate(object) - optionaly set receiver of the events if not 'inheriting' from L.CanvasLayer\r\n * \r\n */\r\nL.GridvizLayer = function (opts) {\r\n    opts = opts || {}\r\n    this.proj = opts.proj || 'EPSG:3035'     // proj4 projection definition name. Make sure to add it using proj4.defs() first\r\n    this.gridvizMap = null //gridviz map. See https://eurostat.github.io/gridviz/docs/reference\r\n    this.onLayerDidMountCallback = opts.onLayerDidMountCallback || null // Specify a callback function to fire when the layer is added to the map and the gridviz app is built\r\n\r\n    /**\r\n     * @description Fires after leaflet layer canvas is attached/added to the map\r\n     *\r\n     */\r\n    this.onLayerDidMount = function () {\r\n        // build gridviz app\r\n        this.buildGridvizMap();\r\n\r\n        if (this.onLayerDidMountCallback) this.onLayerDidMountCallback(this.gridvizMap);\r\n\r\n        // Resize observer\r\n        this.addResizeObserver()\r\n\r\n    };\r\n\r\n    this.addResizeObserver = function () {\r\n        const mapContainer = this._map._container;\r\n        const resizeObserver = new ResizeObserver((entries) => {\r\n            window.requestAnimationFrame(() => {\r\n                if (!Array.isArray(entries) || !entries.length) return;\r\n                if (this.gridvizMap.h !== mapContainer.clientHeight || this.gridvizMap.w !== mapContainer.clientWidth) {\r\n                    this.gridvizMap.h = mapContainer.clientHeight;\r\n                    this.gridvizMap.w = mapContainer.clientWidth;\r\n                    this.gridvizMap.geoCanvas.h = mapContainer.clientHeight;\r\n                    this.gridvizMap.geoCanvas.w = mapContainer.clientWidth;\r\n                    this._canvas.setAttribute('width', '' + this.gridvizMap.w);\r\n                    this._canvas.setAttribute('height', '' + this.gridvizMap.h);\r\n                    this.gridvizMap.redraw();\r\n                    this.needRedraw()\r\n                }\r\n            });\r\n        });\r\n        resizeObserver.observe(mapContainer);\r\n    }\r\n\r\n    /**\r\n     * @description Fires before layer is removed from the map\r\n     *\r\n     */\r\n    this.onLayerWillUnmount = function () {\r\n        this.gridvizMap.destroy();\r\n    };\r\n\r\n    /**\r\n     * @description Fires when layer data changes\r\n     *\r\n     */\r\n    this.setData = function (data) {\r\n        // -- custom data set\r\n        this.needRedraw() // -- call to drawLayer\r\n    }\r\n\r\n    /**\r\n     * @description Fires when layer is drawn, info contains view parameters like bounds, size, canvas etc.\r\n     * Here we need to feed gridviz it's new position and zoom, then redraw it's canvas\r\n     *\r\n     */\r\n    this.onDrawLayer = function (info) {\r\n        if (this._zooming) return; // defer to zoomend\r\n\r\n        // Sync view to Leaflet\r\n        const geoCenter = this.leafletToGeoCenter(this._map.getCenter());\r\n        const zoomFactor = this.leafletZoomToGridvizZoom();\r\n        this.gridvizMap.setView(geoCenter[0], geoCenter[1], zoomFactor);\r\n\r\n        // Redraw gridviz canvas\r\n        this.gridvizMap.redraw();\r\n    };\r\n\r\n    /**\r\n     * @description Converts leaflet center to gridviz projection's geoCenter\r\n     * proj4(fromProjection, toProjection, [coordinates])\r\n     * @param {{lng: number, lat: number}} latLon leaflet latLon object\r\n     */\r\n    this.leafletToGeoCenter = function (latLon) {\r\n        return (0,proj4__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(this.proj, [latLon.lng, latLon.lat])\r\n    }\r\n\r\n    /**\r\n     * @description Converts leaflet zoom level to gridviz zoom factor (pixel size, in ground m)\r\n     *@deprecated\r\n     */\r\n    this.leafletZoomToGridvizZoom = function () {\r\n        return this.getMetresPerPixel()\r\n    }\r\n\r\n    /**\r\n     * @description Calculates meters per pixel at the current leaflet zoom level\r\n     *\r\n     */\r\n    this.getMetresPerPixel = function () {\r\n        // get map center\r\n        let centerLatLng = this._map.getCenter()\r\n\r\n        // convert to containerpoint (pixels)\r\n        let pointC = this._map.latLngToContainerPoint(centerLatLng)\r\n        let pointX = [pointC.x + 1, pointC.y] // add one pixel to x\r\n\r\n        // convert containerpoints to latlng's\r\n        let latLngC = this._map.containerPointToLatLng(pointC)\r\n        let latLngX = this._map.containerPointToLatLng(pointX)\r\n\r\n        // convert to our projection\r\n        let projCenter = this.leafletToGeoCenter(latLngC)\r\n        let projX = this.leafletToGeoCenter(latLngX)\r\n        let difference = projX[0] - projCenter[0]\r\n\r\n        //console.log('zoom factor: ' + difference + '. Zoom level: ' + this._map._zoom)\r\n        return difference\r\n    }\r\n\r\n    /**\r\n     * @description build a gridviz app and add a layer to it\r\n     * gridviz api: https://eurostat.github.io/gridviz/docs/reference\r\n     * Uses (optionally):\r\n     * opts.container\r\n     * opts.selectionRectangleColor\r\n     * opts.selectionRectangleWidthPix\r\n     * opts.legendDivId\r\n     */\r\n    this.buildGridvizMap = function () {\r\n        let geoCenter = this.leafletToGeoCenter(this._map.getCenter())\r\n        opts.container = opts.container || this._canvas.parentElement\r\n        this.gridvizMap = new gridviz__WEBPACK_IMPORTED_MODULE_1__.Map(opts.container, {\r\n            canvas: this._canvas,\r\n            w: window.innerWidth,\r\n            h: window.innerHeight,\r\n            x: geoCenter[0],\r\n            y: geoCenter[1],\r\n            z: this.leafletZoomToGridvizZoom(),\r\n            disableZoom: true,\r\n            transparentBackground: true,\r\n            selectionRectangleColor: opts.selectionRectangleColor,\r\n            selectionRectangleWidthPix: opts.selectionRectangleWidthPix,\r\n            legendContainer: opts.legendContainer,\r\n            tooltip: { parentElement: document.body },\r\n        })\r\n    }\r\n}\r\n\r\nL.GridvizLayer.prototype = new L.CanvasLayer() // -- setup prototype\r\n\n\n//# sourceURL=webpack://leaflet-gridviz/./src/main.js?\n}");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("1d800bf251fa60df62c0")
/******/ })();
/******/ 
/******/ }
);