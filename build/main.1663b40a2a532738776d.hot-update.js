"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdateleaflet_gridviz"]("main",{

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\");\n/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var leaflet_canvas_layer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! leaflet-canvas-layer */ \"./node_modules/leaflet-canvas-layer/dist/leaflet-canvas-layer.js\");\n/* harmony import */ var leaflet_canvas_layer__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(leaflet_canvas_layer__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var gridviz__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! gridviz */ \"./node_modules/gridviz/dist/gridviz.min.js\");\n/* harmony import */ var gridviz__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(gridviz__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var d3_scale_chromatic__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! d3-scale-chromatic */ \"./node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js\");\n/* harmony import */ var proj4__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! proj4 */ \"./node_modules/proj4/lib/index.js\");\n/* harmony import */ var proj4leaflet__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! proj4leaflet */ \"./node_modules/proj4leaflet/src/proj4leaflet.js\");\n/* harmony import */ var proj4leaflet__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(proj4leaflet__WEBPACK_IMPORTED_MODULE_4__);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nproj4__WEBPACK_IMPORTED_MODULE_3__[\"default\"].defs(\r\n    'EPSG:3035',\r\n    '+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs'\r\n)\r\n\r\n// TODO\r\n// instead of updating leaflet when gridviz pans and zooms, do it the other way around: disable zoom for griddviz and redraw the canvas when leaflet pans/zooms\r\n\r\n/** An extension of L.CanvasLayer (leaflet-canvas-layer) for integrating gridviz into Leaflet\r\n *  @description \r\n *  methods\tdescription\r\n    needRedraw - will schedule next frame call for drawLayer\r\n    delegate(object) - optionaly set receiver of the events if not 'inheriting' from L.CanvasLayer\r\n * \r\n */\r\nleaflet__WEBPACK_IMPORTED_MODULE_0__.GridvizLayer = function (opts) {\r\n    /**\r\n     * @description Layer (canvas) opacity\r\n     *\r\n     */\r\n    this.opacity = 0.5 || 0\r\n\r\n    /**\r\n     * @description gridviz app. see https://eurostat.github.io/gridviz/docs/reference\r\n     *\r\n     */\r\n    this.app = null\r\n\r\n    /**\r\n     * @description EPSG:3035 tiling resolutions\r\n     *\r\n     */\r\n    this.resolutions = [\r\n        66145.9656252646, 26458.386250105836, 13229.193125052918, 6614.596562526459,\r\n        2645.8386250105837, 1322.9193125052918, 661.4596562526459, 264.5838625010584,\r\n        132.2919312505292, 66.1459656252646,\r\n    ]\r\n\r\n    /**\r\n     * @description Fires after leaflet layer canvas is attached/added to the map\r\n     *\r\n     */\r\n    this.onLayerDidMount = function () {\r\n        // build gridviz app\r\n        this.buildGridVizApp()\r\n\r\n        //set canvas opacity\r\n        this.app.cg.canvas.style.opacity = this.opacity\r\n    }\r\n\r\n    /**\r\n     * @description Fires before layer is removed from the map\r\n     *\r\n     */\r\n    this.onLayerWillUnmount = function () {\r\n        // cleanup?\r\n    }\r\n\r\n    /**\r\n     * @description Fires when layer data changes\r\n     *\r\n     */\r\n    this.setData = function (data) {\r\n        // -- custom data set\r\n        this.needRedraw() // -- call to drawLayer\r\n    }\r\n\r\n    /**\r\n     * @description Fires when layer is drawn, info contains view parameters like bounds, size, canvas etc.\r\n     * Here we need to feed gridviz it's new position and zoom, then redraw it's canvas\r\n     *\r\n     */\r\n    this.onDrawLayer = function (info) {\r\n        // console.log(info)\r\n        // set gridviz center and zoom to match leaflet\r\n        // for some reason info.center is inaccurate so we take the map center is WGS84 and project\r\n        let leafCenter = this.map.getCenter()\r\n        let geoCenter = this.leafletToGeoCenter(leafCenter.lng, leafCenter.lat)\r\n        this.app.setGeoCenter({ x: geoCenter[0], y: geoCenter[1] })\r\n        this.app.setZoomFactor(this.resolutions[info.zoom])\r\n        // redraw gridviz canvas\r\n        this.app.redraw()\r\n    }\r\n\r\n    /**\r\n     * @description Converts gridviz geoCenter to leaflet center\r\n     * proj4(fromProjection, toProjection, [coordinates])\r\n     *\r\n     */\r\n    this.geoCenterToLeaflet = function (x, y) {\r\n        let xy = (0,proj4__WEBPACK_IMPORTED_MODULE_3__[\"default\"])('EPSG:3035', 'WGS84', [x, y])\r\n        return [xy[1], xy[0]] // leaflet uses [lat,lon]\r\n    }\r\n\r\n    /**\r\n     * @description Converts leaflet center to gridviz EPSG geoCenter\r\n     * proj4(fromProjection, toProjection, [coordinates])\r\n     *\r\n     */\r\n    this.leafletToGeoCenter = function (x, y) {\r\n        return (0,proj4__WEBPACK_IMPORTED_MODULE_3__[\"default\"])('EPSG:3035', [x, y])\r\n    }\r\n\r\n    /**\r\n     * @description Converts leaflet zoom level to gridviz zoom factor (pixel size, in ground m)\r\n     *@deprecated\r\n     */\r\n    this.leafletZoomToGridvizZoom = function (leafletZoom) {\r\n        return this.zoomLevelToMetresPerPixel()\r\n    }\r\n\r\n    /**\r\n     * @description Calculates meters per pixel at a leaflet zoom level\r\n     *\r\n     */\r\n    this.zoomLevelToMetresPerPixel = function () {\r\n        let centerLatLng = this._map.getCenter() // get map center\r\n        let pointC = this._map.latLngToContainerPoint(centerLatLng) // convert to containerpoint (pixels)\r\n        let pointX = [pointC.x + 1, pointC.y] // add one pixel to x\r\n        let pointY = [pointC.x, pointC.y + 1] // add one pixel to y\r\n\r\n        // convert containerpoints to latlng's\r\n        let latLngC = this._map.containerPointToLatLng(pointC)\r\n        let latLngX = this._map.containerPointToLatLng(pointX)\r\n        let latLngY = this._map.containerPointToLatLng(pointY)\r\n\r\n        let distanceX = latLngC.distanceTo(latLngX) // calculate distance between c and x (latitude)\r\n        let distanceY = latLngC.distanceTo(latLngY) // calculate distance between c and y (longitude)\r\n\r\n        return distanceX + distanceY / 2\r\n    }\r\n\r\n    /**\r\n     * @description build a gridviz app and add a layer to it\r\n     */\r\n    this.buildGridVizApp = function () {\r\n        let container = this._canvas.parentElement\r\n        let geoCenter = this.leafletToGeoCenter(this.map._lastCenter.lng, this.map._lastCenter.lat)\r\n\r\n        this.app = new gridviz__WEBPACK_IMPORTED_MODULE_2__.App(container, {\r\n            canvas: this._canvas,\r\n            w: window.innerWidth,\r\n            h: window.innerHeight,\r\n            disableZoom: true,\r\n            // gridviz now follows leaflets' lead, not vice-versa\r\n            // onZoomEndFun: (e) => this.gridvizZoomEndHandler(e),\r\n            // onZoomFun: (e) => this.gridvizZoomEndHandler(e),\r\n        })\r\n            .setGeoCenter({ x: geoCenter[0], y: geoCenter[1] })\r\n            .setZoomFactor(this.leafletZoomToGridvizZoom(this.map._zoom))\r\n            .setZoomFactorExtent([\r\n                this.resolutions[this.resolutions.length - 1],\r\n                this.resolutions[0],\r\n            ])\r\n            .setBackgroundColor('#ffffff')\r\n            .addMultiScaleTiledGridLayer(\r\n                [1000, 2000, 5000, 10000, 20000, 50000, 100000],\r\n                (r) =>\r\n                    'https://raw.githubusercontent.com/jgaffuri/tiledgrids/main/data/europe/population/' +\r\n                    r +\r\n                    'm/',\r\n                gridviz__WEBPACK_IMPORTED_MODULE_2__.TanakaStyle.get('2018', {\r\n                    tFun: (v, r, s, zf) => gridviz__WEBPACK_IMPORTED_MODULE_2__.sExpRev((v - s.min) / (s.max - s.min), -7),\r\n                    nb: 6,\r\n                    color: (t) => (0,d3_scale_chromatic__WEBPACK_IMPORTED_MODULE_5__.inferno)(t * 0.9 + 0.1),\r\n                    colDark: '#333',\r\n                }),\r\n                {\r\n                    pixNb: 6,\r\n                    cellInfoHTML: (c) => '<b>' + c['2018'] + '</b> inhabitant(s)',\r\n                }\r\n            )\r\n\r\n            .setLabelLayer(\r\n                gridviz__WEBPACK_IMPORTED_MODULE_2__.getEuronymeLabelLayer('EUR', 50, {\r\n                    ex: 2,\r\n                    fontFamily: 'mfLeg',\r\n                    exSize: 0.9,\r\n                    color: () => 'black',\r\n                    haloColor: () => '#ffffff',\r\n                    haloWidth: () => 3,\r\n                })\r\n            )\r\n            .setBoundaryLayer(\r\n                gridviz__WEBPACK_IMPORTED_MODULE_2__.getEurostatBoundariesLayer({\r\n                    scale: '10M',\r\n                    col: '#fff5',\r\n                    lineDash: () => [],\r\n                })\r\n            )\r\n    }\r\n}\r\n\r\nleaflet__WEBPACK_IMPORTED_MODULE_0__.GridvizLayer.prototype = new leaflet_canvas_layer__WEBPACK_IMPORTED_MODULE_1__.CanvasLayer() // -- setup prototype\r\n\n\n//# sourceURL=webpack://leaflet-gridviz/./src/main.js?");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("17a6fb20edc2760c6a39")
/******/ })();
/******/ 
/******/ }
);