/*! For license information please see leaflet-gridviz.min.js.LICENSE.txt */
(()=>{var t={616:function(t,e,i){var n;t.exports=(n=i(243),function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),r=function(t){function e(e){var i=t.call(this,e)||this;return i._map=null,i._canvas=null,i._frame=null,i._delegate=null,i}return n(e,t),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),e.prototype.getEvents=function(){var t={moveend:this._onLayerDidMove};return this._map.options.zoomAnimation&&s.Browser.any3d&&(t.zoomanim=this._animateZoom),t},e.prototype.onAdd=function(t){this._map=t,this._canvas=s.DomUtil.create("canvas","leaflet-layer");var e=this._map.getSize();this._canvas.width=e.x,this._canvas.height=e.y;var i=this._map.options.zoomAnimation&&s.Browser.any3d;s.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(i?"animated":"hide")),t.getPanes().overlayPane.appendChild(this._canvas);var n=this._delegate||this;return n.onLayerDidMount&&n.onLayerDidMount(),this.needRedraw(),this},e.prototype.onRemove=function(t){var e=this._delegate||this;return e.onLayerWillUnmount&&e.onLayerWillUnmount(),t.getPanes().overlayPane.removeChild(this._canvas),this._canvas=null,this},e.prototype.needRedraw=function(){return this._frame||(this._frame=s.Util.requestAnimFrame(this.drawLayer,this)),this},e.prototype.delegate=function(t){return this._delegate=t,this},e.prototype._onLayerDidResize=function(t){this._canvas.width=t.newSize.x,this._canvas.height=t.newSize.y},e.prototype._onLayerDidMove=function(){var t=this._map.containerPointToLayerPoint([0,0]);s.DomUtil.setPosition(this._canvas,t),this.drawLayer()},e.prototype.LatLonToMercator=function(t){return{x:6378137*t.lng*Math.PI/180,y:6378137*Math.log(Math.tan((90+t.lat)*Math.PI/360))}},e.prototype.drawLayer=function(){var t=this._map.getSize();this._canvas.width=t.x,this._canvas.height=t.y;var e=this._map.getBounds(),i=this._map.getZoom(),n=this.LatLonToMercator(this._map.getCenter()),s=this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize())),r=this._delegate||this;r.onDrawLayer&&r.onDrawLayer({bounds:e,canvas:this._canvas,center:n,corner:s,layer:this,size:t,zoom:i}),this._frame=null},e.prototype._animateZoom=function(t){var e=t.target.getZoomScale(t.zoom,t.target.getZoom()),i=this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(),t.zoom,t.center).min;s.DomUtil.setTransform(this._canvas,i,e)},e}(s.Layer);e.CanvasLayer=r},function(t,e){t.exports=n}]))},243:function(t,e){!function(t){"use strict";function e(t){var e,i,n,s;for(i=1,n=arguments.length;i<n;i++)for(e in s=arguments[i])t[e]=s[e];return t}var i=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function n(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}var s=0;function r(t){return"_leaflet_id"in t||(t._leaflet_id=++s),t._leaflet_id}function o(t,e,i){var n,s,r,o;return o=function(){n=!1,s&&(r.apply(i,s),s=!1)},r=function(){n?s=arguments:(t.apply(i,arguments),setTimeout(o,e),n=!0)},r}function a(t,e,i){var n=e[1],s=e[0],r=n-s;return t===n&&i?t:((t-s)%r+r)%r+s}function h(){return!1}function l(t,e){if(!1===e)return t;var i=Math.pow(10,void 0===e?6:e);return Math.round(t*i)/i}function c(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function u(t){return c(t).split(/\s+/)}function d(t,e){for(var n in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?i(t.options):{}),e)t.options[n]=e[n];return t.options}function f(t,e,i){var n=[];for(var s in t)n.push(encodeURIComponent(i?s.toUpperCase():s)+"="+encodeURIComponent(t[s]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}var p=/\{ *([\w_ -]+) *\}/g;function m(t,e){return t.replace(p,(function(t,i){var n=e[i];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(e)),n}))}var y=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function _(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var g="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function v(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var b=0;function x(t){var e=+new Date,i=Math.max(0,16-(e-b));return b=e+i,window.setTimeout(t,i)}var w=window.requestAnimationFrame||v("RequestAnimationFrame")||x,M=window.cancelAnimationFrame||v("CancelAnimationFrame")||v("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function S(t,e,i){if(!i||w!==x)return w.call(window,n(t,e));t.call(e)}function T(t){t&&M.call(window,t)}var I={__proto__:null,extend:e,create:i,bind:n,get lastId(){return s},stamp:r,throttle:o,wrapNum:a,falseFn:h,formatNum:l,trim:c,splitWords:u,setOptions:d,getParamString:f,template:m,isArray:y,indexOf:_,emptyImageUrl:g,requestFn:w,cancelFn:M,requestAnimFrame:S,cancelAnimFrame:T};function A(){}A.extend=function(t){var n=function(){d(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},s=n.__super__=this.prototype,r=i(s);for(var o in r.constructor=n,n.prototype=r,this)Object.prototype.hasOwnProperty.call(this,o)&&"prototype"!==o&&"__super__"!==o&&(n[o]=this[o]);return t.statics&&e(n,t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=y(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),e.apply(null,[r].concat(t.includes))),e(r,t),delete r.statics,delete r.includes,r.options&&(r.options=s.options?i(s.options):{},e(r.options,t.options)),r._initHooks=[],r.callInitHooks=function(){if(!this._initHooksCalled){s.callInitHooks&&s.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=r._initHooks.length;t<e;t++)r._initHooks[t].call(this)}},n},A.include=function(t){var i=this.prototype.options;return e(this.prototype,t),t.options&&(this.prototype.options=i,this.mergeOptions(t.options)),this},A.mergeOptions=function(t){return e(this.prototype.options,t),this},A.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var C={on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else for(var s=0,r=(t=u(t)).length;s<r;s++)this._on(t[s],e,i);return this},off:function(t,e,i){if(arguments.length)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else{t=u(t);for(var s=1===arguments.length,r=0,o=t.length;r<o;r++)s?this._off(t[r]):this._off(t[r],e,i)}else delete this._events;return this},_on:function(t,e,i,n){if("function"==typeof e){if(!1===this._listens(t,e,i)){i===this&&(i=void 0);var s={fn:e,ctx:i};n&&(s.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(s)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,i){var n,s,r;if(this._events&&(n=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var o=this._listens(t,e,i);if(!1!==o){var a=n[o];this._firingCount&&(a.fn=h,this._events[t]=n=n.slice()),n.splice(o,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(s=0,r=n.length;s<r;s++)n[s].fn=h;delete this._events[t]}},fire:function(t,i,n){if(!this.listens(t,n))return this;var s=e({},i,{type:t,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var r=this._events[t];if(r){this._firingCount=this._firingCount+1||1;for(var o=0,a=r.length;o<a;o++){var h=r[o],l=h.fn;h.once&&this.off(t,l,h.ctx),l.call(h.ctx||this,s)}this._firingCount--}}return n&&this._propagateEvent(s),this},listens:function(t,e,i,n){"string"!=typeof t&&console.warn('"string" type argument expected');var s=e;"function"!=typeof e&&(n=!!e,s=void 0,i=void 0);var r=this._events&&this._events[t];if(r&&r.length&&!1!==this._listens(t,s,i))return!0;if(n)for(var o in this._eventParents)if(this._eventParents[o].listens(t,e,i,n))return!0;return!1},_listens:function(t,e,i){if(!this._events)return!1;var n=this._events[t]||[];if(!e)return!!n.length;i===this&&(i=void 0);for(var s=0,r=n.length;s<r;s++)if(n[s].fn===e&&n[s].ctx===i)return s;return!1},once:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e,!0);else for(var s=0,r=(t=u(t)).length;s<r;s++)this._on(t[s],e,i,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[r(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[r(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};C.addEventListener=C.on,C.removeEventListener=C.clearAllEventListeners=C.off,C.addOneTimeEventListener=C.once,C.fireEvent=C.fire,C.hasEventListeners=C.listens;var P=A.extend(C);function B(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}var E=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function z(t,e,i){return t instanceof B?t:y(t)?new B(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new B(t.x,t.y):new B(t,e,i)}function O(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;n<s;n++)this.extend(i[n])}function k(t,e){return!t||t instanceof O?t:new O(t,e)}function N(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;n<s;n++)this.extend(i[n])}function F(t,e){return t instanceof N?t:new N(t,e)}function D(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function R(t,e,i){return t instanceof D?t:y(t)&&"object"!=typeof t[0]?3===t.length?new D(t[0],t[1],t[2]):2===t.length?new D(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new D(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new D(t,e,i)}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(t){return this.clone()._add(z(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(z(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new B(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new B(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=E(this.x),this.y=E(this.y),this},distanceTo:function(t){var e=(t=z(t)).x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return(t=z(t)).x===this.x&&t.y===this.y},contains:function(t){return t=z(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+l(this.x)+", "+l(this.y)+")"}},O.prototype={extend:function(t){var e,i;if(!t)return this;if(t instanceof B||"number"==typeof t[0]||"x"in t)e=i=z(t);else if(e=(t=k(t)).min,i=t.max,!e||!i)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)):(this.min=e.clone(),this.max=i.clone()),this},getCenter:function(t){return z((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return z(this.min.x,this.max.y)},getTopRight:function(){return z(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return(t="number"==typeof t[0]||t instanceof B?z(t):k(t))instanceof O?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=k(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x>=e.x&&n.x<=i.x,o=s.y>=e.y&&n.y<=i.y;return r&&o},overlaps:function(t){t=k(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x>e.x&&n.x<i.x,o=s.y>e.y&&n.y<i.y;return r&&o},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,i=this.max,n=Math.abs(e.x-i.x)*t,s=Math.abs(e.y-i.y)*t;return k(z(e.x-n,e.y-s),z(i.x+n,i.y+s))},equals:function(t){return!!t&&(t=k(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},N.prototype={extend:function(t){var e,i,n=this._southWest,s=this._northEast;if(t instanceof D)e=t,i=t;else{if(!(t instanceof N))return t?this.extend(R(t)||F(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||s?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),s.lat=Math.max(i.lat,s.lat),s.lng=Math.max(i.lng,s.lng)):(this._southWest=new D(e.lat,e.lng),this._northEast=new D(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new N(new D(e.lat-n,e.lng-s),new D(i.lat+n,i.lng+s))},getCenter:function(){return new D((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new D(this.getNorth(),this.getWest())},getSouthEast:function(){return new D(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof D||"lat"in t?R(t):F(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof N?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=F(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>=e.lat&&n.lat<=i.lat,o=s.lng>=e.lng&&n.lng<=i.lng;return r&&o},overlaps:function(t){t=F(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>e.lat&&n.lat<i.lat,o=s.lng>e.lng&&n.lng<i.lng;return r&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=F(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},D.prototype={equals:function(t,e){return!!t&&(t=R(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+l(this.lat,t)+", "+l(this.lng,t)+")"},distanceTo:function(t){return j.distance(this,R(t))},wrap:function(){return j.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return F([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new D(this.lat,this.lng,this.alt)}};var U,Z={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t);return new O(this.transformation.transform(e.min,i),this.transformation.transform(e.max,i))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?a(t.lng,this.wrapLng,!0):t.lng;return new D(this.wrapLat?a(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,s=e.lng-i.lng;if(0===n&&0===s)return t;var r=t.getSouthWest(),o=t.getNorthEast();return new N(new D(r.lat-n,r.lng-s),new D(o.lat-n,o.lng-s))}},j=e({},Z,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,s=e.lat*i,r=Math.sin((e.lat-t.lat)*i/2),o=Math.sin((e.lng-t.lng)*i/2),a=r*r+Math.cos(n)*Math.cos(s)*o*o,h=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*h}}),V=6378137,W={R:V,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=Math.sin(n*e);return new B(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject:function(t){var e=180/Math.PI;return new D((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(U=V*Math.PI,new O([-U,-U],[U,U]))};function G(t,e,i,n){if(y(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=i,this._d=n}function q(t,e,i,n){return new G(t,e,i,n)}G.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new B((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var H=e({},j,{code:"EPSG:3857",projection:W,transformation:function(){var t=.5/(Math.PI*W.R);return q(t,.5,-t,.5)}()}),Y=e({},H,{code:"EPSG:900913"});function $(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function X(t,e){var i,n,s,r,o,a,h="";for(i=0,s=t.length;i<s;i++){for(n=0,r=(o=t[i]).length;n<r;n++)h+=(n?"L":"M")+(a=o[n]).x+" "+a.y;h+=e?Ot.svg?"z":"x":""}return h||"M0 0"}var K,J=document.documentElement.style,Q="ActiveXObject"in window,tt=Q&&!document.addEventListener,et="msLaunchUri"in navigator&&!("documentMode"in document),it=zt("webkit"),nt=zt("android"),st=zt("android 2")||zt("android 3"),rt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ot=nt&&zt("Google")&&rt<537&&!("AudioNode"in window),at=!!window.opera,ht=!et&&zt("chrome"),lt=zt("gecko")&&!it&&!at&&!Q,ct=!ht&&zt("safari"),ut=zt("phantom"),dt="OTransition"in J,ft=0===navigator.platform.indexOf("Win"),pt=Q&&"transition"in J,mt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!st,yt="MozPerspective"in J,_t=!window.L_DISABLE_3D&&(pt||mt||yt)&&!dt&&!ut,gt="undefined"!=typeof orientation||zt("mobile"),vt=gt&&it,bt=gt&&mt,xt=!window.PointerEvent&&window.MSPointerEvent,wt=!(!window.PointerEvent&&!xt),Mt="ontouchstart"in window||!!window.TouchEvent,St=!window.L_NO_TOUCH&&(Mt||wt),Tt=gt&&at,It=gt&&lt,At=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ct=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",h,e),window.removeEventListener("testPassiveEventSupport",h,e)}catch(t){}return t}(),Lt=!!document.createElement("canvas").getContext,Pt=!(!document.createElementNS||!$("svg").createSVGRect),Bt=!!Pt&&((K=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(K.firstChild&&K.firstChild.namespaceURI)),Et=!Pt&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function zt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Ot={ie:Q,ielt9:tt,edge:et,webkit:it,android:nt,android23:st,androidStock:ot,opera:at,chrome:ht,gecko:lt,safari:ct,phantom:ut,opera12:dt,win:ft,ie3d:pt,webkit3d:mt,gecko3d:yt,any3d:_t,mobile:gt,mobileWebkit:vt,mobileWebkit3d:bt,msPointer:xt,pointer:wt,touch:St,touchNative:Mt,mobileOpera:Tt,mobileGecko:It,retina:At,passiveEvents:Ct,canvas:Lt,svg:Pt,vml:Et,inlineSvg:Bt,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},kt=Ot.msPointer?"MSPointerDown":"pointerdown",Nt=Ot.msPointer?"MSPointerMove":"pointermove",Ft=Ot.msPointer?"MSPointerUp":"pointerup",Dt=Ot.msPointer?"MSPointerCancel":"pointercancel",Rt={touchstart:kt,touchmove:Nt,touchend:Ft,touchcancel:Dt},Ut={touchstart:function(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&De(e),Ht(t,e)},touchmove:Ht,touchend:Ht,touchcancel:Ht},Zt={},jt=!1;function Vt(t,e,i){return"touchstart"===e&&(jt||(document.addEventListener(kt,Wt,!0),document.addEventListener(Nt,Gt,!0),document.addEventListener(Ft,qt,!0),document.addEventListener(Dt,qt,!0),jt=!0)),Ut[e]?(i=Ut[e].bind(this,i),t.addEventListener(Rt[e],i,!1),i):(console.warn("wrong event specified:",e),h)}function Wt(t){Zt[t.pointerId]=t}function Gt(t){Zt[t.pointerId]&&(Zt[t.pointerId]=t)}function qt(t){delete Zt[t.pointerId]}function Ht(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var i in e.touches=[],Zt)e.touches.push(Zt[i]);e.changedTouches=[e],t(e)}}var Yt=200;var $t,Xt,Kt,Jt,Qt,te=ye(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ee=ye(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ie="webkitTransition"===ee||"OTransition"===ee?ee+"End":"transitionend";function ne(t){return"string"==typeof t?document.getElementById(t):t}function se(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);i=n?n[e]:null}return"auto"===i?null:i}function re(t,e,i){var n=document.createElement(t);return n.className=e||"",i&&i.appendChild(n),n}function oe(t){var e=t.parentNode;e&&e.removeChild(t)}function ae(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function he(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function le(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ce(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=pe(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function ue(t,e){if(void 0!==t.classList)for(var i=u(e),n=0,s=i.length;n<s;n++)t.classList.add(i[n]);else if(!ce(t,e)){var r=pe(t);fe(t,(r?r+" ":"")+e)}}function de(t,e){void 0!==t.classList?t.classList.remove(e):fe(t,c((" "+pe(t)+" ").replace(" "+e+" "," ")))}function fe(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function pe(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function me(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}(t,e)}function ye(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function _e(t,e,i){var n=e||new B(0,0);t.style[te]=(Ot.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")}function ge(t,e){t._leaflet_pos=e,Ot.any3d?_e(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function ve(t){return t._leaflet_pos||new B(0,0)}if("onselectstart"in document)$t=function(){Ce(window,"selectstart",De)},Xt=function(){Pe(window,"selectstart",De)};else{var be=ye(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);$t=function(){if(be){var t=document.documentElement.style;Kt=t[be],t[be]="none"}},Xt=function(){be&&(document.documentElement.style[be]=Kt,Kt=void 0)}}function xe(){Ce(window,"dragstart",De)}function we(){Pe(window,"dragstart",De)}function Me(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Se(),Jt=t,Qt=t.style.outline,t.style.outline="none",Ce(window,"keydown",Se))}function Se(){Jt&&(Jt.style.outline=Qt,Jt=void 0,Qt=void 0,Pe(window,"keydown",Se))}function Te(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function Ie(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Ae={__proto__:null,TRANSFORM:te,TRANSITION:ee,TRANSITION_END:ie,get:ne,getStyle:se,create:re,remove:oe,empty:ae,toFront:he,toBack:le,hasClass:ce,addClass:ue,removeClass:de,setClass:fe,getClass:pe,setOpacity:me,testProp:ye,setTransform:_e,setPosition:ge,getPosition:ve,get disableTextSelection(){return $t},get enableTextSelection(){return Xt},disableImageDrag:xe,enableImageDrag:we,preventOutline:Me,restoreOutline:Se,getSizedParentNode:Te,getScale:Ie};function Ce(t,e,i,n){if(e&&"object"==typeof e)for(var s in e)ze(t,s,e[s],i);else for(var r=0,o=(e=u(e)).length;r<o;r++)ze(t,e[r],i,n);return this}var Le="_leaflet_events";function Pe(t,e,i,n){if(1===arguments.length)Be(t),delete t[Le];else if(e&&"object"==typeof e)for(var s in e)Oe(t,s,e[s],i);else if(e=u(e),2===arguments.length)Be(t,(function(t){return-1!==_(e,t)}));else for(var r=0,o=e.length;r<o;r++)Oe(t,e[r],i,n);return this}function Be(t,e){for(var i in t[Le]){var n=i.split(/\d/)[0];e&&!e(n)||Oe(t,n,null,null,i)}}var Ee={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function ze(t,e,i,n){var s=e+r(i)+(n?"_"+r(n):"");if(t[Le]&&t[Le][s])return this;var o=function(e){return i.call(n||t,e||window.event)},a=o;!Ot.touchNative&&Ot.pointer&&0===e.indexOf("touch")?o=Vt(t,e,o):Ot.touch&&"dblclick"===e?o=function(t,e){t.addEventListener("dblclick",e);var i,n=0;function s(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var s=Ue(t);if(!s.some((function(t){return t instanceof HTMLLabelElement&&t.attributes.for}))||s.some((function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement}))){var r=Date.now();r-n<=Yt?2==++i&&e(function(t){var e,i,n={};for(i in t)e=t[i],n[i]=e&&e.bind?e.bind(t):e;return t=n,n.type="dblclick",n.detail=2,n.isTrusted=!1,n._simulated=!0,n}(t)):i=1,n=r}}}else i=t.detail}return t.addEventListener("click",s),{dblclick:e,simDblclick:s}}(t,o):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(Ee[e]||e,o,!!Ot.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(o=function(e){e=e||window.event,We(t,e)&&a(e)},t.addEventListener(Ee[e],o,!1)):t.addEventListener(e,a,!1):t.attachEvent("on"+e,o),t[Le]=t[Le]||{},t[Le][s]=o}function Oe(t,e,i,n,s){s=s||e+r(i)+(n?"_"+r(n):"");var o=t[Le]&&t[Le][s];if(!o)return this;!Ot.touchNative&&Ot.pointer&&0===e.indexOf("touch")?function(t,e,i){Rt[e]?t.removeEventListener(Rt[e],i,!1):console.warn("wrong event specified:",e)}(t,e,o):Ot.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,o):"removeEventListener"in t?t.removeEventListener(Ee[e]||e,o,!1):t.detachEvent("on"+e,o),t[Le][s]=null}function ke(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ne(t){return ze(t,"wheel",ke),this}function Fe(t){return Ce(t,"mousedown touchstart dblclick contextmenu",ke),t._leaflet_disable_click=!0,this}function De(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Re(t){return De(t),ke(t),this}function Ue(t){if(t.composedPath)return t.composedPath();for(var e=[],i=t.target;i;)e.push(i),i=i.parentNode;return e}function Ze(t,e){if(!e)return new B(t.clientX,t.clientY);var i=Ie(e),n=i.boundingClientRect;return new B((t.clientX-n.left)/i.x-e.clientLeft,(t.clientY-n.top)/i.y-e.clientTop)}var je=Ot.linux&&Ot.chrome?window.devicePixelRatio:Ot.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ve(t){return Ot.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/je:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function We(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t}var Ge={__proto__:null,on:Ce,off:Pe,stopPropagation:ke,disableScrollPropagation:Ne,disableClickPropagation:Fe,preventDefault:De,stop:Re,getPropagationPath:Ue,getMousePosition:Ze,getWheelDelta:Ve,isExternalTarget:We,addListener:Ce,removeListener:Pe},qe=P.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=ve(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=S(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),ge(this._el,i),this.fire("step")},_complete:function(){T(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),He=P.extend({options:{crs:H,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=d(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=n(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(R(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ee&&Ot.any3d&&!Ot.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ce(this._proxy,ie,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,i,n){return i=void 0===i?this._zoom:this._limitZoom(i),t=this._limitCenter(R(t),i,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&!0!==n&&(void 0!==n.animate&&(n.zoom=e({animate:n.animate},n.zoom),n.pan=e({animate:n.animate,duration:n.duration},n.pan)),this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,n.zoom):this._tryAnimatedPan(t,n.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,i,n.pan&&n.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Ot.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Ot.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),r=(t instanceof B?t:this.latLngToContainerPoint(t)).subtract(s).multiplyBy(1-1/n),o=this.containerPointToLatLng(s.add(r));return this.setView(o,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():F(t);var i=z(e.paddingTopLeft||e.padding||[0,0]),n=z(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));if((s="number"==typeof e.maxZoom?Math.min(e.maxZoom,s):s)===1/0)return{center:t.getCenter(),zoom:s};var r=n.subtract(i).divideBy(2),o=this.project(t.getSouthWest(),s),a=this.project(t.getNorthEast(),s);return{center:this.unproject(o.add(a).divideBy(2).add(r),s),zoom:s}},fitBounds:function(t,e){if(!(t=F(t)).isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=z(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new qe,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){ue(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){if(!1===(i=i||{}).animate||!Ot.any3d)return this.setView(t,e,i);this._stop();var n=this.project(this.getCenter()),s=this.project(t),r=this.getSize(),o=this._zoom;t=R(t),e=void 0===e?o:e;var a=Math.max(r.x,r.y),h=a*this.getZoomScale(o,e),l=s.distanceTo(n)||1,c=1.42,u=c*c;function d(t){var e=(h*h-a*a+(t?-1:1)*u*u*l*l)/(2*(t?h:a)*u*l),i=Math.sqrt(e*e+1)-e;return i<1e-9?-18:Math.log(i)}function f(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}var m=d(0);function y(t){return a*(p(m)*(f(e=m+c*t)/p(e))-f(m))/u;var e}var _=Date.now(),g=(d(1)-m)/c,v=i.duration?1e3*i.duration:1e3*g*.8;return this._moveStart(!0,i.noMoveStart),function i(){var r=(Date.now()-_)/v,h=function(t){return 1-Math.pow(1-t,1.5)}(r)*g;r<=1?(this._flyToFrame=S(i,this),this._move(this.unproject(n.add(s.subtract(n).multiplyBy(y(h)/l)),o),this.getScaleZoom(a/function(t){return a*(p(m)/p(m+c*t))}(h),o),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=F(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,F(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},panInside:function(t,e){var i=z((e=e||{}).paddingTopLeft||e.padding||[0,0]),n=z(e.paddingBottomRight||e.padding||[0,0]),s=this.project(this.getCenter()),r=this.project(t),o=this.getPixelBounds(),a=k([o.min.add(i),o.max.subtract(n)]),h=a.getSize();if(!a.contains(r)){this._enforcingBounds=!0;var l=r.subtract(a.getCenter()),c=a.extend(r).getSize().subtract(h);s.x+=l.x<0?-c.x:c.x,s.y+=l.y<0?-c.y:c.y,this.panTo(this.unproject(s),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},!0===t?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var s=this.getSize(),r=i.divideBy(2).round(),o=s.divideBy(2).round(),a=r.subtract(o);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(n(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:s})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var i=n(this._handleGeolocationResponse,this),s=n(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(i,s,t):navigator.geolocation.getCurrentPosition(i,s,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new D(t.coords.latitude,t.coords.longitude),i=e.toBounds(2*t.coords.accuracy),n=this._locateOptions;if(n.setView){var s=this.getBoundsZoom(i);this.setView(e,n.maxZoom?Math.min(s,n.maxZoom):s)}var r={latlng:e,bounds:i,timestamp:t.timestamp};for(var o in t.coords)"number"==typeof t.coords[o]&&(r[o]=t.coords[o]);this.fire("locationfound",r)}},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),oe(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(T(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)oe(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i=re("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new N(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=F(t),i=z(i||[0,0]);var n=this.getZoom()||0,s=this.getMinZoom(),r=this.getMaxZoom(),o=t.getNorthWest(),a=t.getSouthEast(),h=this.getSize().subtract(i),l=k(this.project(a,n),this.project(o,n)).getSize(),c=Ot.any3d?this.options.zoomSnap:1,u=h.x/l.x,d=h.y/l.y,f=e?Math.max(u,d):Math.min(u,d);return n=this.getScaleZoom(f,n),c&&(n=Math.round(n/(c/100))*(c/100),n=e?Math.ceil(n/c)*c:Math.floor(n/c)*c),Math.max(s,Math.min(r,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new B(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new O(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;var n=i.zoom(t*i.scale(e));return isNaN(n)?1/0:n},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(R(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(z(t),e)},layerPointToLatLng:function(t){var e=z(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(R(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(R(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(F(t))},distance:function(t,e){return this.options.crs.distance(R(t),R(e))},containerPointToLayerPoint:function(t){return z(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return z(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(z(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(R(t)))},mouseEventToContainerPoint:function(t){return Ze(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=ne(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");Ce(e,"scroll",this._onScroll,this),this._containerId=r(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ot.any3d,ue(t,"leaflet-container"+(Ot.touch?" leaflet-touch":"")+(Ot.retina?" leaflet-retina":"")+(Ot.ielt9?" leaflet-oldie":"")+(Ot.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=se(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ge(this._mapPane,new B(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ue(t.markerPane,"leaflet-zoom-hide"),ue(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,i){ge(this._mapPane,new B(0,0));var n=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var s=this._zoom!==e;this._moveStart(s,i)._move(t,e)._moveEnd(s),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i,n){void 0===e&&(e=this._zoom);var s=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),n?i&&i.pinch&&this.fire("zoom",i):((s||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return T(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ge(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[r(this._container)]=this;var e=t?Pe:Ce;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Ot.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){T(this._resizeRequest),this._resizeRequest=S((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],s="mouseout"===e||"mouseover"===e,o=t.target||t.srcElement,a=!1;o;){if((i=this._targets[r(o)])&&("click"===e||"preclick"===e)&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(s&&!We(o,t))break;if(n.push(i),s)break}if(o===this._container)break;o=o.parentNode}return n.length||a||s||!this.listens(e,!0)||(n=[this]),n},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var i=t.type;"mousedown"===i&&Me(e),this._fireDOMEvent(t,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,i,n){if("click"===t.type){var s=e({},t);s.type="preclick",this._fireDOMEvent(s,s.type,n)}var r=this._findEventTargets(t,i);if(n){for(var o=[],a=0;a<n.length;a++)n[a].listens(i,!0)&&o.push(n[a]);r=o.concat(r)}if(r.length){"contextmenu"===i&&De(t);var h=r[0],l={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var c=h.getLatLng&&(!h._radius||h._radius<=10);l.containerPoint=c?this.latLngToContainerPoint(h.getLatLng()):this.mouseEventToContainerPoint(t),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=c?h.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(a=0;a<r.length;a++)if(r[a].fire(i,l,!0),l.originalEvent._stopped||!1===r[a].options.bubblingMouseEvents&&-1!==_(this._mouseEvents,i))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return ve(this._mapPane)||new B(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return k([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),r=new O(n.subtract(s),n.add(s)),o=this._getBoundsOffset(r,i,e);return Math.abs(o.x)<=1&&Math.abs(o.y)<=1?t:this.unproject(n.add(o),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new O(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=k(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),s=n.min.subtract(t.min),r=n.max.subtract(t.max);return new B(this._rebound(s.x,-r.x),this._rebound(s.y,-r.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=Ot.any3d?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){de(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(i)||(this.panBy(i,e),0))},_createAnimProxy:function(){var t=this._proxy=re("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",(function(t){var e=te,i=this._proxy.style[e];_e(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){oe(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();_e(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n);return!(!0!==i.animate&&!this.getSize().contains(s)||(S((function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)}),this),0))},_animateZoom:function(t,e,i,s){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,ue(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:s}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(n(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&de(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var Ye=A.extend({options:{position:"topright"},initialize:function(t){d(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return ue(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(oe(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),$e=function(t){return new Ye(t)};He.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=re("div",e+"control-container",this._container);function n(n,s){var r=e+n+" "+e+s;t[n+s]=re("div",r,i)}n("top","left"),n("top","right"),n("bottom","left"),n("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)oe(this._controlCorners[t]);oe(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Xe=Ye.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){for(var n in d(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Ye.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(r(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){ue(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(ue(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):de(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return de(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=re("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Fe(e),Ne(e);var n=this._section=re("section",t+"-list");i&&(this._map.on("click",this.collapse,this),Ce(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var s=this._layersLink=re("a",t+"-toggle",e);s.href="#",s.title="Layers",s.setAttribute("role","button"),Ce(s,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){De(t),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=re("div",t+"-base",n),this._separator=re("div",t+"-separator",n),this._overlaysList=re("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&r(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(n((function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)}),this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ae(this._baseLayersList),ae(this._overlaysList),this._layerControlInputs=[];var t,e,i,n,s=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,s+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(r(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",n=document.createElement("div");return n.innerHTML=i,n.firstChild},_addItem:function(t){var e,i=document.createElement("label"),n=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=n):e=this._createRadioElement("leaflet-base-layers_"+r(this),n),this._layerControlInputs.push(e),e.layerId=r(t.layer),Ce(e,"click",this._onInputClick,this);var s=document.createElement("span");s.innerHTML=" "+t.name;var o=document.createElement("span");return i.appendChild(o),o.appendChild(e),o.appendChild(s),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){var t,e,i=this._layerControlInputs,n=[],s=[];this._handlingClick=!0;for(var r=i.length-1;r>=0;r--)t=i[r],e=this._getLayer(t.layerId).layer,t.checked?n.push(e):t.checked||s.push(e);for(r=0;r<s.length;r++)this._map.hasLayer(s[r])&&this._map.removeLayer(s[r]);for(r=0;r<n.length;r++)this._map.hasLayer(n[r])||this._map.addLayer(n[r]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,n=this._map.getZoom(),s=i.length-1;s>=0;s--)t=i[s],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&n<e.options.minZoom||void 0!==e.options.maxZoom&&n>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;Ce(t,"click",De),this.expand(),setTimeout((function(){Pe(t,"click",De)}))}}),Ke=Ye.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=re("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,s){var r=re("a",i,n);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),Fe(r),Ce(r,"click",Re),Ce(r,"click",s,this),Ce(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";de(this._zoomInButton,e),de(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(ue(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(ue(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});He.mergeOptions({zoomControl:!0}),He.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new Ke,this.addControl(this.zoomControl))}));var Je=Ye.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=re("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=re("div",e,i)),t.imperial&&(this._iScale=re("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,s=3.2808399*t;s>5280?(e=s/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(s),this._updateScale(this._iScale,n+" ft",n/s))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)}}),Qe=Ye.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ot.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(t){d(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=re("div","leaflet-control-attribution"),Fe(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",(function(){this.removeAttribution(t.layer.getAttribution())}),this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});He.mergeOptions({attributionControl:!0}),He.addInitHook((function(){this.options.attributionControl&&(new Qe).addTo(this)}));Ye.Layers=Xe,Ye.Zoom=Ke,Ye.Scale=Je,Ye.Attribution=Qe,$e.layers=function(t,e,i){return new Xe(t,e,i)},$e.zoom=function(t){return new Ke(t)},$e.scale=function(t){return new Je(t)},$e.attribution=function(t){return new Qe(t)};var ti=A.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ti.addTo=function(t,e){return t.addHandler(e,this),this};var ei,ii={Events:C},ni=Ot.touch?"touchstart mousedown":"mousedown",si=P.extend({options:{clickTolerance:3},initialize:function(t,e,i,n){d(this,n),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(Ce(this._dragStartTarget,ni,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(si._dragging===this&&this.finishDrag(!0),Pe(this._dragStartTarget,ni,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ce(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)si._dragging===this&&this.finishDrag();else if(!(si._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(si._dragging=this,this._preventOutline&&Me(this._element),xe(),$t(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,i=Te(this._element);this._startPoint=new B(e.clientX,e.clientY),this._startPos=ve(this._element),this._parentScale=Ie(i);var n="mousedown"===t.type;Ce(document,n?"mousemove":"touchmove",this._onMove,this),Ce(document,n?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new B(e.clientX,e.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,De(t),this._moved||(this.fire("dragstart"),this._moved=!0,ue(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ue(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ge(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){de(document.body,"leaflet-dragging"),this._lastTarget&&(de(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Pe(document,"mousemove touchmove",this._onMove,this),Pe(document,"mouseup touchend touchcancel",this._onUp,this),we(),Xt(),this._moved&&this._moving&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,si._dragging=!1}});function ri(t,e){if(!e||!t.length)return t.slice();var i=e*e;return function(t,e){var i=t.length,n=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);n[0]=n[i-1]=1,ai(t,n,e,0,i-1);var s,r=[];for(s=0;s<i;s++)n[s]&&r.push(t[s]);return r}(t=function(t,e){for(var i=[t[0]],n=1,s=0,r=t.length;n<r;n++)ui(t[n],t[s])>e&&(i.push(t[n]),s=n);return s<r-1&&i.push(t[r-1]),i}(t,i),i)}function oi(t,e,i){return Math.sqrt(di(t,e,i,!0))}function ai(t,e,i,n,s){var r,o,a,h=0;for(o=n+1;o<=s-1;o++)(a=di(t[o],t[n],t[s],!0))>h&&(r=o,h=a);h>i&&(e[r]=1,ai(t,e,i,n,r),ai(t,e,i,r,s))}function hi(t,e,i,n,s){var r,o,a,h=n?ei:ci(t,i),l=ci(e,i);for(ei=l;;){if(!(h|l))return[t,e];if(h&l)return!1;a=ci(o=li(t,e,r=h||l,i,s),i),r===h?(t=o,h=a):(e=o,l=a)}}function li(t,e,i,n,s){var r,o,a=e.x-t.x,h=e.y-t.y,l=n.min,c=n.max;return 8&i?(r=t.x+a*(c.y-t.y)/h,o=c.y):4&i?(r=t.x+a*(l.y-t.y)/h,o=l.y):2&i?(r=c.x,o=t.y+h*(c.x-t.x)/a):1&i&&(r=l.x,o=t.y+h*(l.x-t.x)/a),new B(r,o,s)}function ci(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function ui(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function di(t,e,i,n){var s,r=e.x,o=e.y,a=i.x-r,h=i.y-o,l=a*a+h*h;return l>0&&((s=((t.x-r)*a+(t.y-o)*h)/l)>1?(r=i.x,o=i.y):s>0&&(r+=a*s,o+=h*s)),a=t.x-r,h=t.y-o,n?a*a+h*h:new B(r,o)}function fi(t){return!y(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function pi(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),fi(t)}function mi(t,e){var i,n,s,r,o,a,h,l;if(!t||0===t.length)throw new Error("latlngs not passed");fi(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var c=[];for(var u in t)c.push(e.project(R(t[u])));var d=c.length;for(i=0,n=0;i<d-1;i++)n+=c[i].distanceTo(c[i+1])/2;if(0===n)l=c[0];else for(i=0,r=0;i<d-1;i++)if(o=c[i],a=c[i+1],(r+=s=o.distanceTo(a))>n){h=(r-n)/s,l=[a.x-h*(a.x-o.x),a.y-h*(a.y-o.y)];break}return e.unproject(z(l))}var yi={__proto__:null,simplify:ri,pointToSegmentDistance:oi,closestPointOnSegment:function(t,e,i){return di(t,e,i)},clipSegment:hi,_getEdgeIntersection:li,_getBitCode:ci,_sqClosestPointOnSegment:di,isFlat:fi,_flat:pi,polylineCenter:mi};function _i(t,e,i){var n,s,r,o,a,h,l,c,u,d=[1,4,2,8];for(s=0,l=t.length;s<l;s++)t[s]._code=ci(t[s],e);for(o=0;o<4;o++){for(c=d[o],n=[],s=0,r=(l=t.length)-1;s<l;r=s++)a=t[s],h=t[r],a._code&c?h._code&c||((u=li(h,a,c,e,i))._code=ci(u,e),n.push(u)):(h._code&c&&((u=li(h,a,c,e,i))._code=ci(u,e),n.push(u)),n.push(a));t=n}return t}function gi(t,e){var i,n,s,r,o,a,h,l,c;if(!t||0===t.length)throw new Error("latlngs not passed");fi(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var u=[];for(var d in t)u.push(e.project(R(t[d])));var f=u.length;for(a=h=l=0,i=0,n=f-1;i<f;n=i++)s=u[i],r=u[n],o=s.y*r.x-r.y*s.x,h+=(s.x+r.x)*o,l+=(s.y+r.y)*o,a+=3*o;return c=0===a?u[0]:[h/a,l/a],e.unproject(z(c))}var vi={__proto__:null,clipPolygon:_i,polygonCenter:gi},bi={project:function(t){return new B(t.lng,t.lat)},unproject:function(t){return new D(t.y,t.x)},bounds:new O([-180,-90],[180,90])},xi={R:6378137,R_MINOR:6356752.314245179,bounds:new O([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),o=r*Math.sin(n),a=Math.tan(Math.PI/4-n/2)/Math.pow((1-o)/(1+o),r/2);return n=-i*Math.log(Math.max(a,1e-10)),new B(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,s=this.R_MINOR/n,r=Math.sqrt(1-s*s),o=Math.exp(-t.y/n),a=Math.PI/2-2*Math.atan(o),h=0,l=.1;h<15&&Math.abs(l)>1e-7;h++)e=r*Math.sin(a),e=Math.pow((1-e)/(1+e),r/2),a+=l=Math.PI/2-2*Math.atan(o*e)-a;return new D(a*i,t.x*i/n)}},wi={__proto__:null,LonLat:bi,Mercator:xi,SphericalMercator:W},Mi=e({},j,{code:"EPSG:3395",projection:xi,transformation:function(){var t=.5/(Math.PI*xi.R);return q(t,.5,-t,.5)}()}),Si=e({},j,{code:"EPSG:4326",projection:bi,transformation:q(1/180,1,-1/180,.5)}),Ti=e({},Z,{projection:bi,transformation:q(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0});Z.Earth=j,Z.EPSG3395=Mi,Z.EPSG3857=H,Z.EPSG900913=Y,Z.EPSG4326=Si,Z.Simple=Ti;var Ii=P.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[r(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[r(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",(function(){e.off(i,this)}),this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});He.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=r(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=r(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return r(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var e=0,i=(t=t?y(t)?t:[t]:[]).length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[r(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=r(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var n in this._zoomBoundLayers){var s=this._zoomBoundLayers[n].options;t=void 0===s.minZoom?t:Math.min(t,s.minZoom),e=void 0===s.maxZoom?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ai=Ii.extend({initialize:function(t,e){var i,n;if(d(this,e),this._layers={},t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,n);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return r(t)}}),Ci=Ai.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ai.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ai.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new N;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),Li=A.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){d(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var s=z(n),r=z("shadow"===e&&i.shadowAnchor||i.iconAnchor||s&&s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Ot.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});var Pi=Li.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof Pi.imagePath&&(Pi.imagePath=this._detectIconPath()),(this.options.imagePath||Pi.imagePath)+Li.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,i){var n=e.exec(t);return n&&n[i]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=re("div","leaflet-default-icon-path",document.body),e=se(t,"background-image")||se(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),Bi=ti.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new si(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ue(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&de(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,n=this._marker.options.autoPanSpeed,s=this._marker.options.autoPanPadding,r=ve(e._icon),o=i.getPixelBounds(),a=i.getPixelOrigin(),h=k(o.min._subtract(a).add(s),o.max._subtract(a).subtract(s));if(!h.contains(r)){var l=z((Math.max(h.max.x,r.x)-h.max.x)/(o.max.x-h.max.x)-(Math.min(h.min.x,r.x)-h.min.x)/(o.min.x-h.min.x),(Math.max(h.max.y,r.y)-h.max.y)/(o.max.y-h.max.y)-(Math.min(h.min.y,r.y)-h.min.y)/(o.min.y-h.min.y)).multiplyBy(n);i.panBy(l,{animate:!1}),this._draggable._newPos._add(l),this._draggable._startPos._add(l),ge(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=S(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(T(this._panRequest),this._panRequest=S(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,n=ve(e._icon),s=e._map.layerPointToLatLng(n);i&&ge(i,n),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){T(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Ei=Ii.extend({options:{icon:new Pi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){d(this,e),this._latlng=R(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=R(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),ue(i,e),t.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ce(i,"focus",this._panOnFocus,this);var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&&(this._removeShadow(),r=!0),s&&(ue(s,e),s.alt=""),this._shadow=s,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&r&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Pe(this._icon,"focus",this._panOnFocus,this),oe(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&oe(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&ge(this._icon,t),this._shadow&&ge(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(ue(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Bi)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Bi(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&me(this._icon,t),this._shadow&&me(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,i=e.iconSize?z(e.iconSize):z(0,0),n=e.iconAnchor?z(e.iconAnchor):z(0,0);t.panInside(this._latlng,{paddingTopLeft:n,paddingBottomRight:i.subtract(n)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var zi=Ii.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return d(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Oi=zi.extend({options:{fill:!0,radius:10},initialize:function(t,e){d(this,e),this._latlng=R(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=R(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return zi.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new O(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var ki=Oi.extend({initialize:function(t,i,n){if("number"==typeof i&&(i=e({},n,{radius:i})),d(this,i),this._latlng=R(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new N(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:zi.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===j.distance){var s=Math.PI/180,r=this._mRadius/j.R/s,o=i.project([e+r,t]),a=i.project([e-r,t]),h=o.add(a).divideBy(2),l=i.unproject(h).lat,c=Math.acos((Math.cos(r*s)-Math.sin(e*s)*Math.sin(l*s))/(Math.cos(e*s)*Math.cos(l*s)))/s;(isNaN(c)||0===c)&&(c=r/Math.cos(Math.PI/180*e)),this._point=h.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:h.x-i.project([l,t-c]).x,this._radiusY=h.y-o.y}else{var u=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(u).x}this._updateBounds()}});var Ni=zi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){d(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,s=null,r=di,o=0,a=this._parts.length;o<a;o++)for(var h=this._parts[o],l=1,c=h.length;l<c;l++){var u=r(t,e=h[l-1],i=h[l],!0);u<n&&(n=u,s=r(t,e,i))}return s&&(s.distance=Math.sqrt(n)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return mi(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=R(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new N,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return fi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=fi(t),n=0,s=t.length;n<s;n++)i?(e[n]=R(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new O;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new B(t,t);this._rawPxBounds&&(this._pxBounds=new O([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,i){var n,s,r=t[0]instanceof D,o=t.length;if(r){for(s=[],n=0;n<o;n++)s[n]=this._map.latLngToLayerPoint(t[n]),i.extend(s[n]);e.push(s)}else for(n=0;n<o;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,i,n,s,r,o,a,h=this._parts;for(e=0,n=0,s=this._rings.length;e<s;e++)for(i=0,r=(a=this._rings[e]).length;i<r-1;i++)(o=hi(a[i],a[i+1],t,i,!0))&&(h[n]=h[n]||[],h[n].push(o[0]),o[1]===a[i+1]&&i!==r-2||(h[n].push(o[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=ri(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,n,s,r,o,a,h=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,r=this._parts.length;i<r;i++)for(n=0,s=(o=(a=this._parts[i]).length)-1;n<o;s=n++)if((e||0!==n)&&oi(t,a[s],a[n])<=h)return!0;return!1}});Ni._flat=pi;var Fi=Ni.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return gi(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=Ni.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof D&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){Ni.prototype._setLatLngs.call(this,t),fi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return fi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new B(e,e);if(t=new O(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var n,s=0,r=this._rings.length;s<r;s++)(n=_i(this._rings[s],t,!0)).length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,n,s,r,o,a,h,l=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(s=0,a=this._parts.length;s<a;s++)for(r=0,o=(h=(e=this._parts[s]).length)-1;r<h;o=r++)i=e[r],n=e[o],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(l=!l);return l||Ni.prototype._containsPoint.call(this,t,!0)}});var Di=Ci.extend({initialize:function(t,e){d(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=y(t)?t:t.features;if(s){for(e=0,i=s.length;e<i;e++)((n=s[e]).geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var o=Ri(t,r);return o?(o.feature=qi(t),o.defaultOptions=o.options,this.resetStyle(o),r.onEachFeature&&r.onEachFeature(t,o),this.addLayer(o)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer((function(e){this._setLayerStyle(e,t)}),this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function Ri(t,e){var i,n,s,r,o="Feature"===t.type?t.geometry:t,a=o?o.coordinates:null,h=[],l=e&&e.pointToLayer,c=e&&e.coordsToLatLng||Zi;if(!a&&!o)return null;switch(o.type){case"Point":return Ui(l,t,i=c(a),e);case"MultiPoint":for(s=0,r=a.length;s<r;s++)i=c(a[s]),h.push(Ui(l,t,i,e));return new Ci(h);case"LineString":case"MultiLineString":return n=ji(a,"LineString"===o.type?0:1,c),new Ni(n,e);case"Polygon":case"MultiPolygon":return n=ji(a,"Polygon"===o.type?1:2,c),new Fi(n,e);case"GeometryCollection":for(s=0,r=o.geometries.length;s<r;s++){var u=Ri({geometry:o.geometries[s],type:"Feature",properties:t.properties},e);u&&h.push(u)}return new Ci(h);case"FeatureCollection":for(s=0,r=o.features.length;s<r;s++){var d=Ri(o.features[s],e);d&&h.push(d)}return new Ci(h);default:throw new Error("Invalid GeoJSON object.")}}function Ui(t,e,i,n){return t?t(e,i):new Ei(i,n&&n.markersInheritOptions&&n)}function Zi(t){return new D(t[1],t[0],t[2])}function ji(t,e,i){for(var n,s=[],r=0,o=t.length;r<o;r++)n=e?ji(t[r],e-1,i):(i||Zi)(t[r]),s.push(n);return s}function Vi(t,e){return void 0!==(t=R(t)).alt?[l(t.lng,e),l(t.lat,e),l(t.alt,e)]:[l(t.lng,e),l(t.lat,e)]}function Wi(t,e,i,n){for(var s=[],r=0,o=t.length;r<o;r++)s.push(e?Wi(t[r],fi(t[r])?0:e-1,i,n):Vi(t[r],n));return!e&&i&&s.push(s[0].slice()),s}function Gi(t,i){return t.feature?e({},t.feature,{geometry:i}):qi(i)}function qi(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Hi={toGeoJSON:function(t){return Gi(this,{type:"Point",coordinates:Vi(this.getLatLng(),t)})}};function Yi(t,e){return new Di(t,e)}Ei.include(Hi),ki.include(Hi),Oi.include(Hi),Ni.include({toGeoJSON:function(t){var e=!fi(this._latlngs);return Gi(this,{type:(e?"Multi":"")+"LineString",coordinates:Wi(this._latlngs,e?1:0,!1,t)})}}),Fi.include({toGeoJSON:function(t){var e=!fi(this._latlngs),i=e&&!fi(this._latlngs[0]),n=Wi(this._latlngs,i?2:e?1:0,!0,t);return e||(n=[n]),Gi(this,{type:(i?"Multi":"")+"Polygon",coordinates:n})}}),Ai.include({toMultiPoint:function(t){var e=[];return this.eachLayer((function(i){e.push(i.toGeoJSON(t).geometry.coordinates)})),Gi(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var i="GeometryCollection"===e,n=[];return this.eachLayer((function(e){if(e.toGeoJSON){var s=e.toGeoJSON(t);if(i)n.push(s.geometry);else{var r=qi(s);"FeatureCollection"===r.type?n.push.apply(n,r.features):n.push(r)}}})),i?Gi(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}});var $i=Yi,Xi=Ii.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=F(e),d(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ue(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){oe(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&he(this._image),this},bringToBack:function(){return this._map&&le(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=F(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:re("img");ue(e,"leaflet-image-layer"),this._zoomAnimated&&ue(e,"leaflet-zoom-animated"),this.options.className&&ue(e,this.options.className),e.onselectstart=h,e.onmousemove=h,e.onload=n(this.fire,this,"load"),e.onerror=n(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;_e(this._image,i,e)},_reset:function(){var t=this._image,e=new O(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();ge(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){me(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Ki=Xi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:re("video");if(ue(e,"leaflet-image-layer"),this._zoomAnimated&&ue(e,"leaflet-zoom-animated"),this.options.className&&ue(e,this.options.className),e.onselectstart=h,e.onmousemove=h,e.onloadeddata=n(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),s=[],r=0;r<i.length;r++)s.push(i[r].src);this._url=i.length>0?s:[e.src]}else{y(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var o=0;o<this._url.length;o++){var a=re("source");a.src=this._url[o],e.appendChild(a)}}}});var Ji=Xi.extend({_initImage:function(){var t=this._image=this._url;ue(t,"leaflet-image-layer"),this._zoomAnimated&&ue(t,"leaflet-zoom-animated"),this.options.className&&ue(t,this.options.className),t.onselectstart=h,t.onmousemove=h}});var Qi=Ii.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof D||y(t))?(this._latlng=R(t),d(this,e)):(d(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&me(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&me(this._container,1),this.bringToFront(),this.options.interactive&&(ue(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(me(this._container,0),this._removeTimeout=setTimeout(n(oe,void 0,this._container),200)):oe(this._container),this.options.interactive&&(de(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=R(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&he(this._container),this},bringToBack:function(){return this._map&&le(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Ci){e=null;var i=this._source._layers;for(var n in i)if(i[n]._map){e=i[n];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=z(this.options.offset),i=this._getAnchor();this._zoomAnimated?ge(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}});He.include({_initOverlay:function(t,e,i,n){var s=e;return s instanceof t||(s=new t(n).setContent(e)),i&&s.setLatLng(i),s}}),Ii.include({_initOverlay:function(t,e,i,n){var s=i;return s instanceof t?(d(s,n),s._source=this):(s=e&&!n?e:new t(n,this)).setContent(i),s}});var tn=Qi.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Qi.prototype.openOn.call(this,t)},onAdd:function(t){Qi.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof zi||this._source.on("preclick",ke))},onRemove:function(t){Qi.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof zi||this._source.off("preclick",ke))},getEvents:function(){var t=Qi.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=re("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=re("div",t+"-content-wrapper",e);if(this._contentNode=re("div",t+"-content",i),Fe(e),Ne(this._contentNode),Ce(e,"contextmenu",ke),this._tipContainer=re("div",t+"-tip-container",e),this._tip=re("div",t+"-tip",this._tipContainer),this.options.closeButton){var n=this._closeButton=re("a",t+"-close-button",e);n.setAttribute("role","button"),n.setAttribute("aria-label","Close popup"),n.href="#close",n.innerHTML='<span aria-hidden="true">&#215;</span>',Ce(n,"click",(function(t){De(t),this.close()}),this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,r="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",ue(t,r)):de(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();ge(this._container,e.add(i))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(se(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,s=new B(this._containerLeft,-i-this._containerBottom);s._add(ve(this._container));var r=t.layerPointToContainerPoint(s),o=z(this.options.autoPanPadding),a=z(this.options.autoPanPaddingTopLeft||o),h=z(this.options.autoPanPaddingBottomRight||o),l=t.getSize(),c=0,u=0;r.x+n+h.x>l.x&&(c=r.x+n-l.x+h.x),r.x-c-a.x<0&&(c=r.x-a.x),r.y+i+h.y>l.y&&(u=r.y+i-l.y+h.y),r.y-u-a.y<0&&(u=r.y-a.y),(c||u)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([c,u]))}},_getAnchor:function(){return z(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});He.mergeOptions({closePopupOnClick:!0}),He.include({openPopup:function(t,e,i){return this._initOverlay(tn,t,e,i).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Ii.include({bindPopup:function(t,e){return this._popup=this._initOverlay(tn,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Ci||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Re(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof zi?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var en=Qi.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Qi.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Qi.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Qi.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=re("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+r(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,i,n=this._map,s=this._container,r=n.latLngToContainerPoint(n.getCenter()),o=n.layerPointToContainerPoint(t),a=this.options.direction,h=s.offsetWidth,l=s.offsetHeight,c=z(this.options.offset),u=this._getAnchor();"top"===a?(e=h/2,i=l):"bottom"===a?(e=h/2,i=0):"center"===a?(e=h/2,i=l/2):"right"===a?(e=0,i=l/2):"left"===a?(e=h,i=l/2):o.x<r.x?(a="right",e=0,i=l/2):(a="left",e=h+2*(c.x+u.x),i=l/2),t=t.subtract(z(e,i,!0)).add(c).add(u),de(s,"leaflet-tooltip-right"),de(s,"leaflet-tooltip-left"),de(s,"leaflet-tooltip-top"),de(s,"leaflet-tooltip-bottom"),ue(s,"leaflet-tooltip-"+a),ge(s,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&me(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return z(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});He.include({openTooltip:function(t,e,i){return this._initOverlay(en,t,e,i).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Ii.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(en,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Ci||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e=t.getElement();e&&(Ce(e,"focus",(function(){this._tooltip._source=t,this.openTooltip()}),this),Ce(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e=t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0))},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}});var nn=Li.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),i=this.options;if(i.html instanceof Element?(ae(e),e.appendChild(i.html)):e.innerHTML=!1!==i.html?i.html:"",i.bgPos){var n=z(i.bgPos);e.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Li.Default=Pi;var sn=Ii.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ot.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){d(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),oe(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(he(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(le(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof B?t:new B(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-1/0,1/0),s=0,r=i.length;s<r;s++)e=i[s].style.zIndex,i[s]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ot.ielt9){me(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var s=this._tiles[n];if(s.current&&s.loaded){var r=Math.min(1,(t-s.loaded)/200);me(s.el,r),r<1?e=!0:(s.active?i=!0:this._onOpaqueTile(s),s.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(T(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this))}},_onOpaqueTile:h,_initContainer:function(){this._container||(this._container=re("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(oe(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var n=this._levels[t],s=this._map;return n||((n=this._levels[t]={}).el=re("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=e,n.origin=s.project(s.unproject(s.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,s.getCenter(),s.getZoom()),n.el.offsetWidth,this._onCreateLevel(n)),this._level=n,n}},_onUpdateLevel:h,_onRemoveLevel:h,_onCreateLevel:h,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)oe(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,n){var s=Math.floor(t/2),r=Math.floor(e/2),o=i-1,a=new B(+s,+r);a.z=+o;var h=this._tileCoordsToKey(a),l=this._tiles[h];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),o>n&&this._retainParent(s,r,o,n))},_retainChildren:function(t,e,i,n){for(var s=2*t;s<2*t+2;s++)for(var r=2*e;r<2*e+2;r++){var o=new B(s,r);o.z=i+1;var a=this._tileCoordsToKey(o),h=this._tiles[a];h&&h.active?h.retain=!0:(h&&h.loaded&&(h.retain=!0),i+1<n&&this._retainChildren(s,r,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,n){var s=Math.round(e);s=void 0!==this.options.maxZoom&&s>this.options.maxZoom||void 0!==this.options.minZoom&&s<this.options.minZoom?void 0:this._clampZoom(s);var r=this.options.updateWhenZooming&&s!==this._tileZoom;n&&!r||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==s&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),s=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();Ot.any3d?_e(t.el,s,n):ge(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,s=this._map.getPixelWorldBounds(this._tileZoom);s&&(this._globalTileRange=this._pxBoundsToTileRange(s)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),s=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*n);return new O(s.subtract(r),s.add(r))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var n=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(n),r=s.getCenter(),o=[],a=this.options.keepBuffer,h=new O(s.getBottomLeft().subtract([a,-a]),s.getTopRight().add([a,-a]));if(!(isFinite(s.min.x)&&isFinite(s.min.y)&&isFinite(s.max.x)&&isFinite(s.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var l in this._tiles){var c=this._tiles[l].coords;c.z===this._tileZoom&&h.contains(new B(c.x,c.y))||(this._tiles[l].current=!1)}if(Math.abs(i-this._tileZoom)>1)this._setView(t,i);else{for(var u=s.min.y;u<=s.max.y;u++)for(var d=s.min.x;d<=s.max.x;d++){var f=new B(d,u);if(f.z=this._tileZoom,this._isValidTile(f)){var p=this._tiles[this._tileCoordsToKey(f)];p?p.current=!0:o.push(f)}}if(o.sort((function(t,e){return t.distanceTo(r)-e.distanceTo(r)})),0!==o.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(d=0;d<o.length;d++)this._addTile(o[d],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return F(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),s=n.add(i);return[e.unproject(n,t.z),e.unproject(s,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new N(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new B(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(oe(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){ue(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=h,t.onmousemove=h,Ot.ielt9&&this.options.opacity<1&&me(t,this.options.opacity)},_addTile:function(t,e){var i=this._getTilePos(t),s=this._tileCoordsToKey(t),r=this.createTile(this._wrapCoords(t),n(this._tileReady,this,t));this._initTile(r),this.createTile.length<2&&S(n(this._tileReady,this,t,null,r)),ge(r,i),this._tiles[s]={el:r,coords:t,current:!0},e.appendChild(r),this.fire("tileloadstart",{tile:r,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var s=this._tileCoordsToKey(t);(i=this._tiles[s])&&(i.loaded=+new Date,this._map._fadeAnimated?(me(i.el,0),T(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(ue(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ot.ielt9||!this._map._fadeAnimated?S(this._pruneTiles,this):setTimeout(n(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new B(this._wrapX?a(t.x,this._wrapX):t.x,this._wrapY?a(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new O(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});var rn=sn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=d(this,e)).detectRetina&&Ot.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return Ce(i,"load",n(this._tileOnLoad,this,e,i)),Ce(i,"error",n(this._tileOnError,this,e,i)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(t),i},getTileUrl:function(t){var i={r:Ot.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=n),i["-y"]=n}return m(this._url,e(i,this.options))},_tileOnLoad:function(t,e){Ot.ielt9?setTimeout(n(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.getAttribute("src")!==n&&(e.src=n),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=h,e.onerror=h,!e.complete)){e.src=g;var i=this._tiles[t].coords;oe(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:i})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",g),sn.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(this._map&&(!i||i.getAttribute("src")!==g))return sn.prototype._tileReady.call(this,t,e,i)}});function on(t,e){return new rn(t,e)}var an=rn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,i){this._url=t;var n=e({},this.defaultWmsParams);for(var s in i)s in this.options||(n[s]=i[s]);var r=(i=d(this,i)).detectRetina&&Ot.retina?2:1,o=this.getTileSize();n.width=o.x*r,n.height=o.y*r,this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,rn.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,n=k(i.project(e[0]),i.project(e[1])),s=n.min,r=n.max,o=(this._wmsVersion>=1.3&&this._crs===Si?[s.y,s.x,r.y,r.x]:[s.x,s.y,r.x,r.y]).join(","),a=rn.prototype.getTileUrl.call(this,t);return a+f(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+o},setParams:function(t,i){return e(this.wmsParams,t),i||this.redraw(),this}});rn.WMS=an,on.wms=function(t,e){return new an(t,e)};var hn=Ii.extend({options:{padding:.1},initialize:function(t){d(this,t),r(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&ue(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),r=n.multiplyBy(-i).add(s).subtract(this._map._getNewPixelOrigin(t,e));Ot.any3d?_e(this._container,r,i):ge(this._container,r)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new O(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ln=hn.extend({options:{tolerance:0},getEvents:function(){var t=hn.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){hn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Ce(t,"mousemove",this._onMouseMove,this),Ce(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ce(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){T(this._redrawRequest),delete this._ctx,oe(this._container),Pe(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){hn.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=Ot.retina?2:1;ge(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",Ot.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){hn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[r(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete t._order,delete this._layers[r(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,n=t.options.dashArray.split(/[, ]+/),s=[];for(i=0;i<n.length;i++){if(e=Number(n[i]),isNaN(e))return;s.push(e)}t.options._dashArray=s}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||S(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new O,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,s,r,o=t._parts,a=o.length,h=this._ctx;if(a){for(h.beginPath(),i=0;i<a;i++){for(n=0,s=o[i].length;n<s;n++)r=o[i][n],h[n?"lineTo":"moveTo"](r.x,r.y);e&&h.closePath()}this._fillStroke(h,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,n=Math.max(Math.round(t._radius),1),s=(Math.max(Math.round(t._radiusY),1)||n)/n;1!==s&&(i.save(),i.scale(1,s)),i.beginPath(),i.arc(e.x,e.y/s,n,0,2*Math.PI,!1),1!==s&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),s=this._drawFirst;s;s=s.next)(e=s.layer).options.interactive&&e._containsPoint(n)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(i=e);this._fireEvent(!!i&&[i],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(de(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var i,s,r=this._drawFirst;r;r=r.next)(i=r.layer).options.interactive&&i._containsPoint(e)&&(s=i);s!==this._hoveredLayer&&(this._handleMouseOut(t),s&&(ue(this._container,"leaflet-interactive"),this._fireEvent([s],t,"mouseover"),this._hoveredLayer=s)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(n((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var i=e.next,n=e.prev;i&&(i.prev=n,n?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var i=e.next,n=e.prev;n&&(n.next=i,i?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function cn(t){return Ot.canvas?new ln(t):null}var un=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),dn={_initContainer:function(){this._container=re("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(hn.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=un("shape");ue(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=un("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[r(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;oe(e),t.removeInteractiveTarget(e),delete this._layers[r(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,s=t._container;s.stroked=!!n.stroke,s.filled=!!n.fill,n.stroke?(e||(e=t._stroke=un("stroke")),s.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=y(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(s.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=un("fill")),s.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(s.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){he(t._container)},_bringToBack:function(t){le(t._container)}},fn=Ot.vml?un:$,pn=hn.extend({_initContainer:function(){this._container=fn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){oe(this._container),Pe(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){hn.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),ge(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=fn("path");t.options.className&&ue(e,t.options.className),t.options.interactive&&ue(e,"leaflet-interactive"),this._updateStyle(t),this._layers[r(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){oe(t._path),t.removeInteractiveTarget(t._path),delete this._layers[r(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,X(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),n="a"+i+","+(Math.max(Math.round(t._radiusY),1)||i)+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+n+2*i+",0 "+n+2*-i+",0 ";this._setPath(t,s)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){he(t._path)},_bringToBack:function(t){le(t._path)}});function mn(t){return Ot.svg||Ot.vml?new pn(t):null}Ot.vml&&pn.include(dn),He.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&cn(t)||mn(t)}});var yn=Fi.extend({initialize:function(t,e){Fi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=F(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});pn.create=fn,pn.pointsToPath=X,Di.geometryToLayer=Ri,Di.coordsToLatLng=Zi,Di.coordsToLatLngs=ji,Di.latLngToCoords=Vi,Di.latLngsToCoords=Wi,Di.getFeature=Gi,Di.asFeature=qi,He.mergeOptions({boxZoom:!0});var _n=ti.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){Ce(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Pe(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){oe(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),$t(),xe(),this._startPoint=this._map.mouseEventToContainerPoint(t),Ce(document,{contextmenu:Re,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=re("div","leaflet-zoom-box",this._container),ue(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new O(this._point,this._startPoint),i=e.getSize();ge(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(oe(this._box),de(this._container,"leaflet-crosshair")),Xt(),we(),Pe(document,{contextmenu:Re,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(n(this._resetState,this),0);var e=new N(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});He.addInitHook("addHandler","boxZoom",_n),He.mergeOptions({doubleClickZoom:!0});var gn=ti.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,s=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(s):e.setZoomAround(t.containerPoint,s)}});He.addInitHook("addHandler","doubleClickZoom",gn),He.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var vn=ti.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new si(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}ue(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){de(this._map._container,"leaflet-grab"),de(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=F(this._map.options.maxBounds);this._offsetLimit=k(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,s=(n-e+i)%t+e-i,r=(n+e+i)%t-e-i,o=Math.abs(s+i)<Math.abs(r+i)?s:r;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{this._prunePositions(+new Date);var s=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,o=i.easeLinearity,a=s.multiplyBy(o/r),h=a.distanceTo([0,0]),l=Math.min(i.inertiaMaxSpeed,h),c=a.multiplyBy(l/h),u=l/(i.inertiaDeceleration*o),d=c.multiplyBy(-u/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),S((function(){e.panBy(d,{duration:u,easeLinearity:o,noMoveStart:!0,animate:!0})}))):e.fire("moveend")}}});He.addInitHook("addHandler","dragging",vn),He.mergeOptions({keyboard:!0,keyboardPanDelta:80});var bn=ti.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Ce(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Pe(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,n=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(n,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},s=this.keyCodes;for(e=0,i=s.left.length;e<i;e++)n[s.left[e]]=[-1*t,0];for(e=0,i=s.right.length;e<i;e++)n[s.right[e]]=[t,0];for(e=0,i=s.down.length;e<i;e++)n[s.down[e]]=[0,t];for(e=0,i=s.up.length;e<i;e++)n[s.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},s=this.keyCodes;for(e=0,i=s.zoomIn.length;e<i;e++)n[s.zoomIn[e]]=t;for(e=0,i=s.zoomOut.length;e<i;e++)n[s.zoomOut[e]]=-t},_addHooks:function(){Ce(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Pe(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys){if(!n._panAnim||!n._panAnim._inProgress)if(e=this._panKeys[i],t.shiftKey&&(e=z(e).multiplyBy(3)),n.options.maxBounds&&(e=n._limitOffset(z(e),n.options.maxBounds)),n.options.worldCopyJump){var s=n.wrapLatLng(n.unproject(n.project(n.getCenter()).add(e)));n.panTo(s)}else n.panBy(e)}else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!n._popup||!n._popup.options.closeOnEscapeKey)return;n.closePopup()}Re(t)}}});He.addInitHook("addHandler","keyboard",bn),He.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var xn=ti.extend({addHooks:function(){Ce(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Pe(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Ve(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var s=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(n(this._performZoom,this),s),Re(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),s=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,r=i?Math.ceil(s/i)*i:s,o=t._limitZoom(e+(this._delta>0?r:-r))-e;this._delta=0,this._startTime=null,o&&("center"===t.options.scrollWheelZoom?t.setZoom(e+o):t.setZoomAround(this._lastMousePos,e+o))}});He.addInitHook("addHandler","scrollWheelZoom",xn);He.mergeOptions({tapHold:Ot.touchNative&&Ot.safari&&Ot.mobile,tapTolerance:15});var wn=ti.extend({addHooks:function(){Ce(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Pe(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new B(e.clientX,e.clientY),this._holdTimeout=setTimeout(n((function(){this._cancel(),this._isTapValid()&&(Ce(document,"touchend",De),Ce(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))}),this),600),Ce(document,"touchend touchcancel contextmenu",this._cancel,this),Ce(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){Pe(document,"touchend",De),Pe(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),Pe(document,"touchend touchcancel contextmenu",this._cancel,this),Pe(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new B(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});i._simulated=!0,e.target.dispatchEvent(i)}});He.addInitHook("addHandler","tapHold",wn),He.mergeOptions({touchZoom:Ot.touch,bounceAtZoomLimits:!0});var Mn=ti.extend({addHooks:function(){ue(this._map._container,"leaflet-touch-zoom"),Ce(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){de(this._map._container,"leaflet-touch-zoom"),Pe(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(n)._divideBy(2))),this._startDist=i.distanceTo(n),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),Ce(document,"touchmove",this._onTouchMove,this),Ce(document,"touchend touchcancel",this._onTouchEnd,this),De(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),s=e.mouseEventToContainerPoint(t.touches[1]),r=i.distanceTo(s)/this._startDist;if(this._zoom=e.getScaleZoom(r,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&r<1||this._zoom>e.getMaxZoom()&&r>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===r)return}else{var o=i._add(s)._divideBy(2)._subtract(this._centerPoint);if(1===r&&0===o.x&&0===o.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),T(this._animRequest);var a=n(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=S(a,this,!0),De(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,T(this._animRequest),Pe(document,"touchmove",this._onTouchMove,this),Pe(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});He.addInitHook("addHandler","touchZoom",Mn),He.BoxZoom=_n,He.DoubleClickZoom=gn,He.Drag=vn,He.Keyboard=bn,He.ScrollWheelZoom=xn,He.TapHold=wn,He.TouchZoom=Mn,t.Bounds=O,t.Browser=Ot,t.CRS=Z,t.Canvas=ln,t.Circle=ki,t.CircleMarker=Oi,t.Class=A,t.Control=Ye,t.DivIcon=nn,t.DivOverlay=Qi,t.DomEvent=Ge,t.DomUtil=Ae,t.Draggable=si,t.Evented=P,t.FeatureGroup=Ci,t.GeoJSON=Di,t.GridLayer=sn,t.Handler=ti,t.Icon=Li,t.ImageOverlay=Xi,t.LatLng=D,t.LatLngBounds=N,t.Layer=Ii,t.LayerGroup=Ai,t.LineUtil=yi,t.Map=He,t.Marker=Ei,t.Mixin=ii,t.Path=zi,t.Point=B,t.PolyUtil=vi,t.Polygon=Fi,t.Polyline=Ni,t.Popup=tn,t.PosAnimation=qe,t.Projection=wi,t.Rectangle=yn,t.Renderer=hn,t.SVG=pn,t.SVGOverlay=Ji,t.TileLayer=rn,t.Tooltip=en,t.Transformation=G,t.Util=I,t.VideoOverlay=Ki,t.bind=n,t.bounds=k,t.canvas=cn,t.circle=function(t,e,i){return new ki(t,e,i)},t.circleMarker=function(t,e){return new Oi(t,e)},t.control=$e,t.divIcon=function(t){return new nn(t)},t.extend=e,t.featureGroup=function(t,e){return new Ci(t,e)},t.geoJSON=Yi,t.geoJson=$i,t.gridLayer=function(t){return new sn(t)},t.icon=function(t){return new Li(t)},t.imageOverlay=function(t,e,i){return new Xi(t,e,i)},t.latLng=R,t.latLngBounds=F,t.layerGroup=function(t,e){return new Ai(t,e)},t.map=function(t,e){return new He(t,e)},t.marker=function(t,e){return new Ei(t,e)},t.point=z,t.polygon=function(t,e){return new Fi(t,e)},t.polyline=function(t,e){return new Ni(t,e)},t.popup=function(t,e){return new tn(t,e)},t.rectangle=function(t,e){return new yn(t,e)},t.setOptions=d,t.stamp=r,t.svg=mn,t.svgOverlay=function(t,e,i){return new Ji(t,e,i)},t.tileLayer=on,t.tooltip=function(t,e){return new en(t,e)},t.transformation=q,t.version="1.9.3",t.videoOverlay=function(t,e,i){return new Ki(t,e,i)};var Sn=window.L;t.noConflict=function(){return window.L=Sn,this},window.L=t}(e)}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};function e(){}function n(t){return null==t?e:function(){return this.querySelector(t)}}function s(){return[]}function r(t){return null==t?s:function(){return this.querySelectorAll(t)}}function o(t){return function(){return this.matches(t)}}function a(t){return function(e){return e.matches(t)}}i.r(t),i.d(t,{App:()=>ql,BackgroundLayer:()=>jl,BackgroundLayerWMS:()=>Vl,BoundaryLayer:()=>Gl,CSVGrid:()=>tn,ColorCategoryLegend:()=>Hc,ColorDiscreteLegend:()=>qc,ColorLegend:()=>Gc,CompositionStyle:()=>Kl,ContourStyle:()=>pc,Dataset:()=>Di,DatasetComponent:()=>Qi,DotDensityStyle:()=>xc,GeoCanvas:()=>Ni,JoyPlotStyle:()=>Xl,KernelSmoothingStyle:()=>uc,LabelLayer:()=>Wl,Layer:()=>Fi,LegoStyle:()=>Ac,MosaicStyle:()=>Lc,NinjaStarStyle:()=>Pc,PillarStyle:()=>dc,SegmentOrientationLegend:()=>Xc,SegmentStyle:()=>Jl,SegmentWidthLegend:()=>$c,ShapeColorSizeStyle:()=>Yl,SideCatStyle:()=>mc,SideStyle:()=>fc,SizeLegend:()=>Yc,SquareColorCatWGLStyle:()=>Ic,SquareColorWGLStyle:()=>Mc,StrokeStyle:()=>$l,Style:()=>Hl,TanakaStyle:()=>Sc,TextStyle:()=>Ql,TiledGrid:()=>Zl,getClass:()=>nn,getEuronymeLabelLayer:()=>wd,getEurostatBoundariesLayer:()=>Md,getParameterByName:()=>Sd,sCircleHigh:()=>iu,sCircleLow:()=>eu,sExp:()=>Qc,sExpInverse:()=>nu,sExpRev:()=>tu,sExpRevInverse:()=>su,sPow:()=>Kc,sPowInverse:()=>ru,sPowRev:()=>Jc,sPowRevInverse:()=>ou});var h=Array.prototype.find;function l(){return this.firstElementChild}var c=Array.prototype.filter;function u(){return Array.from(this.children)}function d(t){return new Array(t.length)}function f(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function p(t,e,i,n,s,r){for(var o,a=0,h=e.length,l=r.length;a<l;++a)(o=e[a])?(o.__data__=r[a],n[a]=o):i[a]=new f(t,r[a]);for(;a<h;++a)(o=e[a])&&(s[a]=o)}function m(t,e,i,n,s,r,o){var a,h,l,c=new Map,u=e.length,d=r.length,p=new Array(u);for(a=0;a<u;++a)(h=e[a])&&(p[a]=l=o.call(h,h.__data__,a,e)+"",c.has(l)?s[a]=h:c.set(l,h));for(a=0;a<d;++a)l=o.call(t,r[a],a,r)+"",(h=c.get(l))?(n[a]=h,h.__data__=r[a],c.delete(l)):i[a]=new f(t,r[a]);for(a=0;a<u;++a)(h=e[a])&&c.get(p[a])===h&&(s[a]=h)}function y(t){return t.__data__}function _(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function g(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}f.prototype={constructor:f,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var v="http://www.w3.org/1999/xhtml";const b={svg:"http://www.w3.org/2000/svg",xhtml:v,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function x(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),b.hasOwnProperty(e)?{space:b[e],local:t}:t}function w(t){return function(){this.removeAttribute(t)}}function M(t){return function(){this.removeAttributeNS(t.space,t.local)}}function S(t,e){return function(){this.setAttribute(t,e)}}function T(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function I(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function A(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function C(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function P(t){return function(){this.style.removeProperty(t)}}function B(t,e,i){return function(){this.style.setProperty(t,e,i)}}function E(t,e,i){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function z(t,e){return t.style.getPropertyValue(e)||C(t).getComputedStyle(t,null).getPropertyValue(e)}function O(t){return function(){delete this[t]}}function k(t,e){return function(){this[t]=e}}function N(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function F(t){return t.trim().split(/^|\s+/)}function D(t){return t.classList||new R(t)}function R(t){this._node=t,this._names=F(t.getAttribute("class")||"")}function U(t,e){for(var i=D(t),n=-1,s=e.length;++n<s;)i.add(e[n])}function Z(t,e){for(var i=D(t),n=-1,s=e.length;++n<s;)i.remove(e[n])}function j(t){return function(){U(this,t)}}function V(t){return function(){Z(this,t)}}function W(t,e){return function(){(e.apply(this,arguments)?U:Z)(this,t)}}function G(){this.textContent=""}function q(t){return function(){this.textContent=t}}function H(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Y(){this.innerHTML=""}function $(t){return function(){this.innerHTML=t}}function X(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function K(){this.nextSibling&&this.parentNode.appendChild(this)}function J(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Q(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===v&&e.documentElement.namespaceURI===v?e.createElement(t):e.createElementNS(i,t)}}function tt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function et(t){var e=x(t);return(e.local?tt:Q)(e)}function it(){return null}function nt(){var t=this.parentNode;t&&t.removeChild(this)}function st(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function rt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ot(t){return function(){var e=this.__on;if(e){for(var i,n=0,s=-1,r=e.length;n<r;++n)i=e[n],t.type&&i.type!==t.type||i.name!==t.name?e[++s]=i:this.removeEventListener(i.type,i.listener,i.options);++s?e.length=s:delete this.__on}}}function at(t,e,i){return function(){var n,s=this.__on,r=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(s)for(var o=0,a=s.length;o<a;++o)if((n=s[o]).type===t.type&&n.name===t.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=r,n.options=i),void(n.value=e);this.addEventListener(t.type,r,i),n={type:t.type,name:t.name,value:e,listener:r,options:i},s?s.push(n):this.__on=[n]}}function ht(t,e,i){var n=C(t),s=n.CustomEvent;"function"==typeof s?s=new s(e,i):(s=n.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function lt(t,e){return function(){return ht(this,t,e)}}function ct(t,e){return function(){return ht(this,t,e.apply(this,arguments))}}R.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var ut=[null];function dt(t,e){this._groups=t,this._parents=e}function ft(){return new dt([[document.documentElement]],ut)}dt.prototype=ft.prototype={constructor:dt,select:function(t){"function"!=typeof t&&(t=n(t));for(var e=this._groups,i=e.length,s=new Array(i),r=0;r<i;++r)for(var o,a,h=e[r],l=h.length,c=s[r]=new Array(l),u=0;u<l;++u)(o=h[u])&&(a=t.call(o,o.__data__,u,h))&&("__data__"in o&&(a.__data__=o.__data__),c[u]=a);return new dt(s,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):r(t);for(var e=this._groups,i=e.length,n=[],s=[],o=0;o<i;++o)for(var a,h=e[o],l=h.length,c=0;c<l;++c)(a=h[c])&&(n.push(t.call(a,a.__data__,c,h)),s.push(a));return new dt(n,s)},selectChild:function(t){return this.select(null==t?l:function(t){return function(){return h.call(this.children,t)}}("function"==typeof t?t:a(t)))},selectChildren:function(t){return this.selectAll(null==t?u:function(t){return function(){return c.call(this.children,t)}}("function"==typeof t?t:a(t)))},filter:function(t){"function"!=typeof t&&(t=o(t));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var r,a=e[s],h=a.length,l=n[s]=[],c=0;c<h;++c)(r=a[c])&&t.call(r,r.__data__,c,a)&&l.push(r);return new dt(n,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,y);var i,n=e?m:p,s=this._parents,r=this._groups;"function"!=typeof t&&(i=t,t=function(){return i});for(var o=r.length,a=new Array(o),h=new Array(o),l=new Array(o),c=0;c<o;++c){var u=s[c],d=r[c],f=d.length,g=_(t.call(u,u&&u.__data__,c,s)),v=g.length,b=h[c]=new Array(v),x=a[c]=new Array(v);n(u,d,b,x,l[c]=new Array(f),g,e);for(var w,M,S=0,T=0;S<v;++S)if(w=b[S]){for(S>=T&&(T=S+1);!(M=x[T])&&++T<v;);w._next=M||null}}return(a=new dt(a,s))._enter=h,a._exit=l,a},enter:function(){return new dt(this._enter||this._groups.map(d),this._parents)},exit:function(){return new dt(this._exit||this._groups.map(d),this._parents)},join:function(t,e,i){var n=this.enter(),s=this,r=this.exit();return"function"==typeof t?(n=t(n))&&(n=n.selection()):n=n.append(t+""),null!=e&&(s=e(s))&&(s=s.selection()),null==i?r.remove():i(r),n&&s?n.merge(s).order():s},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,n=e._groups,s=i.length,r=n.length,o=Math.min(s,r),a=new Array(s),h=0;h<o;++h)for(var l,c=i[h],u=n[h],d=c.length,f=a[h]=new Array(d),p=0;p<d;++p)(l=c[p]||u[p])&&(f[p]=l);for(;h<s;++h)a[h]=i[h];return new dt(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n,s=t[e],r=s.length-1,o=s[r];--r>=0;)(n=s[r])&&(o&&4^n.compareDocumentPosition(o)&&o.parentNode.insertBefore(n,o),o=n);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=g);for(var i=this._groups,n=i.length,s=new Array(n),r=0;r<n;++r){for(var o,a=i[r],h=a.length,l=s[r]=new Array(h),c=0;c<h;++c)(o=a[c])&&(l[c]=o);l.sort(e)}return new dt(s,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],s=0,r=n.length;s<r;++s){var o=n[s];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var s,r=e[i],o=0,a=r.length;o<a;++o)(s=r[o])&&t.call(s,s.__data__,o,r);return this},attr:function(t,e){var i=x(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==e?i.local?M:w:"function"==typeof e?i.local?A:I:i.local?T:S)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?P:"function"==typeof e?E:B)(t,e,null==i?"":i)):z(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?O:"function"==typeof e?N:k)(t,e)):this.node()[t]},classed:function(t,e){var i=F(t+"");if(arguments.length<2){for(var n=D(this.node()),s=-1,r=i.length;++s<r;)if(!n.contains(i[s]))return!1;return!0}return this.each(("function"==typeof e?W:e?j:V)(i,e))},text:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?H:q)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Y:("function"==typeof t?X:$)(t)):this.node().innerHTML},raise:function(){return this.each(K)},lower:function(){return this.each(J)},append:function(t){var e="function"==typeof t?t:et(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var i="function"==typeof t?t:et(t),s=null==e?it:"function"==typeof e?e:n(e);return this.select((function(){return this.insertBefore(i.apply(this,arguments),s.apply(this,arguments)||null)}))},remove:function(){return this.each(nt)},clone:function(t){return this.select(t?rt:st)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var n,s,r=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}}))}(t+""),o=r.length;if(!(arguments.length<2)){for(a=e?at:ot,n=0;n<o;++n)this.each(a(r[n],e,i));return this}var a=this.node().__on;if(a)for(var h,l=0,c=a.length;l<c;++l)for(n=0,h=a[l];n<o;++n)if((s=r[n]).type===h.type&&s.name===h.name)return h.value},dispatch:function(t,e){return this.each(("function"==typeof e?ct:lt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n,s=t[e],r=0,o=s.length;r<o;++r)(n=s[r])&&(yield n)}};const pt=ft;function mt(t){return"string"==typeof t?new dt([[document.querySelector(t)]],[document.documentElement]):new dt([[t]],ut)}var yt={value:()=>{}};function _t(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n||/[\s.]/.test(t))throw new Error("illegal type: "+t);n[t]=[]}return new gt(n)}function gt(t){this._=t}function vt(t,e){for(var i,n=0,s=t.length;n<s;++n)if((i=t[n]).name===e)return i.value}function bt(t,e,i){for(var n=0,s=t.length;n<s;++n)if(t[n].name===e){t[n]=yt,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}gt.prototype=_t.prototype={constructor:gt,on:function(t,e){var i,n,s=this._,r=(n=s,(t+"").trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(i=(t=r[o]).type)s[i]=bt(s[i],t.name,e);else if(null==e)for(i in s)s[i]=bt(s[i],t.name,null);return this}for(;++o<a;)if((i=(t=r[o]).type)&&(i=vt(s[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new gt(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,s=new Array(i),r=0;r<i;++r)s[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,i=(n=this._[t]).length;r<i;++r)n[r].value.apply(e,s)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],s=0,r=n.length;s<r;++s)n[s].value.apply(e,i)}};const xt=_t,wt={capture:!0,passive:!1};function Mt(t){t.preventDefault(),t.stopImmediatePropagation()}function St(t){return((t=Math.exp(t))+1/t)/2}const Tt=function t(e,i,n){function s(t,s){var r,o,a=t[0],h=t[1],l=t[2],c=s[0],u=s[1],d=s[2],f=c-a,p=u-h,m=f*f+p*p;if(m<1e-12)o=Math.log(d/l)/e,r=function(t){return[a+t*f,h+t*p,l*Math.exp(e*t*o)]};else{var y=Math.sqrt(m),_=(d*d-l*l+n*m)/(2*l*i*y),g=(d*d-l*l-n*m)/(2*d*i*y),v=Math.log(Math.sqrt(_*_+1)-_),b=Math.log(Math.sqrt(g*g+1)-g);o=(b-v)/e,r=function(t){var n,s=t*o,r=St(v),c=l/(i*y)*(r*(n=e*s+v,((n=Math.exp(2*n))-1)/(n+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[a+c*f,h+c*p,l*r/St(e*s+v)]}}return r.duration=1e3*o*e/Math.SQRT2,r}return s.rho=function(e){var i=Math.max(.001,+e),n=i*i;return t(i,n,n*n)},s}(Math.SQRT2,2,4);function It(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,[(n=n.matrixTransform(e.getScreenCTM().inverse())).x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}var At,Ct,Lt=0,Pt=0,Bt=0,Et=1e3,zt=0,Ot=0,kt=0,Nt="object"==typeof performance&&performance.now?performance:Date,Ft="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Dt(){return Ot||(Ft(Rt),Ot=Nt.now()+kt)}function Rt(){Ot=0}function Ut(){this._call=this._time=this._next=null}function Zt(t,e,i){var n=new Ut;return n.restart(t,e,i),n}function jt(){Ot=(zt=Nt.now())+kt,Lt=Pt=0;try{!function(){Dt(),++Lt;for(var t,e=At;e;)(t=Ot-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Lt}()}finally{Lt=0,function(){for(var t,e,i=At,n=1/0;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:At=e);Ct=t,Wt(n)}(),Ot=0}}function Vt(){var t=Nt.now(),e=t-zt;e>Et&&(kt-=e,zt=t)}function Wt(t){Lt||(Pt&&(Pt=clearTimeout(Pt)),t-Ot>24?(t<1/0&&(Pt=setTimeout(jt,t-Nt.now()-kt)),Bt&&(Bt=clearInterval(Bt))):(Bt||(zt=Nt.now(),Bt=setInterval(Vt,Et)),Lt=1,Ft(jt)))}function Gt(t,e,i){var n=new Ut;return e=null==e?0:+e,n.restart((i=>{n.stop(),t(i+e)}),e,i),n}Ut.prototype=Zt.prototype={constructor:Ut,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?Dt():+i)+(null==e?0:+e),this._next||Ct===this||(Ct?Ct._next=this:At=this,Ct=this),this._call=t,this._time=i,Wt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Wt())}};var qt=xt("start","end","cancel","interrupt"),Ht=[],Yt=0,$t=2,Xt=3,Kt=5,Jt=6;function Qt(t,e,i,n,s,r){var o=t.__transition;if(o){if(i in o)return}else t.__transition={};!function(t,e,i){var n,s=t.__transition;function r(h){var l,c,u,d;if(1!==i.state)return a();for(l in s)if((d=s[l]).name===i.name){if(d.state===Xt)return Gt(r);4===d.state?(d.state=Jt,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete s[l]):+l<e&&(d.state=Jt,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete s[l])}if(Gt((function(){i.state===Xt&&(i.state=4,i.timer.restart(o,i.delay,i.time),o(h))})),i.state=$t,i.on.call("start",t,t.__data__,i.index,i.group),i.state===$t){for(i.state=Xt,n=new Array(u=i.tween.length),l=0,c=-1;l<u;++l)(d=i.tween[l].value.call(t,t.__data__,i.index,i.group))&&(n[++c]=d);n.length=c+1}}function o(e){for(var s=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(a),i.state=Kt,1),r=-1,o=n.length;++r<o;)n[r].call(t,s);i.state===Kt&&(i.on.call("end",t,t.__data__,i.index,i.group),a())}function a(){for(var n in i.state=Jt,i.timer.stop(),delete s[e],s)return;delete t.__transition}s[e]=i,i.timer=Zt((function(t){i.state=1,i.timer.restart(r,i.delay,i.time),i.delay<=t&&r(t-i.delay)}),0,i.time)}(t,i,{name:e,index:n,group:s,on:qt,tween:Ht,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:Yt})}function te(t,e){var i=ie(t,e);if(i.state>Yt)throw new Error("too late; already scheduled");return i}function ee(t,e){var i=ie(t,e);if(i.state>Xt)throw new Error("too late; already running");return i}function ie(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function ne(t,e){var i,n,s,r=t.__transition,o=!0;if(r){for(s in e=null==e?null:e+"",r)(i=r[s]).name===e?(n=i.state>$t&&i.state<Kt,i.state=Jt,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete r[s]):o=!1;o&&delete t.__transition}}function se(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var re,oe=180/Math.PI,ae={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function he(t,e,i,n,s,r){var o,a,h;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(h=t*i+e*n)&&(i-=t*h,n-=e*h),(a=Math.sqrt(i*i+n*n))&&(i/=a,n/=a,h/=a),t*n<e*i&&(t=-t,e=-e,h=-h,o=-o),{translateX:s,translateY:r,rotate:Math.atan2(e,t)*oe,skewX:Math.atan(h)*oe,scaleX:o,scaleY:a}}function le(t,e,i,n){function s(t){return t.length?t.pop()+" ":""}return function(r,o){var a=[],h=[];return r=t(r),o=t(o),function(t,n,s,r,o,a){if(t!==s||n!==r){var h=o.push("translate(",null,e,null,i);a.push({i:h-4,x:se(t,s)},{i:h-2,x:se(n,r)})}else(s||r)&&o.push("translate("+s+e+r+i)}(r.translateX,r.translateY,o.translateX,o.translateY,a,h),function(t,e,i,r){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),r.push({i:i.push(s(i)+"rotate(",null,n)-2,x:se(t,e)})):e&&i.push(s(i)+"rotate("+e+n)}(r.rotate,o.rotate,a,h),function(t,e,i,r){t!==e?r.push({i:i.push(s(i)+"skewX(",null,n)-2,x:se(t,e)}):e&&i.push(s(i)+"skewX("+e+n)}(r.skewX,o.skewX,a,h),function(t,e,i,n,r,o){if(t!==i||e!==n){var a=r.push(s(r)+"scale(",null,",",null,")");o.push({i:a-4,x:se(t,i)},{i:a-2,x:se(e,n)})}else 1===i&&1===n||r.push(s(r)+"scale("+i+","+n+")")}(r.scaleX,r.scaleY,o.scaleX,o.scaleY,a,h),r=o=null,function(t){for(var e,i=-1,n=h.length;++i<n;)a[(e=h[i]).i]=e.x(t);return a.join("")}}}var ce=le((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ae:he(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),ue=le((function(t){return null==t?ae:(re||(re=document.createElementNS("http://www.w3.org/2000/svg","g")),re.setAttribute("transform",t),(t=re.transform.baseVal.consolidate())?he((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):ae)}),", ",")",")");function de(t,e){var i,n;return function(){var s=ee(this,t),r=s.tween;if(r!==i)for(var o=0,a=(n=i=r).length;o<a;++o)if(n[o].name===e){(n=n.slice()).splice(o,1);break}s.tween=n}}function fe(t,e,i){var n,s;if("function"!=typeof i)throw new Error;return function(){var r=ee(this,t),o=r.tween;if(o!==n){s=(n=o).slice();for(var a={name:e,value:i},h=0,l=s.length;h<l;++h)if(s[h].name===e){s[h]=a;break}h===l&&s.push(a)}r.tween=s}}function pe(t,e,i){var n=t._id;return t.each((function(){var t=ee(this,n);(t.value||(t.value={}))[e]=i.apply(this,arguments)})),function(t){return ie(t,n).value[e]}}function me(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function ye(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function _e(){}var ge=.7,ve=1/ge,be="\\s*([+-]?\\d+)\\s*",xe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",we="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Me=/^#([0-9a-f]{3,8})$/,Se=new RegExp(`^rgb\\(${be},${be},${be}\\)$`),Te=new RegExp(`^rgb\\(${we},${we},${we}\\)$`),Ie=new RegExp(`^rgba\\(${be},${be},${be},${xe}\\)$`),Ae=new RegExp(`^rgba\\(${we},${we},${we},${xe}\\)$`),Ce=new RegExp(`^hsl\\(${xe},${we},${we}\\)$`),Le=new RegExp(`^hsla\\(${xe},${we},${we},${xe}\\)$`),Pe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Be(){return this.rgb().formatHex()}function Ee(){return this.rgb().formatRgb()}function ze(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Me.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?Oe(e):3===i?new Fe(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?ke(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?ke(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Se.exec(t))?new Fe(e[1],e[2],e[3],1):(e=Te.exec(t))?new Fe(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ie.exec(t))?ke(e[1],e[2],e[3],e[4]):(e=Ae.exec(t))?ke(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ce.exec(t))?Ve(e[1],e[2]/100,e[3]/100,1):(e=Le.exec(t))?Ve(e[1],e[2]/100,e[3]/100,e[4]):Pe.hasOwnProperty(t)?Oe(Pe[t]):"transparent"===t?new Fe(NaN,NaN,NaN,0):null}function Oe(t){return new Fe(t>>16&255,t>>8&255,255&t,1)}function ke(t,e,i,n){return n<=0&&(t=e=i=NaN),new Fe(t,e,i,n)}function Ne(t,e,i,n){return 1===arguments.length?((s=t)instanceof _e||(s=ze(s)),s?new Fe((s=s.rgb()).r,s.g,s.b,s.opacity):new Fe):new Fe(t,e,i,null==n?1:n);var s}function Fe(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function De(){return`#${je(this.r)}${je(this.g)}${je(this.b)}`}function Re(){const t=Ue(this.opacity);return`${1===t?"rgb(":"rgba("}${Ze(this.r)}, ${Ze(this.g)}, ${Ze(this.b)}${1===t?")":`, ${t})`}`}function Ue(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ze(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function je(t){return((t=Ze(t))<16?"0":"")+t.toString(16)}function Ve(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Ge(t,e,i,n)}function We(t){if(t instanceof Ge)return new Ge(t.h,t.s,t.l,t.opacity);if(t instanceof _e||(t=ze(t)),!t)return new Ge;if(t instanceof Ge)return t;var e=(t=t.rgb()).r/255,i=t.g/255,n=t.b/255,s=Math.min(e,i,n),r=Math.max(e,i,n),o=NaN,a=r-s,h=(r+s)/2;return a?(o=e===r?(i-n)/a+6*(i<n):i===r?(n-e)/a+2:(e-i)/a+4,a/=h<.5?r+s:2-r-s,o*=60):a=h>0&&h<1?0:o,new Ge(o,a,h,t.opacity)}function Ge(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function qe(t){return(t=(t||0)%360)<0?t+360:t}function He(t){return Math.max(0,Math.min(1,t||0))}function Ye(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}function $e(t,e,i,n,s){var r=t*t,o=r*t;return((1-3*t+3*r-o)*e+(4-6*r+3*o)*i+(1+3*t+3*r-3*o)*n+o*s)/6}me(_e,ze,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Be,formatHex:Be,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return We(this).formatHsl()},formatRgb:Ee,toString:Ee}),me(Fe,Ne,ye(_e,{brighter(t){return t=null==t?ve:Math.pow(ve,t),new Fe(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?ge:Math.pow(ge,t),new Fe(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Fe(Ze(this.r),Ze(this.g),Ze(this.b),Ue(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:De,formatHex:De,formatHex8:function(){return`#${je(this.r)}${je(this.g)}${je(this.b)}${je(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Re,toString:Re})),me(Ge,(function(t,e,i,n){return 1===arguments.length?We(t):new Ge(t,e,i,null==n?1:n)}),ye(_e,{brighter(t){return t=null==t?ve:Math.pow(ve,t),new Ge(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?ge:Math.pow(ge,t),new Ge(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new Fe(Ye(t>=240?t-240:t+120,s,n),Ye(t,s,n),Ye(t<120?t+240:t-120,s,n),this.opacity)},clamp(){return new Ge(qe(this.h),He(this.s),He(this.l),Ue(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ue(this.opacity);return`${1===t?"hsl(":"hsla("}${qe(this.h)}, ${100*He(this.s)}%, ${100*He(this.l)}%${1===t?")":`, ${t})`}`}}));const Xe=t=>()=>t;function Ke(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):Xe(isNaN(t)?e:t)}const Je=function t(e){var i=function(t){return 1==(t=+t)?Ke:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}(e,i,t):Xe(isNaN(e)?i:e)}}(e);function n(t,e){var n=i((t=Ne(t)).r,(e=Ne(e)).r),s=i(t.g,e.g),r=i(t.b,e.b),o=Ke(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=s(e),t.b=r(e),t.opacity=o(e),t+""}}return n.gamma=t,n}(1);function Qe(t){return function(e){var i,n,s=e.length,r=new Array(s),o=new Array(s),a=new Array(s);for(i=0;i<s;++i)n=Ne(e[i]),r[i]=n.r||0,o[i]=n.g||0,a[i]=n.b||0;return r=t(r),o=t(o),a=t(a),n.opacity=1,function(t){return n.r=r(t),n.g=o(t),n.b=a(t),n+""}}}Qe((function(t){var e=t.length-1;return function(i){var n=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),s=t[n],r=t[n+1],o=n>0?t[n-1]:2*s-r,a=n<e-1?t[n+2]:2*r-s;return $e((i-n/e)*e,o,s,r,a)}})),Qe((function(t){var e=t.length;return function(i){var n=Math.floor(((i%=1)<0?++i:i)*e),s=t[(n+e-1)%e],r=t[n%e],o=t[(n+1)%e],a=t[(n+2)%e];return $e((i-n/e)*e,s,r,o,a)}}));var ti=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ei=new RegExp(ti.source,"g");function ii(t,e){var i,n,s,r=ti.lastIndex=ei.lastIndex=0,o=-1,a=[],h=[];for(t+="",e+="";(i=ti.exec(t))&&(n=ei.exec(e));)(s=n.index)>r&&(s=e.slice(r,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,h.push({i:o,x:se(i,n)})),r=ei.lastIndex;return r<e.length&&(s=e.slice(r),a[o]?a[o]+=s:a[++o]=s),a.length<2?h[0]?function(t){return function(e){return t(e)+""}}(h[0].x):function(t){return function(){return t}}(e):(e=h.length,function(t){for(var i,n=0;n<e;++n)a[(i=h[n]).i]=i.x(t);return a.join("")})}function ni(t,e){var i;return("number"==typeof e?se:e instanceof ze?Je:(i=ze(e))?(e=i,Je):ii)(t,e)}function si(t){return function(){this.removeAttribute(t)}}function ri(t){return function(){this.removeAttributeNS(t.space,t.local)}}function oi(t,e,i){var n,s,r=i+"";return function(){var o=this.getAttribute(t);return o===r?null:o===n?s:s=e(n=o,i)}}function ai(t,e,i){var n,s,r=i+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===n?s:s=e(n=o,i)}}function hi(t,e,i){var n,s,r;return function(){var o,a,h=i(this);if(null!=h)return(o=this.getAttribute(t))===(a=h+"")?null:o===n&&a===s?r:(s=a,r=e(n=o,h));this.removeAttribute(t)}}function li(t,e,i){var n,s,r;return function(){var o,a,h=i(this);if(null!=h)return(o=this.getAttributeNS(t.space,t.local))===(a=h+"")?null:o===n&&a===s?r:(s=a,r=e(n=o,h));this.removeAttributeNS(t.space,t.local)}}function ci(t,e){var i,n;function s(){var s=e.apply(this,arguments);return s!==n&&(i=(n=s)&&function(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}(t,s)),i}return s._value=e,s}function ui(t,e){var i,n;function s(){var s=e.apply(this,arguments);return s!==n&&(i=(n=s)&&function(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}(t,s)),i}return s._value=e,s}function di(t,e){return function(){te(this,t).delay=+e.apply(this,arguments)}}function fi(t,e){return e=+e,function(){te(this,t).delay=e}}function pi(t,e){return function(){ee(this,t).duration=+e.apply(this,arguments)}}function mi(t,e){return e=+e,function(){ee(this,t).duration=e}}var yi=pt.prototype.constructor;function _i(t){return function(){this.style.removeProperty(t)}}var gi=0;function vi(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function bi(){return++gi}var xi=pt.prototype;vi.prototype=function(t){return pt().transition(t)}.prototype={constructor:vi,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=n(t));for(var s=this._groups,r=s.length,o=new Array(r),a=0;a<r;++a)for(var h,l,c=s[a],u=c.length,d=o[a]=new Array(u),f=0;f<u;++f)(h=c[f])&&(l=t.call(h,h.__data__,f,c))&&("__data__"in h&&(l.__data__=h.__data__),d[f]=l,Qt(d[f],e,i,f,d,ie(h,i)));return new vi(o,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=r(t));for(var n=this._groups,s=n.length,o=[],a=[],h=0;h<s;++h)for(var l,c=n[h],u=c.length,d=0;d<u;++d)if(l=c[d]){for(var f,p=t.call(l,l.__data__,d,c),m=ie(l,i),y=0,_=p.length;y<_;++y)(f=p[y])&&Qt(f,e,i,y,p,m);o.push(p),a.push(l)}return new vi(o,a,e,i)},selectChild:xi.selectChild,selectChildren:xi.selectChildren,filter:function(t){"function"!=typeof t&&(t=o(t));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var r,a=e[s],h=a.length,l=n[s]=[],c=0;c<h;++c)(r=a[c])&&t.call(r,r.__data__,c,a)&&l.push(r);return new vi(n,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,s=i.length,r=Math.min(n,s),o=new Array(n),a=0;a<r;++a)for(var h,l=e[a],c=i[a],u=l.length,d=o[a]=new Array(u),f=0;f<u;++f)(h=l[f]||c[f])&&(d[f]=h);for(;a<n;++a)o[a]=e[a];return new vi(o,this._parents,this._name,this._id)},selection:function(){return new yi(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=bi(),n=this._groups,s=n.length,r=0;r<s;++r)for(var o,a=n[r],h=a.length,l=0;l<h;++l)if(o=a[l]){var c=ie(o,e);Qt(o,t,i,l,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new vi(n,this._parents,t,i)},call:xi.call,nodes:xi.nodes,node:xi.node,size:xi.size,empty:xi.empty,each:xi.each,on:function(t,e){var i=this._id;return arguments.length<2?ie(this.node(),i).on.on(t):this.each(function(t,e,i){var n,s,r=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?te:ee;return function(){var o=r(this,t),a=o.on;a!==n&&(s=(n=a).copy()).on(e,i),o.on=s}}(i,t,e))},attr:function(t,e){var i=x(t),n="transform"===i?ue:ni;return this.attrTween(t,"function"==typeof e?(i.local?li:hi)(i,n,pe(this,"attr."+t,e)):null==e?(i.local?ri:si)(i):(i.local?ai:oi)(i,n,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var n=x(t);return this.tween(i,(n.local?ci:ui)(n,e))},style:function(t,e,i){var n="transform"==(t+="")?ce:ni;return null==e?this.styleTween(t,function(t,e){var i,n,s;return function(){var r=z(this,t),o=(this.style.removeProperty(t),z(this,t));return r===o?null:r===i&&o===n?s:s=e(i=r,n=o)}}(t,n)).on("end.style."+t,_i(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var n,s,r;return function(){var o=z(this,t),a=i(this),h=a+"";return null==a&&(this.style.removeProperty(t),h=a=z(this,t)),o===h?null:o===n&&h===s?r:(s=h,r=e(n=o,a))}}(t,n,pe(this,"style."+t,e))).each(function(t,e){var i,n,s,r,o="style."+e,a="end."+o;return function(){var h=ee(this,t),l=h.on,c=null==h.value[o]?r||(r=_i(e)):void 0;l===i&&s===c||(n=(i=l).copy()).on(a,s=c),h.on=n}}(this._id,t)):this.styleTween(t,function(t,e,i){var n,s,r=i+"";return function(){var o=z(this,t);return o===r?null:o===n?s:s=e(n=o,i)}}(t,n,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,function(t,e,i){var n,s;function r(){var r=e.apply(this,arguments);return r!==s&&(n=(s=r)&&function(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}(t,r,i)),n}return r._value=e,r}(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(pe(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,i;function n(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&function(t){return function(e){this.textContent=t.call(this,e)}}(n)),e}return n._value=t,n}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n,s=ie(this.node(),i).tween,r=0,o=s.length;r<o;++r)if((n=s[r]).name===t)return n.value;return null}return this.each((null==e?de:fe)(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?di:fi)(e,t)):ie(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?pi:mi)(e,t)):ie(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){ee(this,t).ease=e}}(e,t)):ie(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;ee(this,t).ease=i}}(this._id,t))},end:function(){var t,e,i=this,n=i._id,s=i.size();return new Promise((function(r,o){var a={value:o},h={value:function(){0==--s&&r()}};i.each((function(){var i=ee(this,n),s=i.on;s!==t&&((e=(t=s).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(h)),i.on=e})),0===s&&r()}))},[Symbol.iterator]:xi[Symbol.iterator]};var wi={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Mi(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}pt.prototype.interrupt=function(t){return this.each((function(){ne(this,t)}))},pt.prototype.transition=function(t){var e,i;t instanceof vi?(e=t._id,t=t._name):(e=bi(),(i=wi).time=Dt(),t=null==t?null:t+"");for(var n=this._groups,s=n.length,r=0;r<s;++r)for(var o,a=n[r],h=a.length,l=0;l<h;++l)(o=a[l])&&Qt(o,t,e,l,a,i||Mi(o,e));return new vi(n,this._parents,t,e)};const Si=t=>()=>t;function Ti(t,{sourceEvent:e,target:i,transform:n,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:s}})}function Ii(t,e,i){this.k=t,this.x=e,this.y=i}Ii.prototype={constructor:Ii,scale:function(t){return 1===t?this:new Ii(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Ii(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ai=new Ii(1,0,0);function Ci(t){t.stopImmediatePropagation()}function Li(t){t.preventDefault(),t.stopImmediatePropagation()}function Pi(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Bi(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Ei(){return this.__zoom||Ai}function zi(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Oi(){return navigator.maxTouchPoints||"ontouchstart"in this}function ki(t,e,i){var n=t.invertX(e[0][0])-i[0][0],s=t.invertX(e[1][0])-i[1][0],r=t.invertY(e[0][1])-i[0][1],o=t.invertY(e[1][1])-i[1][1];return t.translate(s>n?(n+s)/2:Math.min(0,n)||Math.max(0,s),o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o))}Ii.prototype;class Ni{constructor(t,e,i,n){this.opts=n||{},this.canvas=t,this.w=this.canvas.offsetWidth,this.h=this.canvas.offsetHeight,this.canvas.width=this.w,this.canvas.height=this.h;const s=this.canvas.getContext("2d");if(!s)throw"Impossible to create canvas 2D context";if(this.ctx=s,this.center=e||{x:.5*this.w,y:.5*this.h},this.zf=i,this.backgroundColor=n.backgroundColor||"white",this.onZoomStartFun=n.onZoomStartFun,this.onZoomEndFun=n.onZoomEndFun,this.onZoomFun=n.onZoomFun,this.extGeo={xMin:NaN,xMax:NaN,yMin:NaN,yMax:NaN},this.updateExtentGeo(),!n.disableZoom){let t=Ai;(function(){var t,e,i,n=Pi,s=Bi,r=ki,o=zi,a=Oi,h=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],c=250,u=Tt,d=xt("start","zoom","end"),f=500,p=150,m=0,y=10;function _(t){t.property("__zoom",Ei).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",I).filter(a).on("touchstart.zoom",A).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",L).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(h[0],Math.min(h[1],e)))===t.k?t:new Ii(e,t.x,t.y)}function v(t,e,i){var n=e[0]-i[0]*t.k,s=e[1]-i[1]*t.k;return n===t.x&&s===t.y?t:new Ii(t.k,n,s)}function b(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function x(t,e,i,n){t.on("start.zoom",(function(){w(this,arguments).event(n).start()})).on("interrupt.zoom end.zoom",(function(){w(this,arguments).event(n).end()})).tween("zoom",(function(){var t=this,r=arguments,o=w(t,r).event(n),a=s.apply(t,r),h=null==i?b(a):"function"==typeof i?i.apply(t,r):i,l=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),c=t.__zoom,d="function"==typeof e?e.apply(t,r):e,f=u(c.invert(h).concat(l/c.k),d.invert(h).concat(l/d.k));return function(t){if(1===t)t=d;else{var e=f(t),i=l/e[2];t=new Ii(i,h[0]-e[0]*i,h[1]-e[1]*i)}o.zoom(null,t)}}))}function w(t,e,i){return!i&&t.__zooming||new M(t,e)}function M(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=s.apply(t,e),this.taps=0}function S(t,...e){if(n.apply(this,arguments)){var i=w(this,e).event(t),s=this.__zoom,a=Math.max(h[0],Math.min(h[1],s.k*Math.pow(2,o.apply(this,arguments)))),c=It(t);if(i.wheel)i.mouse[0][0]===c[0]&&i.mouse[0][1]===c[1]||(i.mouse[1]=s.invert(i.mouse[0]=c)),clearTimeout(i.wheel);else{if(s.k===a)return;i.mouse=[c,s.invert(c)],ne(this),i.start()}Li(t),i.wheel=setTimeout((function(){i.wheel=null,i.end()}),p),i.zoom("mouse",r(v(g(s,a),i.mouse[0],i.mouse[1]),i.extent,l))}}function T(t,...e){if(!i&&n.apply(this,arguments)){var s=t.currentTarget,o=w(this,e,!0).event(t),a=mt(t.view).on("mousemove.zoom",(function(t){if(Li(t),!o.moved){var e=t.clientX-c,i=t.clientY-u;o.moved=e*e+i*i>m}o.event(t).zoom("mouse",r(v(o.that.__zoom,o.mouse[0]=It(t,s),o.mouse[1]),o.extent,l))}),!0).on("mouseup.zoom",(function(t){a.on("mousemove.zoom mouseup.zoom",null),function(t,e){var i=t.document.documentElement,n=mt(t).on("dragstart.drag",null);e&&(n.on("click.drag",Mt,wt),setTimeout((function(){n.on("click.drag",null)}),0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}(t.view,o.moved),Li(t),o.event(t).end()}),!0),h=It(t,s),c=t.clientX,u=t.clientY;!function(t){var e=t.document.documentElement,i=mt(t).on("dragstart.drag",Mt,wt);"onselectstart"in e?i.on("selectstart.drag",Mt,wt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(t.view),Ci(t),o.mouse=[h,this.__zoom.invert(h)],ne(this),o.start()}}function I(t,...e){if(n.apply(this,arguments)){var i=this.__zoom,o=It(t.changedTouches?t.changedTouches[0]:t,this),a=i.invert(o),h=i.k*(t.shiftKey?.5:2),u=r(v(g(i,h),o,a),s.apply(this,e),l);Li(t),c>0?mt(this).transition().duration(c).call(x,u,o,t):mt(this).call(_.transform,u,o,t)}}function A(i,...s){if(n.apply(this,arguments)){var r,o,a,h,l=i.touches,c=l.length,u=w(this,s,i.changedTouches.length===c).event(i);for(Ci(i),o=0;o<c;++o)h=[h=It(a=l[o],this),this.__zoom.invert(h),a.identifier],u.touch0?u.touch1||u.touch0[2]===h[2]||(u.touch1=h,u.taps=0):(u.touch0=h,r=!0,u.taps=1+!!t);t&&(t=clearTimeout(t)),r&&(u.taps<2&&(e=h[0],t=setTimeout((function(){t=null}),f)),ne(this),u.start())}}function C(t,...e){if(this.__zooming){var i,n,s,o,a=w(this,e).event(t),h=t.changedTouches,c=h.length;for(Li(t),i=0;i<c;++i)s=It(n=h[i],this),a.touch0&&a.touch0[2]===n.identifier?a.touch0[0]=s:a.touch1&&a.touch1[2]===n.identifier&&(a.touch1[0]=s);if(n=a.that.__zoom,a.touch1){var u=a.touch0[0],d=a.touch0[1],f=a.touch1[0],p=a.touch1[1],m=(m=f[0]-u[0])*m+(m=f[1]-u[1])*m,y=(y=p[0]-d[0])*y+(y=p[1]-d[1])*y;n=g(n,Math.sqrt(m/y)),s=[(u[0]+f[0])/2,(u[1]+f[1])/2],o=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!a.touch0)return;s=a.touch0[0],o=a.touch0[1]}a.zoom("touch",r(v(n,s,o),a.extent,l))}}function L(t,...n){if(this.__zooming){var s,r,o=w(this,n).event(t),a=t.changedTouches,h=a.length;for(Ci(t),i&&clearTimeout(i),i=setTimeout((function(){i=null}),f),s=0;s<h;++s)r=a[s],o.touch0&&o.touch0[2]===r.identifier?delete o.touch0:o.touch1&&o.touch1[2]===r.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(r=It(r,this),Math.hypot(e[0]-r[0],e[1]-r[1])<y)){var l=mt(this).on("dblclick.zoom");l&&l.apply(this,arguments)}}}return _.transform=function(t,e,i,n){var s=t.selection?t.selection():t;s.property("__zoom",Ei),t!==s?x(t,e,i,n):s.interrupt().each((function(){w(this,arguments).event(n).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},_.scaleBy=function(t,e,i,n){_.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),i,n)},_.scaleTo=function(t,e,i,n){_.transform(t,(function(){var t=s.apply(this,arguments),n=this.__zoom,o=null==i?b(t):"function"==typeof i?i.apply(this,arguments):i,a=n.invert(o),h="function"==typeof e?e.apply(this,arguments):e;return r(v(g(n,h),o,a),t,l)}),i,n)},_.translateBy=function(t,e,i,n){_.transform(t,(function(){return r(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof i?i.apply(this,arguments):i),s.apply(this,arguments),l)}),null,n)},_.translateTo=function(t,e,i,n,o){_.transform(t,(function(){var t=s.apply(this,arguments),o=this.__zoom,a=null==n?b(t):"function"==typeof n?n.apply(this,arguments):n;return r(Ai.translate(a[0],a[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof i?-i.apply(this,arguments):-i),t,l)}),n,o)},M.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=mt(this.that).datum();d.call(t,this.that,new Ti(t,{sourceEvent:this.sourceEvent,target:_,type:t,transform:this.that.__zoom,dispatch:d}),e)}},_.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:Si(+t),_):o},_.filter=function(t){return arguments.length?(n="function"==typeof t?t:Si(!!t),_):n},_.touchable=function(t){return arguments.length?(a="function"==typeof t?t:Si(!!t),_):a},_.extent=function(t){return arguments.length?(s="function"==typeof t?t:Si([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),_):s},_.scaleExtent=function(t){return arguments.length?(h[0]=+t[0],h[1]=+t[1],_):[h[0],h[1]]},_.translateExtent=function(t){return arguments.length?(l[0][0]=+t[0][0],l[1][0]=+t[1][0],l[0][1]=+t[0][1],l[1][1]=+t[1][1],_):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},_.constrain=function(t){return arguments.length?(r=t,_):r},_.duration=function(t){return arguments.length?(c=+t,_):c},_.interpolate=function(t){return arguments.length?(u=t,_):u},_.on=function(){var t=d.on.apply(d,arguments);return t===d?_:t},_.clickDistance=function(t){return arguments.length?(m=(t=+t)*t,_):Math.sqrt(m)},_.tapDistance=function(t){return arguments.length?(y=+t,_):y},_})().wheelDelta((t=>-t.deltaY*(1===t.deltaMode?.07:t.deltaMode?1:.004))).on("zoom",(e=>{const i=e.transform,n=t.k/i.k;if(1==n){const e=t.x-i.x,n=t.y-i.y;this.pan(e*this.getZf(),-n*this.getZf())}else{const t=e.sourceEvent;if(t instanceof WheelEvent)this.zoom(n,this.pixToGeoX(e.sourceEvent.offsetX),this.pixToGeoY(e.sourceEvent.offsetY));else if(t instanceof TouchEvent){let e=0,i=0;for(let n of t.targetTouches)e+=n.clientX,i+=n.clientY;e/=t.targetTouches.length,i/=t.targetTouches.length,this.zoom(n,this.pixToGeoX(e),this.pixToGeoY(i))}}t=i,this.onZoomFun&&this.onZoomFun(e)})).on("start",(t=>{this.canvasSave.c=document.createElement("canvas"),this.canvasSave.c.setAttribute("width",""+this.w),this.canvasSave.c.setAttribute("height",""+this.h),this.canvasSave.c.getContext("2d").drawImage(this.canvas,0,0),this.canvasSave.dx=0,this.canvasSave.dy=0,this.canvasSave.f=1,this.onZoomStartFun&&this.onZoomStartFun(t)})).on("end",(t=>{this.redraw(!0),this.canvasSave={c:null,dx:0,dy:0,f:1},this.onZoomEndFun&&this.onZoomEndFun(t)}))(mt(this.canvas))}this.zfExtent=[0,1/0],this.canvasSave={c:null,dx:0,dy:0,f:1}}setCenter(t){this.center=t}getCenter(){return this.center}setZf(t){this.zf=t,this.slider&&this.slider.attr("value",+this.zf)}getZf(){return this.zf}setZfExtent(t){this.zfExtent=t}getZfExtent(){return this.zfExtent}initCanvasTransform(){this.ctx.setTransform(1,0,0,1,0,0)}setCanvasTransform(){const t=1/this.getZf(),e=-this.center.x/this.getZf()+.5*this.w,i=this.center.y/this.getZf()+.5*this.h;this.ctx.setTransform(t,0,0,-t,e,i)}getWebGLTransform(){const t=2/(this.w*this.getZf()),e=2/(this.h*this.getZf());return[t,0,0,0,e,0,-t*this.center.x,-e*this.center.y,1]}redraw(t=!0){throw new Error("Method redraw not implemented.")}clear(t="white"){this.opts.transparentBackground?this.ctx.clearRect(0,0,this.w,this.h):(this.ctx&&(this.ctx.fillStyle=t),this.ctx.fillRect(0,0,this.w,this.h))}pan(t=0,e=0){this.center.x+=t,this.center.y+=e,this.updateExtentGeo(),this.canvasSave.c&&(this.canvasSave.dx-=t/this.getZf(),this.canvasSave.dy+=e/this.getZf(),this.clear(this.backgroundColor),this.ctx.drawImage(this.canvasSave.c,this.canvasSave.dx,this.canvasSave.dy))}zoom(t=1,e=this.center.x,i=this.center.y){if(this.zfExtent[0]==this.getZf()&&t<=1)return;if(this.zfExtent[1]==this.getZf()&&t>=1)return;const n=t*this.getZf();n<this.zfExtent[0]&&(t=this.zfExtent[0]/this.getZf()),n>this.zfExtent[1]&&(t=this.zfExtent[1]/this.getZf()),this.setZf(t*this.getZf());const s=(e-this.center.x)*(1-t);this.center.x+=s;const r=(i-this.center.y)*(1-t);this.center.y+=r,this.updateExtentGeo(),this.canvasSave.c&&(this.clear(this.backgroundColor),this.canvasSave.f/=t,this.canvasSave.dx=this.geoToPixX(e)*(1-this.canvasSave.f),this.canvasSave.dy=this.geoToPixY(i)*(1-this.canvasSave.f),this.clear(this.backgroundColor),this.ctx.drawImage(this.canvasSave.c,this.canvasSave.dx,this.canvasSave.dy,this.canvasSave.f*this.canvasSave.c.width,this.canvasSave.f*this.canvasSave.c.height))}updateExtentGeo(t=20){return this.extGeo={xMin:this.pixToGeoX(-t),xMax:this.pixToGeoX(this.w+t),yMin:this.pixToGeoY(this.h+t),yMax:this.pixToGeoY(-t)},this.extGeo}toDraw(t){return!(t.x<this.extGeo.xMin||t.x>this.extGeo.xMax||t.y<this.extGeo.yMin||t.y>this.extGeo.yMax)}geoToPixX(t){return(t-this.center.x)/this.getZf()+.5*this.w}geoToPixY(t){return-(t-this.center.y)/this.getZf()+.5*this.h}pixToGeoX(t){return(t-.5*this.w)*this.getZf()+this.center.x}pixToGeoY(t){return-(t-.5*this.h)*this.getZf()+this.center.y}setViewFromURL(){const t=Ni.getParameterByName("x"),e=Ni.getParameterByName("y"),i=Ni.getParameterByName("z"),n=this.getCenter();null==t||null==t||isNaN(+t)||(n.x=+t),null==e||null==e||isNaN(+e)||(n.y=+e),null==i||null==i||isNaN(+i)||this.setZf(+i)}addZoomSlider(t,e){(e=e||{}).width=e.width||"30px",e.height=e.height||"300px";const i=mt("#"+t);if(i.empty())return console.error("Could not find div element to build zoom slider. Id: "+t),this;const n=this;return this.slider=i.append("input").attr("type","range").attr("min",this.getZfExtent()[0]).attr("max",this.getZfExtent()[1]).attr("value",this.getZf()).on("input",(function(t){if(!this||!this.value)return;const e=+this.value;mt(this).attr("value",e),n.setZf(e),n.redraw()})).style("width",e.width).style("height",e.height).style("opacity",.7).on("mouseover",(function(t){mt(this).style("opacity",1)})).on("mouseout",(function(t){mt(this).style("opacity",.7)})).style("-webkit-appearance","slider-vertical").style("writing-mode","bt-lr").attr("orient","vertical").style("background","lightgray").style("outline","none").style("-webkit-transition",".2s").style("transition","opacity .2s"),this}static getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return e?decodeURIComponent(e[1].replace(/\+/g," ")):null}}class Fi{constructor(t,e,i={}){if(i=i||{},this.dataset=t,this.styles=e,this.visible=0!=i.visible,this.minZoom=i.minZoom||0,this.maxZoom=i.maxZoom||1/0,this.minZoom>=this.maxZoom)throw new Error("Unexpected zoom limits for layer. Zoom min should be smaller than zoom max.");this.pixNb=i.pixNb||3,this.cellInfoHTML=i.cellInfoHTML||Fi.defaultCellInfoHTML}getDatasetComponent(t){if(t<this.minZoom||t>this.maxZoom)return;if(1==this.dataset.datasetComponents.length)return this.dataset.datasetComponents[0];const e=this.dataset.resolutions;let i=0,n=e[i]/this.pixNb;for(;n<t&&i<e.length;)i++,n=e[i]/this.pixNb;return i==e.length?this.dataset.datasetComponents[e.length-1]:this.dataset.datasetComponents[i]}static defaultCellInfoHTML(t){const e=[];for(const i of Object.keys(t))"x"!==i&&"y"!==i&&e.push("<b>",i,"</b>"," : ",t[i],"<br>");return e.join("")}}class Di{constructor(t,e,i={}){if(i=i||{},this.datasetComponents=t,this.resolutions=e,this.datasetComponents.length>1&&this.datasetComponents.length!=this.resolutions.length)throw new Error("Uncompatible number of datasets and resolutions: "+this.datasetComponents.length+" "+this.resolutions.length);i.preprocess&&this.setPrepocesses(i.preprocess)}setPrepocesses(t){for(let e of this.datasetComponents)e.preprocess=t;return this}static make(t,e,i){const n=[];for(const i of t)n.push(e(i));return new Di(n,t,i)}}class Ri{constructor(t){t=t||{},this.div=t.div||"tooltip_eurostat",this.maxWidth=t.maxWidth||"20em",this.fontSize=t.fontSize||"1.2em",this.background=t.background||"white",this.padding=t.padding||"5px",this.border=t.border||"0px",this["border-radius"]=t["border-radius"]||"5px",this["box-shadow"]=t["box-shadow"]||"5px 5px 5px grey",this["font-family"]=t["font-family"]||"Helvetica, Arial, sans-serif",this.transitionDuration=t.transitionDuration||100,this.xOffset=t.xOffset||30,this.yOffset=t.yOffset||20,this.yMouseOffset=t.yMouseOffset||0,this.xMouseOffset=t.xMouseOffset||0,this.tooltip=mt("#"+this.div),this.tooltip.empty()&&(this.tooltip=mt("body").append("div").attr("id",this.div)),this.tooltip.style("max-width",this.maxWidth),this.tooltip.style("overflow","hidden"),this.tooltip.style("font-size",this.fontSize),this.tooltip.style("background",this.background),this.tooltip.style("padding",this.padding),this.tooltip.style("border",this.border),this.tooltip.style("border-radius",this["border-radius"]),this.tooltip.style("box-shadow",this["box-shadow"]),this.tooltip.style("font-family",this["font-family"]),this.tooltip.style("position","absolute"),this.tooltip.style("pointer-events","none"),this.tooltip.style("opacity","0")}show(){this.tooltip.transition().duration(this.transitionDuration).style("opacity",1)}hide(){this.tooltip.transition().duration(this.transitionDuration).style("opacity",0)}html(t){this.tooltip.html(t)}setPosition(t){this.tooltip.style("left",t.pageX+this.xOffset+"px").style("top",t.pageY-this.yOffset+"px")}style(t,e){return 1==arguments.length?this.tooltip.style(t):(this.tooltip.style(t,e),this)}attr(t,e){return 1==arguments.length?this.tooltip.attr(t):(this.tooltip.attr(t,e),this)}}var Ui={},Zi={};function ji(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Vi(t){var e=Object.create(null),i=[];return t.forEach((function(t){for(var n in t)n in e||i.push(e[n]=n)})),i}function Wi(t,e){var i=t+"",n=i.length;return n<e?new Array(e-n+1).join(0)+i:i}function Gi(t){var e=new RegExp('["'+t+"\n\r]"),i=t.charCodeAt(0);function n(t,e){var n,s=[],r=t.length,o=0,a=0,h=r<=0,l=!1;function c(){if(h)return Zi;if(l)return l=!1,Ui;var e,n,s=o;if(34===t.charCodeAt(s)){for(;o++<r&&34!==t.charCodeAt(o)||34===t.charCodeAt(++o););return(e=o)>=r?h=!0:10===(n=t.charCodeAt(o++))?l=!0:13===n&&(l=!0,10===t.charCodeAt(o)&&++o),t.slice(s+1,e-1).replace(/""/g,'"')}for(;o<r;){if(10===(n=t.charCodeAt(e=o++)))l=!0;else if(13===n)l=!0,10===t.charCodeAt(o)&&++o;else if(n!==i)continue;return t.slice(s,e)}return h=!0,t.slice(s,r)}for(10===t.charCodeAt(r-1)&&--r,13===t.charCodeAt(r-1)&&--r;(n=c())!==Zi;){for(var u=[];n!==Ui&&n!==Zi;)u.push(n),n=c();e&&null==(u=e(u,a++))||s.push(u)}return s}function s(e,i){return e.map((function(e){return i.map((function(t){return o(e[t])})).join(t)}))}function r(e){return e.map(o).join(t)}function o(t){return null==t?"":t instanceof Date?(s=(i=t).getUTCHours(),r=i.getUTCMinutes(),o=i.getUTCSeconds(),a=i.getUTCMilliseconds(),isNaN(i)?"Invalid Date":((n=i.getUTCFullYear())<0?"-"+Wi(-n,6):n>9999?"+"+Wi(n,6):Wi(n,4))+"-"+Wi(i.getUTCMonth()+1,2)+"-"+Wi(i.getUTCDate(),2)+(a?"T"+Wi(s,2)+":"+Wi(r,2)+":"+Wi(o,2)+"."+Wi(a,3)+"Z":o?"T"+Wi(s,2)+":"+Wi(r,2)+":"+Wi(o,2)+"Z":r||s?"T"+Wi(s,2)+":"+Wi(r,2)+"Z":"")):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t;var i,n,s,r,o,a}return{parse:function(t,e){var i,s,r=n(t,(function(t,n){if(i)return i(t,n-1);s=t,i=e?function(t,e){var i=ji(t);return function(n,s){return e(i(n),s,t)}}(t,e):ji(t)}));return r.columns=s||[],r},parseRows:n,format:function(e,i){return null==i&&(i=Vi(e)),[i.map(o).join(t)].concat(s(e,i)).join("\n")},formatBody:function(t,e){return null==e&&(e=Vi(t)),s(t,e).join("\n")},formatRows:function(t){return t.map(r).join("\n")},formatRow:r,formatValue:o}}var qi=Gi(","),Hi=qi.parse,Yi=(qi.parseRows,qi.format,qi.formatBody,qi.formatRows,qi.formatRow,qi.formatValue,Gi("\t")),$i=Yi.parse;function Xi(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function Ki(t){return function(e,i,n){return 2===arguments.length&&"function"==typeof i&&(n=i,i=void 0),function(t,e){return fetch(t,e).then(Xi)}(e,i).then((function(e){return t(e,n)}))}}Yi.parseRows,Yi.format,Yi.formatBody,Yi.formatRows,Yi.formatRow,Yi.formatValue;var Ji=Ki(Hi);Ki($i);class Qi{constructor(t,e,i={}){i=i||{},this.url=t,this.resolution=e,this.preprocess=i.preprocess||void 0,this.cellsViewCache=[]}getData(t,e){throw new Error("Method getData not implemented.")}updateViewCache(t){throw new Error("Method updateViewCache not implemented.")}getCellFromPosition(t,e){const i=this.getResolution(),n=i*Math.floor(t.x/i),s=i*Math.floor(t.y/i);for(const t of e)if(t.x==n&&t.y==s)return t}getResolution(){return this.resolution}getViewCache(){return this.cellsViewCache}}class tn extends Qi{constructor(t,e,i={}){super(t,e,i),this.cells=[],this.infoLoadingStatus="notLoaded"}getData(t,e){return"notLoaded"!=this.infoLoadingStatus||(this.infoLoadingStatus="loading",(async()=>{try{const t=await Ji(this.url);for(const e of t)e.x=+e.x,e.y=+e.y;if(this.preprocess){this.cells=[];for(const e of t)0!=this.preprocess(e)&&this.cells.push(e)}else this.cells=t;e&&e(),this.infoLoadingStatus="loaded"}catch(t){this.infoLoadingStatus="failed",this.cells=[]}})()),this}updateViewCache(t){if(this.cells){this.cellsViewCache=[];for(const e of this.cells)+e.x+this.resolution<t.xMin||+e.x-this.resolution>t.xMax||+e.y+this.resolution<t.yMin||+e.y-this.resolution>t.yMax||this.cellsViewCache.push(e)}}}class en{constructor(t,e,i,n){this.cells=t,this.x=e,this.y=i;const s=n.resolutionGeo,r=n.tileSizeCell;this.extGeo={xMin:n.originPoint.x+s*r*this.x,xMax:n.originPoint.x+s*r*(this.x+1),yMin:n.originPoint.y+s*r*this.y,yMax:n.originPoint.y+s*r*(this.y+1)};for(let t of this.cells)t.x=this.extGeo.xMin+t.x*s,t.y=this.extGeo.yMin+t.y*s}}function nn(t,e){if(e){if(0==e.length)return 0;if(t<=e[0])return 0;for(let i=1;i<e.length;i++)if(e[i-1]<t&&t<=e[i])return i;return e.length}}function sn(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function rn(t,e){return fetch(t,e).then(sn)}var on,an,hn,ln,cn,un,dn,fn,pn,mn,yn,_n,gn;function vn(t){if(null===t)return"null";if(void 0===t)return"undefined";switch(typeof t){case"number":case"bigint":return`${t}`;case"string":return`"${t}"`}return"function"==typeof t[Symbol.toPrimitive]?t[Symbol.toPrimitive]("string"):ArrayBuffer.isView(t)?t instanceof BigInt64Array||t instanceof BigUint64Array?`[${[...t].map((t=>vn(t)))}]`:`[${t}]`:ArrayBuffer.isView(t)?`[${t}]`:JSON.stringify(t,((t,e)=>"bigint"==typeof e?`${e}`:e))}function bn(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))}function xn(t){return this instanceof xn?(this.v=t,this):new xn(t)}function wn(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=i.apply(t,e||[]),r=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){s[t]&&(n[t]=function(e){return new Promise((function(i,n){r.push([t,e,i,n])>1||a(t,e)}))})}function a(t,e){try{(i=s[t](e)).value instanceof xn?Promise.resolve(i.value.v).then(h,l):c(r[0][2],i)}catch(t){c(r[0][3],t)}var i}function h(t){a("next",t)}function l(t){a("throw",t)}function c(t,e){t(e),r.shift(),r.length&&a(r[0][0],r[0][1])}}function Mn(t){var e,i;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,s){e[n]=t[n]?function(e){return(i=!i)?{value:xn(t[n](e)),done:!1}:s?s(e):e}:s}}function Sn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,s){!function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)}(n,s,(e=t[i](e)).done,e.value)}))}}}!function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"}(on||(on={})),(gn=an||(an={}))[gn.Sparse=0]="Sparse",gn[gn.Dense=1]="Dense",function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"}(hn||(hn={})),(_n=ln||(ln={}))[_n.DAY=0]="DAY",_n[_n.MILLISECOND=1]="MILLISECOND",(yn=cn||(cn={}))[yn.SECOND=0]="SECOND",yn[yn.MILLISECOND=1]="MILLISECOND",yn[yn.MICROSECOND=2]="MICROSECOND",yn[yn.NANOSECOND=3]="NANOSECOND",(mn=un||(un={}))[mn.YEAR_MONTH=0]="YEAR_MONTH",mn[mn.DAY_TIME=1]="DAY_TIME",mn[mn.MONTH_DAY_NANO=2]="MONTH_DAY_NANO",function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"}(dn||(dn={})),function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(fn||(fn={})),function(t){t[t.OFFSET=0]="OFFSET",t[t.DATA=1]="DATA",t[t.VALIDITY=2]="VALIDITY",t[t.TYPE=3]="TYPE"}(pn||(pn={})),Object.create,Object.create;const Tn=new TextDecoder("utf-8"),In=t=>Tn.decode(t),An=new TextEncoder,Cn=t=>An.encode(t),[Ln,Pn]=(()=>{const t=()=>{throw new Error("BigInt is not available in this environment")};function e(){throw t()}return e.asIntN=()=>{throw t()},e.asUintN=()=>{throw t()},"undefined"!=typeof BigInt?[BigInt,!0]:[e,!1]})(),[Bn,En]=(()=>{const t=()=>{throw new Error("BigInt64Array is not available in this environment")};return"undefined"!=typeof BigInt64Array?[BigInt64Array,!0]:[class{static get BYTES_PER_ELEMENT(){return 8}static of(){throw t()}static from(){throw t()}constructor(){throw t()}},!1]})(),[zn,On]=(()=>{const t=()=>{throw new Error("BigUint64Array is not available in this environment")};return"undefined"!=typeof BigUint64Array?[BigUint64Array,!0]:[class{static get BYTES_PER_ELEMENT(){return 8}static of(){throw t()}static from(){throw t()}constructor(){throw t()}},!1]})(),kn=t=>"function"==typeof t,Nn=t=>null!=t&&Object(t)===t,Fn=t=>Nn(t)&&kn(t.then),Dn=t=>Nn(t)&&kn(t[Symbol.iterator]),Rn=t=>Nn(t)&&kn(t[Symbol.asyncIterator]),Un=t=>Nn(t)&&Nn(t.schema),Zn=t=>Nn(t)&&"done"in t&&"value"in t,jn=t=>Nn(t)&&kn(t.stat)&&(t=>"number"==typeof t)(t.fd),Vn=t=>Nn(t)&&Gn(t.body),Wn=t=>"_getDOMStream"in t&&"_getNodeStream"in t,Gn=t=>Nn(t)&&kn(t.cancel)&&kn(t.getReader)&&!Wn(t),qn=t=>Nn(t)&&kn(t.read)&&kn(t.pipe)&&(t=>"boolean"==typeof t)(t.readable)&&!Wn(t),Hn=t=>Nn(t)&&kn(t.clear)&&kn(t.bytes)&&kn(t.position)&&kn(t.setPosition)&&kn(t.capacity)&&kn(t.getBufferIdentifier)&&kn(t.createLong),Yn="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function $n(t,e,i=0,n=e.byteLength){const s=t.byteLength,r=new Uint8Array(t.buffer,t.byteOffset,s),o=new Uint8Array(e.buffer,e.byteOffset,Math.min(n,s));return r.set(o,i),t}function Xn(t,e){const i=function(t){const e=t[0]?[t[0]]:[];let i,n,s,r;for(let o,a,h=0,l=0,c=t.length;++h<c;)o=e[l],a=t[h],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset?a&&(e[++l]=a):(({byteOffset:i,byteLength:s}=o),({byteOffset:n,byteLength:r}=a),i+s<n||n+r<i?a&&(e[++l]=a):e[l]=new Uint8Array(o.buffer,i,n-i+r));return e}(t),n=i.reduce(((t,e)=>t+e.byteLength),0);let s,r,o,a=0,h=-1;const l=Math.min(e||Number.POSITIVE_INFINITY,n);for(const t=i.length;++h<t;){if(s=i[h],r=s.subarray(0,Math.min(s.length,l-a)),l<=a+r.length){r.length<s.length?i[h]=s.subarray(r.length):r.length===s.length&&h++,o?$n(o,r,a):o=r;break}$n(o||(o=new Uint8Array(l)),r,a),a+=r.length}return[o||new Uint8Array(0),i.slice(h),n-(o?o.byteLength:0)]}function Kn(t,e){let i=Zn(e)?e.value:e;return i instanceof t?t===Uint8Array?new t(i.buffer,i.byteOffset,i.byteLength):i:i?("string"==typeof i&&(i=Cn(i)),i instanceof ArrayBuffer||i instanceof Yn?new t(i):Hn(i)?Kn(t,i.bytes()):ArrayBuffer.isView(i)?i.byteLength<=0?new t(0):new t(i.buffer,i.byteOffset,i.byteLength/t.BYTES_PER_ELEMENT):t.from(i)):new t(0)}const Jn=t=>Kn(Int32Array,t),Qn=t=>Kn(Uint8Array,t),ts=t=>(t.next(),t);function es(t,e){return wn(this,arguments,(function*(){if(Fn(e))return yield xn(yield xn(yield*Mn(Sn(es(t,yield xn(e))))));const i=function(t){return wn(this,arguments,(function*(){yield yield xn(yield xn(t))}))},n="string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Yn?i(e):Dn(e)?function(t){return wn(this,arguments,(function*(){yield xn(yield*Mn(Sn(ts(function*(t){let e=null;do{e=t.next(yield null==e?void 0:e.value)}while(!e.done)}(t[Symbol.iterator]())))))}))}(e):Rn(e)?e:i(e);return yield xn(yield*Mn(Sn(ts(function(e){return wn(this,arguments,(function*(){let i=null;do{i=yield xn(e.next(yield yield xn(Kn(t,i))))}while(!i.done)}))}(n[Symbol.asyncIterator]()))))),yield xn(new t)}))}const is=Symbol.for("isArrowBigNum");function ns(t,...e){return 0===e.length?Object.setPrototypeOf(Kn(this.TypedArray,t),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(t,...e),this.constructor.prototype)}function ss(...t){return ns.apply(this,t)}function rs(...t){return ns.apply(this,t)}function os(...t){return ns.apply(this,t)}function as(t){const{buffer:e,byteOffset:i,length:n,signed:s}=t,r=new zn(e,i,n),o=s&&r[r.length-1]&BigInt(1)<<BigInt(63);let a=o?BigInt(1):BigInt(0),h=BigInt(0);if(o){for(const t of r)a+=~t*(BigInt(1)<<BigInt(32)*h++);a*=BigInt(-1)}else for(const t of r)a+=t*(BigInt(1)<<BigInt(32)*h++);return a}let hs,ls;function cs(t){let e="";const i=new Uint32Array(2);let n=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);const s=new Uint32Array((n=new Uint16Array(n).reverse()).buffer);let r=-1;const o=n.length-1;do{for(i[0]=n[r=0];r<o;)n[r++]=i[1]=i[0]/10,i[0]=(i[0]-10*i[1]<<16)+n[r];n[r]=i[1]=i[0]/10,i[0]=i[0]-10*i[1],e=`${i[0]}${e}`}while(s[0]||s[1]||s[2]||s[3]);return null!=e?e:"0"}ns.prototype[is]=!0,ns.prototype.toJSON=function(){return`"${hs(this)}"`},ns.prototype.valueOf=function(){return as(this)},ns.prototype.toString=function(){return hs(this)},ns.prototype[Symbol.toPrimitive]=function(t="default"){switch(t){case"number":return as(this);case"string":return hs(this);case"default":return ls(this)}return hs(this)},Object.setPrototypeOf(ss.prototype,Object.create(Int32Array.prototype)),Object.setPrototypeOf(rs.prototype,Object.create(Uint32Array.prototype)),Object.setPrototypeOf(os.prototype,Object.create(Uint32Array.prototype)),Object.assign(ss.prototype,ns.prototype,{constructor:ss,signed:!0,TypedArray:Int32Array,BigIntArray:Bn}),Object.assign(rs.prototype,ns.prototype,{constructor:rs,signed:!1,TypedArray:Uint32Array,BigIntArray:zn}),Object.assign(os.prototype,ns.prototype,{constructor:os,signed:!0,TypedArray:Uint32Array,BigIntArray:zn}),Pn?(ls=t=>8===t.byteLength?new t.BigIntArray(t.buffer,t.byteOffset,1)[0]:cs(t),hs=t=>8===t.byteLength?`${new t.BigIntArray(t.buffer,t.byteOffset,1)[0]}`:cs(t)):(hs=cs,ls=hs);class us{static new(t,e){switch(e){case!0:return new ss(t);case!1:return new rs(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case Bn:return new ss(t)}return 16===t.byteLength?new os(t):new rs(t)}static signed(t){return new ss(t)}static unsigned(t){return new rs(t)}static decimal(t){return new os(t)}constructor(t,e){return us.new(t,e)}}var ds,fs,ps,ms,ys,_s,gs,vs,bs,xs,ws,Ms,Ss,Ts,Is,As,Cs,Ls,Ps,Bs;class Es{static isNull(t){return(null==t?void 0:t.typeId)===fn.Null}static isInt(t){return(null==t?void 0:t.typeId)===fn.Int}static isFloat(t){return(null==t?void 0:t.typeId)===fn.Float}static isBinary(t){return(null==t?void 0:t.typeId)===fn.Binary}static isUtf8(t){return(null==t?void 0:t.typeId)===fn.Utf8}static isBool(t){return(null==t?void 0:t.typeId)===fn.Bool}static isDecimal(t){return(null==t?void 0:t.typeId)===fn.Decimal}static isDate(t){return(null==t?void 0:t.typeId)===fn.Date}static isTime(t){return(null==t?void 0:t.typeId)===fn.Time}static isTimestamp(t){return(null==t?void 0:t.typeId)===fn.Timestamp}static isInterval(t){return(null==t?void 0:t.typeId)===fn.Interval}static isList(t){return(null==t?void 0:t.typeId)===fn.List}static isStruct(t){return(null==t?void 0:t.typeId)===fn.Struct}static isUnion(t){return(null==t?void 0:t.typeId)===fn.Union}static isFixedSizeBinary(t){return(null==t?void 0:t.typeId)===fn.FixedSizeBinary}static isFixedSizeList(t){return(null==t?void 0:t.typeId)===fn.FixedSizeList}static isMap(t){return(null==t?void 0:t.typeId)===fn.Map}static isDictionary(t){return(null==t?void 0:t.typeId)===fn.Dictionary}static isDenseUnion(t){return Es.isUnion(t)&&t.mode===an.Dense}static isSparseUnion(t){return Es.isUnion(t)&&t.mode===an.Sparse}get typeId(){return fn.NONE}}ds=Symbol.toStringTag,Es[ds]=((Bs=Es.prototype).children=null,Bs.ArrayType=Array,Bs[Symbol.toStringTag]="DataType");class zs extends Es{toString(){return"Null"}get typeId(){return fn.Null}}fs=Symbol.toStringTag,zs[fs]=(t=>t[Symbol.toStringTag]="Null")(zs.prototype);class Os extends Es{constructor(t,e){super(),this.isSigned=t,this.bitWidth=e}get typeId(){return fn.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}ps=Symbol.toStringTag,Os[ps]=(t=>(t.isSigned=null,t.bitWidth=null,t[Symbol.toStringTag]="Int"))(Os.prototype);class ks extends Os{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(class extends Os{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}.prototype,"ArrayType",{value:Int8Array}),Object.defineProperty(class extends Os{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}.prototype,"ArrayType",{value:Int16Array}),Object.defineProperty(ks.prototype,"ArrayType",{value:Int32Array}),Object.defineProperty(class extends Os{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}}.prototype,"ArrayType",{value:BigInt64Array}),Object.defineProperty(class extends Os{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}.prototype,"ArrayType",{value:Uint8Array}),Object.defineProperty(class extends Os{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}.prototype,"ArrayType",{value:Uint16Array}),Object.defineProperty(class extends Os{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}.prototype,"ArrayType",{value:Uint32Array}),Object.defineProperty(class extends Os{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}}.prototype,"ArrayType",{value:BigUint64Array});class Ns extends Es{constructor(t){super(),this.precision=t}get typeId(){return fn.Float}get ArrayType(){switch(this.precision){case hn.HALF:return Uint16Array;case hn.SINGLE:return Float32Array;case hn.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}ms=Symbol.toStringTag,Ns[ms]=(t=>(t.precision=null,t[Symbol.toStringTag]="Float"))(Ns.prototype),Object.defineProperty(class extends Ns{constructor(){super(hn.HALF)}}.prototype,"ArrayType",{value:Uint16Array}),Object.defineProperty(class extends Ns{constructor(){super(hn.SINGLE)}}.prototype,"ArrayType",{value:Float32Array}),Object.defineProperty(class extends Ns{constructor(){super(hn.DOUBLE)}}.prototype,"ArrayType",{value:Float64Array});class Fs extends Es{constructor(){super()}get typeId(){return fn.Binary}toString(){return"Binary"}}ys=Symbol.toStringTag,Fs[ys]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Binary"))(Fs.prototype);class Ds extends Es{constructor(){super()}get typeId(){return fn.Utf8}toString(){return"Utf8"}}_s=Symbol.toStringTag,Ds[_s]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Utf8"))(Ds.prototype);class Rs extends Es{constructor(){super()}get typeId(){return fn.Bool}toString(){return"Bool"}}gs=Symbol.toStringTag,Rs[gs]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Bool"))(Rs.prototype);class Us extends Es{constructor(t,e,i=128){super(),this.scale=t,this.precision=e,this.bitWidth=i}get typeId(){return fn.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}vs=Symbol.toStringTag,Us[vs]=(t=>(t.scale=null,t.precision=null,t.ArrayType=Uint32Array,t[Symbol.toStringTag]="Decimal"))(Us.prototype);class Zs extends Es{constructor(t){super(),this.unit=t}get typeId(){return fn.Date}toString(){return`Date${32*(this.unit+1)}<${ln[this.unit]}>`}}bs=Symbol.toStringTag,Zs[bs]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Date"))(Zs.prototype);class js extends Es{constructor(t,e){super(),this.unit=t,this.bitWidth=e}get typeId(){return fn.Time}toString(){return`Time${this.bitWidth}<${cn[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}xs=Symbol.toStringTag,js[xs]=(t=>(t.unit=null,t.bitWidth=null,t[Symbol.toStringTag]="Time"))(js.prototype);class Vs extends Es{constructor(t,e){super(),this.unit=t,this.timezone=e}get typeId(){return fn.Timestamp}toString(){return`Timestamp<${cn[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}ws=Symbol.toStringTag,Vs[ws]=(t=>(t.unit=null,t.timezone=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Timestamp"))(Vs.prototype);class Ws extends Es{constructor(t){super(),this.unit=t}get typeId(){return fn.Interval}toString(){return`Interval<${un[this.unit]}>`}}Ms=Symbol.toStringTag,Ws[Ms]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Interval"))(Ws.prototype);class Gs extends Es{constructor(t){super(),this.children=[t]}get typeId(){return fn.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}Ss=Symbol.toStringTag,Gs[Ss]=(t=>(t.children=null,t[Symbol.toStringTag]="List"))(Gs.prototype);class qs extends Es{constructor(t){super(),this.children=t}get typeId(){return fn.Struct}toString(){return`Struct<{${this.children.map((t=>`${t.name}:${t.type}`)).join(", ")}}>`}}Ts=Symbol.toStringTag,qs[Ts]=(t=>(t.children=null,t[Symbol.toStringTag]="Struct"))(qs.prototype);class Hs extends Es{constructor(t,e,i){super(),this.mode=t,this.children=i,this.typeIds=e=Int32Array.from(e),this.typeIdToChildIndex=e.reduce(((t,e,i)=>(t[e]=i)&&t||t),Object.create(null))}get typeId(){return fn.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map((t=>`${t.type}`)).join(" | ")}>`}}Is=Symbol.toStringTag,Hs[Is]=(t=>(t.mode=null,t.typeIds=null,t.children=null,t.typeIdToChildIndex=null,t.ArrayType=Int8Array,t[Symbol.toStringTag]="Union"))(Hs.prototype);class Ys extends Es{constructor(t){super(),this.byteWidth=t}get typeId(){return fn.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}As=Symbol.toStringTag,Ys[As]=(t=>(t.byteWidth=null,t.ArrayType=Uint8Array,t[Symbol.toStringTag]="FixedSizeBinary"))(Ys.prototype);class $s extends Es{constructor(t,e){super(),this.listSize=t,this.children=[e]}get typeId(){return fn.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}Cs=Symbol.toStringTag,$s[Cs]=(t=>(t.children=null,t.listSize=null,t[Symbol.toStringTag]="FixedSizeList"))($s.prototype);class Xs extends Es{constructor(t,e=!1){super(),this.children=[t],this.keysSorted=e}get typeId(){return fn.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map((t=>`${t.name}:${t.type}`)).join(", ")}}>`}}Ls=Symbol.toStringTag,Xs[Ls]=(t=>(t.children=null,t.keysSorted=null,t[Symbol.toStringTag]="Map_"))(Xs.prototype);const Ks=(Js=-1,()=>++Js);var Js;class Qs extends Es{constructor(t,e,i,n){super(),this.indices=e,this.dictionary=t,this.isOrdered=n||!1,this.id=null==i?Ks():"number"==typeof i?i:i.low}get typeId(){return fn.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}function tr(t){const e=t;switch(t.typeId){case fn.Decimal:return t.bitWidth/32;case fn.Timestamp:return 2;case fn.Date:case fn.Interval:return 1+e.unit;case fn.FixedSizeList:return e.listSize;case fn.FixedSizeBinary:return e.byteWidth;default:return 1}}Ps=Symbol.toStringTag,Qs[Ps]=(t=>(t.id=null,t.indices=null,t.isOrdered=null,t.dictionary=null,t[Symbol.toStringTag]="Dictionary"))(Qs.prototype);class er{visitMany(t,...e){return t.map(((t,i)=>this.visit(t,...e.map((t=>t[i])))))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,e=!0){return function(t,e,i=!0){return"number"==typeof e?ir(t,e,i):"string"==typeof e&&e in fn?ir(t,fn[e],i):e&&e instanceof Es?ir(t,nr(e),i):(null==e?void 0:e.type)&&e.type instanceof Es?ir(t,nr(e.type),i):ir(t,fn.NONE,i)}(this,t,e)}getVisitFnByTypeId(t,e=!0){return ir(this,t,e)}visitNull(t,...e){return null}visitBool(t,...e){return null}visitInt(t,...e){return null}visitFloat(t,...e){return null}visitUtf8(t,...e){return null}visitBinary(t,...e){return null}visitFixedSizeBinary(t,...e){return null}visitDate(t,...e){return null}visitTimestamp(t,...e){return null}visitTime(t,...e){return null}visitDecimal(t,...e){return null}visitList(t,...e){return null}visitStruct(t,...e){return null}visitUnion(t,...e){return null}visitDictionary(t,...e){return null}visitInterval(t,...e){return null}visitFixedSizeList(t,...e){return null}visitMap(t,...e){return null}}function ir(t,e,i=!0){let n=null;switch(e){case fn.Null:n=t.visitNull;break;case fn.Bool:n=t.visitBool;break;case fn.Int:n=t.visitInt;break;case fn.Int8:n=t.visitInt8||t.visitInt;break;case fn.Int16:n=t.visitInt16||t.visitInt;break;case fn.Int32:n=t.visitInt32||t.visitInt;break;case fn.Int64:n=t.visitInt64||t.visitInt;break;case fn.Uint8:n=t.visitUint8||t.visitInt;break;case fn.Uint16:n=t.visitUint16||t.visitInt;break;case fn.Uint32:n=t.visitUint32||t.visitInt;break;case fn.Uint64:n=t.visitUint64||t.visitInt;break;case fn.Float:n=t.visitFloat;break;case fn.Float16:n=t.visitFloat16||t.visitFloat;break;case fn.Float32:n=t.visitFloat32||t.visitFloat;break;case fn.Float64:n=t.visitFloat64||t.visitFloat;break;case fn.Utf8:n=t.visitUtf8;break;case fn.Binary:n=t.visitBinary;break;case fn.FixedSizeBinary:n=t.visitFixedSizeBinary;break;case fn.Date:n=t.visitDate;break;case fn.DateDay:n=t.visitDateDay||t.visitDate;break;case fn.DateMillisecond:n=t.visitDateMillisecond||t.visitDate;break;case fn.Timestamp:n=t.visitTimestamp;break;case fn.TimestampSecond:n=t.visitTimestampSecond||t.visitTimestamp;break;case fn.TimestampMillisecond:n=t.visitTimestampMillisecond||t.visitTimestamp;break;case fn.TimestampMicrosecond:n=t.visitTimestampMicrosecond||t.visitTimestamp;break;case fn.TimestampNanosecond:n=t.visitTimestampNanosecond||t.visitTimestamp;break;case fn.Time:n=t.visitTime;break;case fn.TimeSecond:n=t.visitTimeSecond||t.visitTime;break;case fn.TimeMillisecond:n=t.visitTimeMillisecond||t.visitTime;break;case fn.TimeMicrosecond:n=t.visitTimeMicrosecond||t.visitTime;break;case fn.TimeNanosecond:n=t.visitTimeNanosecond||t.visitTime;break;case fn.Decimal:n=t.visitDecimal;break;case fn.List:n=t.visitList;break;case fn.Struct:n=t.visitStruct;break;case fn.Union:n=t.visitUnion;break;case fn.DenseUnion:n=t.visitDenseUnion||t.visitUnion;break;case fn.SparseUnion:n=t.visitSparseUnion||t.visitUnion;break;case fn.Dictionary:n=t.visitDictionary;break;case fn.Interval:n=t.visitInterval;break;case fn.IntervalDayTime:n=t.visitIntervalDayTime||t.visitInterval;break;case fn.IntervalYearMonth:n=t.visitIntervalYearMonth||t.visitInterval;break;case fn.FixedSizeList:n=t.visitFixedSizeList;break;case fn.Map:n=t.visitMap}if("function"==typeof n)return n;if(!i)return()=>null;throw new Error(`Unrecognized type '${fn[e]}'`)}function nr(t){switch(t.typeId){case fn.Null:return fn.Null;case fn.Int:{const{bitWidth:e,isSigned:i}=t;switch(e){case 8:return i?fn.Int8:fn.Uint8;case 16:return i?fn.Int16:fn.Uint16;case 32:return i?fn.Int32:fn.Uint32;case 64:return i?fn.Int64:fn.Uint64}return fn.Int}case fn.Float:switch(t.precision){case hn.HALF:return fn.Float16;case hn.SINGLE:return fn.Float32;case hn.DOUBLE:return fn.Float64}return fn.Float;case fn.Binary:return fn.Binary;case fn.Utf8:return fn.Utf8;case fn.Bool:return fn.Bool;case fn.Decimal:return fn.Decimal;case fn.Time:switch(t.unit){case cn.SECOND:return fn.TimeSecond;case cn.MILLISECOND:return fn.TimeMillisecond;case cn.MICROSECOND:return fn.TimeMicrosecond;case cn.NANOSECOND:return fn.TimeNanosecond}return fn.Time;case fn.Timestamp:switch(t.unit){case cn.SECOND:return fn.TimestampSecond;case cn.MILLISECOND:return fn.TimestampMillisecond;case cn.MICROSECOND:return fn.TimestampMicrosecond;case cn.NANOSECOND:return fn.TimestampNanosecond}return fn.Timestamp;case fn.Date:switch(t.unit){case ln.DAY:return fn.DateDay;case ln.MILLISECOND:return fn.DateMillisecond}return fn.Date;case fn.Interval:switch(t.unit){case un.DAY_TIME:return fn.IntervalDayTime;case un.YEAR_MONTH:return fn.IntervalYearMonth}return fn.Interval;case fn.Map:return fn.Map;case fn.List:return fn.List;case fn.Struct:return fn.Struct;case fn.Union:switch(t.mode){case an.Dense:return fn.DenseUnion;case an.Sparse:return fn.SparseUnion}return fn.Union;case fn.FixedSizeBinary:return fn.FixedSizeBinary;case fn.FixedSizeList:return fn.FixedSizeList;case fn.Dictionary:return fn.Dictionary}throw new Error(`Unrecognized type '${fn[t.typeId]}'`)}er.prototype.visitInt8=null,er.prototype.visitInt16=null,er.prototype.visitInt32=null,er.prototype.visitInt64=null,er.prototype.visitUint8=null,er.prototype.visitUint16=null,er.prototype.visitUint32=null,er.prototype.visitUint64=null,er.prototype.visitFloat16=null,er.prototype.visitFloat32=null,er.prototype.visitFloat64=null,er.prototype.visitDateDay=null,er.prototype.visitDateMillisecond=null,er.prototype.visitTimestampSecond=null,er.prototype.visitTimestampMillisecond=null,er.prototype.visitTimestampMicrosecond=null,er.prototype.visitTimestampNanosecond=null,er.prototype.visitTimeSecond=null,er.prototype.visitTimeMillisecond=null,er.prototype.visitTimeMicrosecond=null,er.prototype.visitTimeNanosecond=null,er.prototype.visitDenseUnion=null,er.prototype.visitSparseUnion=null,er.prototype.visitIntervalDayTime=null,er.prototype.visitIntervalYearMonth=null;const sr=new Float64Array(1),rr=new Uint32Array(sr.buffer);function or(t){const e=(31744&t)>>10,i=(1023&t)/1024,n=Math.pow(-1,(32768&t)>>15);switch(e){case 31:return n*(i?Number.NaN:1/0);case 0:return n*(i?6103515625e-14*i:0)}return n*Math.pow(2,e-15)*(1+i)}class ar extends er{}function hr(t){return(e,i,n)=>{if(e.setValid(i,null!=n))return t(e,i,n)}}const lr=(t,e,i)=>{t[e]=Math.trunc(i%4294967296),t[e+1]=Math.trunc(i/4294967296)},cr=(t,e,i,n)=>{if(i+1<e.length){const{[i]:s,[i+1]:r}=e;t.set(n.subarray(0,r-s),s)}},ur=({values:t},e,i)=>{t[e]=i},dr=({values:t},e,i)=>{t[e]=i},fr=({values:t},e,i)=>{t[e]=function(t){if(t!=t)return 32256;sr[0]=t;const e=(2147483648&rr[1])>>16&65535;let i=2146435072&rr[1],n=0;return i>=1089470464?rr[0]>0?i=31744:(i=(2080374784&i)>>16,n=(1048575&rr[1])>>10):i<=1056964608?(n=1048576+(1048575&rr[1]),n=1048576+(n<<(i>>20)-998)>>21,i=0):(i=i-1056964608>>10,n=512+(1048575&rr[1])>>10),e|i|65535&n}(i)},pr=({values:t},e,i)=>{((t,e,i)=>{t[e]=Math.trunc(i/864e5)})(t,e,i.valueOf())},mr=({values:t},e,i)=>{lr(t,2*e,i.valueOf())},yr=({values:t},e,i)=>lr(t,2*e,i/1e3),_r=({values:t},e,i)=>lr(t,2*e,i),gr=({values:t},e,i)=>((t,e,i)=>{t[e]=Math.trunc(1e3*i%4294967296),t[e+1]=Math.trunc(1e3*i/4294967296)})(t,2*e,i),vr=({values:t},e,i)=>((t,e,i)=>{t[e]=Math.trunc(1e6*i%4294967296),t[e+1]=Math.trunc(1e6*i/4294967296)})(t,2*e,i),br=({values:t},e,i)=>{t[e]=i},xr=({values:t},e,i)=>{t[e]=i},wr=({values:t},e,i)=>{t[e]=i},Mr=({values:t},e,i)=>{t[e]=i},Sr=(t,e,i)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],s=t.children[n];Cr.visit(s,t.valueOffsets[e],i)},Tr=(t,e,i)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],s=t.children[n];Cr.visit(s,e,i)},Ir=({values:t},e,i)=>{t.set(i.subarray(0,2),2*e)},Ar=({values:t},e,i)=>{t[e]=12*i[0]+i[1]%12};ar.prototype.visitBool=hr((({offset:t,values:e},i,n)=>{const s=t+i;n?e[s>>3]|=1<<s%8:e[s>>3]&=~(1<<s%8)})),ar.prototype.visitInt=hr(ur),ar.prototype.visitInt8=hr(ur),ar.prototype.visitInt16=hr(ur),ar.prototype.visitInt32=hr(ur),ar.prototype.visitInt64=hr(ur),ar.prototype.visitUint8=hr(ur),ar.prototype.visitUint16=hr(ur),ar.prototype.visitUint32=hr(ur),ar.prototype.visitUint64=hr(ur),ar.prototype.visitFloat=hr(((t,e,i)=>{switch(t.type.precision){case hn.HALF:return fr(t,e,i);case hn.SINGLE:case hn.DOUBLE:return dr(t,e,i)}})),ar.prototype.visitFloat16=hr(fr),ar.prototype.visitFloat32=hr(dr),ar.prototype.visitFloat64=hr(dr),ar.prototype.visitUtf8=hr((({values:t,valueOffsets:e},i,n)=>{cr(t,e,i,Cn(n))})),ar.prototype.visitBinary=hr((({values:t,valueOffsets:e},i,n)=>cr(t,e,i,n))),ar.prototype.visitFixedSizeBinary=hr((({stride:t,values:e},i,n)=>{e.set(n.subarray(0,t),t*i)})),ar.prototype.visitDate=hr(((t,e,i)=>{t.type.unit===ln.DAY?pr(t,e,i):mr(t,e,i)})),ar.prototype.visitDateDay=hr(pr),ar.prototype.visitDateMillisecond=hr(mr),ar.prototype.visitTimestamp=hr(((t,e,i)=>{switch(t.type.unit){case cn.SECOND:return yr(t,e,i);case cn.MILLISECOND:return _r(t,e,i);case cn.MICROSECOND:return gr(t,e,i);case cn.NANOSECOND:return vr(t,e,i)}})),ar.prototype.visitTimestampSecond=hr(yr),ar.prototype.visitTimestampMillisecond=hr(_r),ar.prototype.visitTimestampMicrosecond=hr(gr),ar.prototype.visitTimestampNanosecond=hr(vr),ar.prototype.visitTime=hr(((t,e,i)=>{switch(t.type.unit){case cn.SECOND:return br(t,e,i);case cn.MILLISECOND:return xr(t,e,i);case cn.MICROSECOND:return wr(t,e,i);case cn.NANOSECOND:return Mr(t,e,i)}})),ar.prototype.visitTimeSecond=hr(br),ar.prototype.visitTimeMillisecond=hr(xr),ar.prototype.visitTimeMicrosecond=hr(wr),ar.prototype.visitTimeNanosecond=hr(Mr),ar.prototype.visitDecimal=hr((({values:t,stride:e},i,n)=>{t.set(n.subarray(0,e),e*i)})),ar.prototype.visitList=hr(((t,e,i)=>{const n=t.children[0],s=t.valueOffsets,r=Cr.getVisitFn(n);if(Array.isArray(i))for(let t=-1,o=s[e],a=s[e+1];o<a;)r(n,o++,i[++t]);else for(let t=-1,o=s[e],a=s[e+1];o<a;)r(n,o++,i.get(++t))})),ar.prototype.visitStruct=hr(((t,e,i)=>{const n=t.type.children.map((t=>Cr.getVisitFn(t.type))),s=i instanceof Map?(r=e,o=i,(t,e,i,n)=>e&&t(e,r,o.get(i.name))):i instanceof Go?((t,e)=>(i,n,s,r)=>n&&i(n,t,e.get(r)))(e,i):Array.isArray(i)?((t,e)=>(i,n,s,r)=>n&&i(n,t,e[r]))(e,i):((t,e)=>(i,n,s,r)=>n&&i(n,t,e[s.name]))(e,i);var r,o;t.type.children.forEach(((e,i)=>s(n[i],t.children[i],e,i)))})),ar.prototype.visitUnion=hr(((t,e,i)=>{t.type.mode===an.Dense?Sr(t,e,i):Tr(t,e,i)})),ar.prototype.visitDenseUnion=hr(Sr),ar.prototype.visitSparseUnion=hr(Tr),ar.prototype.visitDictionary=hr(((t,e,i)=>{var n;null===(n=t.dictionary)||void 0===n||n.set(t.values[e],i)})),ar.prototype.visitInterval=hr(((t,e,i)=>{t.type.unit===un.DAY_TIME?Ir(t,e,i):Ar(t,e,i)})),ar.prototype.visitIntervalDayTime=hr(Ir),ar.prototype.visitIntervalYearMonth=hr(Ar),ar.prototype.visitFixedSizeList=hr(((t,e,i)=>{const{stride:n}=t,s=t.children[0],r=Cr.getVisitFn(s);if(Array.isArray(i))for(let t=-1,o=e*n;++t<n;)r(s,o+t,i[t]);else for(let t=-1,o=e*n;++t<n;)r(s,o+t,i.get(t))})),ar.prototype.visitMap=hr(((t,e,i)=>{const n=t.children[0],{valueOffsets:s}=t,r=Cr.getVisitFn(n);let{[e]:o,[e+1]:a}=s;const h=i instanceof Map?i.entries():Object.entries(i);for(const t of h)if(r(n,o,t),++o>=a)break}));const Cr=new ar,Lr=Symbol.for("parent"),Pr=Symbol.for("rowIndex");class Br{constructor(t,e){return this[Lr]=t,this[Pr]=e,new Proxy(this,new zr)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Pr],e=this[Lr],i=e.type.children,n={};for(let s=-1,r=i.length;++s<r;)n[i[s].name]=eo.visit(e.children[s],t);return n}toString(){return`{${[...this].map((([t,e])=>`${vn(t)}: ${vn(e)}`)).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Er(this[Lr],this[Pr])}}class Er{constructor(t,e){this.childIndex=0,this.children=t.children,this.rowIndex=e,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,eo.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(Br.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Lr]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Pr]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class zr{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Lr].type.children.map((t=>t.name))}has(t,e){return-1!==t[Lr].type.children.findIndex((t=>t.name===e))}getOwnPropertyDescriptor(t,e){if(-1!==t[Lr].type.children.findIndex((t=>t.name===e)))return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const i=t[Lr].type.children.findIndex((t=>t.name===e));if(-1!==i){const n=eo.visit(t[Lr].children[i],t[Pr]);return Reflect.set(t,e,n),n}}set(t,e,i){const n=t[Lr].type.children.findIndex((t=>t.name===e));return-1!==n?(Cr.visit(t[Lr].children[n],t[Pr],i),Reflect.set(t,e,i)):!(!Reflect.has(t,e)&&"symbol"!=typeof e)&&Reflect.set(t,e,i)}}class Or extends er{}function kr(t){return(e,i)=>e.getValid(i)?t(e,i):null}const Nr=(t,e)=>4294967296*t[e+1]+(t[e]>>>0),Fr=t=>new Date(t),Dr=(t,e,i)=>{if(i+1>=e.length)return null;const n=e[i],s=e[i+1];return t.subarray(n,s)},Rr=({values:t},e)=>((t,e)=>Fr(((t,e)=>864e5*t[e])(t,e)))(t,e),Ur=({values:t},e)=>((t,e)=>Fr(Nr(t,e)))(t,2*e),Zr=({stride:t,values:e},i)=>e[t*i],jr=({values:t},e)=>t[e],Vr=({values:t},e)=>1e3*Nr(t,2*e),Wr=({values:t},e)=>Nr(t,2*e),Gr=({values:t},e)=>((t,e)=>t[e+1]/1e3*4294967296+(t[e]>>>0)/1e3)(t,2*e),qr=({values:t},e)=>((t,e)=>t[e+1]/1e6*4294967296+(t[e]>>>0)/1e6)(t,2*e),Hr=({values:t},e)=>t[e],Yr=({values:t},e)=>t[e],$r=({values:t},e)=>t[e],Xr=({values:t},e)=>t[e],Kr=(t,e)=>{const i=t.type.typeIdToChildIndex[t.typeIds[e]],n=t.children[i];return eo.visit(n,t.valueOffsets[e])},Jr=(t,e)=>{const i=t.type.typeIdToChildIndex[t.typeIds[e]],n=t.children[i];return eo.visit(n,e)},Qr=({values:t},e)=>t.subarray(2*e,2*(e+1)),to=({values:t},e)=>{const i=t[e],n=new Int32Array(2);return n[0]=Math.trunc(i/12),n[1]=Math.trunc(i%12),n};Or.prototype.visitNull=kr(((t,e)=>null)),Or.prototype.visitBool=kr((({offset:t,values:e},i)=>{const n=t+i;return 0!=(e[n>>3]&1<<n%8)})),Or.prototype.visitInt=kr((({values:t},e)=>t[e])),Or.prototype.visitInt8=kr(Zr),Or.prototype.visitInt16=kr(Zr),Or.prototype.visitInt32=kr(Zr),Or.prototype.visitInt64=kr(jr),Or.prototype.visitUint8=kr(Zr),Or.prototype.visitUint16=kr(Zr),Or.prototype.visitUint32=kr(Zr),Or.prototype.visitUint64=kr(jr),Or.prototype.visitFloat=kr((({type:t,values:e},i)=>t.precision!==hn.HALF?e[i]:or(e[i]))),Or.prototype.visitFloat16=kr((({stride:t,values:e},i)=>or(e[t*i]))),Or.prototype.visitFloat32=kr(Zr),Or.prototype.visitFloat64=kr(Zr),Or.prototype.visitUtf8=kr((({values:t,valueOffsets:e},i)=>{const n=Dr(t,e,i);return null!==n?In(n):null})),Or.prototype.visitBinary=kr((({values:t,valueOffsets:e},i)=>Dr(t,e,i))),Or.prototype.visitFixedSizeBinary=kr((({stride:t,values:e},i)=>e.subarray(t*i,t*(i+1)))),Or.prototype.visitDate=kr(((t,e)=>t.type.unit===ln.DAY?Rr(t,e):Ur(t,e))),Or.prototype.visitDateDay=kr(Rr),Or.prototype.visitDateMillisecond=kr(Ur),Or.prototype.visitTimestamp=kr(((t,e)=>{switch(t.type.unit){case cn.SECOND:return Vr(t,e);case cn.MILLISECOND:return Wr(t,e);case cn.MICROSECOND:return Gr(t,e);case cn.NANOSECOND:return qr(t,e)}})),Or.prototype.visitTimestampSecond=kr(Vr),Or.prototype.visitTimestampMillisecond=kr(Wr),Or.prototype.visitTimestampMicrosecond=kr(Gr),Or.prototype.visitTimestampNanosecond=kr(qr),Or.prototype.visitTime=kr(((t,e)=>{switch(t.type.unit){case cn.SECOND:return Hr(t,e);case cn.MILLISECOND:return Yr(t,e);case cn.MICROSECOND:return $r(t,e);case cn.NANOSECOND:return Xr(t,e)}})),Or.prototype.visitTimeSecond=kr(Hr),Or.prototype.visitTimeMillisecond=kr(Yr),Or.prototype.visitTimeMicrosecond=kr($r),Or.prototype.visitTimeNanosecond=kr(Xr),Or.prototype.visitDecimal=kr((({values:t,stride:e},i)=>us.decimal(t.subarray(e*i,e*(i+1))))),Or.prototype.visitList=kr(((t,e)=>{const{valueOffsets:i,stride:n,children:s}=t,{[e*n]:r,[e*n+1]:o}=i,a=s[0].slice(r,o-r);return new Go([a])})),Or.prototype.visitStruct=kr(((t,e)=>new Br(t,e))),Or.prototype.visitUnion=kr(((t,e)=>t.type.mode===an.Dense?Kr(t,e):Jr(t,e))),Or.prototype.visitDenseUnion=kr(Kr),Or.prototype.visitSparseUnion=kr(Jr),Or.prototype.visitDictionary=kr(((t,e)=>{var i;return null===(i=t.dictionary)||void 0===i?void 0:i.get(t.values[e])})),Or.prototype.visitInterval=kr(((t,e)=>t.type.unit===un.DAY_TIME?Qr(t,e):to(t,e))),Or.prototype.visitIntervalDayTime=kr(Qr),Or.prototype.visitIntervalYearMonth=kr(to),Or.prototype.visitFixedSizeList=kr(((t,e)=>{const{stride:i,children:n}=t,s=n[0].slice(e*i,i);return new Go([s])})),Or.prototype.visitMap=kr(((t,e)=>{const{valueOffsets:i,children:n}=t,{[e]:s,[e+1]:r}=i,o=n[0];return new so(o.slice(s,r-s))}));const eo=new Or,io=Symbol.for("keys"),no=Symbol.for("vals");class so{constructor(t){return this[io]=new Go([t.children[0]]).memoize(),this[no]=t.children[1],new Proxy(this,new oo)}[Symbol.iterator](){return new ro(this[io],this[no])}get size(){return this[io].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[io],e=this[no],i={};for(let n=-1,s=t.length;++n<s;)i[t.get(n)]=eo.visit(e,n);return i}toString(){return`{${[...this].map((([t,e])=>`${vn(t)}: ${vn(e)}`)).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class ro{constructor(t,e){this.keys=t,this.vals=e,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),eo.visit(this.vals,t)]})}}class oo{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[io].toArray().map(String)}has(t,e){return t[io].includes(e)}getOwnPropertyDescriptor(t,e){if(-1!==t[io].indexOf(e))return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const i=t[io].indexOf(e);if(-1!==i){const n=eo.visit(Reflect.get(t,no),i);return Reflect.set(t,e,n),n}}set(t,e,i){const n=t[io].indexOf(e);return-1!==n?(Cr.visit(Reflect.get(t,no),n,i),Reflect.set(t,e,i)):!!Reflect.has(t,e)&&Reflect.set(t,e,i)}}let ao;function ho(t,e,i,n){const{length:s=0}=t;let r="number"!=typeof e?0:e,o="number"!=typeof i?s:i;return r<0&&(r=(r%s+s)%s),o<0&&(o=(o%s+s)%s),o<r&&(ao=r,r=o,o=ao),o>s&&(o=s),n?n(t,r,o):[r,o]}Object.defineProperties(so.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[io]:{writable:!0,enumerable:!1,configurable:!1,value:null},[no]:{writable:!0,enumerable:!1,configurable:!1,value:null}});const lo=t=>t!=t;function co(t){if("object"!=typeof t||null===t)return lo(t)?lo:e=>e===t;if(t instanceof Date){const e=t.valueOf();return t=>t instanceof Date&&t.valueOf()===e}return ArrayBuffer.isView(t)?e=>!!e&&function(t,e){let i=0;const n=t.length;if(n!==e.length)return!1;if(n>0)do{if(t[i]!==e[i])return!1}while(++i<n);return!0}(t,e):t instanceof Map?function(t){let e=-1;const i=[];for(const n of t.values())i[++e]=co(n);return uo(i)}(t):Array.isArray(t)?function(t){const e=[];for(let i=-1,n=t.length;++i<n;)e[i]=co(t[i]);return uo(e)}(t):t instanceof Go?function(t){const e=[];for(let i=-1,n=t.length;++i<n;)e[i]=co(t.get(i));return uo(e)}(t):function(t,e=!1){const i=Object.keys(t);if(!e&&0===i.length)return()=>!1;const n=[];for(let e=-1,s=i.length;++e<s;)n[e]=co(t[i[e]]);return uo(n,i)}(t,!0)}function uo(t,e){return i=>{if(!i||"object"!=typeof i)return!1;switch(i.constructor){case Array:return function(t,e){const i=t.length;if(e.length!==i)return!1;for(let n=-1;++n<i;)if(!t[n](e[n]))return!1;return!0}(t,i);case Map:return fo(t,i,i.keys());case so:case Br:case Object:case void 0:return fo(t,i,e||Object.keys(i))}return i instanceof Go&&function(t,e){const i=t.length;if(e.length!==i)return!1;for(let n=-1;++n<i;)if(!t[n](e.get(n)))return!1;return!0}(t,i)}}function fo(t,e,i){const n=i[Symbol.iterator](),s=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),r=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let o=0;const a=t.length;let h=r.next(),l=n.next(),c=s.next();for(;o<a&&!l.done&&!c.done&&!h.done&&l.value===c.value&&t[o](h.value);++o,l=n.next(),c=s.next(),h=r.next());return!!(o===a&&l.done&&c.done&&h.done)||(n.return&&n.return(),s.return&&s.return(),r.return&&r.return(),!1)}class po{constructor(t=0,e){this.numChunks=t,this.getChunkIterator=e,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function mo(t){return t.reduce(((t,e)=>t+e.nullCount),0)}function yo(t){return t.reduce(((t,e,i)=>(t[i+1]=t[i]+e.length,t)),new Uint32Array(t.length+1))}function _o(t,e,i,n){const s=[];for(let r=-1,o=t.length;++r<o;){const o=t[r],a=e[r],{length:h}=o;if(a>=n)break;if(i>=a+h)continue;if(a>=i&&a+h<=n){s.push(o);continue}const l=Math.max(0,i-a),c=Math.min(n-a,h);s.push(o.slice(l,c-l))}return 0===s.length&&s.push(t[0].slice(0,0)),s}function go(t,e,i,n){let s=0,r=0,o=e.length-1;do{if(s>=o-1)return i<e[o]?n(t,s,i-e[s]):null;r=s+Math.trunc(.5*(o-s)),i<e[r]?o=r:s=r}while(s<o)}function vo(t,e){return t.getValid(e)}function bo(t){function e(e,i,n){return t(e[i],n)}return function(t){return go(this.data,this._offsets,t,e)}}function xo(t){let e;function i(i,n,s){return t(i[n],s,e)}return function(t,n){const s=this.data;e=n;const r=go(s,this._offsets,t,i);return e=void 0,r}}function wo(t){let e;function i(i,n,s){let r=s,o=0,a=0;for(let s=n-1,h=i.length;++s<h;){const n=i[s];if(~(o=t(n,e,r)))return a+o;r=0,a+=n.length}return-1}return function(t,n){e=t;const s=this.data,r="number"!=typeof n?i(s,0,0):go(s,this._offsets,n,i);return e=void 0,r}}function Mo(t,e,i,n){return 0!=(i&1<<n)}function So(t,e,i,n){return(i&1<<n)>>n}function To(t){const e=[];let i=0,n=0,s=0;for(const r of t)r&&(s|=1<<n),8==++n&&(e[i++]=s,s=n=0);(0===i||n>0)&&(e[i++]=s);const r=new Uint8Array(e.length+7&-8);return r.set(e),r}class Io{constructor(t,e,i,n,s){this.bytes=t,this.length=i,this.context=n,this.get=s,this.bit=e%8,this.byteIndex=e>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(8===this.bit&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Ao(t,e,i){if(i-e<=0)return 0;if(i-e<8){let n=0;for(const s of new Io(t,e,i-e,t,So))n+=s;return n}const n=i>>3<<3,s=e+(e%8==0?0:8-e%8);return Ao(t,e,s)+Ao(t,n,i)+function(t,e,i){let n=0,s=Math.trunc(e);const r=new DataView(t.buffer,t.byteOffset,t.byteLength),o=void 0===i?t.byteLength:s+i;for(;o-s>=4;)n+=Co(r.getUint32(s)),s+=4;for(;o-s>=2;)n+=Co(r.getUint16(s)),s+=2;for(;o-s>=1;)n+=Co(r.getUint8(s)),s+=1;return n}(t,s>>3,n-s>>3)}function Co(t){let e=Math.trunc(t);return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),16843009*(e+(e>>>4)&252645135)>>>24}class Lo extends er{}function Po(t,e,i){if(void 0===e)return-1;if(null===e)return function(t,e){const{nullBitmap:i}=t;if(!i||t.nullCount<=0)return-1;let n=0;for(const s of new Io(i,t.offset+(e||0),t.length,i,Mo)){if(!s)return n;++n}return-1}(t,i);const n=eo.getVisitFn(t),s=co(e);for(let e=(i||0)-1,r=t.length;++e<r;)if(s(n(t,e)))return e;return-1}function Bo(t,e,i){const n=eo.getVisitFn(t),s=co(e);for(let e=(i||0)-1,r=t.length;++e<r;)if(s(n(t,e)))return e;return-1}Lo.prototype.visitNull=function(t,e){return null===e&&t.length>0?0:-1},Lo.prototype.visitBool=Po,Lo.prototype.visitInt=Po,Lo.prototype.visitInt8=Po,Lo.prototype.visitInt16=Po,Lo.prototype.visitInt32=Po,Lo.prototype.visitInt64=Po,Lo.prototype.visitUint8=Po,Lo.prototype.visitUint16=Po,Lo.prototype.visitUint32=Po,Lo.prototype.visitUint64=Po,Lo.prototype.visitFloat=Po,Lo.prototype.visitFloat16=Po,Lo.prototype.visitFloat32=Po,Lo.prototype.visitFloat64=Po,Lo.prototype.visitUtf8=Po,Lo.prototype.visitBinary=Po,Lo.prototype.visitFixedSizeBinary=Po,Lo.prototype.visitDate=Po,Lo.prototype.visitDateDay=Po,Lo.prototype.visitDateMillisecond=Po,Lo.prototype.visitTimestamp=Po,Lo.prototype.visitTimestampSecond=Po,Lo.prototype.visitTimestampMillisecond=Po,Lo.prototype.visitTimestampMicrosecond=Po,Lo.prototype.visitTimestampNanosecond=Po,Lo.prototype.visitTime=Po,Lo.prototype.visitTimeSecond=Po,Lo.prototype.visitTimeMillisecond=Po,Lo.prototype.visitTimeMicrosecond=Po,Lo.prototype.visitTimeNanosecond=Po,Lo.prototype.visitDecimal=Po,Lo.prototype.visitList=Po,Lo.prototype.visitStruct=Po,Lo.prototype.visitUnion=Po,Lo.prototype.visitDenseUnion=Bo,Lo.prototype.visitSparseUnion=Bo,Lo.prototype.visitDictionary=Po,Lo.prototype.visitInterval=Po,Lo.prototype.visitIntervalDayTime=Po,Lo.prototype.visitIntervalYearMonth=Po,Lo.prototype.visitFixedSizeList=Po,Lo.prototype.visitMap=Po;const Eo=new Lo;class zo extends er{}function Oo(t){const{type:e}=t;if(0===t.nullCount&&1===t.stride&&(e.typeId===fn.Timestamp||e instanceof Os&&64!==e.bitWidth||e instanceof js&&64!==e.bitWidth||e instanceof Ns&&e.precision!==hn.HALF))return new po(t.data.length,(e=>{const i=t.data[e];return i.values.subarray(0,i.length)[Symbol.iterator]()}));let i=0;return new po(t.data.length,(e=>{const n=t.data[e].length,s=t.slice(i,i+n);return i+=n,new ko(s)}))}class ko{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}zo.prototype.visitNull=Oo,zo.prototype.visitBool=Oo,zo.prototype.visitInt=Oo,zo.prototype.visitInt8=Oo,zo.prototype.visitInt16=Oo,zo.prototype.visitInt32=Oo,zo.prototype.visitInt64=Oo,zo.prototype.visitUint8=Oo,zo.prototype.visitUint16=Oo,zo.prototype.visitUint32=Oo,zo.prototype.visitUint64=Oo,zo.prototype.visitFloat=Oo,zo.prototype.visitFloat16=Oo,zo.prototype.visitFloat32=Oo,zo.prototype.visitFloat64=Oo,zo.prototype.visitUtf8=Oo,zo.prototype.visitBinary=Oo,zo.prototype.visitFixedSizeBinary=Oo,zo.prototype.visitDate=Oo,zo.prototype.visitDateDay=Oo,zo.prototype.visitDateMillisecond=Oo,zo.prototype.visitTimestamp=Oo,zo.prototype.visitTimestampSecond=Oo,zo.prototype.visitTimestampMillisecond=Oo,zo.prototype.visitTimestampMicrosecond=Oo,zo.prototype.visitTimestampNanosecond=Oo,zo.prototype.visitTime=Oo,zo.prototype.visitTimeSecond=Oo,zo.prototype.visitTimeMillisecond=Oo,zo.prototype.visitTimeMicrosecond=Oo,zo.prototype.visitTimeNanosecond=Oo,zo.prototype.visitDecimal=Oo,zo.prototype.visitList=Oo,zo.prototype.visitStruct=Oo,zo.prototype.visitUnion=Oo,zo.prototype.visitDenseUnion=Oo,zo.prototype.visitSparseUnion=Oo,zo.prototype.visitDictionary=Oo,zo.prototype.visitInterval=Oo,zo.prototype.visitIntervalDayTime=Oo,zo.prototype.visitIntervalYearMonth=Oo,zo.prototype.visitFixedSizeList=Oo,zo.prototype.visitMap=Oo;const No=new zo,Fo=(t,e)=>t+e;class Do extends er{visitNull(t,e){return 0}visitInt(t,e){return t.type.bitWidth/8}visitFloat(t,e){return t.type.ArrayType.BYTES_PER_ELEMENT}visitBool(t,e){return 1/8}visitDecimal(t,e){return t.type.bitWidth/8}visitDate(t,e){return 4*(t.type.unit+1)}visitTime(t,e){return t.type.bitWidth/8}visitTimestamp(t,e){return t.type.unit===cn.SECOND?4:8}visitInterval(t,e){return 4*(t.type.unit+1)}visitStruct(t,e){return t.children.reduce(((t,i)=>t+Zo.visit(i,e)),0)}visitFixedSizeBinary(t,e){return t.type.byteWidth}visitMap(t,e){return 8+t.children.reduce(((t,i)=>t+Zo.visit(i,e)),0)}visitDictionary(t,e){var i;return t.type.indices.bitWidth/8+((null===(i=t.dictionary)||void 0===i?void 0:i.getByteLength(t.values[e]))||0)}}const Ro=({type:t,children:e,typeIds:i,valueOffsets:n},s)=>{const r=t.typeIdToChildIndex[i[s]];return 8+Zo.visit(e[r],n[s])},Uo=({children:t},e)=>4+Zo.visitMany(t,t.map((()=>e))).reduce(Fo,0);Do.prototype.visitUtf8=({valueOffsets:t},e)=>t[e+1]-t[e]+8,Do.prototype.visitBinary=({valueOffsets:t},e)=>t[e+1]-t[e]+8,Do.prototype.visitList=({valueOffsets:t,stride:e,children:i},n)=>{const s=i[0],{[n*e]:r}=t,{[n*e+1]:o}=t,a=Zo.getVisitFn(s.type),h=s.slice(r,o-r);let l=8;for(let t=-1,e=o-r;++t<e;)l+=a(h,t);return l},Do.prototype.visitFixedSizeList=({stride:t,children:e},i)=>{const n=e[0],s=n.slice(i*t,t),r=Zo.getVisitFn(n.type);let o=0;for(let t=-1,e=s.length;++t<e;)o+=r(s,t);return o},Do.prototype.visitUnion=(t,e)=>t.type.mode===an.Dense?Ro(t,e):Uo(t,e),Do.prototype.visitDenseUnion=Ro,Do.prototype.visitSparseUnion=Uo;const Zo=new Do;var jo;const Vo={},Wo={};class Go{constructor(t){var e,i,n;const s=t[0]instanceof Go?t.flatMap((t=>t.data)):t;if(0===s.length||s.some((t=>!(t instanceof Ho))))throw new TypeError("Vector constructor expects an Array of Data instances.");const r=null===(e=s[0])||void 0===e?void 0:e.type;switch(s.length){case 0:this._offsets=[0];break;case 1:{const{get:t,set:e,indexOf:i,byteLength:n}=Vo[r.typeId],o=s[0];this.isValid=t=>vo(o,t),this.get=e=>t(o,e),this.set=(t,i)=>e(o,t,i),this.indexOf=t=>i(o,t),this.getByteLength=t=>n(o,t),this._offsets=[0,o.length];break}default:Object.setPrototypeOf(this,Wo[r.typeId]),this._offsets=yo(s)}this.data=s,this.type=r,this.stride=tr(r),this.numChildren=null!==(n=null===(i=r.children)||void 0===i?void 0:i.length)&&void 0!==n?n:0,this.length=this._offsets[this._offsets.length-1]}get byteLength(){return-1===this._byteLength&&(this._byteLength=this.data.reduce(((t,e)=>t+e.byteLength),0)),this._byteLength}get nullCount(){return-1===this._nullCount&&(this._nullCount=mo(this.data)),this._nullCount}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${fn[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}includes(t,e){return this.indexOf(t,e)>0}getByteLength(t){return 0}[Symbol.iterator](){return No.visit(this)}concat(...t){return new Go(this.data.concat(t.flatMap((t=>t.data)).flat(Number.POSITIVE_INFINITY)))}slice(t,e){return new Go(ho(this,t,e,(({data:t,_offsets:e},i,n)=>_o(t,e,i,n))))}toJSON(){return[...this]}toArray(){const{type:t,data:e,length:i,stride:n,ArrayType:s}=this;switch(t.typeId){case fn.Int:case fn.Float:case fn.Decimal:case fn.Time:case fn.Timestamp:switch(e.length){case 0:return new s;case 1:return e[0].values.subarray(0,i*n);default:return e.reduce(((t,{values:e})=>(t.array.set(e,t.offset),t.offset+=e.length,t)),{array:new s(i*n),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var e;return this.getChildAt(null===(e=this.type.children)||void 0===e?void 0:e.findIndex((e=>e.name===t)))}getChildAt(t){return t>-1&&t<this.numChildren?new Go(this.data.map((({children:e})=>e[t]))):null}get isMemoized(){return!!Es.isDictionary(this.type)&&this.data[0].dictionary.isMemoized}memoize(){if(Es.isDictionary(this.type)){const t=new qo(this.data[0].dictionary),e=this.data.map((e=>{const i=e.clone();return i.dictionary=t,i}));return new Go(e)}return new qo(this)}unmemoize(){if(Es.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),e=this.data.map((e=>{const i=e.clone();return i.dictionary=t,i}));return new Go(e)}return this}}jo=Symbol.toStringTag,Go[jo]=(t=>{t.type=Es.prototype,t.data=[],t.length=0,t.stride=1,t.numChildren=0,t._nullCount=-1,t._byteLength=-1,t._offsets=new Uint32Array([0]),t[Symbol.isConcatSpreadable]=!0;const e=Object.keys(fn).map((t=>fn[t])).filter((t=>"number"==typeof t&&t!==fn.NONE));for(const i of e){const e=eo.getVisitFnByTypeId(i),n=Cr.getVisitFnByTypeId(i),s=Eo.getVisitFnByTypeId(i),r=Zo.getVisitFnByTypeId(i);Vo[i]={get:e,set:n,indexOf:s,byteLength:r},Wo[i]=Object.create(t,{isValid:{value:bo(vo)},get:{value:bo(eo.getVisitFnByTypeId(i))},set:{value:xo(Cr.getVisitFnByTypeId(i))},indexOf:{value:wo(Eo.getVisitFnByTypeId(i))},getByteLength:{value:bo(Zo.getVisitFnByTypeId(i))}})}return"Vector"})(Go.prototype);class qo extends Go{constructor(t){super(t.data);const e=this.get,i=this.set,n=this.slice,s=new Array(this.length);Object.defineProperty(this,"get",{value(t){const i=s[t];if(void 0!==i)return i;const n=e.call(this,t);return s[t]=n,n}}),Object.defineProperty(this,"set",{value(t,e){i.call(this,t,e),s[t]=e}}),Object.defineProperty(this,"slice",{value:(t,e)=>new qo(n.call(this,t,e))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Go(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class Ho{constructor(t,e,i,n,s,r=[],o){let a;this.type=t,this.children=r,this.dictionary=o,this.offset=Math.floor(Math.max(e||0,0)),this.length=Math.floor(Math.max(i||0,0)),this._nullCount=Math.floor(Math.max(n||0,-1)),s instanceof Ho?(this.stride=s.stride,this.values=s.values,this.typeIds=s.typeIds,this.nullBitmap=s.nullBitmap,this.valueOffsets=s.valueOffsets):(this.stride=tr(t),s&&((a=s[0])&&(this.valueOffsets=a),(a=s[1])&&(this.values=a),(a=s[2])&&(this.nullBitmap=a),(a=s[3])&&(this.typeIds=a))),this.nullable=0!==this._nullCount&&this.nullBitmap&&this.nullBitmap.byteLength>0}get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get byteLength(){let t=0;const{valueOffsets:e,values:i,nullBitmap:n,typeIds:s}=this;return e&&(t+=e.byteLength),i&&(t+=i.byteLength),n&&(t+=n.byteLength),s&&(t+=s.byteLength),this.children.reduce(((t,e)=>t+e.byteLength),t)}get nullCount(){let t,e=this._nullCount;return e<=-1&&(t=this.nullBitmap)&&(this._nullCount=e=this.length-Ao(t,this.offset,this.offset+this.length)),e}getValid(t){if(this.nullable&&this.nullCount>0){const e=this.offset+t;return 0!=(this.nullBitmap[e>>3]&1<<e%8)}return!0}setValid(t,e){if(!this.nullable)return e;if(!this.nullBitmap||this.nullBitmap.byteLength<=t>>3){const{nullBitmap:t}=this._changeLengthAndBackfillNullBitmap(this.length);Object.assign(this,{nullBitmap:t,_nullCount:0})}const{nullBitmap:i,offset:n}=this,s=n+t>>3,r=(n+t)%8,o=i[s]>>r&1;return e?0===o&&(i[s]|=1<<r,this._nullCount=this.nullCount+1):1===o&&(i[s]&=~(1<<r),this._nullCount=this.nullCount-1),e}clone(t=this.type,e=this.offset,i=this.length,n=this._nullCount,s=this,r=this.children){return new Ho(t,e,i,n,s,r,this.dictionary)}slice(t,e){const{stride:i,typeId:n,children:s}=this,r=+(0===this._nullCount)-1,o=16===n?i:1,a=this._sliceBuffers(t,e,i,n);return this.clone(this.type,this.offset+t,e,r,a,0===s.length||this.valueOffsets?s:this._sliceChildren(s,o*t,o*e))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===fn.Null)return this.clone(this.type,0,t,0);const{length:e,nullCount:i}=this,n=new Uint8Array((t+63&-64)>>3).fill(255,0,e>>3);n[e>>3]=(1<<e-(-8&e))-1,i>0&&n.set(function(t,e,i){const n=i.byteLength+7&-8;if(t>0||i.byteLength<n){const s=new Uint8Array(n);return s.set(t%8==0?i.subarray(t>>3):To(new Io(i,t,e,null,Mo)).subarray(0,n)),s}return i}(this.offset,e,this.nullBitmap),0);const s=this.buffers;return s[pn.VALIDITY]=n,this.clone(this.type,0,t,i+(t-e),s)}_sliceBuffers(t,e,i,n){let s;const{buffers:r}=this;return(s=r[pn.TYPE])&&(r[pn.TYPE]=s.subarray(t,t+e)),(s=r[pn.OFFSET])&&(r[pn.OFFSET]=s.subarray(t,t+e+1))||(s=r[pn.DATA])&&(r[pn.DATA]=6===n?s:s.subarray(i*t,i*(t+e))),r}_sliceChildren(t,e,i){return t.map((t=>t.slice(e,i)))}}Ho.prototype.children=Object.freeze([]);class Yo extends er{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{type:e,offset:i=0,length:n=0}=t;return new Ho(e,i,n,0)}visitBool(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length>>3,nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitInt(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length,nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitFloat(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length,nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitUtf8(t){const{type:e,offset:i=0}=t,n=Qn(t.data),s=Qn(t.nullBitmap),r=Jn(t.valueOffsets),{length:o=r.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,o,a,[r,n,s])}visitBinary(t){const{type:e,offset:i=0}=t,n=Qn(t.data),s=Qn(t.nullBitmap),r=Jn(t.valueOffsets),{length:o=r.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,o,a,[r,n,s])}visitFixedSizeBinary(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitDate(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitTimestamp(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitTime(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitDecimal(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitList(t){const{type:e,offset:i=0,child:n}=t,s=Qn(t.nullBitmap),r=Jn(t.valueOffsets),{length:o=r.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,o,a,[r,void 0,s],[n])}visitStruct(t){const{type:e,offset:i=0,children:n=[]}=t,s=Qn(t.nullBitmap),{length:r=n.reduce(((t,{length:e})=>Math.max(t,e)),0),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,void 0,s],n)}visitUnion(t){const{type:e,offset:i=0,children:n=[]}=t,s=Qn(t.nullBitmap),r=Kn(e.ArrayType,t.typeIds),{length:o=r.length,nullCount:a=(t.nullBitmap?-1:0)}=t;if(Es.isSparseUnion(e))return new Ho(e,i,o,a,[void 0,void 0,s,r],n);const h=Jn(t.valueOffsets);return new Ho(e,i,o,a,[h,void 0,s,r],n)}visitDictionary(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.indices.ArrayType,t.data),{dictionary:r=new Go([(new Yo).visit({type:e.dictionary})])}=t,{length:o=s.length,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,o,a,[void 0,s,n],[],r)}visitInterval(t){const{type:e,offset:i=0}=t,n=Qn(t.nullBitmap),s=Kn(e.ArrayType,t.data),{length:r=s.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,s,n])}visitFixedSizeList(t){const{type:e,offset:i=0,child:n=(new Yo).visit({type:e.valueType})}=t,s=Qn(t.nullBitmap),{length:r=n.length/tr(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,r,o,[void 0,void 0,s],[n])}visitMap(t){const{type:e,offset:i=0,child:n=(new Yo).visit({type:e.childType})}=t,s=Qn(t.nullBitmap),r=Jn(t.valueOffsets),{length:o=r.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Ho(e,i,o,a,[r,void 0,s],[n])}}function $o(t){return(new Yo).visit(t)}class Xo{constructor(t=[],e,i){this.fields=t||[],this.metadata=e||new Map,i||(i=Qo(t)),this.dictionaries=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map((t=>t.name))}toString(){return`Schema<{ ${this.fields.map(((t,e)=>`${e}: ${t}`)).join(", ")} }>`}select(t){const e=new Set(t),i=this.fields.filter((t=>e.has(t.name)));return new Xo(i,this.metadata)}selectAt(t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new Xo(e,this.metadata)}assign(...t){const e=t[0]instanceof Xo?t[0]:Array.isArray(t[0])?new Xo(t[0]):new Xo(t),i=[...this.fields],n=Jo(Jo(new Map,this.metadata),e.metadata),s=e.fields.filter((t=>{const e=i.findIndex((e=>e.name===t.name));return!~e||(i[e]=t.clone({metadata:Jo(Jo(new Map,i[e].metadata),t.metadata)}))&&!1})),r=Qo(s,new Map);return new Xo([...i,...s],n,new Map([...this.dictionaries,...r]))}}Xo.prototype.fields=null,Xo.prototype.metadata=null,Xo.prototype.dictionaries=null;class Ko{constructor(t,e,i=!1,n){this.name=t,this.type=e,this.nullable=i,this.metadata=n||new Map}static new(...t){let[e,i,n,s]=t;return t[0]&&"object"==typeof t[0]&&(({name:e}=t[0]),void 0===i&&(i=t[0].type),void 0===n&&(n=t[0].nullable),void 0===s&&(s=t[0].metadata)),new Ko(`${e}`,i,n,s)}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[e,i,n,s]=t;return t[0]&&"object"==typeof t[0]?({name:e=this.name,type:i=this.type,nullable:n=this.nullable,metadata:s=this.metadata}=t[0]):[e=this.name,i=this.type,n=this.nullable,s=this.metadata]=t,Ko.new(e,i,n,s)}}function Jo(t,e){return new Map([...t||new Map,...e||new Map])}function Qo(t,e=new Map){for(let i=-1,n=t.length;++i<n;){const n=t[i].type;if(Es.isDictionary(n))if(e.has(n.id)){if(e.get(n.id)!==n.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else e.set(n.id,n.dictionary);n.children&&n.children.length>0&&Qo(n.children,e)}return e}Ko.prototype.type=null,Ko.prototype.name=null,Ko.prototype.nullable=null,Ko.prototype.metadata=null;class ta extends er{compareSchemas(t,e){return t===e||e instanceof t.constructor&&this.compareManyFields(t.fields,e.fields)}compareManyFields(t,e){return t===e||Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every(((t,i)=>this.compareFields(t,e[i])))}compareFields(t,e){return t===e||e instanceof t.constructor&&t.name===e.name&&t.nullable===e.nullable&&this.visit(t.type,e.type)}}function ea(t,e){return e instanceof t.constructor}function ia(t,e){return t===e||ea(t,e)}function na(t,e){return t===e||ea(t,e)&&t.bitWidth===e.bitWidth&&t.isSigned===e.isSigned}function sa(t,e){return t===e||ea(t,e)&&t.precision===e.precision}function ra(t,e){return t===e||ea(t,e)&&t.unit===e.unit}function oa(t,e){return t===e||ea(t,e)&&t.unit===e.unit&&t.timezone===e.timezone}function aa(t,e){return t===e||ea(t,e)&&t.unit===e.unit&&t.bitWidth===e.bitWidth}function ha(t,e){return t===e||ea(t,e)&&t.mode===e.mode&&t.typeIds.every(((t,i)=>t===e.typeIds[i]))&&ca.compareManyFields(t.children,e.children)}function la(t,e){return t===e||ea(t,e)&&t.unit===e.unit}ta.prototype.visitNull=ia,ta.prototype.visitBool=ia,ta.prototype.visitInt=na,ta.prototype.visitInt8=na,ta.prototype.visitInt16=na,ta.prototype.visitInt32=na,ta.prototype.visitInt64=na,ta.prototype.visitUint8=na,ta.prototype.visitUint16=na,ta.prototype.visitUint32=na,ta.prototype.visitUint64=na,ta.prototype.visitFloat=sa,ta.prototype.visitFloat16=sa,ta.prototype.visitFloat32=sa,ta.prototype.visitFloat64=sa,ta.prototype.visitUtf8=ia,ta.prototype.visitBinary=ia,ta.prototype.visitFixedSizeBinary=function(t,e){return t===e||ea(t,e)&&t.byteWidth===e.byteWidth},ta.prototype.visitDate=ra,ta.prototype.visitDateDay=ra,ta.prototype.visitDateMillisecond=ra,ta.prototype.visitTimestamp=oa,ta.prototype.visitTimestampSecond=oa,ta.prototype.visitTimestampMillisecond=oa,ta.prototype.visitTimestampMicrosecond=oa,ta.prototype.visitTimestampNanosecond=oa,ta.prototype.visitTime=aa,ta.prototype.visitTimeSecond=aa,ta.prototype.visitTimeMillisecond=aa,ta.prototype.visitTimeMicrosecond=aa,ta.prototype.visitTimeNanosecond=aa,ta.prototype.visitDecimal=ia,ta.prototype.visitList=function(t,e){return t===e||ea(t,e)&&t.children.length===e.children.length&&ca.compareManyFields(t.children,e.children)},ta.prototype.visitStruct=function(t,e){return t===e||ea(t,e)&&t.children.length===e.children.length&&ca.compareManyFields(t.children,e.children)},ta.prototype.visitUnion=ha,ta.prototype.visitDenseUnion=ha,ta.prototype.visitSparseUnion=ha,ta.prototype.visitDictionary=function(t,e){return t===e||ea(t,e)&&t.id===e.id&&t.isOrdered===e.isOrdered&&ca.visit(t.indices,e.indices)&&ca.visit(t.dictionary,e.dictionary)},ta.prototype.visitInterval=la,ta.prototype.visitIntervalDayTime=la,ta.prototype.visitIntervalYearMonth=la,ta.prototype.visitFixedSizeList=function(t,e){return t===e||ea(t,e)&&t.listSize===e.listSize&&t.children.length===e.children.length&&ca.compareManyFields(t.children,e.children)},ta.prototype.visitMap=function(t,e){return t===e||ea(t,e)&&t.keysSorted===e.keysSorted&&t.children.length===e.children.length&&ca.compareManyFields(t.children,e.children)};const ca=new ta;function ua(t,e){return ca.compareSchemas(t,e)}var da,fa;class pa{constructor(...t){switch(t.length){case 2:if([this.schema]=t,!(this.schema instanceof Xo))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=$o({nullCount:0,type:new qs(this.schema.fields),children:this.schema.fields.map((t=>$o({type:t.type,nullCount:0})))})]=t,!(this.data instanceof Ho))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=ma(this.schema,this.data.children);break;case 1:{const[e]=t,{fields:i,children:n,length:s}=Object.keys(e).reduce(((t,i,n)=>(t.children[n]=e[i],t.length=Math.max(t.length,e[i].length),t.fields[n]=Ko.new({name:i,type:e[i].type,nullable:!0}),t)),{length:0,fields:new Array,children:new Array}),r=new Xo(i),o=$o({type:new qs(i),length:s,children:n,nullCount:0});[this.schema,this.data]=ma(r,o.children,s);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=ya(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return eo.visit(this.data,t)}set(t,e){return Cr.visit(this.data,t,e)}indexOf(t,e){return Eo.visit(this.data,t,e)}getByteLength(t){return Zo.visit(this.data,t)}[Symbol.iterator](){return No.visit(new Go([this.data]))}toArray(){return[...this]}concat(...t){return new ba(this.schema,[this,...t])}slice(t,e){const[i]=new Go([this.data]).slice(t,e).data;return new pa(this.schema,i)}getChild(t){var e;return this.getChildAt(null===(e=this.schema.fields)||void 0===e?void 0:e.findIndex((e=>e.name===t)))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new Go([this.data.children[t]]):null}setChild(t,e){var i;return this.setChildAt(null===(i=this.schema.fields)||void 0===i?void 0:i.findIndex((e=>e.name===t)),e)}setChildAt(t,e){let i=this.schema,n=this.data;if(t>-1&&t<this.numCols){e||(e=new Go([$o({type:new zs,length:this.numRows})]));const s=i.fields.slice(),r=n.children.slice(),o=s[t].clone({type:e.type});[s[t],r[t]]=[o,e.data[0]],i=new Xo(s,new Map(this.schema.metadata)),n=$o({type:new qs(s),children:r})}return new pa(i,n)}select(t){const e=this.schema.select(t),i=new qs(e.fields),n=[];for(const e of t){const t=this.schema.fields.findIndex((t=>t.name===e));~t&&(n[t]=this.data.children[t])}return new pa(e,$o({type:i,length:this.numRows,children:n}))}selectAt(t){const e=this.schema.selectAt(t),i=t.map((t=>this.data.children[t])).filter(Boolean),n=$o({type:new qs(e.fields),length:this.numRows,children:i});return new pa(e,n)}}function ma(t,e,i=e.reduce(((t,e)=>Math.max(t,e.length)),0)){var n;const s=[...t.fields],r=[...e],o=(i+63&-64)>>3;for(const[a,h]of t.fields.entries()){const t=e[a];t&&t.length===i||(s[a]=h.clone({nullable:!0}),r[a]=null!==(n=null==t?void 0:t._changeLengthAndBackfillNullBitmap(i))&&void 0!==n?n:$o({type:h.type,length:i,nullCount:i,nullBitmap:new Uint8Array(o)}))}return[t.assign(s),$o({type:new qs(s),length:i,children:r})]}function ya(t,e,i=new Map){for(let n=-1,s=t.length;++n<s;){const s=t[n].type,r=e[n];if(Es.isDictionary(s))if(i.has(s.id)){if(i.get(s.id)!==r.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else r.dictionary&&i.set(s.id,r.dictionary);s.children&&s.children.length>0&&ya(s.children,r.children,i)}return i}da=Symbol.toStringTag,pa[da]=(t=>(t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(pa.prototype);class _a extends pa{constructor(t){const e=t.fields.map((t=>$o({type:t.type})));super(t,$o({type:new qs(t.fields),nullCount:0,children:e}))}}function ga(t,e){return function(t,e){const i=[...t.fields],n=[],s={numBatches:e.reduce(((t,e)=>Math.max(t,e.length)),0)};let r=0,o=0,a=-1;const h=e.length;let l,c=[];for(;s.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<h;)c[a]=l=e[a].shift(),o=Math.min(o,l?l.length:o);Number.isFinite(o)&&(c=va(i,o,c,e,s),o>0&&(n[r++]=$o({type:new qs(i),length:o,nullCount:0,children:c.slice()})))}return[t=t.assign(i),n.map((e=>new pa(t,e)))]}(t,e.map((t=>t.data.concat())))}function va(t,e,i,n,s){var r;const o=(e+63&-64)>>3;for(let a=-1,h=n.length;++a<h;){const h=i[a],l=null==h?void 0:h.length;if(l>=e)l===e?i[a]=h:(i[a]=h.slice(0,e),s.numBatches=Math.max(s.numBatches,n[a].unshift(h.slice(e,l-e))));else{const n=t[a];t[a]=n.clone({nullable:!0}),i[a]=null!==(r=null==h?void 0:h._changeLengthAndBackfillNullBitmap(e))&&void 0!==r?r:$o({type:n.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)})}}return i}class ba{constructor(...t){var e,i;if(0===t.length)return this.batches=[],this.schema=new Xo([]),this._offsets=[0],this;let n,s;t[0]instanceof Xo&&(n=t.shift()),t[t.length-1]instanceof Uint32Array&&(s=t.pop());const r=t=>{if(t){if(t instanceof pa)return[t];if(t instanceof ba)return t.batches;if(t instanceof Ho){if(t.type instanceof qs)return[new pa(new Xo(t.type.children),t)]}else{if(Array.isArray(t))return t.flatMap((t=>r(t)));if("function"==typeof t[Symbol.iterator])return[...t].flatMap((t=>r(t)));if("object"==typeof t){const e=Object.keys(t),i=e.map((e=>new Go([t[e]]))),n=new Xo(e.map(((t,e)=>new Ko(String(t),i[e].type)))),[,s]=ga(n,i);return 0===s.length?[new pa(t)]:s}}}return[]},o=t.flatMap((t=>r(t)));if(n=null!==(i=null!=n?n:null===(e=o[0])||void 0===e?void 0:e.schema)&&void 0!==i?i:new Xo([]),!(n instanceof Xo))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const t of o){if(!(t instanceof pa))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!ua(n,t.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=n,this.batches=o,this._offsets=null!=s?s:yo(this.data)}get data(){return this.batches.map((({data:t})=>t))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce(((t,e)=>t+e.length),0)}get nullCount(){return-1===this._nullCount&&(this._nullCount=mo(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}getByteLength(t){return 0}[Symbol.iterator](){return this.batches.length>0?No.visit(new Go(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[\n  ${this.toArray().join(",\n  ")}\n]`}concat(...t){const e=this.schema,i=this.data.concat(t.flatMap((({data:t})=>t)));return new ba(e,i.map((t=>new pa(e,t))))}slice(t,e){const i=this.schema;[t,e]=ho({length:this.numRows},t,e);const n=_o(this.data,this._offsets,t,e);return new ba(i,n.map((t=>new pa(i,t))))}getChild(t){return this.getChildAt(this.schema.fields.findIndex((e=>e.name===t)))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const e=this.data.map((e=>e.children[t]));if(0===e.length){const{type:i}=this.schema.fields[t],n=$o({type:i,length:0,nullCount:0});e.push(n._changeLengthAndBackfillNullBitmap(this.numRows))}return new Go(e)}return null}setChild(t,e){var i;return this.setChildAt(null===(i=this.schema.fields)||void 0===i?void 0:i.findIndex((e=>e.name===t)),e)}setChildAt(t,e){let i=this.schema,n=[...this.batches];if(t>-1&&t<this.numCols){e||(e=new Go([$o({type:new zs,length:this.numRows})]));const s=i.fields.slice(),r=s[t].clone({type:e.type}),o=this.schema.fields.map(((t,e)=>this.getChildAt(e)));[s[t],o[t]]=[r,e],[i,n]=ga(i,o)}return new ba(i,n)}select(t){const e=this.schema.fields.reduce(((t,e,i)=>t.set(e.name,i)),new Map);return this.selectAt(t.map((t=>e.get(t))).filter((t=>t>-1)))}selectAt(t){const e=this.schema.selectAt(t),i=this.batches.map((e=>e.selectAt(t)));return new ba(e,i)}assign(t){const e=this.schema.fields,[i,n]=t.schema.fields.reduce(((t,i,n)=>{const[s,r]=t,o=e.findIndex((t=>t.name===i.name));return~o?r[o]=n:s.push(n),t}),[[],[]]),s=this.schema.assign(t.schema),r=[...e.map(((t,e)=>[e,n[e]])).map((([e,i])=>void 0===i?this.getChildAt(e):t.getChildAt(i))),...i.map((e=>t.getChildAt(e)))].filter(Boolean);return new ba(...ga(s,r))}}fa=Symbol.toStringTag,ba[fa]=(t=>(t.schema=null,t.batches=[],t._offsets=new Uint32Array([0]),t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,t.isValid=bo(vo),t.get=bo(eo.getVisitFn(fn.Struct)),t.set=xo(Cr.getVisitFn(fn.Struct)),t.indexOf=wo(Eo.getVisitFn(fn.Struct)),t.getByteLength=bo(Zo.getVisitFn(fn.Struct)),"Table"))(ba.prototype);class xa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,i,n){return t.prep(8,24),t.writeInt64(n),t.pad(4),t.writeInt32(i),t.writeInt64(e),t.offset()}}const wa=new Int32Array(2),Ma=new Float32Array(wa.buffer),Sa=new Float64Array(wa.buffer),Ta=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];class Ia{constructor(t,e){this.low=0|t,this.high=0|e}static create(t,e){return 0==t&&0==e?Ia.ZERO:new Ia(t,e)}toFloat64(){return(this.low>>>0)+4294967296*this.high}equals(t){return this.low==t.low&&this.high==t.high}}var Aa,Ca,La,Pa,Ba;Ia.ZERO=new Ia(0,0),function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"}(Aa||(Aa={}));class Ea{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new Ea(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return new Ia(this.readInt32(t),this.readInt32(t+4))}readUint64(t){return new Ia(this.readUint32(t),this.readUint32(t+4))}readFloat32(t){return wa[0]=this.readInt32(t),Ma[0]}readFloat64(t){return wa[Ta?0:1]=this.readInt32(t),wa[Ta?1:0]=this.readInt32(t+4),Sa[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)}writeUint64(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)}writeFloat32(t,e){Ma[0]=e,this.writeInt32(t,wa[0])}writeFloat64(t,e){Sa[0]=e,this.writeInt32(t,wa[Ta?0:1]),this.writeInt32(t+4,wa[Ta?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const i=t-this.readInt32(t);return e<this.readInt16(i)?this.readInt16(i+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const i=this.readInt32(t);let n="",s=0;if(t+=4,e===Aa.UTF8_BYTES)return this.bytes_.subarray(t,t+i);for(;s<i;){let e;const i=this.readUint8(t+s++);if(i<192)e=i;else{const n=this.readUint8(t+s++);if(i<224)e=(31&i)<<6|63&n;else{const r=this.readUint8(t+s++);e=i<240?(15&i)<<12|(63&n)<<6|63&r:(7&i)<<18|(63&n)<<12|(63&r)<<6|63&this.readUint8(t+s++)}}e<65536?n+=String.fromCharCode(e):(e-=65536,n+=String.fromCharCode(55296+(e>>10),56320+(1023&e)))}return n}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createLong(t,e){return Ia.create(t,e)}createScalarList(t,e){const i=[];for(let n=0;n<e;++n)null!==t(n)&&i.push(t(n));return i}createObjList(t,e){const i=[];for(let n=0;n<e;++n){const e=t(n);null!==e&&i.push(e.unpack())}return i}}class za{constructor(t){let e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,e=t||1024,this.bb=Ea.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const i=1+~(this.bb.capacity()-this.space+e)&t-1;for(;this.space<i+t+e;){const t=this.bb.capacity();this.bb=za.growByteBuffer(this.bb),this.space+=this.bb.capacity()-t}this.pad(i)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,i){(this.force_defaults||e!=i)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,i){(this.force_defaults||e!=i)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,i){(this.force_defaults||e!=i)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,i){!this.force_defaults&&e.equals(i)||(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,i){(this.force_defaults||e!=i)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,i){e!=i&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){null!==this.vtable&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=e<<1,n=Ea.allocate(i);return n.setPosition(i-e),n.bytes().set(t.bytes(),i-e),n}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&0==this.vtable[e];e--);const i=e+1;for(;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);const n=2*(i+2);this.addInt16(n);let s=0;const r=this.space;t:for(e=0;e<this.vtables.length;e++){const t=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(t)){for(let e=2;e<n;e+=2)if(this.bb.readInt16(r+e)!=this.bb.readInt16(t+e))continue t;s=this.vtables[e];break}}return s?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,s-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,i){const n=i?4:0;if(e){const t=e;if(this.prep(this.minalign,8+n),4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=3;e>=0;e--)this.writeInt8(t.charCodeAt(e))}this.prep(this.minalign,4+n),this.addOffset(t),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const i=this.bb.capacity()-t,n=i-this.bb.readInt32(i);if(0==this.bb.readInt16(n+e))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,i){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(i,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(!t)return 0;let e;if(t instanceof Uint8Array)e=t;else{e=[];let i=0;for(;i<t.length;){let n;const s=t.charCodeAt(i++);n=s<55296||s>=56320?s:(s<<10)+t.charCodeAt(i++)+-56613888,n<128?e.push(n):(n<2048?e.push(n>>6&31|192):(n<65536?e.push(n>>12&15|224):e.push(n>>18&7|240,n>>12&63|128),e.push(n>>6&63|128)),e.push(63&n|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let t=0,i=this.space,n=this.bb.bytes();t<e.length;t++)n[i++]=e[t];return this.endVector()}createLong(t,e){return Ia.create(t,e)}createObjectOffset(t){return null===t?0:"string"==typeof t?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let i=0;i<t.length;++i){const n=t[i];if(null===n)throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(n))}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t),this.endVector()}}class Oa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new Oa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+4),(e||new Oa).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,e,i){return Oa.startKeyValue(t),Oa.addKey(t,e),Oa.addValue(t,i),Oa.endKeyValue(t)}}!function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"}(Ca||(Ca={})),function(t){t[t.Little=0]="Little",t[t.Big=1]="Big"}(La||(La={})),function(t){t[t.DenseArray=0]="DenseArray"}(Pa||(Pa={}));class ka{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+4),(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){return t.endObject()}static createInt(t,e,i){return ka.startInt(t),ka.addBitWidth(t,e),ka.addIsSigned(t,i),ka.endInt(t)}}class Na{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new Na).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+4),(e||new Na).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new ka).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):Pa.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,Pa.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.FloatingPoint=3]="FloatingPoint",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct_=13]="Struct_",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.LargeList=21]="LargeList"}(Ba||(Ba={}));class Fa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(t,e){return(e||new Fa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,e){return t.setPosition(t.position()+4),(e||new Fa).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Ba.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new Na).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(t,e){const i=this.bb.__offset(this.bb_pos,14);return i?(e||new Fa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const i=this.bb.__offset(this.bb_pos,16);return i?(e||new Oa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,Ba.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){return t.endObject()}}class Da{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(t,e){return(e||new Da).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,e){return t.setPosition(t.position()+4),(e||new Da).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):La.Little}fields(t,e){const i=this.bb.__offset(this.bb_pos,6);return i?(e||new Fa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new Oa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,La.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addInt64(e[i]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(t,e,i,n,s){return Da.startSchema(t),Da.addEndianness(t,e),Da.addFields(t,i),Da.addCustomMetadata(t,n),Da.addFeatures(t,s),Da.endSchema(t)}}class Ra{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new Ra).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+4),(e||new Ra).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ca.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Da).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new xa).__init(this.bb.__vector(this.bb_pos+i)+24*t,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new xa).__init(this.bb.__vector(this.bb_pos+i)+24*t,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new Oa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,Ca.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}var Ua=Ia,Za=za,ja=Ea;class Va{constructor(t,e=on.V4,i,n){this.schema=t,this.version=e,i&&(this._recordBatches=i),n&&(this._dictionaryBatches=n)}static decode(t){t=new ja(Qn(t));const e=Ra.getRootAsFooter(t),i=Xo.decode(e.schema());return new Wa(i,e)}static encode(t){const e=new Za,i=Xo.encode(e,t.schema);Ra.startRecordBatchesVector(e,t.numRecordBatches);for(const i of[...t.recordBatches()].slice().reverse())Ga.encode(e,i);const n=e.endVector();Ra.startDictionariesVector(e,t.numDictionaries);for(const i of[...t.dictionaryBatches()].slice().reverse())Ga.encode(e,i);const s=e.endVector();return Ra.startFooter(e),Ra.addSchema(e,i),Ra.addVersion(e,on.V4),Ra.addRecordBatches(e,n),Ra.addDictionaries(e,s),Ra.finishFooterBuffer(e,Ra.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}*recordBatches(){for(let t,e=-1,i=this.numRecordBatches;++e<i;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,i=this.numDictionaries;++e<i;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class Wa extends Va{constructor(t,e){super(t,e.version()),this._footer=e}get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return Ga.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return Ga.decode(e)}return null}}class Ga{constructor(t,e,i){this.metaDataLength=t,this.offset="number"==typeof i?i:i.low,this.bodyLength="number"==typeof e?e:e.low}static decode(t){return new Ga(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:i}=e,n=new Ua(e.offset,0),s=new Ua(e.bodyLength,0);return xa.createBlock(t,n,i,s)}}const qa={fromIterable:t=>Ha(function*(t){let e,i,n,s,r=!1,o=[],a=0;({cmd:n,size:s}=yield null);const h=(l=t,function*(t,e){const i=function*(t){yield t},n="string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Yn?i(e):Dn(e)?e:i(e);return yield*ts(function*(e){let i=null;do{i=e.next(yield Kn(t,i))}while(!i.done)}(n[Symbol.iterator]())),new t}(Uint8Array,l))[Symbol.iterator]();var l;try{do{if(({done:e,value:i}=Number.isNaN(s-a)?h.next():h.next(s-a)),!e&&i.byteLength>0&&(o.push(i),a+=i.byteLength),e||s<=a)do{({cmd:n,size:s}=yield"peek"===n?Xn(o,s)[0]:([i,o,a]=Xn(o,s),i))}while(s<a)}while(!e)}catch(t){(r=!0)&&"function"==typeof h.throw&&h.throw(t)}finally{!1===r&&"function"==typeof h.return&&h.return(null)}return null}(t)),fromAsyncIterable:t=>Ha(function(t){return wn(this,arguments,(function*(){let e,i,n,s,r=!1,o=[],a=0;({cmd:n,size:s}=yield yield xn(null));const h=(l=t,es(Uint8Array,l))[Symbol.asyncIterator]();var l;try{do{if(({done:e,value:i}=Number.isNaN(s-a)?yield xn(h.next()):yield xn(h.next(s-a))),!e&&i.byteLength>0&&(o.push(i),a+=i.byteLength),e||s<=a)do{({cmd:n,size:s}=yield yield xn("peek"===n?Xn(o,s)[0]:([i,o,a]=Xn(o,s),i)))}while(s<a)}while(!e)}catch(t){(r=!0)&&"function"==typeof h.throw&&(yield xn(h.throw(t)))}finally{!1===r&&"function"==typeof h.return&&(yield xn(h.return(new Uint8Array(0))))}return yield xn(null)}))}(t)),fromDOMStream:t=>Ha(function(t){return wn(this,arguments,(function*(){let e,i,n,s=!1,r=!1,o=[],a=0;({cmd:i,size:n}=yield yield xn(null));const h=new Ya(t);try{do{if(({done:s,value:e}=Number.isNaN(n-a)?yield xn(h.read()):yield xn(h.read(n-a))),!s&&e.byteLength>0&&(o.push(Qn(e)),a+=e.byteLength),s||n<=a)do{({cmd:i,size:n}=yield yield xn("peek"===i?Xn(o,n)[0]:([e,o,a]=Xn(o,n),e)))}while(n<a)}while(!s)}catch(t){(r=!0)&&(yield xn(h.cancel(t)))}finally{!1===r?yield xn(h.cancel()):t.locked&&h.releaseLock()}return yield xn(null)}))}(t)),fromNodeStream:t=>Ha(function(t){return wn(this,arguments,(function*(){const e=[];let i,n,s,r="error",o=!1,a=null,h=0,l=[];if(({cmd:i,size:n}=yield yield xn(null)),t.isTTY)return yield yield xn(new Uint8Array(0)),yield xn(null);try{e[0]=$a(t,"end"),e[1]=$a(t,"error");do{if(e[2]=$a(t,"readable"),[r,a]=yield xn(Promise.race(e.map((t=>t[2])))),"error"===r)break;if((o="end"===r)||(Number.isFinite(n-h)?(s=Qn(t.read(n-h)),s.byteLength<n-h&&(s=Qn(t.read()))):s=Qn(t.read()),s.byteLength>0&&(l.push(s),h+=s.byteLength)),o||n<=h)do{({cmd:i,size:n}=yield yield xn("peek"===i?Xn(l,n)[0]:([s,l,h]=Xn(l,n),s)))}while(n<h)}while(!o)}finally{yield xn(function(e,i){return s=l=null,new Promise(((n,s)=>{for(const[i,n]of e)t.off(i,n);try{const e=t.destroy;e&&e.call(t,i),i=void 0}catch(t){i=t||i}finally{null!=i?s(i):n()}}))}(e,"error"===r?a:null))}return yield xn(null)}))}(t)),toDOMStream(t,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(t,e){throw new Error('"toNodeStream" not available in this environment')}},Ha=t=>(t.next(),t);class Ya{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch((()=>{}))}get closed(){return this.reader?this.reader.closed.catch((()=>{})):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return bn(this,void 0,void 0,(function*(){const{reader:e,source:i}=this;e&&(yield e.cancel(t).catch((()=>{}))),i&&i.locked&&this.releaseLock()}))}read(t){return bn(this,void 0,void 0,(function*(){if(0===t)return{done:null==this.reader,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=Qn(e)),e}))}}const $a=(t,e)=>{const i=t=>n([e,t]);let n;return[e,i,new Promise((s=>(n=s)&&t.once(e,i)))]},Xa=Object.freeze({done:!0,value:void 0});class Ka{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Ja{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class Qa extends Ja{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise((t=>this._closedPromiseResolve=t))}get closed(){return this._closedPromise}cancel(t){return bn(this,void 0,void 0,(function*(){yield this.return(t)}))}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(Xa);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return qa.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return qa.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return bn(this,void 0,void 0,(function*(){return yield this.abort(t),Xa}))}return(t){return bn(this,void 0,void 0,(function*(){return yield this.close(),Xa}))}read(t){return bn(this,void 0,void 0,(function*(){return(yield this.next(t,"read")).value}))}peek(t){return bn(this,void 0,void 0,(function*(){return(yield this.next(t,"peek")).value}))}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise(((t,e)=>{this.resolvers.push({resolve:t,reject:e})})):Promise.resolve(Xa)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class th extends Qa{write(t){if((t=Qn(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?In(this.toUint8Array(!0)):this.toUint8Array(!1).then(In)}toUint8Array(t=!1){return t?Xn(this._values)[0]:(()=>bn(this,void 0,void 0,(function*(){var t,e;const i=[];let n=0;try{for(var s,r=Sn(this);!(s=yield r.next()).done;){const t=s.value;i.push(t),n+=t.byteLength}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&(yield e.call(r))}finally{if(t)throw t.error}}return Xn(i,n)[0]})))()}}class eh{constructor(t){t&&(this.source=new nh(qa.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class ih{constructor(t){t instanceof ih?this.source=t.source:t instanceof th?this.source=new sh(qa.fromAsyncIterable(t)):qn(t)?this.source=new sh(qa.fromNodeStream(t)):Gn(t)?this.source=new sh(qa.fromDOMStream(t)):Vn(t)?this.source=new sh(qa.fromDOMStream(t.body)):Dn(t)?this.source=new sh(qa.fromIterable(t)):(Fn(t)||Rn(t))&&(this.source=new sh(qa.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class nh{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||Xa)}return(t){return Object.create(this.source.return&&this.source.return(t)||Xa)}}class sh{constructor(t){this.source=t,this._closedPromise=new Promise((t=>this._closedPromiseResolve=t))}cancel(t){return bn(this,void 0,void 0,(function*(){yield this.return(t)}))}get closed(){return this._closedPromise}read(t){return bn(this,void 0,void 0,(function*(){return(yield this.next(t,"read")).value}))}peek(t){return bn(this,void 0,void 0,(function*(){return(yield this.next(t,"peek")).value}))}next(t,e="read"){return bn(this,void 0,void 0,(function*(){return yield this.source.next({cmd:e,size:t})}))}throw(t){return bn(this,void 0,void 0,(function*(){const e=this.source.throw&&(yield this.source.throw(t))||Xa;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)}))}return(t){return bn(this,void 0,void 0,(function*(){const e=this.source.return&&(yield this.source.return(t))||Xa;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)}))}}class rh extends eh{constructor(t,e){super(),this.position=0,this.buffer=Qn(t),this.size=void 0===e?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:i}=this.readAt(t,4);return new DataView(e,i).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:i,position:n}=this;return e&&n<i?("number"!=typeof t&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(i,n+Math.min(i-n,t)),e.subarray(n,this.position)):null}readAt(t,e){const i=this.buffer,n=Math.min(this.size,t+e);return i?i.subarray(t,n):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class oh extends ih{constructor(t,e){super(),this.position=0,this._handle=t,"number"==typeof e?this.size=e:this._pending=(()=>bn(this,void 0,void 0,(function*(){this.size=(yield t.stat()).size,delete this._pending})))()}readInt32(t){return bn(this,void 0,void 0,(function*(){const{buffer:e,byteOffset:i}=yield this.readAt(t,4);return new DataView(e,i).getInt32(0,!0)}))}seek(t){return bn(this,void 0,void 0,(function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size}))}read(t){return bn(this,void 0,void 0,(function*(){this._pending&&(yield this._pending);const{_handle:e,size:i,position:n}=this;if(e&&n<i){"number"!=typeof t&&(t=Number.POSITIVE_INFINITY);let s=n,r=0,o=0;const a=Math.min(i,s+Math.min(i-s,t)),h=new Uint8Array(Math.max(0,(this.position=a)-s));for(;(s+=o)<a&&(r+=o)<h.byteLength;)({bytesRead:o}=yield e.read(h,r,h.byteLength-r,s));return h}return null}))}readAt(t,e){return bn(this,void 0,void 0,(function*(){this._pending&&(yield this._pending);const{_handle:i,size:n}=this;if(i&&t+e<n){const s=Math.min(n,t+e),r=new Uint8Array(s-t);return(yield i.read(r,0,e,t)).buffer}return new Uint8Array(e)}))}close(){return bn(this,void 0,void 0,(function*(){const t=this._handle;this._handle=null,t&&(yield t.close())}))}throw(t){return bn(this,void 0,void 0,(function*(){return yield this.close(),{done:!0,value:t}}))}return(t){return bn(this,void 0,void 0,(function*(){return yield this.close(),{done:!0,value:t}}))}}function ah(t){return t<0&&(t=4294967295+t+1),`0x${t.toString(16)}`}const hh=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class lh{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,65535&this.buffer[1],this.buffer[0]>>>16,65535&this.buffer[0]]),i=new Uint32Array([t.buffer[1]>>>16,65535&t.buffer[1],t.buffer[0]>>>16,65535&t.buffer[0]]);let n=e[3]*i[3];this.buffer[0]=65535&n;let s=n>>>16;return n=e[2]*i[3],s+=n,n=e[3]*i[2]>>>0,s+=n,this.buffer[0]+=s<<16,this.buffer[1]=s>>>0<n?65536:0,this.buffer[1]+=s>>>16,this.buffer[1]+=e[1]*i[3]+e[2]*i[2]+e[3]*i[1],this.buffer[1]+=e[0]*i[3]+e[1]*i[2]+e[2]*i[1]+e[3]*i[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${ah(this.buffer[1])} ${ah(this.buffer[0])}`}}class ch extends lh{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return ch.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return ch.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const i=t.length,n=new ch(e);for(let e=0;e<i;){const s=8<i-e?8:i-e,r=new ch(new Uint32Array([Number.parseInt(t.slice(e,e+s),10),0])),o=new ch(new Uint32Array([hh[s],0]));n.times(o),n.plus(r),e+=s}return n}static convertArray(t){const e=new Uint32Array(2*t.length);for(let i=-1,n=t.length;++i<n;)ch.from(t[i],new Uint32Array(e.buffer,e.byteOffset+2*i*4,2));return e}static multiply(t,e){return new ch(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new ch(new Uint32Array(t.buffer)).plus(e)}}class uh extends lh{negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],0==this.buffer[0]&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,i=t.buffer[1]<<0;return e<i||e===i&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return uh.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return uh.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const i=t.startsWith("-"),n=t.length,s=new uh(e);for(let e=i?1:0;e<n;){const i=8<n-e?8:n-e,r=new uh(new Uint32Array([Number.parseInt(t.slice(e,e+i),10),0])),o=new uh(new Uint32Array([hh[i],0]));s.times(o),s.plus(r),e+=i}return i?s.negate():s}static convertArray(t){const e=new Uint32Array(2*t.length);for(let i=-1,n=t.length;++i<n;)uh.from(t[i],new Uint32Array(e.buffer,e.byteOffset+2*i*4,2));return e}static multiply(t,e){return new uh(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new uh(new Uint32Array(t.buffer)).plus(e)}}class dh{constructor(t){this.buffer=t}high(){return new uh(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new uh(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],0==this.buffer[0]&&++this.buffer[1],0==this.buffer[1]&&++this.buffer[2],0==this.buffer[2]&&++this.buffer[3],this}times(t){const e=new ch(new Uint32Array([this.buffer[3],0])),i=new ch(new Uint32Array([this.buffer[2],0])),n=new ch(new Uint32Array([this.buffer[1],0])),s=new ch(new Uint32Array([this.buffer[0],0])),r=new ch(new Uint32Array([t.buffer[3],0])),o=new ch(new Uint32Array([t.buffer[2],0])),a=new ch(new Uint32Array([t.buffer[1],0])),h=new ch(new Uint32Array([t.buffer[0],0]));let l=ch.multiply(s,h);this.buffer[0]=l.low();const c=new ch(new Uint32Array([l.high(),0]));return l=ch.multiply(n,h),c.plus(l),l=ch.multiply(s,a),c.plus(l),this.buffer[1]=c.low(),this.buffer[3]=c.lessThan(l)?1:0,this.buffer[2]=c.high(),new ch(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(ch.multiply(i,h)).plus(ch.multiply(n,a)).plus(ch.multiply(s,o)),this.buffer[3]+=ch.multiply(e,h).plus(ch.multiply(i,a)).plus(ch.multiply(n,o)).plus(ch.multiply(s,r)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${ah(this.buffer[3])} ${ah(this.buffer[2])} ${ah(this.buffer[1])} ${ah(this.buffer[0])}`}static multiply(t,e){return new dh(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new dh(new Uint32Array(t.buffer)).plus(e)}static from(t,e=new Uint32Array(4)){return dh.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return dh.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const i=t.startsWith("-"),n=t.length,s=new dh(e);for(let e=i?1:0;e<n;){const i=8<n-e?8:n-e,r=new dh(new Uint32Array([Number.parseInt(t.slice(e,e+i),10),0,0,0])),o=new dh(new Uint32Array([hh[i],0,0,0]));s.times(o),s.plus(r),e+=i}return i?s.negate():s}static convertArray(t){const e=new Uint32Array(4*t.length);for(let i=-1,n=t.length;++i<n;)dh.from(t[i],new Uint32Array(e.buffer,e.byteOffset+16*i,4));return e}}class fh extends er{constructor(t,e,i,n){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=i,this.dictionaries=n}visit(t){return super.visit(t instanceof Ko?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return $o({type:t,length:e})}visitBool(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitInt(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitDate(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitTime(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitList(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),children:this.visitMany(t.children)})}visitUnion(t){return t.mode===an.Sparse?this.visitSparseUnion(t):this.visitDenseUnion(t)}visitDenseUnion(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:i}=this.nextFieldNode()){return $o({type:t,length:e,nullCount:i,nullBitmap:this.readNullBitmap(t,i),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,i=this.nextBufferRange()){return e>0&&this.readData(t,i)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:i}=this.nextBufferRange()){return this.bytes.subarray(i,i+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class ph extends fh{constructor(t,e,i,n){super(new Uint8Array(0),e,i,n),this.sources=t}readNullBitmap(t,e,{offset:i}=this.nextBufferRange()){return e<=0?new Uint8Array(0):To(this.sources[i])}readOffsets(t,{offset:e}=this.nextBufferRange()){return Kn(Uint8Array,Kn(Int32Array,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return Kn(Uint8Array,Kn(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:i}=this;return Es.isTimestamp(t)||(Es.isInt(t)||Es.isTime(t))&&64===t.bitWidth||Es.isDate(t)&&t.unit===ln.MILLISECOND?Kn(Uint8Array,uh.convertArray(i[e])):Es.isDecimal(t)?Kn(Uint8Array,dh.convertArray(i[e])):Es.isBinary(t)||Es.isFixedSizeBinary(t)?function(t){const e=t.join(""),i=new Uint8Array(e.length/2);for(let t=0;t<e.length;t+=2)i[t>>1]=Number.parseInt(e.slice(t,t+2),16);return i}(i[e]):Es.isBool(t)?To(i[e]):Es.isUtf8(t)?Cn(i[e].join("")):Kn(Uint8Array,Kn(t.ArrayType,i[e].map((t=>+t))))}}var mh,yh,_h,gh,vh,bh,xh,wh;!function(t){t[t.BUFFER=0]="BUFFER"}(mh||(mh={})),function(t){t[t.LZ4_FRAME=0]="LZ4_FRAME",t[t.ZSTD=1]="ZSTD"}(yh||(yh={}));class Mh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new Mh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+4),(e||new Mh).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):yh.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):mh.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,yh.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,mh.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,e,i){return Mh.startBodyCompression(t),Mh.addCodec(t,e),Mh.addMethod(t,i),Mh.endBodyCompression(t)}}class Sh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,i){return t.prep(8,16),t.writeInt64(i),t.writeInt64(e),t.offset()}}class Th{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,i){return t.prep(8,16),t.writeInt64(i),t.writeInt64(e),t.offset()}}class Ih{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(t,e){return(e||new Ih).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,e){return t.setPosition(t.position()+4),(e||new Ih).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}nodes(t,e){const i=this.bb.__offset(this.bb_pos,6);return i?(e||new Th).__init(this.bb.__vector(this.bb_pos+i)+16*t,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new Sh).__init(this.bb.__vector(this.bb_pos+i)+16*t,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new Mh).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){return t.endObject()}}class Ah{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(t,e){return(e||new Ah).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,e){return t.setPosition(t.position()+4),(e||new Ah).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Ih).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){return t.endObject()}}!function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"}(_h||(_h={}));class Ch{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new Ch).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+4),(e||new Ch).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):_h.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,_h.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,e){return Ch.startFloatingPoint(t),Ch.addPrecision(t,e),Ch.endFloatingPoint(t)}}class Lh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new Lh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+4),(e||new Lh).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,e,i,n){return Lh.startDecimal(t),Lh.addPrecision(t,e),Lh.addScale(t,i),Lh.addBitWidth(t,n),Lh.endDecimal(t)}}!function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"}(gh||(gh={}));class Ph{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(t,e){return(e||new Ph).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,e){return t.setPosition(t.position()+4),(e||new Ph).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):gh.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,gh.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,e){return Ph.startDate(t),Ph.addUnit(t,e),Ph.endDate(t)}}!function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"}(vh||(vh={}));class Bh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new Bh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+4),(e||new Bh).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):vh.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,vh.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){return t.endObject()}static createTime(t,e,i){return Bh.startTime(t),Bh.addUnit(t,e),Bh.addBitWidth(t,i),Bh.endTime(t)}}class Eh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new Eh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+4),(e||new Eh).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):vh.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,vh.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,e,i){return Eh.startTimestamp(t),Eh.addUnit(t,e),Eh.addTimezone(t,i),Eh.endTimestamp(t)}}!function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"}(bh||(bh={}));class zh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new zh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+4),(e||new zh).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):bh.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,bh.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,e){return zh.startInterval(t),zh.addUnit(t,e),zh.endInterval(t)}}!function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"}(xh||(xh={}));class Oh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new Oh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+4),(e||new Oh).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):xh.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,xh.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){return t.endObject()}static createUnion(t,e,i){return Oh.startUnion(t),Oh.addMode(t,e),Oh.addTypeIds(t,i),Oh.endUnion(t)}}class kh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new kh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+4),(e||new kh).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,e){return kh.startFixedSizeBinary(t),kh.addByteWidth(t,e),kh.endFixedSizeBinary(t)}}class Nh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new Nh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+4),(e||new Nh).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,e){return Nh.startFixedSizeList(t),Nh.addListSize(t,e),Nh.endFixedSizeList(t)}}class Fh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(t,e){return(e||new Fh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,e){return t.setPosition(t.position()+4),(e||new Fh).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){return t.endObject()}static createMap(t,e){return Fh.startMap(t),Fh.addKeysSorted(t,e),Fh.endMap(t)}}!function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"}(wh||(wh={}));class Dh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(t,e){return(e||new Dh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,e){return t.setPosition(t.position()+4),(e||new Dh).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ca.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):wh.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}customMetadata(t,e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new Oa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,Ca.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,wh.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,t.createLong(0,0))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(t,e,i,n,s,r){return Dh.startMessage(t),Dh.addVersion(t,e),Dh.addHeaderType(t,i),Dh.addHeader(t,n),Dh.addBodyLength(t,s),Dh.addCustomMetadata(t,r),Dh.endMessage(t)}}class Rh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new Rh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+4),(e||new Rh).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return Rh.startNull(t),Rh.endNull(t)}}class Uh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new Uh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+4),(e||new Uh).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return Uh.startBinary(t),Uh.endBinary(t)}}class Zh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new Zh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+4),(e||new Zh).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return Zh.startBool(t),Zh.endBool(t)}}class jh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new jh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+4),(e||new jh).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return jh.startUtf8(t),jh.endUtf8(t)}}class Vh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new Vh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+4),(e||new Vh).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return Vh.startList(t),Vh.endList(t)}}class Wh{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new Wh).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+4),(e||new Wh).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return Wh.startStruct_(t),Wh.endStruct_(t)}}var Gh=Ia;const qh=new class extends er{visit(t,e){return null==t||null==e?void 0:super.visit(t,e)}visitNull(t,e){return Rh.startNull(e),Rh.endNull(e)}visitInt(t,e){return ka.startInt(e),ka.addBitWidth(e,t.bitWidth),ka.addIsSigned(e,t.isSigned),ka.endInt(e)}visitFloat(t,e){return Ch.startFloatingPoint(e),Ch.addPrecision(e,t.precision),Ch.endFloatingPoint(e)}visitBinary(t,e){return Uh.startBinary(e),Uh.endBinary(e)}visitBool(t,e){return Zh.startBool(e),Zh.endBool(e)}visitUtf8(t,e){return jh.startUtf8(e),jh.endUtf8(e)}visitDecimal(t,e){return Lh.startDecimal(e),Lh.addScale(e,t.scale),Lh.addPrecision(e,t.precision),Lh.addBitWidth(e,t.bitWidth),Lh.endDecimal(e)}visitDate(t,e){return Ph.startDate(e),Ph.addUnit(e,t.unit),Ph.endDate(e)}visitTime(t,e){return Bh.startTime(e),Bh.addUnit(e,t.unit),Bh.addBitWidth(e,t.bitWidth),Bh.endTime(e)}visitTimestamp(t,e){const i=t.timezone&&e.createString(t.timezone)||void 0;return Eh.startTimestamp(e),Eh.addUnit(e,t.unit),void 0!==i&&Eh.addTimezone(e,i),Eh.endTimestamp(e)}visitInterval(t,e){return zh.startInterval(e),zh.addUnit(e,t.unit),zh.endInterval(e)}visitList(t,e){return Vh.startList(e),Vh.endList(e)}visitStruct(t,e){return Wh.startStruct_(e),Wh.endStruct_(e)}visitUnion(t,e){Oh.startTypeIdsVector(e,t.typeIds.length);const i=Oh.createTypeIdsVector(e,t.typeIds);return Oh.startUnion(e),Oh.addMode(e,t.mode),Oh.addTypeIds(e,i),Oh.endUnion(e)}visitDictionary(t,e){const i=this.visit(t.indices,e);return Na.startDictionaryEncoding(e),Na.addId(e,new Gh(t.id,0)),Na.addIsOrdered(e,t.isOrdered),void 0!==i&&Na.addIndexType(e,i),Na.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return kh.startFixedSizeBinary(e),kh.addByteWidth(e,t.byteWidth),kh.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return Nh.startFixedSizeList(e),Nh.addListSize(e,t.listSize),Nh.endFixedSizeList(e)}visitMap(t,e){return Fh.startMap(e),Fh.addKeysSorted(e,t.keysSorted),Fh.endMap(e)}};function Hh(t){return new sl(t.count,$h(t.columns),Xh(t.columns))}function Yh(t,e){return(t.children||[]).filter(Boolean).map((t=>Ko.fromJSON(t,e)))}function $h(t){return(t||[]).reduce(((t,e)=>{return[...t,new al(e.count,(i=e.VALIDITY,(i||[]).reduce(((t,e)=>t+ +(0===e)),0))),...$h(e.children)];var i}),[])}function Xh(t,e=[]){for(let i=-1,n=(t||[]).length;++i<n;){const n=t[i];n.VALIDITY&&e.push(new ol(e.length,n.VALIDITY.length)),n.TYPE&&e.push(new ol(e.length,n.TYPE.length)),n.OFFSET&&e.push(new ol(e.length,n.OFFSET.length)),n.DATA&&e.push(new ol(e.length,n.DATA.length)),e=Xh(n.children,e)}return e}function Kh(t){return new Map(Object.entries(t||{}))}function Jh(t){return new Os(t.isSigned,t.bitWidth)}function Qh(t,e){const i=t.type.name;switch(i){case"NONE":case"null":return new zs;case"binary":return new Fs;case"utf8":return new Ds;case"bool":return new Rs;case"list":return new Gs((e||[])[0]);case"struct":case"struct_":return new qs(e||[])}switch(i){case"int":{const e=t.type;return new Os(e.isSigned,e.bitWidth)}case"floatingpoint":{const e=t.type;return new Ns(hn[e.precision])}case"decimal":{const e=t.type;return new Us(e.scale,e.precision,e.bitWidth)}case"date":{const e=t.type;return new Zs(ln[e.unit])}case"time":{const e=t.type;return new js(cn[e.unit],e.bitWidth)}case"timestamp":{const e=t.type;return new Vs(cn[e.unit],e.timezone)}case"interval":{const e=t.type;return new Ws(un[e.unit])}case"union":{const i=t.type;return new Hs(an[i.mode],i.typeIds||[],e||[])}case"fixedsizebinary":{const e=t.type;return new Ys(e.byteWidth)}case"fixedsizelist":{const i=t.type;return new $s(i.listSize,(e||[])[0])}case"map":{const i=t.type;return new Xs((e||[])[0],i.keysSorted)}}throw new Error(`Unrecognized type: "${i}"`)}var tl=Ia,el=za,il=Ea;class nl{constructor(t,e,i,n){this._version=e,this._headerType=i,this.body=new Uint8Array(0),n&&(this._createHeader=()=>n),this._bodyLength="number"==typeof t?t:t.low}static fromJSON(t,e){const i=new nl(0,on.V4,e);return i._createHeader=function(t,e){return()=>{switch(e){case dn.Schema:return Xo.fromJSON(t);case dn.RecordBatch:return sl.fromJSON(t);case dn.DictionaryBatch:return rl.fromJSON(t)}throw new Error(`Unrecognized Message type: { name: ${dn[e]}, type: ${e} }`)}}(t,e),i}static decode(t){t=new il(Qn(t));const e=Dh.getRootAsMessage(t),i=e.bodyLength(),n=e.version(),s=e.headerType(),r=new nl(i,n,s);return r._createHeader=function(t,e){return()=>{switch(e){case dn.Schema:return Xo.decode(t.header(new Da));case dn.RecordBatch:return sl.decode(t.header(new Ih),t.version());case dn.DictionaryBatch:return rl.decode(t.header(new Ah),t.version())}throw new Error(`Unrecognized Message type: { name: ${dn[e]}, type: ${e} }`)}}(e,s),r}static encode(t){const e=new el;let i=-1;return t.isSchema()?i=Xo.encode(e,t.header()):t.isRecordBatch()?i=sl.encode(e,t.header()):t.isDictionaryBatch()&&(i=rl.encode(e,t.header())),Dh.startMessage(e),Dh.addVersion(e,on.V4),Dh.addHeader(e,i),Dh.addHeaderType(e,t.headerType),Dh.addBodyLength(e,new tl(t.bodyLength,0)),Dh.finishMessageBuffer(e,Dh.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof Xo)return new nl(0,on.V4,dn.Schema,t);if(t instanceof sl)return new nl(e,on.V4,dn.RecordBatch,t);if(t instanceof rl)return new nl(e,on.V4,dn.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===dn.Schema}isRecordBatch(){return this.headerType===dn.RecordBatch}isDictionaryBatch(){return this.headerType===dn.DictionaryBatch}}class sl{constructor(t,e,i){this._nodes=e,this._buffers=i,this._length="number"==typeof t?t:t.low}get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}}class rl{constructor(t,e,i=!1){this._data=t,this._isDelta=i,this._id="number"==typeof e?e:e.low}get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}}class ol{constructor(t,e){this.offset="number"==typeof t?t:t.low,this.length="number"==typeof e?e:e.low}}class al{constructor(t,e){this.length="number"==typeof t?t:t.low,this.nullCount="number"==typeof e?e:e.low}}function hl(t,e){const i=[];for(let n,s=-1,r=-1,o=t.childrenLength();++s<o;)(n=t.children(s))&&(i[++r]=Ko.decode(n,e));return i}function ll(t){const e=new Map;if(t)for(let i,n,s=-1,r=Math.trunc(t.customMetadataLength());++s<r;)(i=t.customMetadata(s))&&null!=(n=i.key())&&e.set(n,i.value());return e}function cl(t){return new Os(t.isSigned(),t.bitWidth())}function ul(t,e){const i=t.typeType();switch(i){case Ba.NONE:case Ba.Null:return new zs;case Ba.Binary:return new Fs;case Ba.Utf8:return new Ds;case Ba.Bool:return new Rs;case Ba.List:return new Gs((e||[])[0]);case Ba.Struct_:return new qs(e||[])}switch(i){case Ba.Int:{const e=t.type(new ka);return new Os(e.isSigned(),e.bitWidth())}case Ba.FloatingPoint:{const e=t.type(new Ch);return new Ns(e.precision())}case Ba.Decimal:{const e=t.type(new Lh);return new Us(e.scale(),e.precision(),e.bitWidth())}case Ba.Date:{const e=t.type(new Ph);return new Zs(e.unit())}case Ba.Time:{const e=t.type(new Bh);return new js(e.unit(),e.bitWidth())}case Ba.Timestamp:{const e=t.type(new Eh);return new Vs(e.unit(),e.timezone())}case Ba.Interval:{const e=t.type(new zh);return new Ws(e.unit())}case Ba.Union:{const i=t.type(new Oh);return new Hs(i.mode(),i.typeIdsArray()||[],e||[])}case Ba.FixedSizeBinary:{const e=t.type(new kh);return new Ys(e.byteWidth())}case Ba.FixedSizeList:{const i=t.type(new Nh);return new $s(i.listSize(),(e||[])[0])}case Ba.Map:{const i=t.type(new Fh);return new Xs((e||[])[0],i.keysSorted())}}throw new Error(`Unrecognized type: "${Ba[i]}" (${i})`)}Ko.encode=function(t,e){let i=-1,n=-1,s=-1;const r=e.type;let o=e.typeId;Es.isDictionary(r)?(o=r.dictionary.typeId,s=qh.visit(r,t),n=qh.visit(r.dictionary,t)):n=qh.visit(r,t);const a=(r.children||[]).map((e=>Ko.encode(t,e))),h=Fa.createChildrenVector(t,a),l=e.metadata&&e.metadata.size>0?Fa.createCustomMetadataVector(t,[...e.metadata].map((([e,i])=>{const n=t.createString(`${e}`),s=t.createString(`${i}`);return Oa.startKeyValue(t),Oa.addKey(t,n),Oa.addValue(t,s),Oa.endKeyValue(t)}))):-1;return e.name&&(i=t.createString(e.name)),Fa.startField(t),Fa.addType(t,n),Fa.addTypeType(t,o),Fa.addChildren(t,h),Fa.addNullable(t,!!e.nullable),-1!==i&&Fa.addName(t,i),-1!==s&&Fa.addDictionary(t,s),-1!==l&&Fa.addCustomMetadata(t,l),Fa.endField(t)},Ko.decode=function(t,e){let i,n,s,r,o,a;return e&&(a=t.dictionary())?e.has(i=a.id().low)?(r=(r=a.indexType())?cl(r):new ks,o=new Qs(e.get(i),r,i,a.isOrdered()),n=new Ko(t.name(),o,t.nullable(),ll(t))):(r=(r=a.indexType())?cl(r):new ks,e.set(i,s=ul(t,hl(t,e))),o=new Qs(s,r,i,a.isOrdered()),n=new Ko(t.name(),o,t.nullable(),ll(t))):(s=ul(t,hl(t,e)),n=new Ko(t.name(),s,t.nullable(),ll(t))),n||null},Ko.fromJSON=function(t,e){let i,n,s,r,o,a;return e&&(r=t.dictionary)?e.has(i=r.id)?(n=(n=r.indexType)?Jh(n):new ks,a=new Qs(e.get(i),n,i,r.isOrdered),s=new Ko(t.name,a,t.nullable,Kh(t.customMetadata))):(n=(n=r.indexType)?Jh(n):new ks,e.set(i,o=Qh(t,Yh(t,e))),a=new Qs(o,n,i,r.isOrdered),s=new Ko(t.name,a,t.nullable,Kh(t.customMetadata))):(o=Qh(t,Yh(t,e)),s=new Ko(t.name,o,t.nullable,Kh(t.customMetadata))),s||null},Xo.encode=function(t,e){const i=e.fields.map((e=>Ko.encode(t,e)));Da.startFieldsVector(t,i.length);const n=Da.createFieldsVector(t,i),s=e.metadata&&e.metadata.size>0?Da.createCustomMetadataVector(t,[...e.metadata].map((([e,i])=>{const n=t.createString(`${e}`),s=t.createString(`${i}`);return Oa.startKeyValue(t),Oa.addKey(t,n),Oa.addValue(t,s),Oa.endKeyValue(t)}))):-1;return Da.startSchema(t),Da.addFields(t,n),Da.addEndianness(t,dl?La.Little:La.Big),-1!==s&&Da.addCustomMetadata(t,s),Da.endSchema(t)},Xo.decode=function(t,e=new Map){const i=function(t,e){const i=[];for(let n,s=-1,r=-1,o=t.fieldsLength();++s<o;)(n=t.fields(s))&&(i[++r]=Ko.decode(n,e));return i}(t,e);return new Xo(i,ll(t),e)},Xo.fromJSON=function(t,e=new Map){return new Xo(function(t,e){return(t.fields||[]).filter(Boolean).map((t=>Ko.fromJSON(t,e)))}(t,e),Kh(t.customMetadata),e)},sl.encode=function(t,e){const i=e.nodes||[],n=e.buffers||[];Ih.startNodesVector(t,i.length);for(const e of i.slice().reverse())al.encode(t,e);const s=t.endVector();Ih.startBuffersVector(t,n.length);for(const e of n.slice().reverse())ol.encode(t,e);const r=t.endVector();return Ih.startRecordBatch(t),Ih.addLength(t,new tl(e.length,0)),Ih.addNodes(t,s),Ih.addBuffers(t,r),Ih.endRecordBatch(t)},sl.decode=function(t,e=on.V4){if(null!==t.compression())throw new Error("Record batch compression not implemented");return new sl(t.length(),function(t){const e=[];for(let i,n=-1,s=-1,r=t.nodesLength();++n<r;)(i=t.nodes(n))&&(e[++s]=al.decode(i));return e}(t),function(t,e){const i=[];for(let n,s=-1,r=-1,o=t.buffersLength();++s<o;)(n=t.buffers(s))&&(e<on.V4&&(n.bb_pos+=8*(s+1)),i[++r]=ol.decode(n));return i}(t,e))},sl.fromJSON=Hh,rl.encode=function(t,e){const i=sl.encode(t,e.data);return Ah.startDictionaryBatch(t),Ah.addId(t,new tl(e.id,0)),Ah.addIsDelta(t,e.isDelta),Ah.addData(t,i),Ah.endDictionaryBatch(t)},rl.decode=function(t,e=on.V4){return new rl(sl.decode(t.data(),e),t.id(),t.isDelta())},rl.fromJSON=function(t){return new rl(Hh(t.data),t.id,t.isDelta)},al.encode=function(t,e){return Th.createFieldNode(t,new tl(e.length,0),new tl(e.nullCount,0))},al.decode=function(t){return new al(t.length(),t.nullCount())},ol.encode=function(t,e){return Sh.createBuffer(t,new tl(e.offset,0),new tl(e.length,0))},ol.decode=function(t){return new ol(t.offset(),t.length())};const dl=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]})(),fl=t=>`Expected ${dn[t]} Message in stream, but was null or length 0.`,pl=t=>`Header pointer of flatbuffer-encoded ${dn[t]} Message is null or length 0.`,ml=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,yl=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`;class _l{constructor(t){this.source=t instanceof eh?t:new eh(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||-1===t.value&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?Xa:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(fl(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=Qn(this.source.read(t));if(e.byteLength<t)throw new Error(yl(t,e.byteLength));return e.byteOffset%8==0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=dn.Schema,i=this.readMessage(e),n=null==i?void 0:i.header();if(t&&!n)throw new Error(pl(e));return n}readMetadataLength(){const t=this.source.read(bl),e=t&&new Ea(t),i=(null==e?void 0:e.readInt32(0))||0;return{done:0===i,value:i}}readMetadata(t){const e=this.source.read(t);if(!e)return Xa;if(e.byteLength<t)throw new Error(ml(t,e.byteLength));return{done:!1,value:nl.decode(e)}}}class gl{constructor(t,e){this.source=t instanceof ih?t:jn(t)?new oh(t,e):new ih(t)}[Symbol.asyncIterator](){return this}next(){return bn(this,void 0,void 0,(function*(){let t;return(t=yield this.readMetadataLength()).done||-1===t.value&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?Xa:t}))}throw(t){return bn(this,void 0,void 0,(function*(){return yield this.source.throw(t)}))}return(t){return bn(this,void 0,void 0,(function*(){return yield this.source.return(t)}))}readMessage(t){return bn(this,void 0,void 0,(function*(){let e;if((e=yield this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(fl(t));return e.value}))}readMessageBody(t){return bn(this,void 0,void 0,(function*(){if(t<=0)return new Uint8Array(0);const e=Qn(yield this.source.read(t));if(e.byteLength<t)throw new Error(yl(t,e.byteLength));return e.byteOffset%8==0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}))}readSchema(t=!1){return bn(this,void 0,void 0,(function*(){const e=dn.Schema,i=yield this.readMessage(e),n=null==i?void 0:i.header();if(t&&!n)throw new Error(pl(e));return n}))}readMetadataLength(){return bn(this,void 0,void 0,(function*(){const t=yield this.source.read(bl),e=t&&new Ea(t),i=(null==e?void 0:e.readInt32(0))||0;return{done:0===i,value:i}}))}readMetadata(t){return bn(this,void 0,void 0,(function*(){const e=yield this.source.read(t);if(!e)return Xa;if(e.byteLength<t)throw new Error(ml(t,e.byteLength));return{done:!1,value:nl.decode(e)}}))}}class vl extends _l{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof Ka?t:new Ka(t)}next(){const{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:nl.fromJSON(t.schema,dn.Schema)};if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];return this._body=e.data.columns,{done:!1,value:nl.fromJSON(e,dn.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];return this._body=e.columns,{done:!1,value:nl.fromJSON(e,dn.RecordBatch)}}return this._body=[],Xa}readMessageBody(t){return function t(e){return(e||[]).reduce(((e,i)=>[...e,...i.VALIDITY&&[i.VALIDITY]||[],...i.TYPE&&[i.TYPE]||[],...i.OFFSET&&[i.OFFSET]||[],...i.DATA&&[i.DATA]||[],...t(i.children)]),[])}(this._body)}readMessage(t){let e;if((e=this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(fl(t));return e.value}readSchema(){const t=dn.Schema,e=this.readMessage(t),i=null==e?void 0:e.header();if(!e||!i)throw new Error(pl(t));return i}}const bl=4,xl=new Uint8Array(6);for(let t=0;t<6;t+=1)xl[t]="ARROW1".codePointAt(t);function wl(t,e=0){for(let i=-1,n=xl.length;++i<n;)if(xl[i]!==t[e+i])return!1;return!0}const Ml=xl.length,Sl=Ml+bl,Tl=2*Ml+bl;class Il extends Ja{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return Fn(e)?e.then((()=>this)):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return qa.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return qa.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof Il?t:Un(t)?function(t){return new Al(new Nl(t))}(t):jn(t)?function(t){return bn(this,void 0,void 0,(function*(){const{size:e}=yield t.stat(),i=new oh(t,e);return e>=Tl&&wl(yield i.readAt(0,Ml+7&-8))?new Pl(new kl(i)):new Cl(new zl(i))}))}(t):Fn(t)?(()=>bn(this,void 0,void 0,(function*(){return yield Il.from(yield t)})))():Vn(t)||Gn(t)||qn(t)||Rn(t)?function(t){return bn(this,void 0,void 0,(function*(){const e=yield t.peek(Ml+7&-8);return e&&e.byteLength>=4?wl(e)?new Ll(new Ol(yield t.read())):new Cl(new zl(t)):new Cl(new zl(function(){return wn(this,arguments,(function*(){}))}()))}))}(new ih(t)):function(t){const e=t.peek(Ml+7&-8);return e&&e.byteLength>=4?wl(e)?new Ll(new Ol(t.read())):new Al(new El(t)):new Al(new El(function*(){}()))}(new eh(t))}static readAll(t){return t instanceof Il?t.isSync()?Dl(t):Rl(t):Un(t)||ArrayBuffer.isView(t)||Dn(t)||Zn(t)?Dl(t):Rl(t)}}class Al extends Il{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return wn(this,arguments,(function*(){yield xn(yield*Mn(Sn(this[Symbol.iterator]())))}))}}class Cl extends Il{constructor(t){super(t),this._impl=t}readAll(){var t,e;return bn(this,void 0,void 0,(function*(){const i=new Array;try{for(var n,s=Sn(this);!(n=yield s.next()).done;){const t=n.value;i.push(t)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=s.return)&&(yield e.call(s))}finally{if(t)throw t.error}}return i}))}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Ll extends Al{constructor(t){super(t),this._impl=t}}class Pl extends Cl{constructor(t){super(t),this._impl=t}}class Bl{constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const i=this._loadVectors(t,e,this.schema.fields),n=$o({type:new qs(this.schema.fields),length:t.length,children:i});return new pa(this.schema,n)}_loadDictionaryBatch(t,e){const{id:i,isDelta:n}=t,{dictionaries:s,schema:r}=this,o=s.get(i);if(n||!o){const s=r.dictionaries.get(i),a=this._loadVectors(t.data,e,[s]);return(o&&n?o.concat(new Go(a)):new Go(a)).memoize()}return o.memoize()}_loadVectors(t,e,i){return new fh(e,t.nodes,t.buffers,this.dictionaries).visitMany(i)}}class El extends Bl{constructor(t,e){super(e),this._reader=Un(t)?new vl(this._handle=t):new _l(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=Fl(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):Xa}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):Xa}next(){if(this.closed)return Xa;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else{if(t.isRecordBatch()){this._recordBatchIndex++;const i=t.header(),n=e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(i,n)}}if(t.isDictionaryBatch()){this._dictionaryIndex++;const i=t.header(),n=e.readMessageBody(t.bodyLength),s=this._loadDictionaryBatch(i,n);this.dictionaries.set(i.id,s)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new _a(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class zl extends Bl{constructor(t,e){super(e),this._reader=new gl(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return bn(this,void 0,void 0,(function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}))}open(t){return bn(this,void 0,void 0,(function*(){return this.closed||(this.autoDestroy=Fl(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this}))}throw(t){return bn(this,void 0,void 0,(function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):Xa}))}return(t){return bn(this,void 0,void 0,(function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):Xa}))}next(){return bn(this,void 0,void 0,(function*(){if(this.closed)return Xa;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else{if(t.isRecordBatch()){this._recordBatchIndex++;const i=t.header(),n=yield e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(i,n)}}if(t.isDictionaryBatch()){this._dictionaryIndex++;const i=t.header(),n=yield e.readMessageBody(t.bodyLength),s=this._loadDictionaryBatch(i,n);this.dictionaries.set(i.id,s)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new _a(this.schema)}):yield this.return()}))}_readNextMessageAndValidate(t){return bn(this,void 0,void 0,(function*(){return yield this._reader.readMessage(t)}))}}class Ol extends El{constructor(t,e){super(t instanceof rh?t:new rh(t),e)}get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const i=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(t);if(i&&this._handle.seek(i.offset)){const t=this._reader.readMessage(dn.RecordBatch);if(null==t?void 0:t.isRecordBatch()){const e=t.header(),i=this._reader.readMessageBody(t.bodyLength);return this._loadRecordBatch(e,i)}}return null}_readDictionaryBatch(t){var e;const i=null===(e=this._footer)||void 0===e?void 0:e.getDictionaryBatch(t);if(i&&this._handle.seek(i.offset)){const t=this._reader.readMessage(dn.DictionaryBatch);if(null==t?void 0:t.isDictionaryBatch()){const e=t.header(),i=this._reader.readMessageBody(t.bodyLength),n=this._loadDictionaryBatch(e,i);this.dictionaries.set(e.id,n)}}}_readFooter(){const{_handle:t}=this,e=t.size-Sl,i=t.readInt32(e),n=t.readAt(e-i,i);return Va.decode(n)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const i=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(this._recordBatchIndex);if(i&&this._handle.seek(i.offset))return this._reader.readMessage(t)}return null}}class kl extends zl{constructor(t,...e){const i="number"!=typeof e[0]?e.shift():void 0,n=e[0]instanceof Map?e.shift():void 0;super(t instanceof oh?t:new oh(t,i),n)}get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return bn(this,void 0,void 0,(function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)}))}readRecordBatch(t){var e;return bn(this,void 0,void 0,(function*(){if(this.closed)return null;this._footer||(yield this.open());const i=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(t);if(i&&(yield this._handle.seek(i.offset))){const t=yield this._reader.readMessage(dn.RecordBatch);if(null==t?void 0:t.isRecordBatch()){const e=t.header(),i=yield this._reader.readMessageBody(t.bodyLength);return this._loadRecordBatch(e,i)}}return null}))}_readDictionaryBatch(t){var e;return bn(this,void 0,void 0,(function*(){const i=null===(e=this._footer)||void 0===e?void 0:e.getDictionaryBatch(t);if(i&&(yield this._handle.seek(i.offset))){const t=yield this._reader.readMessage(dn.DictionaryBatch);if(null==t?void 0:t.isDictionaryBatch()){const e=t.header(),i=yield this._reader.readMessageBody(t.bodyLength),n=this._loadDictionaryBatch(e,i);this.dictionaries.set(e.id,n)}}}))}_readFooter(){return bn(this,void 0,void 0,(function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-Sl,i=yield t.readInt32(e),n=yield t.readAt(e-i,i);return Va.decode(n)}))}_readNextMessageAndValidate(t){return bn(this,void 0,void 0,(function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null}))}}class Nl extends El{constructor(t,e){super(t,e)}_loadVectors(t,e,i){return new ph(e,t.nodes,t.buffers,this.dictionaries).visitMany(i)}}function Fl(t,e){return e&&"boolean"==typeof e.autoDestroy?e.autoDestroy:t.autoDestroy}function*Dl(t){const e=Il.from(t);try{if(!e.open({autoDestroy:!1}).closed)do{yield e}while(!e.reset().open().closed)}finally{e.cancel()}}function Rl(t){return wn(this,arguments,(function*(){const e=yield xn(Il.from(t));try{if(!(yield xn(e.open({autoDestroy:!1}))).closed)do{yield yield xn(e)}while(!(yield xn(e.reset().open())).closed)}finally{yield xn(e.cancel())}}))}function Ul(t){const e=Il.from(t);return Fn(e)?e.then((t=>Ul(t))):e.isAsync()?e.readAll().then((t=>new ba(t))):new ba(e.readAll())}class Zl extends Qi{constructor(t,e,i={}){super(t,0,i),this.app=e,this.info=void 0,this.infoLoadingStatus="notLoaded",this.cache={},this.readParquetFun=i.readParquetFun}loadInfo(t){return this.info||"notLoaded"!==this.infoLoadingStatus?!t||"loaded"!==this.infoLoadingStatus&&"failed"!==this.infoLoadingStatus||t():(async()=>{try{const e=await rn(this.url+"info.json");this.info=e,this.resolution=e.resolutionGeo,this.infoLoadingStatus="loaded",t&&t()}catch(t){this.infoLoadingStatus="failed"}})(),this}getTilingEnvelope(t){if(!this.info)return void this.loadInfo((()=>{}));const e=this.info.originPoint,i=this.info.resolutionGeo,n=this.info.tileSizeCell;return{xMin:Math.floor((t.xMin-e.x)/(i*n)),xMax:Math.floor((t.xMax-e.x)/(i*n)),yMin:Math.floor((t.yMin-e.y)/(i*n)),yMax:Math.floor((t.yMax-e.y)/(i*n))}}getData(t,e){if(!this.info)return this;const i=this.getTilingEnvelope(t);if(!i)return this;const n=this.info.tilingBounds,s=this.info.format;for(let t=Math.max(i.xMin,n.xMin);t<=Math.min(i.xMax,n.xMax);t++)for(let r=Math.max(i.yMin,n.yMin);r<=Math.min(i.yMax,n.yMax);r++)this.cache[t]||(this.cache[t]={}),this.cache[t][r]||(this.cache[t][r]="loading",(async()=>{let i;try{if(s&&"CSV"!==s){if("PARQUET"!==s)throw new Error("Tiled format not supported: "+s);{if(!this.readParquetFun)throw new Error("readParquet function needed for parquet dataset");const e=await fetch(this.url+t+"/"+r+".parquet"),n=new Uint8Array(await e.arrayBuffer()),s=Ul(this.readParquetFun(n));i=[];for(const t of s){const e=t.toJSON();if(this.preprocess){if(0==this.preprocess(e))continue;i.push(e)}else i.push(e)}}}else{const e=await Ji(this.url+t+"/"+r+".csv");if(this.preprocess){i=[];for(const t of e)0!=this.preprocess(t)&&i.push(t)}else i=e}}catch(e){return void(this.cache[t][r]="failed")}if(!this.info)return void console.error("Tile info inknown");const n=new en(i,t,r,this.info);if(this.cache[t][r]=n,!e)return;let o=!1;const a=this.app.getZoomFactor();for(const t of this.app.layers)if(t.visible&&t.getDatasetComponent(a)==this){o=!0;break}if(!o)return;const h=this.app.updateExtentGeo(),l=n.extGeo;h.xMax<=l.xMin||h.xMin>=l.xMax||h.yMax<=l.yMin||h.yMin>=l.yMax||e()})());return this}updateViewCache(t){if(this.cellsViewCache=[],!this.info)return;const e=this.getTilingEnvelope(t);if(!e)return;const i=this.info.tilingBounds;for(let n=Math.max(e.xMin,i.xMin);n<=Math.min(e.xMax,i.xMax);n++)if(this.cache[n])for(let s=Math.max(e.yMin,i.yMin);s<=Math.min(e.yMax,i.yMax);s++){const e=this.cache[n][s];if(e&&"string"!=typeof e)for(const i of e.cells)+i.x+this.resolution<t.xMin||+i.x-this.resolution>t.xMax||+i.y+this.resolution<t.yMin||+i.y-this.resolution>t.yMax||this.cellsViewCache.push(i)}}}class jl{constructor(t){if(t=t||{},this.visible=0!=t.visible,this.minZoom=t.minZoom||0,this.maxZoom=t.maxZoom||1/0,this.minZoom>=this.maxZoom)throw new Error("Unexpected zoom limits for layer. Zoom min should be smaller than zoom max.");if(this.cache={},this.url=t.url,this.urlFun=t.urlFun||((t,e,i)=>this.url+i+"/"+t+"/"+e+".png"),this.resolutions=t.resolutions,!this.resolutions||0==this.resolutions.length)throw new Error("No resolutions provided for background layer");this.nbPix=t.nbPix||256,this.origin=t.origin||[0,0],this.z0=t.z0||0,this.filterColor=t.filterColor}get(t,e,i){let n=this.cache[t];if(n&&(n=n[e],n))return n[i]}put(t,e,i,n){this.cache[e]||(this.cache[e]={}),this.cache[e][i]||(this.cache[e][i]={}),this.cache[e][i][n]=t}draw(t){if(!this.resolutions||0==this.resolutions.length)return void console.error("No resolutions provided for background layer");const e=t.getZf(),i=this.origin[0],n=this.origin[1];let s=0;for(s=0;s<this.resolutions.length&&!(this.resolutions[s]<e);s++);s-=1,s=Math.max(0,s),s=Math.min(s,this.resolutions.length-1);const r=this.resolutions[s];s+=this.z0;const o=this.nbPix*r,a=o/e,h=t=>Math.ceil((t-i)/o),l=t=>Math.ceil(-(t-n)/o),c=h(t.extGeo.xMin)-1,u=h(t.extGeo.xMax),d=l(t.extGeo.yMin),f=l(t.extGeo.yMax)-1;for(let e=c;e<u;e++)for(let r=f;r<d;r++){let h=this.get(s,e,r);if(!h){const i=new Image;this.put(i,s,e,r),i.onload=()=>{t.redraw()},i.onerror=()=>{this.put("failed",s,e,r)},i.src=this.urlFun(e,r,s);continue}if("failed"===h)continue;if(!(h instanceof HTMLImageElement)){console.log(h);continue}if(0==h.width||0==h.height)continue;const l=i+e*o,c=n-r*o;try{t.ctx.drawImage(h,t.geoToPixX(l),t.geoToPixY(c),a,a)}catch(t){console.error(t)}}if(this.filterColor){const i=this.filterColor(e);i&&"none"!=i&&(t.ctx.fillStyle=i,t.ctx.fillRect(0,0,t.w,t.h))}}}class Vl{constructor(t){if(t=t||{},this.visible=0!=t.visible,this.minZoom=t.minZoom||0,this.maxZoom=t.maxZoom||1/0,this.minZoom>=this.maxZoom)throw new Error("Unexpected zoom limits for layer. Zoom min should be smaller than zoom max.");this.url=t.url,this.filterColor=t.filterColor,this.img=void 0,this.xMin=void 0,this.xMax=void 0,this.yMin=void 0,this.yMax=void 0}hasMoved(t){return t.xMin!=this.xMin||t.xMax!=this.xMax||t.yMin!=this.yMin||t.yMax!=this.yMax}draw(t){if(t.updateExtentGeo(0),!this.hasMoved(t.extGeo)&&this.img)t.ctx.drawImage(this.img,0,0,t.w,t.h);else{this.xMin=t.extGeo.xMin,this.xMax=t.extGeo.xMax,this.yMin=t.extGeo.yMin,this.yMax=t.extGeo.yMax;const e=[];e.push(this.url),e.push("&width="),e.push(t.w),e.push("&height="),e.push(t.h),e.push("&bbox="),e.push(t.extGeo.xMin),e.push(","),e.push(t.extGeo.yMin),e.push(","),e.push(t.extGeo.xMax),e.push(","),e.push(t.extGeo.yMax);const i=e.join("");this.img||(this.img=new Image,this.img.onload=()=>{t.redraw()},this.img.onerror=()=>{console.warn("Could not retrieve WMS background image from",i)}),this.img.src=i}const e=t.getZf();if(this.filterColor){const i=this.filterColor(e);i&&"none"!=i&&(t.ctx.fillStyle=i,t.ctx.fillRect(0,0,t.w,t.h))}}}class Wl{constructor(t){t=t||{},this.url=t.url,this.style=t.style||(()=>"bold 1em Arial"),this.color=t.color||(t.dark?()=>"#ddd":()=>"#222"),this.haloColor=t.haloColor||(t.dark?()=>"#000000BB":()=>"#FFFFFFBB"),this.haloWidth=t.haloWidth||(()=>4),this.textAlign=t.textAlign||"start",this.offsetPix=t.offsetPix||[5,5],this.preprocess=t.preprocess,this.labels=void 0,this.loadingStatus="notLoaded"}draw(t){if(!this.labels)return void this.load(t.redraw);const e=t.getZf();t.ctx.textAlign=this.textAlign||"start",t.ctx.lineJoin="bevel",t.ctx.lineCap="butt",t.initCanvasTransform();for(const i of this.labels){const n=this.style(i,e);if(!n)continue;if(t.ctx.font=n,!t.toDraw(i))continue;const s=t.geoToPixX(i.x)+this.offsetPix[0],r=t.geoToPixY(i.y)-this.offsetPix[1];if(this.haloColor&&this.haloWidth){const n=this.haloColor(i,e),o=this.haloWidth(i,e);n&&o&&o>0&&(t.ctx.strokeStyle=n,t.ctx.lineWidth=o,t.ctx.strokeText(i.name,s,r))}if(this.color){const n=this.color(i,e);n&&(t.ctx.fillStyle=n,t.ctx.fillText(i.name,s,r))}}}async load(t){if(!this.url)return console.log("Failed loading labels: No URL specified. "+this.url),this.loadingStatus="failed",void(this.labels=[]);if("notLoaded"==this.loadingStatus){this.loadingStatus="loading";try{const e=await Ji(this.url);if(this.preprocess){this.labels=[];for(const t of e)0!=this.preprocess(t)&&this.labels.push(t)}else this.labels=e;this.loadingStatus="loaded",t&&t()}catch(t){console.log("Failed loading labels from "+this.url),this.labels=[],this.loadingStatus="failed"}}}}class Gl{constructor(t){t=t||{},this.url=t.url,this.preprocess=t.preprocess,this.color=t.color||((t,e)=>"gray"),this.width=t.width||((t,e)=>2),this.lineDash=t.lineDash||((t,e)=>{}),this.fs=void 0,this.loadingStatus="notLoaded"}draw(t){if(!this.fs)return void this.load(t.redraw);const e=t.getZf();t.setCanvasTransform();for(const i of this.fs){const n=i.geometry.coordinates;if(n.length<2)continue;const s=this.color(i,e);if(!s||"none"==s)continue;t.ctx.strokeStyle=s;const r=this.width(i,e);if(!r||r<0)continue;t.ctx.lineWidth=r*e;const o=this.lineDash(i,e);o&&t.ctx.setLineDash(o),t.ctx.beginPath(),t.ctx.moveTo(n[0][0],n[0][1]);for(let e=1;e<n.length;e++)t.ctx.lineTo(n[e][0],n[e][1]);t.ctx.stroke()}t.ctx.setLineDash([])}async load(t){if(!this.url)return console.log("Failed loading boundaries: No URL specified. "+this.url),this.loadingStatus="failed",void(this.labels=[]);if("notLoaded"==this.loadingStatus){this.loadingStatus="loading";try{const e=(await rn(this.url)).features;if(this.preprocess){this.fs=[];for(const t of e)0!=this.preprocess(t)&&this.fs.push(t)}else this.fs=e;this.loadingStatus="loaded",t&&t()}catch(t){console.log("Failed loading boundaries from "+this.url),this.fs=[],this.loadingStatus="failed"}}}}class ql{constructor(t,e){if(e=e||{},this.layers=[],!(t=t||document.getElementById("gridviz")))return void console.error("Cannot find gridviz container element.");this.w=e.w||t.offsetWidth,this.h=e.h||t.offsetHeight;let i=e.canvas||null;i||(i=document.createElement("canvas"),i.setAttribute("width",""+this.w),i.setAttribute("height",""+this.h),t.appendChild(i)),this.cg=new Ni(i,void 0,1,e),this.cg.redraw=(e=!0)=>{this.legend&&e&&this.legend.selectAll("*").remove(),this.cg.initCanvasTransform(),this.cg.clear(this.cg.backgroundColor);const n=this.getZoomFactor();this.updateExtentGeo();for(const t of this.bgLayers)t.visible&&(n>t.maxZoom||n<t.minZoom||t.draw(this.cg));for(const t of this.layers){if(!t.visible)continue;if(n>t.maxZoom)continue;if(n<t.minZoom)continue;const i=t.getDatasetComponent(n);if(i){if(e&&i.getData(this.cg.extGeo,(()=>{this.cg.redraw()})),e&&i.updateViewCache(this.cg.extGeo),e)for(const e of t.styles)n>e.maxZoom||n<e.minZoom||e.draw(i.getViewCache(),i.getResolution(),this.cg);if(this.legend&&e)for(const e of t.styles)if(!(n>e.maxZoom||n<e.minZoom)){for(const t of e.legends)this.legend.node().append(t.div.node());if(e.styles)for(const t of e.styles)if(!(n>t.maxZoom||n<t.minZoom))for(const e of t.legends)this.legend.node().append(e.div.node())}}}return this.showBoundaries&&this.boundaryLayer&&this.boundaryLayer.draw(this.cg),this.showLabels&&this.labelLayer&&this.labelLayer.draw(this.cg),this.canvasSave=null,this.defineResizeObserver(t,i),this},this.bgLayers=[],this.showBgLayers=!0,this.labelLayer=void 0,this.showLabels=!0,this.boundaryLayer=void 0,this.showBoundaries=!0,this.legendDivId=e.legendDivId||"gvizLegend",this.legend=mt("#"+this.legendDivId),this.legend.empty()&&(this.legend=mt("body").append("div").attr("id",this.legendDivId).style("position","absolute").style("width","auto").style("height","auto").style("background","#FFFFFFCC").style("border","0px").style("border-radius","5px").style("box-shadow","3px 3px 3px grey, -3px -3px 3px #ddd").style("font-family","Helvetica, Arial, sans-serif").style("top","20px").style("right","20px")),this.tooltip=new Ri(e.tooltip);const n=t=>{const i={x:this.cg.pixToGeoX(t.offsetX+this.tooltip.xMouseOffset),y:this.cg.pixToGeoY(t.offsetY+this.tooltip.yMouseOffset)},n=this.getCellFocusInfo(i);if(e.transparentBackground)return n?(this.tooltip.setPosition(t),this.tooltip.show(),this.tooltip.html(n.html)):this.tooltip.hide(),this.canvasSave=document.createElement("canvas"),this.canvasSave.setAttribute("width",""+this.w),this.canvasSave.setAttribute("height",""+this.h),this.canvasSave.getContext("2d").drawImage(this.cg.canvas,0,0),void this.cg.initCanvasTransform();if(n){this.tooltip.setPosition(t),this.tooltip.show(),this.tooltip.html(n.html),this.canvasSave?this.cg.ctx.drawImage(this.canvasSave,0,0):(this.canvasSave=document.createElement("canvas"),this.canvasSave.setAttribute("width",""+this.w),this.canvasSave.setAttribute("height",""+this.h),this.canvasSave.getContext("2d").drawImage(this.cg.canvas,0,0));const e=this.selectionRectangleWidthPix?this.selectionRectangleWidthPix(n.resolution,this.getZoomFactor()):4;this.cg.initCanvasTransform(),this.cg.ctx.strokeStyle=this.selectionRectangleColor,this.cg.ctx.lineWidth=e,this.cg.ctx.beginPath(),this.cg.ctx.rect(this.cg.geoToPixX(n.cell.x)-e/2,this.cg.geoToPixY(n.cell.y)+e/2,n.resolution/this.getZoomFactor()+e,-n.resolution/this.getZoomFactor()-e),this.cg.ctx.stroke()}else this.tooltip.hide(),this.canvasSave&&this.cg.ctx.drawImage(this.canvasSave,0,0)};t.addEventListener("mouseover",(t=>{n(t)})),t.addEventListener("mousemove",(t=>{n(t)})),t.addEventListener("mouseout",(()=>{this.tooltip.hide()})),this.cg.onZoomStartFun=()=>{this.tooltip.hide()},this.canvasSave=null,this.selectionRectangleColor=e.selectionRectangleColor||"red",this.selectionRectangleWidthPix=e.selectionRectangleWidthPix||(()=>4)}updateExtentGeo(t=20){return this.cg.updateExtentGeo(t)}getCellFocusInfo(t){const e=this.getZoomFactor();for(let i=this.layers.length-1;i>=0;i--){const n=this.layers[i];if(!n.visible)continue;if(!n.cellInfoHTML)continue;if("none"===n.cellInfoHTML)continue;const s=n.getDatasetComponent(e);if(!s)continue;const r=s.getCellFromPosition(t,s.getViewCache());if(!r)return;const o=n.cellInfoHTML(r,s.getResolution());if(!o)return;return{cell:r,html:o,resolution:s.getResolution()}}}getGeoCenter(){return this.cg.getCenter()}setGeoCenter(t){return this.cg.setCenter(t),this}getZoomFactor(){return this.cg.getZf()}setZoomFactor(t){return this.cg.setZf(t),this}getZoomFactorExtent(){return this.cg.getZfExtent()}setZoomFactorExtent(t){return this.cg.setZfExtent(t),this}getBackgroundColor(){return this.cg.backgroundColor}setBackgroundColor(t){return this.cg.backgroundColor=t,this}getBoundaryLayer(){return this.boundaryLayer}setBoundaryLayer(t){return this.boundaryLayer=new Gl(t),this}getLabelLayer(){return this.labelLayer}setLabelLayer(t){return this.labelLayer=new Wl(t),this}redraw(){return this.cg.redraw(),this}addLayerFromDataset(t,e,i){const n=new Fi(t,e,i);return this.layers.push(n),this}makeCSVGridDataset(t,e,i){return new Di([new tn(t,e,i).getData(void 0,(()=>{this.cg.redraw()}))],[],i)}makeTiledGridDataset(t,e){return new Di([new Zl(t,this,e).loadInfo((()=>{this.cg.redraw()}))],[],e)}makeMultiScaleCSVGridDataset(t,e,i){return Di.make(t,(t=>new tn(e(t),t,i).getData(void 0,(()=>{this.cg.redraw()}))),i)}makeMultiScaleTiledGridDataset(t,e,i){return Di.make(t,(t=>new Zl(e(t),this,i).loadInfo((()=>{this.cg.redraw()}))),i)}addCSVGridLayer(t,e,i,n){const s=this.makeCSVGridDataset(t,e,n);return this.addLayerFromDataset(s,i,n)}addTiledGridLayer(t,e,i){const n=this.makeTiledGridDataset(t,i);return this.addLayerFromDataset(n,e,i)}addMultiScaleCSVGridLayer(t,e,i,n){const s=this.makeMultiScaleCSVGridDataset(t,e,n);return this.addLayerFromDataset(s,i,n)}addMultiScaleTiledGridLayer(t,e,i,n){const s=this.makeMultiScaleTiledGridDataset(t,e,n);return this.addLayerFromDataset(s,i,n)}addBackgroundLayer(t){return this.bgLayers.push(new jl(t)),this.redraw(),this}addBackgroundLayerWMS(t){return this.bgLayers.push(new Vl(t)),this.redraw(),this}addZoomSlider(t,e){return this.cg.addZoomSlider(t,e),this}setViewFromURL(){return this.cg.setViewFromURL(),this}defineResizeObserver(t,e){new ResizeObserver((i=>{t.clientWidth>0&&t.clientHeight>0&&window.requestAnimationFrame((()=>{Array.isArray(i)&&i.length&&(this.h===t.clientHeight&&this.w===t.clientWidth||(this.h=t.clientHeight,this.w=t.clientWidth,this.cg.h=t.clientHeight,this.cg.w=t.clientWidth,e.setAttribute("width",""+this.w),e.setAttribute("height",""+this.h),this.redraw()))}))})).observe(t)}}class Hl{constructor(t){if(t=t||{},this.filter=t.filter||(()=>!0),this.offset=t.offset||((t,e,i)=>({dx:0,dy:0})),this.minZoom=t.minZoom||0,this.maxZoom=t.maxZoom||1/0,this.minZoom>=this.maxZoom)throw new Error("Unexpected zoom limits for layer. Zoom min should be smaller than zoom max.");this.legends=[]}draw(t,e,i){throw new Error("Method draw not implemented.")}getOffset(){return this.offset}setOffset(t){return this.offset=t,this}updateLegends(t){for(const e of this.legends)e.update(t);return this}static getStatistics(t,e,i){if(!t||0==t.length)return;let n=1/0,s=-1/0;for(const r of t){const t=+e(r);i&&!t||(t<n&&(n=t),t>s&&(s=t))}return{min:n,max:s}}}class Yl extends Hl{constructor(t){super(t),t=t||{},this.colorCol=t.colorCol,this.color=t.color||(()=>"#EA6BAC"),this.sizeCol=t.sizeCol,this.size=t.size,this.shape=t.shape||(()=>"square")}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s,r;this.sizeCol&&(t.sort(((t,e)=>e[this.sizeCol]-t[this.sizeCol])),s=Hl.getStatistics(t,(t=>t[this.sizeCol]),!0)),this.colorCol&&(r=Hl.getStatistics(t,(t=>t[this.colorCol]),!0)),i.setCanvasTransform();const o=.5*e;for(let a of t){const t=this.color?this.color(a[this.colorCol],e,r,n):void 0;if(!t||"none"===t)continue;i.ctx.fillStyle=t;const h=this.shape?this.shape(a):"square";if("none"===h)continue;const l=(this.size||(()=>e))(a[this.sizeCol],e,s,n),c=this.offset(a,e,n);if("square"===h){const t=e*(1-l/e)*.5;i.ctx.fillRect(a.x+t+c.dx,a.y+t+c.dy,l,l)}else if("circle"===h)i.ctx.beginPath(),i.ctx.arc(a.x+o+c.dx,a.y+o+c.dy,.5*l,0,2*Math.PI,!1),i.ctx.fill();else if("donut"===h){const t=a.x+o+c.dx,n=a.y+o+c.dy;i.ctx.beginPath(),i.ctx.moveTo(t,n),i.ctx.arc(t,n,o,0,2*Math.PI),i.ctx.arc(t,n,(1-l/e)*o,0,2*Math.PI,!0),i.ctx.closePath(),i.ctx.fill()}else{if("diamond"!==h)throw new Error("Unexpected shape:"+h);{const t=.5*l;i.ctx.beginPath(),i.ctx.moveTo(a.x+o-t,a.y+o),i.ctx.lineTo(a.x+o,a.y+o+t),i.ctx.lineTo(a.x+o+t,a.y+o),i.ctx.lineTo(a.x+o,a.y+o-t),i.ctx.fill()}}}this.updateLegends({style:this,r:e,zf:n,sSize:s,sColor:r})}}class $l extends Hl{constructor(t){super(t),t=t||{},this.strokeColorCol=t.strokeColorCol,this.strokeColor=t.strokeColor||(()=>"#666"),this.sizeCol=t.sizeCol,this.size=t.size,this.strokeWidthCol=t.strokeWidthCol,this.strokeWidth=t.strokeWidth,this.shape=t.shape||(()=>"square")}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s,r,o;this.strokeColorCol&&(s=Hl.getStatistics(t,(t=>t[this.strokeColorCol]),!0)),this.sizeCol&&(r=Hl.getStatistics(t,(t=>t[this.sizeCol]),!0)),this.strokeWidthCol&&(o=Hl.getStatistics(t,(t=>t[this.strokeWidthCol]),!0)),i.setCanvasTransform();const a=.5*e;for(let h of t){const t=this.strokeColor?this.strokeColor(h[this.strokeColorCol],e,s):void 0;if(!t||"none"===t)continue;i.ctx.strokeStyle=t;const l=(this.size||(()=>e))(h[this.sizeCol],e,r,n),c=this.strokeWidth?this.strokeWidth(h[this.strokeWidthCol],e,o,n):1*n;if(!c||c<=0)continue;i.ctx.lineWidth=c;const u=this.shape?this.shape(h):"square";if("none"===u)continue;const d=this.offset(h,e,n);if("square"===u){const t=e*(1-l/e)*.5;i.ctx.beginPath(),i.ctx.rect(h.x+t+d.dx,h.y+t+d.dy,l,l),i.ctx.stroke()}else if("circle"===u)i.ctx.beginPath(),i.ctx.arc(h.x+a+d.dx,h.y+a+d.dy,.5*l,0,2*Math.PI,!1),i.ctx.stroke();else if("diamond"===u){const t=.5*l;i.ctx.beginPath(),i.ctx.moveTo(h.x+a-t,h.y+a),i.ctx.lineTo(h.x+a,h.y+a+t),i.ctx.lineTo(h.x+a+t,h.y+a),i.ctx.lineTo(h.x+a,h.y+a-t),i.ctx.lineTo(h.x+a-t,h.y+a),i.ctx.stroke()}else{if("donut"!==u)throw new Error("Unexpected shape:"+u);console.error("Not implemented")}}}}class Xl extends Hl{constructor(t){super(t),t=t||{},this.heightCol=t.heightCol,this.height=t.height||(t=>Math.sqrt(t)),this.lineColor=t.lineColor||((t,e,i,n)=>"#BBB"),this.lineWidth=t.lineWidth||((t,e,i,n)=>n),this.fillColor=t.fillColor||((t,e,i,n)=>"#c08c5968")}draw(t,e,i){this.filter&&(t=t.filter(this.filter)),i.ctx.lineJoin="round";const n=i.getZf(),s=Hl.getStatistics(t,(t=>t[this.heightCol]),!0),r={};for(const i of t){let t=r[i.y];t||(t={},r[i.y]=t),t[i.x]=this.height(i[this.heightCol],e,s,n)}const o=i.extGeo;if(!o)return;const a=Math.floor(o.xMin/e)*e,h=Math.floor(o.xMax/e)*e,l=Math.floor(o.yMin/e)*e,c=Math.floor(o.yMax/e)*e,u={min:l,max:c};i.setCanvasTransform();for(let t=c;t>=l;t-=e){const s=r[t];if(!s)continue;let o;i.ctx.beginPath(),i.ctx.moveTo(a-e/2,t);for(let n=a;n<=h;n+=e){let r=s[n];r||(r=0),r||o?i.ctx.lineTo(n+e/2,t+r):i.ctx.moveTo(n+e/2,t),o=r}o&&i.ctx.lineTo(h+e/2,t);const l=this.fillColor(t,u,e,n);l&&"none"!=l&&(i.ctx.fillStyle=l,i.ctx.fill());const c=this.lineColor(t,u,e,n),d=this.lineWidth(t,u,e,n);c&&"none"!=c&&d>0&&(i.ctx.strokeStyle=c,i.ctx.lineWidth=d,i.ctx.stroke())}}}class Kl extends Hl{constructor(t){super(t),t=t||{},this.color=t.color,this.type=t.type,this.sizeCol=t.sizeCol,this.size=t.size||((t,e,i,n)=>e),this.stripesOrientation=t.stripesOrientation||(()=>0),this.offsetAngle=t.offsetAngle||(()=>0),this.agePyramidHeight=t.agePyramidHeight||((t,e,i)=>e),this.pieChartInternalRadiusFactor=t.pieChartInternalRadiusFactor||0}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s;this.sizeCol&&(t.sort(((t,e)=>e[this.sizeCol]-t[this.sizeCol])),s=Hl.getStatistics(t,(t=>t[this.sizeCol]),!0));const r=Object.entries(this.color).length;i.setCanvasTransform();for(let o of t){const t=(this.size||(()=>e))(o[this.sizeCol],e,s,n),a=this.offset(o,e,n),h=this.type?this.type(o):"flag",l=o.x+a.dx+("agepyramid"===h?0:.5*e),c=o.y+a.dy+("agepyramid"===h?0:.5*e),u=this.offsetAngle?this.offsetAngle(o,e,n)*Math.PI/180:0;if("agepyramid"===h||"radar"===h||"halftone"===h){let s=-1/0;for(let t of Object.keys(this.color)){const e=+o[t];e>s&&(s=e)}let a=0;"agepyramid"===h&&this.agePyramidHeight&&(a=(e-this.agePyramidHeight(o,e,n))/2),"radar"!==h&&"halftone"!==h||(a=Math.PI/2+u);const d="agepyramid"===h?(this.agePyramidHeight?this.agePyramidHeight(o,e,n):e)/r:"radar"===h||"halftone"===h?2*Math.PI/r:void 0;if(void 0===d)throw new Error("Unexpected symbol type:"+h);for(let[n,r]of Object.entries(this.color))if("agepyramid"===h){i.ctx.fillStyle=r;const h=t*o[n]/s;i.ctx.fillRect(l+(e-h)/2,c+a,h,d),a+=d}else if("radar"===h){i.ctx.fillStyle=r;const e=o[n],h=t/2*Math.sqrt(e/s);i.ctx.beginPath(),i.ctx.moveTo(l,c),i.ctx.arc(l,c,h,a-d,a),i.ctx.lineTo(l,c),i.ctx.fill(),a+=d}else{if("halftone"!==h)throw new Error("Unexpected symbol type:"+h);{i.ctx.fillStyle=r;const h=o[n],u=.333*t*Math.sqrt(h/s);i.ctx.beginPath(),i.ctx.arc(l+.25*e*Math.cos(a),c+.25*e*Math.sin(a),u,0,2*Math.PI),i.ctx.fill(),a+=d}}}else{let s=0;for(let t of Object.keys(this.color)){const e=+o[t];e&&(s+=e)}if(!s||isNaN(s))continue;let r=0;const d=e*(1-t/e)*.5,f=this.stripesOrientation(o,e,n);for(let[n,p]of Object.entries(this.color)){const m=o[n]/s;if(m&&!isNaN(m)){if(i.ctx.fillStyle=p,"flag"===h)0==f?i.ctx.fillRect(o.x+d+a.dx,o.y+d+r*t+a.dy,t,m*t):i.ctx.fillRect(o.x+d+r*t+a.dx,o.y+d+a.dy,m*t,t);else if("piechart"===h){const e=2*r*Math.PI,n=2*(r+m)*Math.PI;i.ctx.beginPath(),i.ctx.moveTo(l,c),i.ctx.arc(l,c,.5*t,e+u,n+u),this.pieChartInternalRadiusFactor&&i.ctx.arc(l,c,.5*t*this.pieChartInternalRadiusFactor,e+u,n+u,!0),i.ctx.closePath(),i.ctx.fill()}else if("ring"===h)i.ctx.beginPath(),i.ctx.arc(l,c,Math.sqrt(1-r)*t*.5,0,2*Math.PI),i.ctx.fill();else{if("segment"!==h)throw new Error("Unexpected symbol type:"+h);{const n=t*t/e;0==f?i.ctx.fillRect(o.x+a.dx,o.y+(e-n)/2+r*n+a.dy,e,m*n):i.ctx.fillRect(o.x+r*e+a.dx,o.y+(e-n)/2+a.dy,m*e,n)}}r+=m}}}}this.updateLegends({style:this,r:e,zf:n,sSize:s})}}class Jl extends Hl{constructor(t){super(t),t=t||{},this.orientation=t.orientation||(()=>0),this.colorCol=t.colorCol,this.color=t.color||(()=>"#EA6BAC"),this.lengthCol=t.lengthCol,this.length=t.length,this.widthCol=t.widthCol,this.width=t.width}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s,r,o;this.colorCol&&(s=Hl.getStatistics(t,(t=>t[this.colorCol]),!0)),this.lengthCol&&(t.sort(((t,e)=>e[this.lengthCol]-t[this.lengthCol])),r=Hl.getStatistics(t,(t=>t[this.lengthCol]),!0)),this.widthCol&&(o=Hl.getStatistics(t,(t=>t[this.widthCol]),!0)),i.ctx.lineCap="butt";const a=Math.PI/180;i.setCanvasTransform();for(let h of t){const t=this.color?this.color(h[this.colorCol],e,s):void 0;if(!t)continue;const l=this.width?this.width(h[this.widthCol],e,o,n):void 0;if(!l||l<0)continue;const c=this.length?this.length(h[this.lengthCol],e,r,n):void 0;if(!c||c<0)continue;const u=this.orientation(h)*a;if(void 0===u||isNaN(u))continue;const d=this.offset(h,e,n);i.ctx.strokeStyle=t,i.ctx.lineWidth=l;const f=h.x+e/2+d.dx,p=h.y+e/2+d.dy,m=.5*Math.cos(u)*c,y=.5*Math.sin(u)*c;i.ctx.beginPath(),i.ctx.moveTo(f-m,p-y),i.ctx.lineTo(f+m,p+y),i.ctx.stroke()}this.updateLegends({style:this,r:e,zf:n,sColor:s,sLength:r,sWidth:o})}}class Ql extends Hl{constructor(t){super(t),t=t||{},this.textCol=t.textCol,this.text=t.text||((t,e,i,n)=>"X"),this.colorCol=t.colorCol,this.color=t.color||(()=>"#EA6BAC"),this.fontSizeCol=t.fontSizeCol,this.fontSize=t.fontSize||((t,e,i,n)=>.8*e),this.fontFamily=t.fontFamily||"Arial",this.fontWeight=t.fontWeight||"bold"}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s,r,o;this.textCol&&(s=Hl.getStatistics(t,(t=>t[this.textCol]),!0)),this.colorCol&&(r=Hl.getStatistics(t,(t=>t[this.colorCol]),!0)),this.fontSizeCol&&(t.sort(((t,e)=>e[this.fontSizeCol]-t[this.fontSizeCol])),o=Hl.getStatistics(t,(t=>t[this.fontSizeCol]),!0)),i.initCanvasTransform();for(let a of t){const t=this.text?this.text(a[this.textCol],e,s):void 0;if(null==t||null==t||t+""=="")continue;const h=this.color?this.color(a[this.colorCol],e,r):void 0;if(!h)continue;i.ctx.fillStyle=h;const l=this.fontSize(a[this.fontSizeCol],e,o,n)/n,c=this.fontFamily||"Arial",u=this.fontWeight||"bold";i.ctx.font=u+" "+l+"px "+c;const d=this.offset(a,e,n);i.ctx.textAlign="center";const f=i.geoToPixX(a.x+.5*e+d.dx),p=i.geoToPixY(a.y+.5*e+d.dy)+.3*l;i.ctx.fillText(t,f,p)}this.updateLegends({style:this,r:e,zf:n,sColor:r})}static getCharLegendFun(t){const e=t.length;return i=>0==i?"":1==i?t[e-1]:t[Math.floor(i*e)]}}function tc(t,e){return null==t?e:"function"==typeof t?t:e=>e[t]}function ec(t,e=!1){const i=new Float64Array(5),n=new Float64Array(4);!function(t,e,i){const n=Float64Array.of(.84,1.8675,.84,-1.8675,-.34015,-.1299,-.34015,.1299),s=Math.exp(-1.783/i),r=Math.exp(-1.723/i),o=.6318/i,a=1.997/i,h=Float64Array.of(-s*Math.cos(o),s*Math.sin(o),-s*Math.cos(-o),s*Math.sin(-o),-r*Math.cos(a),r*Math.sin(a),-r*Math.cos(-a),r*Math.sin(-a)),l=2.5066282746310007*i,c=Float64Array.of(n[0],n[1],0,0,0,0,0,0),u=Float64Array.of(1,0,h[0],h[1],0,0,0,0,0,0);let d,f;for(f=2;f<8;f+=2){for(c[f]=h[f]*c[f-2]-h[f+1]*c[f-1],c[f+1]=h[f]*c[f-1]+h[f+1]*c[f-2],d=f-2;d>0;d-=2)c[d]+=h[f]*c[d-2]-h[f+1]*c[d-1],c[d+1]+=h[f]*c[d-1]+h[f+1]*c[d-2];for(d=0;d<=f;d+=2)c[d]+=n[f]*u[d]-n[f+1]*u[d+1],c[d+1]+=n[f]*u[d+1]+n[f+1]*u[d];for(u[f+2]=h[f]*u[f]-h[f+1]*u[f+1],u[f+3]=h[f]*u[f+1]+h[f+1]*u[f],d=f;d>0;d-=2)u[d]+=h[f]*u[d-2]-h[f+1]*u[d-1],u[d+1]+=h[f]*u[d-1]+h[f+1]*u[d-2]}for(f=0;f<4;++f)d=f<<1,e[f]=c[d]/l,t[f+1]=u[d+2]}(i,n,t);const s=Float64Array.of(0,n[1]-i[1]*n[0],n[2]-i[2]*n[0],n[3]-i[3]*n[0],-i[4]*n[0]),r=1+i[1]+i[2]+i[3]+i[4];return{sigma:t,negative:e,a:i,b_causal:n,b_anticausal:s,sum_causal:(n[0]+n[1]+n[2]+n[3])/r,sum_anticausal:(s[1]+s[2]+s[3]+s[4])/r}}function ic(t,e,i,n=1,s=new Float64Array(i),r=new Float64Array(i),o=new Float64Array(5),a=s,h=nc){const l=2*n,c=3*n,u=4*n,d=n*i;let f,p;for(h(s,e,i,n,t.b_causal,3,t.a,4,t.sum_causal,o,t.sigma),p=4,f=u;p<i;++p,f+=n)s[p]=t.b_causal[0]*e[f]+t.b_causal[1]*e[f-n]+t.b_causal[2]*e[f-l]+t.b_causal[3]*e[f-c]-t.a[1]*s[p-1]-t.a[2]*s[p-2]-t.a[3]*s[p-3]-t.a[4]*s[p-4];for(h(r,e,i,-n,t.b_anticausal,4,t.a,4,t.sum_anticausal,o,t.sigma),p=4,f=d-5*n;p<i;++p,f-=n)r[p]=t.b_anticausal[1]*e[f+n]+t.b_anticausal[2]*e[f+l]+t.b_anticausal[3]*e[f+c]+t.b_anticausal[4]*e[f+u]-t.a[1]*r[p-1]-t.a[2]*r[p-2]-t.a[3]*r[p-3]-t.a[4]*r[p-4];if(t.negative)for(p=0,f=0;p<i;++p,f+=n)a[f]=s[p]+r[i-p-1];else for(p=0,f=0;p<i;++p,f+=n)a[f]=Math.max(0,s[p]+r[i-p-1]);return a}function nc(t,e,i,n,s,r,o,a,h,l){const c=Math.abs(n)*i,u=n<0?c+n:0;let d,f,p;for(f=0;f<a;++f)for(l[f]=f<=r?s[f]:0,p=1;p<=a&&p<=f;++p)l[f]-=o[p]*l[f-p];for(p=0;p<a;++p)for(t[p]=0,f=1;f<=p;++f)d=u+n*f,d>=0&&d<c&&(t[p]+=l[p-f]*e[d]);const m=e[u];if(m>0)for(p=0;p<a;++p)t[p]+=l[p]*m}function sc(t,e,i=0){const n=t.length;let s,r;for(let i=0;i<n;++i){const n=e(t[i],i,t);null!=n&&(void 0===s?n>=n&&(s=r=n):(n<s&&(s=n),n>r&&(r=n)))}return[s-i,r+i]}function rc(t,e){const i=t.length;for(let n=0;n<i;++n)t[n]>e&&(e=t[n]);return e}function oc(t,e){const i=t.length;for(let n=0;n<i;++n)t[n]<e&&(e=t[n]);return e}function ac(t,e){const i=t.map(e).filter((t=>null!=t&&t>=t));i.sort(((t,e)=>t-e));const n=function(t){const e=t.length;let i,n=0,s=0,r=0;for(let o=0;o<e;++o){const e=t[o];i=e-s,s+=i/++n,r+=i*(e-s)}return n>1?Math.sqrt(r/(n-1)):NaN}(i),s=hc(i,.25),r=hc(i,.75),o=i.length,a=(r-s)/1.34;return 1.06*(Math.min(n,a)||n||Math.abs(s)||1)*Math.pow(o,-.2)}function hc(t,e){const i=t.length;if(!i)return NaN;if((e=+e)<=0||i<2)return t[0];if(e>=1)return t[i-1];const n=(i-1)*e,s=Math.floor(n),r=t[s];return r+(t[s+1]-r)*(n-s)}function lc(t,e={}){const{adjust:i=1,pad:n=3,bins:s=[256,256]}=e,r=tc(e.x,(t=>t[0])),o=tc(e.y,(t=>t[1])),a=tc(e.weight,(()=>1/t.length));let[h=i*ac(t,r),l=i*ac(t,o)]=cc(e.bandwidth);const[[c,u]=sc(t,r,n*h),[d,f]=sc(t,o,n*l)]=null==(p=e.extent)?[void 0,void 0]:"number"==typeof p[0]?[p,p]:p;var p;const[m,y]=cc(s),_=function(t,e,i,n,s,r,o,a,h,l){const c=new Float64Array(o*l),u=(o-1)/(r-s),d=(l-1)/(h-a);for(let r=0;r<t.length;++r){const h=t[r],f=e(h,r,t),p=i(h,r,t),m=n(h,r,t);if(!(Number.isFinite(f)&&Number.isFinite(p)&&Number.isFinite(m)))continue;const y=(f-s)*u,_=Math.floor(y),g=_+1,v=(p-a)*d,b=Math.floor(v),x=b+1;0<=_&&g<o?0<=b&&x<l?(c[_+b*o]+=(g-y)*(x-v)*m,c[_+x*o]+=(g-y)*(v-b)*m,c[g+b*o]+=(y-_)*(x-v)*m,c[g+x*o]+=(y-_)*(v-b)*m):-1===b?(c[_+x*o]+=(g-y)*(v-b)*m,c[g+x*o]+=(y-_)*(v-b)*m):x===l&&(c[g+b*o]+=(y-_)*(x-v)*m,c[_+b*o]+=(g-y)*(x-v)*m):-1===_?0<=b&&x<l?(c[g+b*o]+=(y-_)*(x-v)*m,c[g+x*o]+=(y-_)*(v-b)*m):-1===b?c[g+x*o]+=(y-_)*(v-b)*m:x===l&&(c[g+b*o]+=(y-_)*(x-v)*m):g===o&&(0<=b&&x<l?(c[_+b*o]+=(g-y)*(x-v)*m,c[_+x*o]+=(g-y)*(v-b)*m):-1===b?c[_+x*o]+=(g-y)*(v-b)*m:x===l&&(c[_+b*o]+=(g-y)*(x-v)*m))}return c}(t,r,o,a,c,u,m,d,f,y),g=(u-c)/(m-1),v=(f-d)/(y-1),b=_.some((t=>t<0));let x,w=ec(h/g,b),M=ec(l/v,b);function*S(t="x",e="y",i="z"){const n=T.grid(),s=1/(g*v);for(let r=0,o=0;o<y;++o)for(let a=0;a<m;++a,++r)yield{[t]:c+a*g,[e]:d+o*v,[i]:n[r]*s}}const T={[Symbol.iterator]:S,points:S,grid:()=>x||(x=function(t,e,i,[n,s]){const r=new Float64Array(Math.max(n,s)),o=new Float64Array(Math.max(n,s)),a=new Float64Array(5),h=new Float64Array(i.length);for(let e=0,l=0;e<s;++e,l+=n){const e=h.subarray(l);ic(t,i.subarray(l),n,1,r,o,a,e)}for(let t=0;t<n;++t){const i=h.subarray(t);ic(e,i,s,n,r,o,a,i)}return h}(w,M,_,[m,y])),extent:()=>[[c,u],[d,f]],heatmap:({color:t,clamp:e,canvas:i,maxColors:n}={})=>function(t,e,i,n=(t=>({r:0,g:0,b:0,opacity:t})),[s,r]=[oc(t,0),rc(t,0)],o=function(t,e){if("undefined"!=typeof document){const i=document.createElement("canvas");return i.setAttribute("width",t),i.setAttribute("height",e),i}throw"Can not create a canvas instance, provide a canvas as a parameter."}(e,i),a=256){const h=1/(r-s),l=o.getContext("2d"),c=l.getImageData(0,0,e,i),u=c.data,d=a-1,f=function(t,e){const i=new Uint8ClampedArray(4*(t+1));for(let n=0;n<=t;++n){const s=e(n/t),{r,g:o,b:a,opacity:h=1}="string"==typeof s?Ne(s):s,l=n<<2;i[l+0]=r,i[l+1]=o,i[l+2]=a,i[l+3]=255*h|0}return i}(d,n);for(let n=0,r=0;n<i;++n)for(let o=0,a=(i-n-1)*e;o<e;++o,r+=4){const e=d*Math.min(1,Math.max(t[o+a]-s,0)*h)<<2;u[r+0]=f[e+0],u[r+1]=f[e+1],u[r+2]=f[e+2],u[r+3]=f[e+3]}return l.putImageData(c,0,0),o}(T.grid(),m,y,t,e,i,n),bandwidth(t){if(arguments.length){const[e,i]=cc(t);return e!==h&&(x=null,w=ec((h=e)/g,b)),i!==l&&(x=null,M=ec((l=i)/v,b)),T}return[h,l]}};return T}function cc(t){return null==t?[void 0,void 0]:"number"==typeof t?[t,t]:t}class uc extends Hl{constructor(t){super(t),t=t||{},this.value=t.value,this.sigma=t.sigma,this.factor=t.factor||2,this.filterSm=t.filterSm,this.sCol=t.sCol||"ksmval",this.styles=t.styles||[]}draw(t,e,i){if(this.filter&&(t=t.filter(this.filter)),!t||0==t.length)return;const n=this.sigma(e,i.zf),s=Math.ceil(i.w/this.factor),r=Math.ceil(i.h/this.factor),o=[[i.pixToGeoX(0),i.pixToGeoX(s*this.factor)],[i.pixToGeoY(r*this.factor),i.pixToGeoY(0)]];let a=lc(t,{x:t=>t.x+e/2,y:t=>t.y+e/2,weight:t=>this.value(t),bins:[s,r],bandwidth:n,extent:o}).grid();const h=(o[0][1]-o[0][0])/s;t=[];for(let e=0;e<a.length;e++){const i=a[e];if(this.filterSm&&!this.filterSm(i))continue;const n=Math.floor(e/s),r=e%s,l={x:o[0][0]+r*h,y:o[1][0]+n*h};l[this.sCol]=i,t.push(l)}for(let e of this.styles)e.draw(t,h,i)}}class dc extends Hl{constructor(t){super(t),t=t||{},this.heightCol=t.heightCol,this.height=t.height,this.colorCol=t.colorCol,this.color=t.color||(()=>"#c08c59"),this.widthCol=t.widthCol,this.width=t.width||((t,e)=>.5*e),this.simple=null!=t.simple,this.viewHeightFactor=t.viewHeightFactor||1.5,this.viewSX=null==t.viewSX?0:t.viewSX,this.viewSY=null==t.viewSY?-.5:t.viewSY,this.shadowDirection=null==t.shadowDirection?-40.3*Math.PI/180:t.shadowDirection,this.shadowFactor=t.shadowFactor||.3,this.shadowColor=t.shadowColor||"#00000033",this.outlineCol=t.outlineCol||"#FFFFFF",this.outlineWidthPix=null==t.outlineWidthPix?.5:t.outlineWidthPix}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s,r,o;this.heightCol&&(s=Hl.getStatistics(t,(t=>t[this.heightCol]),!0)),this.colorCol&&(r=Hl.getStatistics(t,(t=>t[this.colorCol]),!0)),this.widthCol&&(o=Hl.getStatistics(t,(t=>t[this.widthCol]),!0));const a=i.getCenter().x+this.viewSX*i.w*n,h=i.getCenter().y+this.viewSY*i.h*n,l=this.viewHeightFactor*(i.w+i.h)*.5*n;t.sort(((t,e)=>1e8*(e.y-t.y)+t.x-e.x)),i.ctx.lineCap=this.simple?"butt":"round",i.setCanvasTransform(),i.ctx.strokeStyle=this.shadowColor,i.ctx.fillStyle=this.shadowColor;for(let r of t){const t=this.width?this.width(r[this.widthCol],e,o,n):void 0;if(!t||t<0)continue;const a=this.height?this.height(r[this.heightCol],e,s,n):void 0;if(!a||a<0)continue;this.offset(r,e,n),i.ctx.lineWidth=t;const h=r.x+e/2,l=r.y+e/2,c=a*this.shadowFactor;i.ctx.beginPath(),i.ctx.moveTo(h,l),i.ctx.lineTo(h+c*Math.cos(this.shadowDirection),l+c*Math.sin(this.shadowDirection)),i.ctx.stroke()}for(let c of t){const t=this.color?this.color(c[this.colorCol],e,r):void 0;if(!t)continue;const u=this.width?this.width(c[this.widthCol],e,o,n):void 0;if(!u||u<0)continue;const d=this.height?this.height(c[this.heightCol],e,s,n):void 0;if(!d||d<0)continue;this.offset(c,e,n);const f=c.x+e/2,p=c.y+e/2,m=f-a,y=p-h,_=Math.atan2(y,m),g=Math.sqrt(m*m+y*y)*d/(l-d);this.simple?(i.ctx.strokeStyle=t,i.ctx.lineWidth=u,i.ctx.beginPath(),i.ctx.moveTo(f,p),i.ctx.lineTo(f+g*Math.cos(_),p+g*Math.sin(_)),i.ctx.stroke()):(i.ctx.strokeStyle=this.outlineCol,i.ctx.lineWidth=u+2*this.outlineWidthPix*n,i.ctx.beginPath(),i.ctx.moveTo(f,p),i.ctx.lineTo(f+g*Math.cos(_),p+g*Math.sin(_)),i.ctx.stroke(),i.ctx.strokeStyle=t,i.ctx.lineWidth=u,i.ctx.beginPath(),i.ctx.moveTo(f,p),i.ctx.lineTo(f+g*Math.cos(_),p+g*Math.sin(_)),i.ctx.stroke(),i.ctx.strokeStyle=this.outlineCol,i.ctx.lineWidth=this.outlineWidthPix*n,i.ctx.beginPath(),i.ctx.arc(f+g*Math.cos(_),p+g*Math.sin(_),.5*u,0,2*Math.PI,!1),i.ctx.stroke())}i.ctx.lineCap="butt",this.updateLegends({style:this,r:e,zf:n,sColor:r})}}class fc extends Hl{constructor(t){super(t),t=t||{},this.valueCol=t.valueCol,this.value=t.value||((t,e,i,n,s)=>1),this.color=t.color||(()=>"#EA6BAC"),this.width=t.width||((t,e,i,n)=>e*t.value/5),this.orientation=t.orientation||0,this.fillColor=t.fillColor}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s;this.valueCol&&(s=Hl.getStatistics(t,(t=>t[this.valueCol]),!0));const r=[],o=.001*e;t.sort(((t,e)=>e.x==t.x?t.y-e.y:t.x-e.x));let a=t[0];for(let i=1;i<t.length;i++){let h=t[i];Math.abs(a.y+e-h.y)<=o&&Math.abs(a.x-h.x)<=o?r.push({x:a.x,y:h.y,or:"h",value:this.value(a[this.valueCol],h[this.valueCol],e,s,n)}):(r.push({x:a.x,y:a.y+e,or:"h",value:this.value(a[this.valueCol],void 0,e,s,n)}),r.push({x:h.x,y:h.y,or:"h",value:this.value(void 0,h[this.valueCol],e,s,n)})),a=h}t.sort(((t,e)=>e.y==t.y?t.x-e.x:t.y-e.y)),a=t[0];for(let i=1;i<t.length;i++){let h=t[i];Math.abs(a.x+e-h.x)<=o&&Math.abs(a.y-h.y)<=o?r.push({x:a.x+e,y:a.y,or:"v",value:this.value(a[this.valueCol],h[this.valueCol],e,s,n)}):(r.push({x:a.x+e,y:a.y,or:"v",value:this.value(a[this.valueCol],void 0,e,s,n)}),r.push({x:h.x,y:h.y,or:"v",value:this.value(void 0,h[this.valueCol],e,s,n)})),a=h}if(0==r.length)return;const h=fc.getSideStatistics(r,!0);if(i.setCanvasTransform(),this.fillColor)for(let n of t){const t=this.fillColor(n);t&&"none"!=t&&(i.ctx.fillStyle=t,i.ctx.fillRect(n.x,n.y,e,e))}i.ctx.lineCap="butt";const l=e/2;for(let t of r){const s=this.color?this.color(t,e,h,n):void 0;if(!s||"none"==s)continue;const r=this.width?this.width(t,e,h,n):void 0;!r||r<=0||(i.ctx.strokeStyle=s,i.ctx.lineWidth=r,i.ctx.beginPath(),90==this.orientation?(i.ctx.moveTo(t.x+l,t.y+l),"h"===t.or?i.ctx.lineTo(t.x+l,t.y-l):i.ctx.lineTo(t.x-l,t.y+l)):(i.ctx.moveTo(t.x,t.y),i.ctx.lineTo(t.x+("h"===t.or?e:0),t.y+("v"===t.or?e:0))),i.ctx.stroke())}this.updateLegends({style:this,r:e,zf:n})}static getSideStatistics(t,e){if(!t||0==t.length)return;let i=1/0,n=-1/0;for(const s of t){const t=s.value;e&&!t||(t<i&&(i=t),t>n&&(n=t))}return{min:i,max:n}}}class pc extends fc{constructor(t){super(t),(t=t||{}).breaks=t.breaks||[100,1e3,1e4,1e5,1e6],t.width=t.width||(()=>1),t.color=t.color||(()=>"#E7A935");const e=function(e){if(null==e)return 0;for(let i=0;i<t.breaks.length;i++)if(e<t.breaks[i])return i;return t.breaks.length};this.value=(t,i,n,s,r)=>Math.abs(e(i)-e(t)),this.color=(e,i,n,s)=>e.value?t.color(e,i,s):void 0,this.width=(e,i,n,s)=>e.value*s*t.width(e,i,s)}}class mc extends Hl{constructor(t){super(t),t=t||{},this.col=t.col,this.color=t.color,this.width=t.width||((t,e,i)=>.2*e),this.fillColor=t.fillColor}draw(t,e,i){if(this.filter&&(t=t.filter(this.filter)),!t||0==t.length)return;const n=i.getZf(),s=[];t.sort(((t,e)=>e.x==t.x?t.y-e.y:t.x-e.x));let r=t[0],o=r[this.col];for(let i=1;i<t.length;i++){let n=t[i],a=n[this.col];r.y+e==n.y&&r.x==n.x?o!=a&&s.push({x:r.x,y:n.y,or:"h",v1:o,v2:a}):(s.push({x:r.x,y:r.y+e,or:"h",v1:o,v2:void 0}),s.push({x:n.x,y:n.y,or:"h",v1:void 0,v2:a})),r=n,o=a}t.sort(((t,e)=>e.y==t.y?t.x-e.x:t.y-e.y)),r=t[0],o=r[this.col];for(let i=1;i<t.length;i++){let n=t[i],a=n[this.col];r.x+e==n.x&&r.y==n.y?o!=a&&s.push({x:r.x+e,y:r.y,or:"v",v1:o,v2:a}):(s.push({x:r.x+e,y:r.y,or:"v",v1:o,v2:void 0}),s.push({x:n.x,y:n.y,or:"v",v1:void 0,v2:a})),r=n,o=a}if(0!=s.length){if(i.setCanvasTransform(),this.fillColor)for(let n of t){const t=this.fillColor(n);t&&"none"!=t&&(i.ctx.fillStyle=t,i.ctx.fillRect(n.x,n.y,e,e))}i.ctx.lineCap="butt";for(let t of s){const s=this.width?this.width(t,e,n):void 0;if(!s||s<=0)continue;const r=.5*s;i.ctx.lineWidth=s,"h"===t.or?(t.v2&&(i.ctx.beginPath(),i.ctx.strokeStyle=this.color[t.v2],i.ctx.moveTo(t.x,t.y+r),i.ctx.lineTo(t.x+e,t.y+r),i.ctx.stroke()),t.v1&&(i.ctx.beginPath(),i.ctx.strokeStyle=this.color[t.v1],i.ctx.moveTo(t.x,t.y-r),i.ctx.lineTo(t.x+e,t.y-r),i.ctx.stroke())):(t.v2&&(i.ctx.beginPath(),i.ctx.strokeStyle=this.color[t.v2],i.ctx.moveTo(t.x+r,t.y),i.ctx.lineTo(t.x+r,t.y+e),i.ctx.stroke()),t.v1&&(i.ctx.beginPath(),i.ctx.strokeStyle=this.color[t.v1],i.ctx.moveTo(t.x-r,t.y),i.ctx.lineTo(t.x-r,t.y+e),i.ctx.stroke()))}this.updateLegends({style:this,r:e,zf:n})}}}const yc=function t(e){function i(t,i){var n,s;return t=null==t?0:+t,i=null==i?1:+i,function(){var r;if(null!=n)r=n,n=null;else do{n=2*e()-1,r=2*e()-1,s=n*n+r*r}while(!s||s>1);return t+i*r*Math.sqrt(-2*Math.log(s)/s)}}return i.source=t,i}(Math.random);function _c(t,e,i){const n=document.createElement("canvas");n.setAttribute("width",t),n.setAttribute("height",e);const s=n.getContext("webgl",i);if(!s)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");return{canvas:n,gl:s}}function gc(t,...e){const i=t.createProgram();if(null==i)throw new Error("Cannot create webGL program");for(const n of e)t.attachShader(i,n);if(t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;throw new Error(t.getProgramInfoLog(i)||"Cannot create webGL program (2)")}function vc(t,e,...i){const n=t.createShader(e);if(null==n)throw new Error("Cannot create webGL shader");if(t.shaderSource(n,i.join("\n")),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))return n;throw new Error(t.getShaderInfoLog(n)||"Cannot create webGL shader (2)")}class bc{constructor(t,e){this.gl=t,this.sizePix=e||10,this.program=gc(t,vc(t,t.VERTEX_SHADER,"\n            attribute vec2 pos;\n            uniform float sizePix;\n            uniform mat3 mat;\n            attribute vec4 color;\n            varying vec4 vColor;\n            void main() {\n              gl_Position = vec4(mat * vec3(pos, 1.0), 1.0);\n              gl_PointSize = sizePix;\n              vColor = color;\n            }\n          "),vc(t,t.FRAGMENT_SHADER,"\n            precision mediump float;\n            varying vec4 vColor;\n            void main(void) {\n                vec4 vColor_ = vColor / 255.0;\n                vColor_[3] = 255.0 * vColor_[3];\n                gl_FragColor = vColor_;\n            }")),t.useProgram(this.program),this.verticesBuffer=[],this.colorsBuffer=[]}addPointData(t,e,i){const n=ze(i);n&&(this.verticesBuffer.push(t,e),this.colorsBuffer.push(n.r,n.g,n.b,n.opacity))}addPointData2(t,e,i,n,s,r){this.verticesBuffer.push(t,e),this.colorsBuffer.push(i,n,s,r)}draw(t){const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.verticesBuffer),e.STATIC_DRAW);const i=e.getAttribLocation(this.program,"pos");e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.colorsBuffer),e.STATIC_DRAW);var n=e.getAttribLocation(this.program,"color");e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n),e.uniform1f(e.getUniformLocation(this.program,"sizePix"),1*this.sizePix),e.uniformMatrix3fv(e.getUniformLocation(this.program,"mat"),!1,new Float32Array(t)),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.POINTS,0,this.verticesBuffer.length/2)}}class xc extends Hl{constructor(t){super(t),t=t||{},this.nbCol=t.nbCol,this.nb=t.nb||((t,e,i,n)=>.3*e*e/(n*n)*t/i.max),this.color=t.color||(()=>"#FF5733"),this.dotSize=t.dotSize,this.sigma=t.sigma}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s;if(this.nbCol&&(s=Hl.getStatistics(t,(t=>t[this.nbCol]),!0)),!s)return;const r=this.dotSize?this.dotSize(e,n):2*n,o=this.sigma?this.sigma(e,n):.4*e,a=yc(0,o);if(function(){try{const t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}()){const o=_c(i.w+"",i.h+"");if(!o)return void console.error("No webGL");const h=new bc(o.gl,r/n),l=e/2;let c,u,d,f,p,m;for(let i of t)if(c=this.color(i),c&&"none"!==c){if(u=this.offset(i,e,n),d=this.nb(i[this.nbCol],e,s,n),f=i.x+u.dx+l,p=i.y+u.dy+l,m=ze(c),!m)return;for(let t=0;t<=d;t++)h.addPointData2(f+a(),p+a(),m.r,m.g,m.b,m.opacity)}h.draw(i.getWebGLTransform()),i.initCanvasTransform(),i.ctx.drawImage(o.canvas,0,0)}else{i.setCanvasTransform();for(let o of t){const t=this.color(o);if(!t||"none"===t)continue;i.ctx.fillStyle=t;const h=this.offset(o,e,n),l=this.nb(o[this.nbCol],e,s,n),c=o.x+h.dx+e/2,u=o.y+h.dy+e/2;for(let t=0;t<=l;t++)i.ctx.fillRect(c+a(),u+a(),r,r)}}this.updateLegends({style:this,r:e,zf:n})}}class wc{constructor(t,e,i,n=10,s=void 0){this.gl=t;const r=vc(t,t.VERTEX_SHADER,"\n        attribute vec2 pos;\n        uniform float sizePix;\n        uniform mat3 mat;\n\n        attribute float t;\n        varying float vt;\n\n        void main() {\n          gl_Position = vec4(mat * vec3(pos, 1.0), 1.0);\n          gl_PointSize = sizePix;\n          vt = t;\n        }\n      ");let o="precision mediump float;\nvarying float vt;\nuniform float alpha;\n"+(()=>{const t=[];for(let i=0;i<e.length;i++)t.push("uniform vec4 c"+i+";\n");return t.join("")})()+"void main(void) {\n";if(i?"pow"==i.fun?o+="   float t = pow(vt, alpha);\n":"powRev"==i.fun?o+="   float t = 1.0-pow(1.0-vt, 1.0/alpha);\n":"exp"==i.fun?o+=0==i.alpha?"float t = vt;":"   float t = (exp(vt * alpha) - 1.0) / (exp(alpha) - 1.0);\n":"expRev"==i.fun?o+=0==i.alpha?"float t = vt;":"   float t = 1.0 - (1.0 / alpha) * log(exp(alpha) * (1.0 - vt) + vt);\n":"circleLow"==i.fun?0==i.alpha?o+="   float t = vt;\n":1==i.alpha?o+="   float t = sqrt(vt * (2.0 - vt));\n":o+="   float a = alpha / (1.0 - alpha);\n   float t = sqrt(1.0 / (a * a) + vt * ( 2.0/a + 2.0 - vt )) - 1.0 / a;\n":"circleHigh"==i.fun?0==i.alpha?o+="   float t = vt;\n":1==i.alpha?o+="   float t = 1.0 - sqrt((1.0 - vt) * (1.0 + vt));\n":o+="   float a = alpha / (1.0 - alpha);\n   float t = 1.0 - sqrt(1.0 / (a * a) + (1.0-vt) * ( 2.0/a + 1.0 + vt )) + 1.0 / a;\n":(console.error("Unexpected stretching function code: "+i.fun),o+="   float t = vt;\n"):o+="   float t = vt;\n",1==e.length)o+="   vec4 cI=c0;\n   vec4 cF=c0;\n";else if(2==e.length)o+="   vec4 cI=c0;\n   vec4 cF=c1;\n";else{const t=e.length-1,i=t+".0";o+="   vec4 cI;\n",o+="   vec4 cF;\n",o+="   if(t<1.0/"+i+") { cI=c0; cF=c1; t=t*"+i+"; }\n";for(let e=2;e<t;e++)o+="   else if(t<"+e+".0/"+i+") { cI=c"+(e-1)+"; cF=c"+e+"; t="+i+"*t-"+(e-1)+".0; }\n";o+="   else { cI=c"+(t-1)+"; cF=c"+t+"; t="+i+"*t-"+(t-1)+".0; }\n"}1==e.length?o+="   gl_FragColor = vec4(c0[0], c0[1], c0[2], c0[3]);}\n":o+="   gl_FragColor = mix(cI, cF, t);}\n";const a=vc(t,t.FRAGMENT_SHADER,o);this.program=gc(t,r,a),t.useProgram(this.program),t.uniform1f(t.getUniformLocation(this.program,"sizePix"),1*n),t.uniform1f(t.getUniformLocation(this.program,"alpha"),i?1*i.alpha:0);for(let i=0;i<e.length;i++){const n=ze(e[i]);let r=n.opacity;1==n.opacity&&null!=s&&(r=s),t.uniform4fv(t.getUniformLocation(this.program,"c"+i),[+n.r/255,+n.g/255,+n.b/255,+r])}}draw(t,e,i){const n=this.gl,s=this.program;n.bindBuffer(n.ARRAY_BUFFER,n.createBuffer()),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW);const r=n.getAttribLocation(s,"pos");n.vertexAttribPointer(r,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r),n.bindBuffer(n.ARRAY_BUFFER,n.createBuffer()),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n.STATIC_DRAW);const o=n.getAttribLocation(s,"t");n.vertexAttribPointer(o,1,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o),n.uniformMatrix3fv(n.getUniformLocation(s,"mat"),!1,new Float32Array(i)),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.POINTS,0,t.length/2)}}class Mc extends Hl{constructor(t){super(t),t=t||{},this.colorCol=t.colorCol,this.tFun=t.tFun||((t,e,i)=>t/i.max),this.stretching=t.stretching,this.colors=t.colors||["rgb(158, 1, 66)","rgb(248, 142, 83)","rgb(251, 248, 176)","rgb(137, 207, 165)","rgb(94, 79, 162)"].reverse(),t.color&&(this.colors=[t.color(0),t.color(.2),t.color(.4),t.color(.6),t.color(.8),t.color(1)]),this.opacity=t.opacity,this.size=t.size}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf(),s=Hl.getStatistics(t,(t=>t[this.colorCol]),!0);if(!s)return;const r=_c(i.w+"",i.h+"",null!=this.opacity?{premultipliedAlpha:!1}:void 0);if(!r)return void console.error("No webGL");const o=e/2,a=[],h=[];for(let i of t){const t=this.tFun(i[this.colorCol],e,s);null!=t&&null!=t&&(a.push(i.x+o,i.y+o),h.push(t>1?1:t<0?0:t))}const l=this.size?this.size(e,n):e+.2*n,c=this.opacity?this.opacity(e,n):void 0;new wc(r.gl,this.colors,this.stretching,l/n,c).draw(a,h,i.getWebGLTransform()),i.initCanvasTransform(),i.ctx.drawImage(r.canvas,0,0),this.updateLegends({style:this,r:e,zf:n,sColor:s})}}class Sc{static get(t,e){if(null!=(e=e||{}).nb){e.nb<2&&(console.error("unexpected number of colors in tanaka (<2): "+e.nb),e.nb=2),e.color||(console.error("color function not defined in tanaka"),e.color=()=>"gray"),e.colors=[];for(let t=0;t<e.nb;t++)e.colors.push(e.color(t/(e.nb-1)))}e.colors=e.colors||["#a9bb9e","#c9dcaa","#fde89f","#f9a579","#eb444b"];const i=e.colors.length;e.tFun=e.tFun||((t,e,i)=>(t-i.min)/(i.max-i.min)),e.colDark=e.colDark||"#111",e.colBright=e.colBright||"#ddd",e.widthFactor=e.widthFactor||.08,e.newShading=e.newShading,e.newShadingWidthPix=e.newShadingWidthPix||2,e.newShadingTr=e.newShadingTr||((t,e)=>Math.abs(t)/Math.max(Math.abs(e.min),Math.abs(e.max)));const n=t=>{if(isNaN(t)||null==t)return console.error("Unexpected t value 1: "+t),-9;for(let e=0;e<i;e++)if(t<=(e+1)/i)return e;return console.error("Unexpected t value 2: "+t),-9};return[new Mc({colorCol:t,colors:e.colors,tFun:(t,s,r)=>{const o=e.tFun(t,s,r);return n(o)/(i-1)},size:(t,e)=>t+.5*e,filter:e.filter}),new fc({valueCol:t,value:(t,i,s,r,o)=>{if(void 0===t&&void 0===i)return 0;if(void 0===i){const i=e.tFun(t,s,r);if(null==i||isNaN(i))throw new Error("Unexpected value: "+t+" - "+i);return n(i)+1}if(void 0===t){const t=e.tFun(i,s,r);if(null==t||isNaN(t))throw new Error("Unexpected value: "+i+" - "+t);return-n(t)-1}const a=e.tFun(t,s,r);if(null==a||isNaN(a))throw new Error("Unexpected value: "+t+" - "+a);const h=e.tFun(i,s,r);if(null==h||isNaN(h))throw new Error("Unexpected value: "+i+" - "+h);const l=n(a);return-n(h)+l},color:e.newShading?(t,i,n,s)=>{const r=e.newShadingTr(t.value,n);return t.value>0&&"h"===t.or||t.value<0&&"v"===t.or?"rgba(255,255,100,"+r+")":"rgba(0,0,0,"+r+")"}:(t,i,n,s)=>{if(0!==t.value)return"v"===t.or?t.value<0?e.colBright:e.colDark:t.value<0?e.colDark:e.colBright},width:e.newShading?(t,i,n,s)=>e.newShadingWidthPix*s:(t,i,n,s)=>e.widthFactor*i*Math.abs(t.value)*("v"===t.or?.5:1),filter:e.filter})]}}class Tc{constructor(t){this.colors=t,this.vshString="\n        attribute vec2 pos;\n        uniform float sizePix;\n        uniform mat3 mat;\n\n        attribute float i;\n        varying float vi;\n\n        void main() {\n          gl_Position = vec4(mat * vec3(pos, 1.0), 1.0);\n          gl_PointSize = sizePix;\n          vi = i;\n        }\n        ";const e=[];e.push("precision mediump float;\nvarying float vi;\n"),e.push("uniform vec4");for(let i=0;i<t.length;i++)i>0&&e.push(","),e.push(" c"+i);e.push(";\n"),e.push("void main(void) {\n");for(let i=0;i<t.length;i++)i>0&&e.push("else "),e.push("if(vi=="),e.push(i),e.push(".0) gl_FragColor = vec4(c"),e.push(i),e.push("[0], c"),e.push(i),e.push("[1], c"),e.push(i),e.push("[2], c"),e.push(i),e.push("[3]);\n");e.push("else gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}"),this.fshString=e.join("")}draw(t,e,i,n,s=10){const r=gc(t,vc(t,t.VERTEX_SHADER,this.vshString),vc(t,t.FRAGMENT_SHADER,this.fshString));t.useProgram(r),t.uniform1f(t.getUniformLocation(r,"sizePix"),1*s);for(let e=0;e<this.colors.length;e++){const i=ze(this.colors[e]);t.uniform4fv(t.getUniformLocation(r,"c"+e),[+i.r/255,+i.g/255,+i.b/255,+i.opacity])}t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);const o=t.getAttribLocation(r,"pos");t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW);const a=t.getAttribLocation(r,"i");t.vertexAttribPointer(a,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a),t.uniformMatrix3fv(t.getUniformLocation(r,"mat"),!1,new Float32Array(n)),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.POINTS,0,e.length/2)}}class Ic extends Hl{constructor(t){super(t),t=t||{},this.colorCol=t.colorCol,t.color=t.color||void 0;const e=Object.keys(t.color);this.catToI={};for(let t=0;t<e.length;t++)this.catToI[e[t]]=t+"";this.colors=[];for(let i=0;i<e.length;i++)this.colors.push(t.color[""+e[i]]);this.size=t.size,this.wgp=new Tc(this.colors)}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf(),s=e/2;let r,o=t.length;const a=[],h=[];for(let e=0;e<o;e++){r=t[e];const i=r[this.colorCol];if(null==i){console.log("Unexpected category: "+i);continue}const n=this.catToI[i];isNaN(+n)?console.log("Unexpected category index: "+i+" "+n):(a.push(r.x+s,r.y+s),h.push(+n))}const l=_c(i.w+"",i.h+"");if(!l)return void console.error("No webGL");const c=this.size?this.size(e,n):e+.2*n;this.wgp.draw(l.gl,a,h,i.getWebGLTransform(),c/n),i.initCanvasTransform(),i.ctx.drawImage(l.canvas,0,0),this.updateLegends({style:this,r:e,zf:n})}}class Ac{static get(t,e){(e=e||{}).colors=e.colors||["#00852b","#afd246","#fac80a","#bb805a","#d67923","#cb4e29","#b40000","#720012"],e.colDark=e.colDark||"#333",e.colBright=e.colBright||"#aaa",e.widthFactor=e.widthFactor||.12;const i=Sc.get(t,e),n=new $l({strokeColor:()=>"#666",strokeWidth:(t,e,i,n)=>.2*n,filter:e.filter});return[i[0],n,i[1],new Cc({colDark:e.colDark,colBright:e.colBright,filter:e.filter})]}static getCat(t,e){return(e=e||{}).colDark=e.colDark||"#333",e.colBright=e.colBright||"#aaa",[new Ic({colorCol:t,color:e.color}),new $l({strokeColor:()=>"#666",strokeWidth:(t,e,i,n)=>.2*n}),new Cc({colDark:e.colDark,colBright:e.colBright})]}}class Cc extends Hl{constructor(t){super(t),t=t||{},this.colDark=t.colDark||"#333",this.colBright=t.colBright||"#aaa"}draw(t,e,i){this.filter&&(t=t.filter(this.filter)),i.ctx.lineWidth=.6*i.getZf(),i.ctx.strokeStyle=this.colDark;for(let n of t)i.ctx.beginPath(),i.ctx.arc(n.x+.5*e,n.y+.5*e,.55*e*.5,Math.PI/4,-Math.PI*(3/4),!0),i.ctx.stroke();i.ctx.strokeStyle=this.colBright;for(let n of t)i.ctx.beginPath(),i.ctx.arc(n.x+.5*e,n.y+.5*e,.55*e*.5,Math.PI/4,-Math.PI*(3/4),!1),i.ctx.stroke()}}class Lc extends Hl{constructor(t){super(t),t=t||{},this.colorCol=t.colorCol,this.color=t.color||(()=>"#EA6BAC"),this.mosaicFactor=t.mosaicFactor||.15,this.shadowFactor=t.shadowFactor||.2,this.shadowColor=t.shadowColor||"#555"}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s;this.colorCol&&(s=Hl.getStatistics(t,(t=>t[this.colorCol]),!0)),i.ctx.strokeStyle=this.shadowColor,i.ctx.lineWidth=this.shadowFactor*e,i.ctx.lineJoin="round",i.ctx.lineCap="butt";const r=e*this.mosaicFactor,o=()=>({x:Math.random()*r,y:Math.random()*r});i.setCanvasTransform();for(let r of t){const t=this.color?this.color(r[this.colorCol],e,s):void 0;if(!t||"none"===t)continue;i.ctx.fillStyle=t;const a=this.offset(r,e,n),h=o(),l=o(),c=o(),u=o();this.shadowFactor>0&&(i.ctx.beginPath(),i.ctx.moveTo(r.x+a.dx+h.x,r.y+a.dy+h.y),i.ctx.lineTo(r.x+a.dx+e-c.x,r.y+a.dy+c.y),i.ctx.lineTo(r.x+a.dx+e-u.x,r.y+a.dy+e-u.y),i.ctx.stroke()),i.ctx.beginPath(),i.ctx.moveTo(r.x+a.dx+h.x,r.y+a.dy+h.y),i.ctx.lineTo(r.x+a.dx+e-c.x,r.y+a.dy+c.y),i.ctx.lineTo(r.x+a.dx+e-u.x,r.y+a.dy+e-u.y),i.ctx.lineTo(r.x+a.dx+l.x,r.y+a.dy+e-l.y),i.ctx.fill()}this.updateLegends({style:this,r:e,zf:n,sColor:s})}}class Pc extends Hl{constructor(t){super(t),t=t||{},this.colorCol=t.colorCol,this.color=t.color||(()=>"#EA6BAC"),this.sizeCol=t.sizeCol,this.size=t.size,this.shape=t.shape||(()=>"o")}draw(t,e,i){this.filter&&(t=t.filter(this.filter));const n=i.getZf();let s,r;this.sizeCol&&(t.sort(((t,e)=>e[this.sizeCol]-t[this.sizeCol])),s=Hl.getStatistics(t,(t=>t[this.sizeCol]),!0)),this.colorCol&&(r=Hl.getStatistics(t,(t=>t[this.colorCol]),!0)),i.setCanvasTransform();const o=.5*e;for(let a of t){const t=this.color?this.color(a[this.colorCol],e,r,n):void 0;if(!t||"none"===t)continue;i.ctx.fillStyle=t;const h=this.shape?this.shape(a):"o";if("none"===h)continue;const l=(this.size||(()=>.5))(a[this.sizeCol],e,s,n)*o,c=(this.offset(a,e,n),a.x+o),u=a.y+o;if("p"===h)i.ctx.beginPath(),i.ctx.moveTo(c,u+o),i.ctx.lineTo(c+l,u+l),i.ctx.lineTo(c+o,u),i.ctx.lineTo(c+l,u-l),i.ctx.lineTo(c,u-o),i.ctx.lineTo(c-l,u-l),i.ctx.lineTo(c-o,u),i.ctx.lineTo(c-l,u+l),i.ctx.fill();else{if("o"!==h)throw new Error("Unexpected shape:"+h);i.ctx.beginPath(),i.ctx.moveTo(c,u+l),i.ctx.lineTo(c+o,u+o),i.ctx.lineTo(c+l,u),i.ctx.lineTo(c+o,u-o),i.ctx.lineTo(c,u-l),i.ctx.lineTo(c-o,u-o),i.ctx.lineTo(c-l,u),i.ctx.lineTo(c-o,u+o),i.ctx.fill()}}this.updateLegends({style:this,r:e,zf:n,sSize:s,sColor:r})}}class Bc{constructor(t){t=t||{},this.id=t.id,this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right,this.background=t.background||"none",this.padding=t.padding||"5px",this.border=t.border||"0px",this["border-radius"]=t["border-radius"]||"none",this["box-shadow"]=t["box-shadow"]||"none",this["font-family"]=t["font-family"]||"Helvetica, Arial, sans-serif",this.width=t.width,this.height=t.height,this.id&&(this.div=mt("#"+this.id)),this.div&&!this.div.empty()||(this.div=mt(document.createElement("div")),this.id&&this.div.attr("id",this.id)),this.div.style("background",this.background),this.div.style("padding",this.padding),this.div.style("border",this.border),this.div.style("border-radius",this["border-radius"]),this.div.style("box-shadow",this["box-shadow"]),this.div.style("font-family",this["font-family"]),this.width&&this.div.style("width",this.width),this.height&&this.div.style("height",this.height)}style(t,e){return this.div.style(t,e),this}update(t){console.error("Legend update not implemented yet.")}}function Ec(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]}var zc,Oc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function kc(t){if(!(e=Oc.exec(t)))throw new Error("invalid format: "+t);var e;return new Nc({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Nc(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Fc(t,e){var i=Ec(t,e);if(!i)return t+"";var n=i[0],s=i[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}kc.prototype=Nc.prototype,Nc.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Dc={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Fc(100*t,e),r:Fc,s:function(t,e){var i=Ec(t,e);if(!i)return t+"";var n=i[0],s=i[1],r=s-(zc=3*Math.max(-8,Math.min(8,Math.floor(s/3))))+1,o=n.length;return r===o?n:r>o?n+new Array(r-o+1).join("0"):r>0?n.slice(0,r)+"."+n.slice(r):"0."+new Array(1-r).join("0")+Ec(t,Math.max(0,e+r-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Rc(t){return t}var Uc,Zc,jc=Array.prototype.map,Vc=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Wc(t){return Uc=function(t){var e,i,n=void 0===t.grouping||void 0===t.thousands?Rc:(e=jc.call(t.grouping,Number),i=t.thousands+"",function(t,n){for(var s=t.length,r=[],o=0,a=e[0],h=0;s>0&&a>0&&(h+a+1>n&&(a=Math.max(1,n-h)),r.push(t.substring(s-=a,s+a)),!((h+=a+1)>n));)a=e[o=(o+1)%e.length];return r.reverse().join(i)}),s=void 0===t.currency?"":t.currency[0]+"",r=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",a=void 0===t.numerals?Rc:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(jc.call(t.numerals,String)),h=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function u(t){var e=(t=kc(t)).fill,i=t.align,u=t.sign,d=t.symbol,f=t.zero,p=t.width,m=t.comma,y=t.precision,_=t.trim,g=t.type;"n"===g?(m=!0,g="g"):Dc[g]||(void 0===y&&(y=12),_=!0,g="g"),(f||"0"===e&&"="===i)&&(f=!0,e="0",i="=");var v="$"===d?s:"#"===d&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",b="$"===d?r:/[%p]/.test(g)?h:"",x=Dc[g],w=/[defgprs%]/.test(g);function M(t){var s,r,h,d=v,M=b;if("c"===g)M=x(t)+M,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:x(Math.abs(t),y),_&&(t=function(t){t:for(var e,i=t.length,n=1,s=-1;n<i;++n)switch(t[n]){case".":s=e=n;break;case"0":0===s&&(s=n),e=n;break;default:if(!+t[n])break t;s>0&&(s=0)}return s>0?t.slice(0,s)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==u&&(S=!1),d=(S?"("===u?u:l:"-"===u||"("===u?"":u)+d,M=("s"===g?Vc[8+zc/3]:"")+M+(S&&"("===u?")":""),w)for(s=-1,r=t.length;++s<r;)if(48>(h=t.charCodeAt(s))||h>57){M=(46===h?o+t.slice(s+1):t.slice(s))+M,t=t.slice(0,s);break}}m&&!f&&(t=n(t,1/0));var T=d.length+t.length+M.length,I=T<p?new Array(p-T+1).join(e):"";switch(m&&f&&(t=n(I+t,I.length?p-M.length:1/0),I=""),i){case"<":t=d+t+M+I;break;case"=":t=d+I+t+M;break;case"^":t=I.slice(0,T=I.length>>1)+d+t+M+I.slice(T);break;default:t=I+d+t+M}return a(t)}return y=void 0===y?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),M.toString=function(){return t+""},M}return{format:u,formatPrefix:function(t,e){var i,n=u(((t=kc(t)).type="f",t)),s=3*Math.max(-8,Math.min(8,Math.floor((i=e,((i=Ec(Math.abs(i)))?i[1]:NaN)/3)))),r=Math.pow(10,-s),o=Vc[8+s/3];return function(t){return n(r*t)+o}}}}(t),Zc=Uc.format,Uc.formatPrefix,Uc}Wc({thousands:",",grouping:[3],currency:["$",""]});class Gc extends Bc{constructor(t){super(t),t=t||{},this.colorRamp=t.colorRamp,this.fun=t.fun,this.title=t.title,this.tickSize=t.tickSize||6,this.width=t.width||300,this.height=t.height||15,this.margin=t.margin||5,this.ticks=t.ticks||Math.floor(this.width/50),this.tickFormat=t.tickFormat||",.0f",this.tickUnit=t.tickUnit,this.fontSize=t.fontSize||"0.8em",this.invert=t.invert}update(t){if(!t.sColor)return;this.div.selectAll("*").remove();const e=this.width+2*this.margin,i=this.height+3*this.margin+12+this.tickSize+10,n=this.div.append("svg").attr("width",e).attr("height",i);n.append("text").attr("x",this.margin).attr("y",this.margin).style("font-size","0.8em").style("font-weight","bold").style("alignment-baseline","top").style("dominant-baseline","hanging").style("pointer-events","none").text(this.title);const s=n.append("g").attr("transform","translate("+this.margin+" "+(2*this.margin+12)+")"),r=this.width,o=this.height;for(let t=0;t<r;t+=5){let e=t/(r-1);this.invert&&(e=1-e),s.append("rect").attr("x",t).attr("y",0).attr("width",5).attr("height",o).style("fill",this.colorRamp(e))}for(let t=0;t<this.ticks;t++){let e=t/(this.ticks-1);s.append("line").attr("x1",r*e).attr("y1",0).attr("x2",r*e).attr("y2",o+this.tickSize).style("stroke","black"),s.append("text").attr("id","ticklabel_"+t).attr("x",r*e).attr("y",o+this.tickSize+2).style("font-size",this.fontSize).style("text-anchor",0==t?"start":t==this.ticks-1?"end":"middle").style("alignment-baseline","top").style("dominant-baseline","hanging").style("pointer-events","none")}const a=this.tickFormat&&"text"!=this.tickFormat?Zc(this.tickFormat):t=>t;for(let e=0;e<this.ticks;e++){let i=e/(this.ticks-1);const n=this.fun(i,t.r,t.sColor),s=(n?a(n):"0")+(this.tickUnit?this.tickUnit:"");this.div.select("#ticklabel_"+e).text(s)}}}class qc extends Bc{constructor(t){super(t),t=t||{},this.colors=t.colors,this.breaksText=t.breaksText,this.width=t.width||300,this.height=t.height||15,this.title=t.title,this.titleFontSize=t.titleFontSize||"0.8em",this.titleFontWeight=t.titleFontWeight||"bold",this.tickSize=t.tickSize||3,this.labelFontSize=t.labelFontSize||"0.8em",this.invert=t.invert}update(t){this.div.selectAll("*").remove(),this.title&&this.div.append("div").style("font-size",this.titleFontSize).style("font-weight",this.titleFontWeight).style("margin-bottom","7px").text(this.title);const e=this.colors.length;if(0==e)return;const i=this.width/e,n=this.div.append("svg").attr("width",this.width).attr("height",this.height+this.tickSize+2+10);for(let t=0;t<e;t++)n.append("rect").attr("x",t*i).attr("y",0).attr("width",i).attr("height",this.height).style("fill",this.colors[t]);for(let t=1;t<e;t++)n.append("line").attr("x1",i*t).attr("y1",0).attr("x2",i*t).attr("y2",this.height+this.tickSize).style("stroke","black");for(let t=1;t<e;t++)n.append("text").attr("id","ticklabel_"+t).attr("x",i*t).attr("y",this.height+this.tickSize+2).style("font-size",this.labelFontSize).style("text-anchor",0==t?"start":t==this.ticks-1?"end":"middle").style("alignment-baseline","top").style("dominant-baseline","hanging").style("pointer-events","none").text(this.breaksText[t-1])}}class Hc extends Bc{constructor(t){super(t),t=t||{},this.colCat=t.colCat||[["gray","-"]],this.shape=t.shape||"circle",this.dimension=t.dimension||{r:8},this.strokeColor=t.strokeColor||"gray",this.strokeWidth=t.strokeWidth||1,this.title=t.title,this.titleFontSize=t.titleFontSize||"0.8em",this.titleFontWeight=t.titleFontWeight||"bold",this.labelFontSize=t.labelFontSize||"0.8em"}update(t){this.div.selectAll("*").remove(),this.title&&this.div.append("div").style("font-size",this.titleFontSize).style("font-weight",this.titleFontWeight).style("margin-bottom","7px").text(this.title);const e=this.colCat.length;if(0!=e)for(let t=0;t<e;t++){const e=this.colCat[t],i=this.div.append("div"),n=this.strokeWidth;if("square"===this.shape){const t=this.dimension.h||15,s=this.dimension.w||20;i.append("div").style("display","inline").append("svg").attr("width",s+2*n).attr("height",t+2*n).append("rect").attr("x",n).attr("y",n).attr("width",s).attr("height",t).style("fill",e[0]).style("stroke",this.strokeColor).style("stroke-width",this.strokeWidth)}else{if("circle"!==this.shape)throw new Error("Unexpected shape:"+this.shape);{const t=this.dimension.r||8,s=2*t+2*n;i.append("div").style("display","inline").append("svg").attr("width",s).attr("height",s).append("circle").attr("cx",t+n).attr("cy",t+n).attr("r",t).style("fill",e[0]).style("stroke",this.strokeColor).style("stroke-width",this.strokeWidth)}}i.append("div").style("display","inline").style("padding-left","5px").style("font-size",this.labelFontSize).text(e[1])}}}class Yc extends Bc{constructor(t){super(t),t=t||{},this.exaggerationFactor=t.exaggerationFactor||.8,this.value=t.value||void 0,this.title=t.title,this.titleFontSize=t.titleFontSize||"0.8em",this.titleFontWeight=t.titleFontWeight||"bold",this.shape=t.shape||"circle",this.fillColor=t.fillColor||"none",this.strokeColor=t.strokeColor||"gray",this.strokeWidth=t.strokeWidth||1,this.labelFontSize=t.labelFontSize||"0.8em",this.labelUnitText=t.labelUnitText||"",this.labelFormat=t.labelFormat||",.2r"}update(t){if(!t.sSize)return;this.div.selectAll("*").remove();let e=this.value;if(null==e){const i=t.sSize.max*this.exaggerationFactor;let n=Math.log10(i);n=Math.floor(n),e=Math.pow(10,n),8*e<=i?e*=8:6*e<=i?e*=6:5*e<=i?e*=5:4*e<=i?e*=4:2.5*e<=i?e*=2.5:2*e<=i&&(e*=2)}if(!e)return;const i=this.div.append("div");this.title&&i.append("div").attr("class","title").style("font-size",this.titleFontSize).style("font-weight",this.titleFontWeight).text(this.title);const n=t.style.size(e,t.r,t.sSize,t.zf)/t.zf,s=i.append("svg").attr("width",n+this.strokeWidth+2).attr("height",n+this.strokeWidth+2).style("","inline-block");if("square"===this.shape)s.append("rect").attr("x",0).attr("y",0).attr("width",n).attr("height",n).style("fill",this.fillColor).style("stroke",this.strokeColor).style("stroke-width",this.strokeWidth);else if("circle"===this.shape){const t=.5*(n+this.strokeWidth);s.append("circle").attr("cx",t+1).attr("cy",t+1).attr("r",t).style("fill",this.fillColor).style("stroke",this.strokeColor).style("stroke-width",this.strokeWidth)}else if("donut"===this.shape);else if("diamond"!==this.shape)throw new Error("Unexpected shape:"+this.shape);const r=Zc(this.labelFormat)(e);i.append("div").style("display","inline").style("padding-left","5px").style("font-size",this.labelFontSize).text(r+(this.labelUnitText?" ":"")+this.labelUnitText)}}class $c extends Bc{constructor(t){super(t),t=t||{},this.title=t.title,this.titleFontSize=t.titleFontSize||"0.8em",this.titleFontWeight=t.titleFontWeight||"bold",this.exaggerationFactor=t.exaggerationFactor||.5,this.color=t.color||"gray",this.orientation=t.orientation||0,this.labelFontSize=t.labelFontSize||"0.8em",this.labelUnitText=t.labelUnitText||""}update(t){if(!t.sWidth)return;this.div.selectAll("*").remove();const e=this.div.append("div");this.title&&e.append("div").attr("class","title").style("font-size",this.titleFontSize).style("font-weight",this.titleFontWeight).text(this.title);const i=t.sWidth.max*this.exaggerationFactor;let n=Math.log10(i);n=Math.floor(n);let s=Math.pow(10,n);8*s<=i?s*=8:6*s<=i?s*=6:5*s<=i?s*=5:4*s<=i?s*=4:2.5*s<=i?s*=2.5:2*s<=i&&(s*=2);const r=t.style.width(s,t.r,t.sWidth,t.zf)/t.zf,o=1*t.r/t.zf;e.append("svg").attr("width",o).attr("height",r).style("","inline-block").append("line").attr("x1",0).attr("y1",r/2).attr("x2",o).attr("y2",r/2).style("stroke",this.color).style("stroke-width",r);const a=Zc(",.2r")(s);e.append("div").style("display","inline").style("padding-left","5px").style("font-size",this.labelFontSize).text(a+(this.labelUnitText?" ":"")+this.labelUnitText)}}class Xc extends Bc{constructor(t){super(t),t=t||{},this.title=t.title,this.titleFontSize=t.titleFontSize||"0.8em",this.titleFontWeight=t.titleFontWeight||"bold",this.exaggerationFactor=t.exaggerationFactor||.5,this.color=t.color||"gray",this.orientation=t.orientation||0,this.widthPix=t.widthPix||3,this.labelFontSize=t.labelFontSize||"0.8em",this.labelUnitText=t.labelUnitText||""}update(t){if(!t.sWidth)return;this.div.selectAll("*").remove();const e=this.div.append("div");this.title&&e.append("div").attr("class","title").style("font-size",this.titleFontSize).style("font-weight",this.titleFontWeight).text(this.title);const i=this.widthPix,n=1*t.r/t.zf,s=Math.max(n,i),r=e.append("svg").attr("width",s).attr("height",s).style("","inline-block"),o=Math.cos(-this.orientation*Math.PI/180),a=Math.sin(-this.orientation*Math.PI/180),h=.5*s,l=.5*n;r.append("line").attr("x1",h-o*l).attr("y1",h-a*l).attr("x2",h+o*l).attr("y2",h+a*l).style("stroke",this.color).style("stroke-width",i),e.append("div").style("display","inline").style("padding-left","5px").style("font-size",this.labelFontSize).text(this.labelUnitText)}}const Kc=(t,e=3)=>Math.pow(t,e),Jc=(t,e=3)=>1-Math.pow(1-t,1/e),Qc=(t,e=3)=>0==e?t:(Math.exp(t*e)-1)/(Math.exp(e)-1),tu=(t,e=3)=>0==e?t:1-1/e*Math.log(Math.exp(e)*(1-t)+t),eu=(t,e=.8)=>{if(0==e)return t;if(1==e)return Math.sqrt(t*(2-t));const i=e/(1-e);return Math.sqrt(1/(i*i)+t*(2/i+2-t))-1/i},iu=(t,e=.8)=>1-eu(1-t,e),nu=(t,e=3)=>0==e?t:1/e*Math.log(1-t+t*Math.exp(e)),su=(t,e=3)=>(Math.exp(-e*t)-1)/(Math.exp(-e)-1),ru=(t,e=3)=>Math.pow(t,1/e),ou=(t,e=3)=>1-Math.pow(1-t,e);var au=1e-6,hu=1e-12,lu=Math.PI,cu=lu/2,uu=lu/4,du=2*lu,fu=180/lu,pu=lu/180,mu=Math.abs,yu=Math.atan,_u=Math.atan2,gu=Math.cos,vu=(Math.ceil,Math.exp,Math.floor,Math.hypot,Math.log,Math.pow,Math.sin),bu=Math.sign||function(t){return t>0?1:t<0?-1:0},xu=Math.sqrt;function wu(t){return t>1?cu:t<-1?-cu:Math.asin(t)}function Mu(){}function Su(){var t,e=[];return{point:function(e,i,n){t.push([e,i,n])},lineStart:function(){e.push(t=[])},lineEnd:Mu,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var i=e;return e=[],t=null,i}}}function Tu(t,e){return mu(t[0]-e[0])<au&&mu(t[1]-e[1])<au}function Iu(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function Au(t,e,i,n,s){var r,o,a=[],h=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,i,n=t[0],o=t[e];if(Tu(n,o)){if(!n[2]&&!o[2]){for(s.lineStart(),r=0;r<e;++r)s.point((n=t[r])[0],n[1]);return void s.lineEnd()}o[0]+=2*au}a.push(i=new Iu(n,t,null,!0)),h.push(i.o=new Iu(n,null,i,!1)),a.push(i=new Iu(o,t,null,!1)),h.push(i.o=new Iu(o,null,i,!0))}})),a.length){for(h.sort(e),Cu(a),Cu(h),r=0,o=h.length;r<o;++r)h[r].e=i=!i;for(var l,c,u=a[0];;){for(var d=u,f=!0;d.v;)if((d=d.n)===u)return;l=d.z,s.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(r=0,o=l.length;r<o;++r)s.point((c=l[r])[0],c[1]);else n(d.x,d.n.x,1,s);d=d.n}else{if(f)for(l=d.p.z,r=l.length-1;r>=0;--r)s.point((c=l[r])[0],c[1]);else n(d.x,d.p.x,-1,s);d=d.p}l=(d=d.o).z,f=!f}while(!d.v);s.lineEnd()}}}function Cu(t){if(e=t.length){for(var e,i,n=0,s=t[0];++n<e;)s.n=i=t[n],i.p=s,s=i;s.n=i=t[0],i.p=s}}Math.tan;class Lu{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let i=0;for(let n=0;n<this._n&&n<32;n++){const s=e[n],r=t+s,o=Math.abs(t)<Math.abs(s)?t-(r-s):s-(r-t);o&&(e[i++]=o),t=r}return e[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let e,i,n,s=this._n,r=0;if(s>0){for(r=t[--s];s>0&&(e=r,i=t[--s],r=e+i,n=i-(r-e),!n););s>0&&(n<0&&t[s-1]<0||n>0&&t[s-1]>0)&&(i=2*n,e=r+i,i==e-r&&(r=e))}return r}}function Pu(t){return[_u(t[1],t[0]),wu(t[2])]}function Bu(t){var e=t[0],i=t[1],n=gu(i);return[n*gu(e),n*vu(e),vu(i)]}function Eu(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zu(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Ou(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function ku(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Nu(t){var e=xu(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Fu(t){return mu(t[0])<=lu?t[0]:bu(t[0])*((mu(t[0])+lu)%du-lu)}function Du(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}function Ru(t,e,i,n){return function(s){var r,o,a,h=e(s),l=Su(),c=e(l),u=!1,d={point:f,lineStart:m,lineEnd:y,polygonStart:function(){d.point=_,d.lineStart=g,d.lineEnd=v,o=[],r=[]},polygonEnd:function(){d.point=f,d.lineStart=m,d.lineEnd=y,o=Du(o);var t=function(t,e){var i=Fu(e),n=e[1],s=vu(n),r=[vu(i),-gu(i),0],o=0,a=0,h=new Lu;1===s?n=cu+au:-1===s&&(n=-cu-au);for(var l=0,c=t.length;l<c;++l)if(d=(u=t[l]).length)for(var u,d,f=u[d-1],p=Fu(f),m=f[1]/2+uu,y=vu(m),_=gu(m),g=0;g<d;++g,p=b,y=w,_=M,f=v){var v=u[g],b=Fu(v),x=v[1]/2+uu,w=vu(x),M=gu(x),S=b-p,T=S>=0?1:-1,I=T*S,A=I>lu,C=y*w;if(h.add(_u(C*T*vu(I),_*M+C*gu(I))),o+=A?S+T*du:S,A^p>=i^b>=i){var L=zu(Bu(f),Bu(v));Nu(L);var P=zu(r,L);Nu(P);var B=(A^S>=0?-1:1)*wu(P[2]);(n>B||n===B&&(L[0]||L[1]))&&(a+=A^S>=0?1:-1)}}return(o<-au||o<au&&h<-hu)^1&a}(r,n);o.length?(u||(s.polygonStart(),u=!0),Au(o,Zu,t,i,s)):t&&(u||(s.polygonStart(),u=!0),s.lineStart(),i(null,null,1,s),s.lineEnd()),u&&(s.polygonEnd(),u=!1),o=r=null},sphere:function(){s.polygonStart(),s.lineStart(),i(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function f(e,i){t(e,i)&&s.point(e,i)}function p(t,e){h.point(t,e)}function m(){d.point=p,h.lineStart()}function y(){d.point=f,h.lineEnd()}function _(t,e){a.push([t,e]),c.point(t,e)}function g(){c.lineStart(),a=[]}function v(){_(a[0][0],a[0][1]),c.lineEnd();var t,e,i,n,h=c.clean(),d=l.result(),f=d.length;if(a.pop(),r.push(a),a=null,f)if(1&h){if((e=(i=d[0]).length-1)>0){for(u||(s.polygonStart(),u=!0),s.lineStart(),t=0;t<e;++t)s.point((n=i[t])[0],n[1]);s.lineEnd()}}else f>1&&2&h&&d.push(d.pop().concat(d.shift())),o.push(d.filter(Uu))}return d}}function Uu(t){return t.length>1}function Zu(t,e){return((t=t.x)[0]<0?t[1]-cu-au:cu-t[1])-((e=e.x)[0]<0?e[1]-cu-au:cu-e[1])}const ju=Ru((function(){return!0}),(function(t){var e,i=NaN,n=NaN,s=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,o){var a=r>0?lu:-lu,h=mu(r-i);mu(h-lu)<au?(t.point(i,n=(n+o)/2>0?cu:-cu),t.point(s,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(r,n),e=0):s!==a&&h>=lu&&(mu(i-s)<au&&(i-=s*au),mu(r-a)<au&&(r-=a*au),n=function(t,e,i,n){var s,r,o=vu(t-i);return mu(o)>au?yu((vu(e)*(r=gu(n))*vu(i)-vu(n)*(s=gu(e))*vu(t))/(s*r*o)):(e+n)/2}(i,n,r,o),t.point(s,n),t.lineEnd(),t.lineStart(),t.point(a,n),e=0),t.point(i=r,n=o),s=a},lineEnd:function(){t.lineEnd(),i=n=NaN},clean:function(){return 2-e}}}),(function(t,e,i,n){var s;if(null==t)s=i*cu,n.point(-lu,s),n.point(0,s),n.point(lu,s),n.point(lu,0),n.point(lu,-s),n.point(0,-s),n.point(-lu,-s),n.point(-lu,0),n.point(-lu,s);else if(mu(t[0]-e[0])>au){var r=t[0]<e[0]?lu:-lu;s=i*r/2,n.point(-r,s),n.point(0,s),n.point(r,s)}else n.point(e[0],e[1])}),[-lu,-cu]);function Vu(t,e){(e=Bu(e))[0]-=t,Nu(e);var i,n=(i=-e[1])>1?0:i<-1?lu:Math.acos(i);return((-e[2]<0?-n:n)+du-au)%du}var Wu=1e9,Gu=-Wu;function qu(t,e){function i(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(i.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),i}const Hu=t=>t;function Yu(t,e){return mu(t)>lu&&(t-=Math.round(t/du)*du),[t,e]}function $u(t){return function(e,i){return mu(e+=t)>lu&&(e-=Math.round(e/du)*du),[e,i]}}function Xu(t){var e=$u(t);return e.invert=$u(-t),e}function Ku(t,e){var i=gu(t),n=vu(t),s=gu(e),r=vu(e);function o(t,e){var o=gu(e),a=gu(t)*o,h=vu(t)*o,l=vu(e),c=l*i+a*n;return[_u(h*s-c*r,a*i-l*n),wu(c*s+h*r)]}return o.invert=function(t,e){var o=gu(e),a=gu(t)*o,h=vu(t)*o,l=vu(e),c=l*s-h*r;return[_u(h*s+l*r,a*i+c*n),wu(c*i-a*n)]},o}function Ju(t){return function(e){var i=new Qu;for(var n in t)i[n]=t[n];return i.stream=e,i}}function Qu(){}function td(t,e){t&&id.hasOwnProperty(t.type)&&id[t.type](t,e)}Yu.invert=Yu,Qu.prototype={constructor:Qu,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var ed={Feature:function(t,e){td(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,s=i.length;++n<s;)td(i[n].geometry,e)}},id={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){nd(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)nd(i[n],e,0)},Polygon:function(t,e){sd(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)sd(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,s=i.length;++n<s;)td(i[n],e)}};function nd(t,e,i){var n,s=-1,r=t.length-i;for(e.lineStart();++s<r;)n=t[s],e.point(n[0],n[1],n[2]);e.lineEnd()}function sd(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)nd(t[i],e,1);e.polygonEnd()}var rd=1/0,od=rd,ad=-rd,hd=ad,ld={point:function(t,e){t<rd&&(rd=t),t>ad&&(ad=t),e<od&&(od=e),e>hd&&(hd=e)},lineStart:Mu,lineEnd:Mu,polygonStart:Mu,polygonEnd:Mu,result:function(){var t=[[rd,od],[ad,hd]];return ad=hd=-(od=rd=1/0),t}};const cd=ld;function ud(t,e,i){var n=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=n&&t.clipExtent(null),function(t,e){t&&ed.hasOwnProperty(t.type)?ed[t.type](t,e):td(t,e)}(i,t.stream(cd)),e(cd.result()),null!=n&&t.clipExtent(n),t}function dd(t,e,i){return ud(t,(function(i){var n=e[1][0]-e[0][0],s=e[1][1]-e[0][1],r=Math.min(n/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),o=+e[0][0]+(n-r*(i[1][0]+i[0][0]))/2,a=+e[0][1]+(s-r*(i[1][1]+i[0][1]))/2;t.scale(150*r).translate([o,a])}),i)}var fd=16,pd=gu(30*pu);function md(t,e){return+e?function(t,e){function i(n,s,r,o,a,h,l,c,u,d,f,p,m,y){var _=l-n,g=c-s,v=_*_+g*g;if(v>4*e&&m--){var b=o+d,x=a+f,w=h+p,M=xu(b*b+x*x+w*w),S=wu(w/=M),T=mu(mu(w)-1)<au||mu(r-u)<au?(r+u)/2:_u(x,b),I=t(T,S),A=I[0],C=I[1],L=A-n,P=C-s,B=g*L-_*P;(B*B/v>e||mu((_*L+g*P)/v-.5)>.3||o*d+a*f+h*p<pd)&&(i(n,s,r,o,a,h,A,C,T,b/=M,x/=M,w,m,y),y.point(A,C),i(A,C,T,b,x,w,l,c,u,d,f,p,m,y))}}return function(e){var n,s,r,o,a,h,l,c,u,d,f,p,m={point:y,lineStart:_,lineEnd:v,polygonStart:function(){e.polygonStart(),m.lineStart=b},polygonEnd:function(){e.polygonEnd(),m.lineStart=_}};function y(i,n){i=t(i,n),e.point(i[0],i[1])}function _(){c=NaN,m.point=g,e.lineStart()}function g(n,s){var r=Bu([n,s]),o=t(n,s);i(c,u,l,d,f,p,c=o[0],u=o[1],l=n,d=r[0],f=r[1],p=r[2],fd,e),e.point(c,u)}function v(){m.point=y,e.lineEnd()}function b(){_(),m.point=x,m.lineEnd=w}function x(t,e){g(n=t,e),s=c,r=u,o=d,a=f,h=p,m.point=g}function w(){i(c,u,l,d,f,p,s,r,n,o,a,h,fd,e),m.lineEnd=v,v()}return m}}(t,e):function(t){return Ju({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}(t)}var yd=Ju({point:function(t,e){this.stream.point(t*pu,e*pu)}});function _d(t,e,i,n,s,r){if(!r)return function(t,e,i,n,s){function r(r,o){return[e+t*(r*=n),i-t*(o*=s)]}return r.invert=function(r,o){return[(r-e)/t*n,(i-o)/t*s]},r}(t,e,i,n,s);var o=gu(r),a=vu(r),h=o*t,l=a*t,c=o/t,u=a/t,d=(a*i-o*e)/t,f=(a*e+o*i)/t;function p(t,r){return[h*(t*=n)-l*(r*=s)+e,i-l*t-h*r]}return p.invert=function(t,e){return[n*(c*t-u*e+d),s*(f-u*t-c*e)]},p}function gd(t){return function(t){var e,i,n,s,r,o,a,h,l,c,u=150,d=480,f=250,p=0,m=0,y=0,_=0,g=0,v=0,b=1,x=1,w=null,M=ju,S=null,T=Hu,I=.5;function A(t){return h(t[0]*pu,t[1]*pu)}function C(t){return(t=h.invert(t[0],t[1]))&&[t[0]*fu,t[1]*fu]}function L(){var t=_d(u,0,0,b,x,v).apply(null,e(p,m)),n=_d(u,d-t[0],f-t[1],b,x,v);return i=function(t,e,i){return(t%=du)?e||i?qu(Xu(t),Ku(e,i)):Xu(t):e||i?Ku(e,i):Yu}(y,_,g),a=qu(e,n),h=qu(i,a),o=md(a,I),P()}function P(){return l=c=null,A}return A.stream=function(t){return l&&c===t?l:l=yd(function(t){return Ju({point:function(e,i){var n=t(e,i);return this.stream.point(n[0],n[1])}})}(i)(M(o(T(c=t)))))},A.preclip=function(t){return arguments.length?(M=t,w=void 0,P()):M},A.postclip=function(t){return arguments.length?(T=t,S=n=s=r=null,P()):T},A.clipAngle=function(t){return arguments.length?(M=+t?function(t){var e=gu(t),i=6*pu,n=e>0,s=mu(e)>au;function r(t,i){return gu(t)*gu(i)>e}function o(t,i,n){var s=[1,0,0],r=zu(Bu(t),Bu(i)),o=Eu(r,r),a=r[0],h=o-a*a;if(!h)return!n&&t;var l=e*o/h,c=-e*a/h,u=zu(s,r),d=ku(s,l);Ou(d,ku(r,c));var f=u,p=Eu(d,f),m=Eu(f,f),y=p*p-m*(Eu(d,d)-1);if(!(y<0)){var _=xu(y),g=ku(f,(-p-_)/m);if(Ou(g,d),g=Pu(g),!n)return g;var v,b=t[0],x=i[0],w=t[1],M=i[1];x<b&&(v=b,b=x,x=v);var S=x-b,T=mu(S-lu)<au;if(!T&&M<w&&(v=w,w=M,M=v),T||S<au?T?w+M>0^g[1]<(mu(g[0]-b)<au?w:M):w<=g[1]&&g[1]<=M:S>lu^(b<=g[0]&&g[0]<=x)){var I=ku(f,(-p+_)/m);return Ou(I,d),[g,Pu(I)]}}}function a(e,i){var s=n?t:lu-t,r=0;return e<-s?r|=1:e>s&&(r|=2),i<-s?r|=4:i>s&&(r|=8),r}return Ru(r,(function(t){var e,i,h,l,c;return{lineStart:function(){l=h=!1,c=1},point:function(u,d){var f,p=[u,d],m=r(u,d),y=n?m?0:a(u,d):m?a(u+(u<0?lu:-lu),d):0;if(!e&&(l=h=m)&&t.lineStart(),m!==h&&(!(f=o(e,p))||Tu(e,f)||Tu(p,f))&&(p[2]=1),m!==h)c=0,m?(t.lineStart(),f=o(p,e),t.point(f[0],f[1])):(f=o(e,p),t.point(f[0],f[1],2),t.lineEnd()),e=f;else if(s&&e&&n^m){var _;y&i||!(_=o(p,e,!0))||(c=0,n?(t.lineStart(),t.point(_[0][0],_[0][1]),t.point(_[1][0],_[1][1]),t.lineEnd()):(t.point(_[1][0],_[1][1]),t.lineEnd(),t.lineStart(),t.point(_[0][0],_[0][1],3)))}!m||e&&Tu(e,p)||t.point(p[0],p[1]),e=p,h=m,i=y},lineEnd:function(){h&&t.lineEnd(),e=null},clean:function(){return c|(l&&h)<<1}}}),(function(e,n,s,r){!function(t,e,i,n,s,r){if(i){var o=gu(e),a=vu(e),h=n*i;null==s?(s=e+n*du,r=e-h/2):(s=Vu(o,s),r=Vu(o,r),(n>0?s<r:s>r)&&(s+=n*du));for(var l,c=s;n>0?c>r:c<r;c-=h)l=Pu([o,-a*gu(c),-a*vu(c)]),t.point(l[0],l[1])}}(r,t,i,s,e,n)}),n?[0,-t]:[-lu,t-lu])}(w=t*pu):(w=null,ju),P()):w*fu},A.clipExtent=function(t){return arguments.length?(T=null==t?(S=n=s=r=null,Hu):function(t,e,i,n){function s(s,r){return t<=s&&s<=i&&e<=r&&r<=n}function r(s,r,a,l){var c=0,u=0;if(null==s||(c=o(s,a))!==(u=o(r,a))||h(s,r)<0^a>0)do{l.point(0===c||3===c?t:i,c>1?n:e)}while((c=(c+a+4)%4)!==u);else l.point(r[0],r[1])}function o(n,s){return mu(n[0]-t)<au?s>0?0:3:mu(n[0]-i)<au?s>0?2:1:mu(n[1]-e)<au?s>0?1:0:s>0?3:2}function a(t,e){return h(t.x,e.x)}function h(t,e){var i=o(t,1),n=o(e,1);return i!==n?i-n:0===i?e[1]-t[1]:1===i?t[0]-e[0]:2===i?t[1]-e[1]:e[0]-t[0]}return function(o){var h,l,c,u,d,f,p,m,y,_,g,v=o,b=Su(),x={point:w,lineStart:function(){x.point=M,l&&l.push(c=[]),_=!0,y=!1,p=m=NaN},lineEnd:function(){h&&(M(u,d),f&&y&&b.rejoin(),h.push(b.result())),x.point=w,y&&v.lineEnd()},polygonStart:function(){v=b,h=[],l=[],g=!0},polygonEnd:function(){var e=function(){for(var e=0,i=0,s=l.length;i<s;++i)for(var r,o,a=l[i],h=1,c=a.length,u=a[0],d=u[0],f=u[1];h<c;++h)r=d,o=f,d=(u=a[h])[0],f=u[1],o<=n?f>n&&(d-r)*(n-o)>(f-o)*(t-r)&&++e:f<=n&&(d-r)*(n-o)<(f-o)*(t-r)&&--e;return e}(),i=g&&e,s=(h=Du(h)).length;(i||s)&&(o.polygonStart(),i&&(o.lineStart(),r(null,null,1,o),o.lineEnd()),s&&Au(h,a,e,r,o),o.polygonEnd()),v=o,h=l=c=null}};function w(t,e){s(t,e)&&v.point(t,e)}function M(r,o){var a=s(r,o);if(l&&c.push([r,o]),_)u=r,d=o,f=a,_=!1,a&&(v.lineStart(),v.point(r,o));else if(a&&y)v.point(r,o);else{var h=[p=Math.max(Gu,Math.min(Wu,p)),m=Math.max(Gu,Math.min(Wu,m))],b=[r=Math.max(Gu,Math.min(Wu,r)),o=Math.max(Gu,Math.min(Wu,o))];!function(t,e,i,n,s,r){var o,a=t[0],h=t[1],l=0,c=1,u=e[0]-a,d=e[1]-h;if(o=i-a,u||!(o>0)){if(o/=u,u<0){if(o<l)return;o<c&&(c=o)}else if(u>0){if(o>c)return;o>l&&(l=o)}if(o=s-a,u||!(o<0)){if(o/=u,u<0){if(o>c)return;o>l&&(l=o)}else if(u>0){if(o<l)return;o<c&&(c=o)}if(o=n-h,d||!(o>0)){if(o/=d,d<0){if(o<l)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>l&&(l=o)}if(o=r-h,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>l&&(l=o)}else if(d>0){if(o<l)return;o<c&&(c=o)}return l>0&&(t[0]=a+l*u,t[1]=h+l*d),c<1&&(e[0]=a+c*u,e[1]=h+c*d),!0}}}}}(h,b,t,e,i,n)?a&&(v.lineStart(),v.point(r,o),g=!1):(y||(v.lineStart(),v.point(h[0],h[1])),v.point(b[0],b[1]),a||v.lineEnd(),g=!1)}p=r,m=o,y=a}return x}}(S=+t[0][0],n=+t[0][1],s=+t[1][0],r=+t[1][1]),P()):null==S?null:[[S,n],[s,r]]},A.scale=function(t){return arguments.length?(u=+t,L()):u},A.translate=function(t){return arguments.length?(d=+t[0],f=+t[1],L()):[d,f]},A.center=function(t){return arguments.length?(p=t[0]%360*pu,m=t[1]%360*pu,L()):[p*fu,m*fu]},A.rotate=function(t){return arguments.length?(y=t[0]%360*pu,_=t[1]%360*pu,g=t.length>2?t[2]%360*pu:0,L()):[y*fu,_*fu,g*fu]},A.angle=function(t){return arguments.length?(v=t%360*pu,L()):v*fu},A.reflectX=function(t){return arguments.length?(b=t?-1:1,L()):b<0},A.reflectY=function(t){return arguments.length?(x=t?-1:1,L()):x<0},A.precision=function(t){return arguments.length?(o=md(a,I=t*t),P()):xu(I)},A.fitExtent=function(t,e){return dd(A,t,e)},A.fitSize=function(t,e){return function(t,e,i){return dd(t,[[0,0],e],i)}(A,t,e)},A.fitWidth=function(t,e){return function(t,e,i){return ud(t,(function(i){var n=+e,s=n/(i[1][0]-i[0][0]),r=(n-s*(i[1][0]+i[0][0]))/2,o=-s*i[0][1];t.scale(150*s).translate([r,o])}),i)}(A,t,e)},A.fitHeight=function(t,e){return function(t,e,i){return ud(t,(function(i){var n=+e,s=n/(i[1][1]-i[0][1]),r=-s*i[0][0],o=(n-s*(i[1][1]+i[0][1]))/2;t.scale(150*s).translate([r,o])}),i)}(A,t,e)},function(){return e=t.apply(this,arguments),A.invert=e.invert&&C,L()}}((function(){return t}))()}var vd,bd,xd=(vd=function(t){return xu(2/(1+t))},function(t,e){var i=gu(t),n=gu(e),s=vd(i*n);return s===1/0?[2,0]:[s*n*vu(t),s*vu(e)]});xd.invert=(bd=function(t){return 2*wu(t/2)},function(t,e){var i=xu(t*t+e*e),n=bd(i),s=vu(n),r=gu(n);return[_u(t*s,i*r),wu(i&&e*s/i)]});const wd=function(t="EUR",e=50,i){const n=(i=i||{}).ex||1.2,s=i.fontFamily||"Arial",r=i.exSize||1;return i.style=i.style||((t,e)=>{if(!(t.rs<n*e))return t.r1<n*e?r+"em "+s:1.5*r+"em "+s}),i.proj=i.proj||gd(xd).scale(124.75).clipAngle(179.999).rotate([-10,-52]).reflectX(!1).reflectY(!0).scale(6378137).translate([4321e3,321e4]),i.preprocess=t=>{if(i.ccIn&&t.cc&&!(i.ccIn.indexOf(t.cc)>=0))return!1;const e=i.proj([t.lon,t.lat]);t.x=e[0],t.y=e[1],delete t.lon,delete t.lat},i.baseURL=i.baseURL||"https://raw.githubusercontent.com/eurostat/euronym/main/pub/v2/UTF/",i.url=i.baseURL+e+"/"+t+".csv",i},Md=function(t){const e=(t=t||{}).nutsYear||"2021",i=t.crs||"3035",n=t.scale||"03M",s=t.nutsLevel||"3",r=t.col||"#888",o=t.colKosovo||"#bcbcbc",a=null==t.showOth||t.showOth;return t.color=t.color||((t,e)=>{const i=t.properties;if(a||"T"==i.eu||"T"==i.cc||"T"==i.efta||"T"!==i.oth)return i.id>=1e5?o:"T"===i.co||e<400?r:e<1e3?i.lvl>=3?"":r:e<2e3?i.lvl>=2?"":r:i.lvl>=1?"":r}),t.width=t.width||((t,e)=>{const i=t.properties;return"T"===i.co?.5:e<400?3==i.lvl||2==i.lvl||1==i.lvl?2.2:4:e<1e3?2==i.lvl||1==i.lvl?1.8:2.5:e<2e3?1==i.lvl?1.8:2.5:1.2}),t.lineDash=t.lineDash||((t,e)=>{const i=t.properties;return"T"===i.co?[]:e<400?3==i.lvl?[2*e,2*e]:2==i.lvl||1==i.lvl?[5*e,2*e]:[10*e,3*e]:e<1e3?2==i.lvl||1==i.lvl?[5*e,2*e]:[10*e,3*e]:e<2e3&&1==i.lvl?[5*e,2*e]:[10*e,3*e]}),t.baseURL=t.baseURL||"https://raw.githubusercontent.com/eurostat/Nuts2json/master/pub/v2/",t.url=t.baseURL+e+"/"+i+"/"+n+"/nutsbn_"+s+".json",t},Sd=Ni.getParameterByName;Wc({decimal:".",thousands:" ",grouping:[3],currency:["",""]});var Td=i(616),Id=1,Ad=2,Cd=3,Ld=5,Pd=6378137,Bd=6356752.314,Ed=.0066943799901413165,zd=484813681109536e-20,Od=Math.PI/2,kd=1e-10,Nd=.017453292519943295,Fd=57.29577951308232,Dd=Math.PI/4,Rd=2*Math.PI,Ud=3.14159265359,Zd={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const jd={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Vd=/[\s_\-\/\(\)]/g;function Wd(t,e){if(t[e])return t[e];for(var i,n=Object.keys(t),s=e.toLowerCase().replace(Vd,""),r=-1;++r<n.length;)if((i=n[r]).toLowerCase().replace(Vd,"")===s)return t[i]}function Gd(t){var e,i,n,s={},r=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t}),{}),o={proj:"projName",datum:"datumCode",rf:function(t){s.rf=parseFloat(t)},lat_0:function(t){s.lat0=t*Nd},lat_1:function(t){s.lat1=t*Nd},lat_2:function(t){s.lat2=t*Nd},lat_ts:function(t){s.lat_ts=t*Nd},lon_0:function(t){s.long0=t*Nd},lon_1:function(t){s.long1=t*Nd},lon_2:function(t){s.long2=t*Nd},alpha:function(t){s.alpha=parseFloat(t)*Nd},gamma:function(t){s.rectified_grid_angle=parseFloat(t)},lonc:function(t){s.longc=t*Nd},x_0:function(t){s.x0=parseFloat(t)},y_0:function(t){s.y0=parseFloat(t)},k_0:function(t){s.k0=parseFloat(t)},k:function(t){s.k0=parseFloat(t)},a:function(t){s.a=parseFloat(t)},b:function(t){s.b=parseFloat(t)},r_a:function(){s.R_A=!0},zone:function(t){s.zone=parseInt(t,10)},south:function(){s.utmSouth=!0},towgs84:function(t){s.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){s.to_meter=parseFloat(t)},units:function(t){s.units=t;var e=Wd(jd,t);e&&(s.to_meter=e.to_meter)},from_greenwich:function(t){s.from_greenwich=t*Nd},pm:function(t){var e=Wd(Zd,t);s.from_greenwich=(e||parseFloat(t))*Nd},nadgrids:function(t){"@null"===t?s.datumCode="none":s.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(s.axis=t)},approx:function(){s.approx=!0}};for(e in r)i=r[e],e in o?"function"==typeof(n=o[e])?n(i):s[n]=i:s[e]=i;return"string"==typeof s.datumCode&&"WGS84"!==s.datumCode&&(s.datumCode=s.datumCode.toLowerCase()),s}const qd=function(t){return new Qd(t).output()};var Hd=1,Yd=/\s/,$d=/[A-Za-z]/,Xd=/[A-Za-z84_]/,Kd=/[,\]]/,Jd=/[\d\.E\-\+]/;function Qd(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Hd}function tf(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var n=e?{}:t,s=i.reduce((function(t,e){return ef(e,t),t}),n);e&&(t[e]=s)}function ef(t,e){if(Array.isArray(t)){var i=t.shift();if("PARAMETER"===i&&(i=t.shift()),1===t.length)return Array.isArray(t[0])?(e[i]={},void ef(t[0],e[i])):void(e[i]=t[0]);if(t.length)if("TOWGS84"!==i){if("AXIS"===i)return i in e||(e[i]=[]),void e[i].push(t);var n;switch(Array.isArray(i)||(e[i]={}),i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[i]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&ef(t[2],e[i]));case"SPHEROID":case"ELLIPSOID":return e[i]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&ef(t[3],e[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void tf(e,i,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return ef(t,e[i]);return tf(e,i,t)}}else e[i]=t;else e[i]=!0}else e[t]=!0}Qd.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Yd.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Hd:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},Qd.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(Kd.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},Qd.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Hd)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Hd,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Qd.prototype.number=function(t){if(!Jd.test(t)){if(Kd.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},Qd.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},Qd.prototype.keyword=function(t){if(Xd.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Hd)}if(!Kd.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},Qd.prototype.neutral=function(t){if($d.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Jd.test(t))return this.word=t,void(this.state=3);if(!Kd.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},Qd.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var nf=.017453292519943295;function sf(t){return t*nf}function rf(t){var e=qd(t),i=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",i]);var s={};return ef(e,s),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,n=t.AXIS.length;i<n;++i){var s=[t.AXIS[i][0].toLowerCase(),t.AXIS[i][1].toLowerCase()];-1!==s[0].indexOf("north")||("y"===s[0]||"lat"===s[0])&&"north"===s[1]?e+="n":-1!==s[0].indexOf("south")||("y"===s[0]||"lat"===s[0])&&"south"===s[1]?e+="s":-1!==s[0].indexOf("east")||("x"===s[0]||"lon"===s[0])&&"east"===s[1]?e+="e":-1===s[0].indexOf("west")&&("x"!==s[0]&&"lon"!==s[0]||"west"!==s[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var r=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(r=t),r&&(r.DATUM?t.datumCode=r.DATUM.name.toLowerCase():t.datumCode=r.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(t.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=r.DATUM.SPHEROID.a,t.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(t.datum_params=r.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",sf],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",sf],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",sf],["lat0","latitude_of_origin",sf],["lat0","standard_parallel_1",sf],["lat1","standard_parallel_1",sf],["lat2","standard_parallel_2",sf],["azimuth","Azimuth"],["alpha","azimuth",sf],["srsCode","name"]].forEach((function(e){return function(t,e){var i=e[0],n=e[1];!(i in t)&&n in t&&(t[i]=t[n],3===e.length&&(t[i]=e[2](t[i])))}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=sf(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(s),s}function of(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?of[t]=Gd(arguments[1]):of[t]=rf(arguments[1]):of[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?of.apply(e,t):of(t)}));if("string"==typeof t){if(t in of)return of[t]}else"EPSG"in t?of["EPSG:"+t.EPSG]=t:"ESRI"in t?of["ESRI:"+t.ESRI]=t:"IAU2000"in t?of["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(of);const af=of;var hf=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],lf=["3857","900913","3785","102113"];function cf(t,e){var i,n;if(t=t||{},!e)return t;for(n in e)void 0!==(i=e[n])&&(t[n]=i);return t}function uf(t,e,i){var n=t*e;return i/Math.sqrt(1-n*n)}function df(t){return t<0?-1:1}function ff(t){return Math.abs(t)<=Ud?t:t-df(t)*Rd}function pf(t,e,i){var n=t*i,s=.5*t;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(Od-e))/n}function mf(t,e){for(var i,n,s=.5*t,r=Od-2*Math.atan(e),o=0;o<=15;o++)if(i=t*Math.sin(r),r+=n=Od-2*Math.atan(e*Math.pow((1-i)/(1+i),s))-r,Math.abs(n)<=1e-10)return r;return-9999}function yf(t){return t}var _f=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=uf(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,n=t.x,s=t.y;if(s*Fd>90&&s*Fd<-90&&n*Fd>180&&n*Fd<-180)return null;if(Math.abs(Math.abs(s)-Od)<=kd)return null;if(this.sphere)e=this.x0+this.a*this.k0*ff(n-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(Dd+.5*s));else{var r=Math.sin(s),o=pf(this.e,s,r);e=this.x0+this.a*this.k0*ff(n-this.long0),i=this.y0-this.a*this.k0*Math.log(o)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n=t.x-this.x0,s=t.y-this.y0;if(this.sphere)i=Od-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var r=Math.exp(-s/(this.a*this.k0));if(-9999===(i=mf(this.e,r)))return null}return e=ff(this.long0+n/(this.a*this.k0)),t.x=e,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:yf,inverse:yf,names:["longlat","identity"]}],gf={},vf=[];function bf(t,e){var i=vf.length;return t.names?(vf[i]=t,t.names.forEach((function(t){gf[t.toLowerCase()]=i})),this):(console.log(e),!0)}const xf={start:function(){_f.forEach(bf)},add:bf,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==gf[e]&&vf[gf[e]]?vf[gf[e]]:void 0}};var wf={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Mf=wf.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};wf.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Sf={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};var Tf={};function If(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:Tf[t]||null,isNull:!1}}function Af(t){return t/3600*Math.PI/180}function Cf(t,e,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,i)))}function Lf(t){return t.map((function(t){return[Af(t.longitudeShift),Af(t.latitudeShift)]}))}function Pf(t,e,i){return{name:Cf(t,e+8,e+16).trim(),parent:Cf(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,i),upperLatitude:t.getFloat64(e+88,i),lowerLongitude:t.getFloat64(e+104,i),upperLongitude:t.getFloat64(e+120,i),latitudeInterval:t.getFloat64(e+136,i),longitudeInterval:t.getFloat64(e+152,i),gridNodeCount:t.getInt32(e+168,i)}}function Bf(t,e,i,n){for(var s=e+176,r=[],o=0;o<i.gridNodeCount;o++){var a={latitudeShift:t.getFloat32(s+16*o,n),longitudeShift:t.getFloat32(s+16*o+4,n),latitudeAccuracy:t.getFloat32(s+16*o+8,n),longitudeAccuracy:t.getFloat32(s+16*o+12,n)};r.push(a)}return r}function Ef(t,e){if(!(this instanceof Ef))return new Ef(t);e=e||function(t){if(t)throw t};var i=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in af}(t))return af[t];if(function(t){return hf.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=rf(t);if(function(t){var e=Wd(t,"authority");if(e){var i=Wd(e,"epsg");return i&&lf.indexOf(i)>-1}}(e))return af["EPSG:3857"];var i=function(t){var e=Wd(t,"extension");if(e)return Wd(e,"proj4")}(e);return i?Gd(i):e}return function(t){return"+"===t[0]}(t)?Gd(t):void 0}(t);if("object"==typeof i){var n=Ef.projections.get(i.projName);if(n){if(i.datumCode&&"none"!==i.datumCode){var s=Wd(Sf,i.datumCode);s&&(i.datum_params=i.datum_params||(s.towgs84?s.towgs84.split(","):null),i.ellps=s.ellipse,i.datumName=s.datumName?s.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var r,o,a,h,l,c,u=function(t,e,i,n,s){if(!t){var r=Wd(wf,n);r||(r=Mf),t=r.a,e=r.b,i=r.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<kd)&&(s=!0,e=t),{a:t,b:e,rf:i,sphere:s}}(i.a,i.b,i.rf,i.ellps,i.sphere),d=(r=u.a,o=u.b,u.rf,l=((a=r*r)-(h=o*o))/a,c=0,i.R_A?(a=(r*=1-l*(.16666666666666666+l*(.04722222222222222+.022156084656084655*l)))*r,l=0):c=Math.sqrt(l),{es:l,e:c,ep2:(a-h)/h}),f=function(t){return void 0===t?null:t.split(",").map(If)}(i.nadgrids),p=i.datum||function(t,e,i,n,s,r,o){var a={};return a.datum_type=void 0===t||"none"===t?Ld:4,e&&(a.datum_params=e.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=Id),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=Ad,a.datum_params[3]*=zd,a.datum_params[4]*=zd,a.datum_params[5]*=zd,a.datum_params[6]=a.datum_params[6]/1e6+1))),o&&(a.datum_type=Cd,a.grids=o),a.a=i,a.b=n,a.es=s,a.ep2=r,a}(i.datumCode,i.datum_params,u.a,u.b,d.es,d.ep2,f);cf(this,i),cf(this,n),this.a=u.a,this.b=u.b,this.rf=u.rf,this.sphere=u.sphere,this.es=d.es,this.e=d.e,this.ep2=d.ep2,this.datum=p,this.init(),e(null,this)}else e(t)}else e(t)}Ef.projections=xf,Ef.projections.start();const zf=Ef;function Of(t,e,i){var n,s,r,o,a=t.x,h=t.y,l=t.z?t.z:0;if(h<-Od&&h>-1.001*Od)h=-Od;else if(h>Od&&h<1.001*Od)h=Od;else{if(h<-Od)return{x:-1/0,y:-1/0,z:t.z};if(h>Od)return{x:1/0,y:1/0,z:t.z}}return a>Math.PI&&(a-=2*Math.PI),s=Math.sin(h),o=Math.cos(h),r=s*s,{x:((n=i/Math.sqrt(1-e*r))+l)*o*Math.cos(a),y:(n+l)*o*Math.sin(a),z:(n*(1-e)+l)*s}}function kf(t,e,i,n){var s,r,o,a,h,l,c,u,d,f,p,m,y,_,g,v=t.x,b=t.y,x=t.z?t.z:0;if(s=Math.sqrt(v*v+b*b),r=Math.sqrt(v*v+b*b+x*x),s/i<1e-12){if(_=0,r/i<1e-12)return g=-n,{x:t.x,y:t.y,z:t.z}}else _=Math.atan2(b,v);o=x/r,u=(a=s/r)*(1-e)*(h=1/Math.sqrt(1-e*(2-e)*a*a)),d=o*h,y=0;do{y++,l=e*(c=i/Math.sqrt(1-e*d*d))/(c+(g=s*u+x*d-c*(1-e*d*d))),m=(p=o*(h=1/Math.sqrt(1-l*(2-l)*a*a)))*u-(f=a*(1-l)*h)*d,u=f,d=p}while(m*m>1e-24&&y<30);return{x:_,y:Math.atan(p/Math.abs(f)),z:g}}function Nf(t){return t===Id||t===Ad}function Ff(t,e,i){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var n={x:-i.x,y:i.y},s={x:Number.NaN,y:Number.NaN},r=[],o=0;o<t.grids.length;o++){var a=t.grids[o];if(r.push(a.name),a.isNull){s=n;break}if(a.mandatory,null!==a.grid){var h=a.grid.subgrids[0],l=(Math.abs(h.del[1])+Math.abs(h.del[0]))/1e4,c=h.ll[0]-l,u=h.ll[1]-l,d=h.ll[0]+(h.lim[0]-1)*h.del[0]+l,f=h.ll[1]+(h.lim[1]-1)*h.del[1]+l;if(!(u>n.y||c>n.x||f<n.y||d<n.x||(s=Df(n,e,h),isNaN(s.x))))break}else if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*Fd+" "+n.y*Fd+" tried: '"+r+"'"),-1):(i.x=-s.x,i.y=s.y,0)}function Df(t,e,i){var n={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return n;var s={x:t.x,y:t.y};s.x-=i.ll[0],s.y-=i.ll[1],s.x=ff(s.x-Math.PI)+Math.PI;var r=Rf(s,i);if(e){if(isNaN(r.x))return n;r.x=s.x-r.x,r.y=s.y-r.y;var o,a,h=9;do{if(a=Rf(r,i),isNaN(a.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}o={x:s.x-(a.x+r.x),y:s.y-(a.y+r.y)},r.x+=o.x,r.y+=o.y}while(h--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(h<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=ff(r.x+i.ll[0]),n.y=r.y+i.ll[1]}else isNaN(r.x)||(n.x=t.x+r.x,n.y=t.y+r.y);return n}function Rf(t,e){var i,n={x:t.x/e.del[0],y:t.y/e.del[1]},s=Math.floor(n.x),r=Math.floor(n.y),o=n.x-1*s,a=n.y-1*r,h={x:Number.NaN,y:Number.NaN};if(s<0||s>=e.lim[0])return h;if(r<0||r>=e.lim[1])return h;i=r*e.lim[0]+s;var l=e.cvs[i][0],c=e.cvs[i][1];i++;var u=e.cvs[i][0],d=e.cvs[i][1];i+=e.lim[0];var f=e.cvs[i][0],p=e.cvs[i][1];i--;var m=e.cvs[i][0],y=e.cvs[i][1],_=o*a,g=o*(1-a),v=(1-o)*(1-a),b=(1-o)*a;return h.x=v*l+g*u+b*m+_*f,h.y=v*c+g*d+b*y+_*p,h}function Uf(t,e,i){var n,s,r,o=i.x,a=i.y,h=i.z||0,l={};for(r=0;r<3;r++)if(!e||2!==r||void 0!==i.z)switch(0===r?(n=o,s=-1!=="ew".indexOf(t.axis[r])?"x":"y"):1===r?(n=a,s=-1!=="ns".indexOf(t.axis[r])?"y":"x"):(n=h,s="z"),t.axis[r]){case"e":case"n":l[s]=n;break;case"w":case"s":l[s]=-n;break;case"u":void 0!==i[s]&&(l.z=n);break;case"d":void 0!==i[s]&&(l.z=-n);break;default:return null}return l}function Zf(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function jf(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Vf(t,e,i,n){var s,r=void 0!==(i=Array.isArray(i)?Zf(i):{x:i.x,y:i.y,z:i.z,m:i.m}).z;if(function(t){jf(t.x),jf(t.y)}(i),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===Id||t.datum.datum_type===Ad||t.datum.datum_type===Cd)&&"WGS84"!==e.datumCode||(e.datum.datum_type===Id||e.datum.datum_type===Ad||e.datum.datum_type===Cd)&&"WGS84"!==t.datumCode}(t,e)&&(i=Vf(t,s=new zf("WGS84"),i,n),t=s),n&&"enu"!==t.axis&&(i=Uf(t,!1,i)),"longlat"===t.projName)i={x:i.x*Nd,y:i.y*Nd,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;if(t.from_greenwich&&(i.x+=t.from_greenwich),i=function(t,e,i){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===Id?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==Ad||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return i;if(t.datum_type===Ld||e.datum_type===Ld)return i;var n=t.a,s=t.es;if(t.datum_type===Cd){if(0!==Ff(t,!1,i))return;n=Pd,s=Ed}var r=e.a,o=e.b,a=e.es;return e.datum_type===Cd&&(r=Pd,o=Bd,a=Ed),s!==a||n!==r||Nf(t.datum_type)||Nf(e.datum_type)?(i=Of(i,s,n),Nf(t.datum_type)&&(i=function(t,e,i){if(e===Id)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===Ad){var n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],h=i[5],l=i[6];return{x:l*(t.x-h*t.y+a*t.z)+n,y:l*(h*t.x+t.y-o*t.z)+s,z:l*(-a*t.x+o*t.y+t.z)+r}}}(i,t.datum_type,t.datum_params)),Nf(e.datum_type)&&(i=function(t,e,i){if(e===Id)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===Ad){var n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],h=i[5],l=i[6],c=(t.x-n)/l,u=(t.y-s)/l,d=(t.z-r)/l;return{x:c+h*u-a*d,y:-h*c+u+o*d,z:a*c-o*u+d}}}(i,e.datum_type,e.datum_params)),i=kf(i,a,r,o),e.datum_type!==Cd||0===Ff(e,!0,i)?i:void 0):i}(t.datum,e.datum,i))return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),"longlat"===e.projName?i={x:i.x*Fd,y:i.y*Fd,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),n&&"enu"!==e.axis?Uf(e,!0,i):(r||delete i.z,i)}var Wf=zf("WGS84");function Gf(t,e,i,n){var s,r,o;return Array.isArray(i)?(s=Vf(t,e,i,n)||{x:NaN,y:NaN},i.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof s.z?[s.x,s.y,s.z].concat(i.splice(3)):[s.x,s.y,i[2]].concat(i.splice(3)):[s.x,s.y].concat(i.splice(2)):[s.x,s.y]):(r=Vf(t,e,i,n),2===(o=Object.keys(i)).length||o.forEach((function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;r[n]=i[n]})),r)}function qf(t){return t instanceof zf?t:t.oProj?t.oProj:zf(t)}const Hf=function(t,e,i){t=qf(t);var n,s=!1;return void 0===e?(e=t,t=Wf,s=!0):(void 0!==e.x||Array.isArray(e))&&(i=e,e=t,t=Wf,s=!0),e=qf(e),i?Gf(t,e,i):(n={forward:function(i,n){return Gf(t,e,i,n)},inverse:function(i,n){return Gf(e,t,i,n)}},s&&(n.oProj=e),n)};var Yf=6,$f="AJSAJS",Xf="AFAFAF",Kf=65,Jf=73,Qf=79,tp=86,ep=90;const ip={forward:np,inverse:function(t){var e=ap(lp(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:sp};function np(t,e){return e=e||5,function(t,e){var i,n,s,r,o,a,h,l,c,u,d,f="00000"+t.easting,p="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(c=t.easting,u=t.northing,d=hp(t.zoneNumber),i=Math.floor(c/1e5),n=Math.floor(u/1e5)%20,s=d-1,r=$f.charCodeAt(s),o=Xf.charCodeAt(s),l=!1,(a=r+i-1)>ep&&(a=a-ep+Kf-1,l=!0),(a===Jf||r<Jf&&a>Jf||(a>Jf||r<Jf)&&l)&&a++,(a===Qf||r<Qf&&a>Qf||(a>Qf||r<Qf)&&l)&&++a===Jf&&a++,a>ep&&(a=a-ep+Kf-1),(h=o+n)>tp?(h=h-tp+Kf-1,l=!0):l=!1,(h===Jf||o<Jf&&h>Jf||(h>Jf||o<Jf)&&l)&&h++,(h===Qf||o<Qf&&h>Qf||(h>Qf||o<Qf)&&l)&&++h===Jf&&h++,h>tp&&(h=h-tp+Kf-1),String.fromCharCode(a)+String.fromCharCode(h))+f.substr(f.length-5,e)+p.substr(p.length-5,e)}(function(t){var e,i,n,s,r,o,a,h=t.lat,l=t.lon,c=6378137,u=.00669438,d=.9996,f=rp(h),p=rp(l);a=Math.floor((l+180)/6)+1,180===l&&(a=60),h>=56&&h<64&&l>=3&&l<12&&(a=32),h>=72&&h<84&&(l>=0&&l<9?a=31:l>=9&&l<21?a=33:l>=21&&l<33?a=35:l>=33&&l<42&&(a=37)),o=rp(6*(a-1)-180+3),e=.006739496752268451,i=c/Math.sqrt(1-u*Math.sin(f)*Math.sin(f)),n=Math.tan(f)*Math.tan(f),s=e*Math.cos(f)*Math.cos(f);var m,y,_=d*i*((r=Math.cos(f)*(p-o))+(1-n+s)*r*r*r/6+(5-18*n+n*n+72*s-58*e)*r*r*r*r*r/120)+5e5,g=d*(c*(.9983242984503243*f-.002514607064228144*Math.sin(2*f)+2639046602129982e-21*Math.sin(4*f)-3.418046101696858e-9*Math.sin(6*f))+i*Math.tan(f)*(r*r/2+(5-n+9*s+4*s*s)*r*r*r*r/24+(61-58*n+n*n+600*s-2.2240339282485886)*r*r*r*r*r*r/720));return h<0&&(g+=1e7),{northing:Math.round(g),easting:Math.round(_),zoneNumber:a,zoneLetter:(m=h,y="Z",84>=m&&m>=72?y="X":72>m&&m>=64?y="W":64>m&&m>=56?y="V":56>m&&m>=48?y="U":48>m&&m>=40?y="T":40>m&&m>=32?y="S":32>m&&m>=24?y="R":24>m&&m>=16?y="Q":16>m&&m>=8?y="P":8>m&&m>=0?y="N":0>m&&m>=-8?y="M":-8>m&&m>=-16?y="L":-16>m&&m>=-24?y="K":-24>m&&m>=-32?y="J":-32>m&&m>=-40?y="H":-40>m&&m>=-48?y="G":-48>m&&m>=-56?y="F":-56>m&&m>=-64?y="E":-64>m&&m>=-72?y="D":-72>m&&m>=-80&&(y="C"),y)}}({lat:t[1],lon:t[0]}),e)}function sp(t){var e=ap(lp(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function rp(t){return t*(Math.PI/180)}function op(t){return t/Math.PI*180}function ap(t){var e=t.northing,i=t.easting,n=t.zoneLetter,s=t.zoneNumber;if(s<0||s>60)return null;var r,o,a,h,l,c,u,d,f,p=.9996,m=6378137,y=.00669438,_=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),g=i-5e5,v=e;n<"N"&&(v-=1e7),u=6*(s-1)-180+3,r=.006739496752268451,f=(d=v/p/6367449.145945056)+(3*_/2-27*_*_*_/32)*Math.sin(2*d)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*d)+151*_*_*_/96*Math.sin(6*d),o=m/Math.sqrt(1-y*Math.sin(f)*Math.sin(f)),a=Math.tan(f)*Math.tan(f),h=r*Math.cos(f)*Math.cos(f),l=.99330562*m/Math.pow(1-y*Math.sin(f)*Math.sin(f),1.5),c=g/(o*p);var b=f-o*Math.tan(f)/l*(c*c/2-(5+3*a+10*h-4*h*h-9*r)*c*c*c*c/24+(61+90*a+298*h+45*a*a-1.6983531815716497-3*h*h)*c*c*c*c*c*c/720);b=op(b);var x,w=(c-(1+2*a+h)*c*c*c/6+(5-2*h+28*a-3*h*h+8*r+24*a*a)*c*c*c*c*c/120)/Math.cos(f);if(w=u+op(w),t.accuracy){var M=ap({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});x={top:M.lat,right:M.lon,bottom:b,left:w}}else x={lat:b,lon:w};return x}function hp(t){var e=t%Yf;return 0===e&&(e=Yf),e}function lp(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,n=null,s="",r=0;!/[A-Z]/.test(e=t.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+t;s+=e,r++}var o=parseInt(s,10);if(0===r||r+3>i)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(r++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+t;n=t.substring(r,r+=2);for(var h=hp(o),l=function(t,e){for(var i=$f.charCodeAt(e-1),n=1e5,s=!1;i!==t.charCodeAt(0);){if(++i===Jf&&i++,i===Qf&&i++,i>ep){if(s)throw"Bad character: "+t;i=Kf,s=!0}n+=1e5}return n}(n.charAt(0),h),c=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=Xf.charCodeAt(e-1),n=0,s=!1;i!==t.charCodeAt(0);){if(++i===Jf&&i++,i===Qf&&i++,i>tp){if(s)throw"Bad character: "+t;i=Kf,s=!0}n+=1e5}return n}(n.charAt(1),h);c<cp(a);)c+=2e6;var u=i-r;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,f,p,m=u/2,y=0,_=0;return m>0&&(d=1e5/Math.pow(10,m),f=t.substring(r,r+m),y=parseFloat(f)*d,p=t.substring(r+m),_=parseFloat(p)*d),{easting:y+l,northing:_+c,zoneLetter:a,zoneNumber:o,accuracy:d}}function cp(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function up(t,e,i){if(!(this instanceof up))return new up(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}up.fromMGRS=function(t){return new up(sp(t))},up.prototype.toMGRS=function(t){return np([this.x,this.y],t)};const dp=up;var fp=.046875,pp=.01953125,mp=.01068115234375;function yp(t){var e=[];e[0]=1-t*(.25+t*(fp+t*(pp+t*mp))),e[1]=t*(.75-t*(fp+t*(pp+t*mp)));var i=t*t;return e[2]=i*(.46875-t*(.013020833333333334+.007120768229166667*t)),i*=t,e[3]=i*(.3645833333333333-.005696614583333333*t),e[4]=i*t*.3076171875,e}function _p(t,e,i,n){return i*=e,e*=e,n[0]*t-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}function gp(t,e,i){for(var n=1/(1-e),s=t,r=20;r;--r){var o=Math.sin(s),a=1-e*o*o;if(s-=a=(_p(s,o,Math.cos(s),i)-t)*(a*Math.sqrt(a))*n,Math.abs(a)<kd)return s}return s}const vp={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=yp(this.es),this.ml0=_p(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,i,n,s=t.x,r=t.y,o=ff(s-this.long0),a=Math.sin(r),h=Math.cos(r);if(this.es){var l=h*o,c=Math.pow(l,2),u=this.ep2*Math.pow(h,2),d=Math.pow(u,2),f=Math.abs(h)>kd?Math.tan(r):0,p=Math.pow(f,2),m=Math.pow(p,2);e=1-this.es*Math.pow(a,2),l/=Math.sqrt(e);var y=_p(r,a,h,this.en);i=this.a*(this.k0*l*(1+c/6*(1-p+u+c/20*(5-18*p+m+14*u-58*p*u+c/42*(61+179*m-m*p-479*p)))))+this.x0,n=this.a*(this.k0*(y-this.ml0+a*o*l/2*(1+c/12*(5-p+9*u+4*d+c/30*(61+m-58*p+270*u-330*p*u+c/56*(1385+543*m-m*p-3111*p))))))+this.y0}else{var _=h*Math.sin(o);if(Math.abs(Math.abs(_)-1)<kd)return 93;if(i=.5*this.a*this.k0*Math.log((1+_)/(1-_))+this.x0,n=h*Math.cos(o)/Math.sqrt(1-Math.pow(_,2)),(_=Math.abs(n))>=1){if(_-1>kd)return 93;n=0}else n=Math.acos(n);r<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=i,t.y=n,t},inverse:function(t){var e,i,n,s,r=(t.x-this.x0)*(1/this.a),o=(t.y-this.y0)*(1/this.a);if(this.es)if(i=gp(e=this.ml0+o/this.k0,this.es,this.en),Math.abs(i)<Od){var a=Math.sin(i),h=Math.cos(i),l=Math.abs(h)>kd?Math.tan(i):0,c=this.ep2*Math.pow(h,2),u=Math.pow(c,2),d=Math.pow(l,2),f=Math.pow(d,2);e=1-this.es*Math.pow(a,2);var p=r*Math.sqrt(e)/this.k0,m=Math.pow(p,2);n=i-(e*=l)*m/(1-this.es)*.5*(1-m/12*(5+3*d-9*c*d+c-4*u-m/30*(61+90*d-252*c*d+45*f+46*c-m/56*(1385+3633*d+4095*f+1574*f*d)))),s=ff(this.long0+p*(1-m/6*(1+2*d+c-m/20*(5+28*d+24*f+8*c*d+6*c-m/42*(61+662*d+1320*f+720*f*d))))/h)}else n=Od*df(o),s=0;else{var y=Math.exp(r/this.k0),_=.5*(y-1/y),g=this.lat0+o/this.k0,v=Math.cos(g);e=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(_,2))),n=Math.asin(e),o<0&&(n=-n),s=0===_&&0===v?0:ff(Math.atan2(_,v)+this.long0)}return t.x=s,t.y=n,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function bp(t){var e=Math.exp(t);return(e-1/e)/2}function xp(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),n=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))}function wp(t,e){for(var i,n=2*Math.cos(2*e),s=t.length-1,r=t[s],o=0;--s>=0;)i=n*r-o+t[s],o=r,r=i;return e+i*Math.sin(2*e)}function Mp(t,e,i){for(var n,s,r=Math.sin(e),o=Math.cos(e),a=bp(i),h=function(t){var e=Math.exp(t);return(e+1/e)/2}(i),l=2*o*h,c=-2*r*a,u=t.length-1,d=t[u],f=0,p=0,m=0;--u>=0;)n=p,s=f,d=l*(p=d)-n-c*(f=m)+t[u],m=c*p-s+l*f;return[(l=r*h)*d-(c=o*a)*m,l*m+c*d]}const Sp={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(vp.init.apply(this),this.forward=vp.forward,this.inverse=vp.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),i*=e,this.cgb[1]=i*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i*=e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),i*=e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(e*(-24832/14175)-2.4)),i*=e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i*=e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),i*=e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i*=e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i*=e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i*=e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=.6650675310896665*i;var n=wp(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var i,n=2*Math.cos(e),s=t.length-1,r=t[s],o=0;--s>=0;)i=n*r-o+t[s],o=r,r=i;return Math.sin(e)*i}(this.gtu,2*n))},forward:function(t){var e=ff(t.x-this.long0),i=t.y;i=wp(this.cbg,i);var n=Math.sin(i),s=Math.cos(i),r=Math.sin(e),o=Math.cos(e);i=Math.atan2(n,o*s),e=Math.atan2(r*s,xp(n,s*o)),e=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,i=e-1;return 0===i?t:t*Math.log(e)/i}(e*(1+e/(xp(1,e)+1))),t<0?-e:e}(Math.tan(e));var a,h,l=Mp(this.gtu,2*i,2*e);return i+=l[0],e+=l[1],Math.abs(e)<=2.623395162778?(a=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*i+this.Zb)+this.y0):(a=1/0,h=1/0),t.x=a,t.y=h,t},inverse:function(t){var e,i,n=(t.x-this.x0)*(1/this.a),s=(t.y-this.y0)*(1/this.a);if(s=(s-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var r=Mp(this.utg,2*s,2*n);s+=r[0],n+=r[1],n=Math.atan(bp(n));var o=Math.sin(s),a=Math.cos(s),h=Math.sin(n),l=Math.cos(n);s=Math.atan2(o*l,xp(h,l*a)),e=ff((n=Math.atan2(h,l*a))+this.long0),i=wp(this.cgb,s)}else e=1/0,i=1/0;return t.x=e,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},Tp={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(ff(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Nd,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Sp.init.apply(this),this.forward=Sp.forward,this.inverse=Sp.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Ip(t,e){return Math.pow((1-t)/(1+t),e)}const Ap={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Dd)/(Math.pow(Math.tan(.5*this.lat0+Dd),this.C)*Ip(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Dd),this.C)*Ip(this.e*Math.sin(i),this.ratexp))-Od,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,n=Math.pow(Math.tan(.5*i+Dd)/this.K,1/this.C),s=20;s>0&&(i=2*Math.atan(n*Ip(this.e*Math.sin(t.y),-.5*this.e))-Od,!(Math.abs(i-t.y)<1e-14));--s)t.y=i;return s?(t.x=e,t.y=i,t):null},names:["gauss"]},Cp={init:function(){Ap.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,n,s;return t.x=ff(t.x-this.long0),Ap.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),n=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*n),t.x=s*i*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*i*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,n,s,r;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,r=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(r,this.R2);e=Math.sin(o),i=Math.cos(o),s=Math.asin(i*this.sinc0+t.y*e*this.cosc0/r),n=Math.atan2(t.x*e,r*this.cosc0*i-t.y*this.sinc0*e)}else s=this.phic0,n=0;return t.x=n,t.y=s,Ap.inverse.apply(this,[t]),t.x=ff(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},Lp={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=kd&&(this.k0=.5*(1+df(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=kd&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=kd&&(this.k0=.5*this.cons*uf(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/pf(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=uf(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Od,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,n,s,r,o,a=t.x,h=t.y,l=Math.sin(h),c=Math.cos(h),u=ff(a-this.long0);return Math.abs(Math.abs(a-this.long0)-Math.PI)<=kd&&Math.abs(h+this.lat0)<=kd?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*l+this.coslat0*c*Math.cos(u)),t.x=this.a*e*c*Math.sin(u)+this.x0,t.y=this.a*e*(this.coslat0*l-this.sinlat0*c*Math.cos(u))+this.y0,t):(i=2*Math.atan(this.ssfn_(h,l,this.e))-Od,s=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=kd?(r=pf(this.e,h*this.con,this.con*l),o=2*this.a*this.k0*r/this.cons,t.x=this.x0+o*Math.sin(a-this.long0),t.y=this.y0-this.con*o*Math.cos(a-this.long0),t):(Math.abs(this.sinlat0)<kd?(e=2*this.a*this.k0/(1+s*Math.cos(u)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*s*Math.cos(u))),t.y=e*(this.cosX0*n-this.sinX0*s*Math.cos(u))+this.y0),t.x=e*s*Math.sin(u)+this.x0,t))},inverse:function(t){var e,i,n,s,r;t.x-=this.x0,t.y-=this.y0;var o=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,i=this.lat0,o<=kd?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(a)*this.sinlat0+t.y*Math.sin(a)*this.coslat0/o),e=Math.abs(this.coslat0)<kd?this.lat0>0?ff(this.long0+Math.atan2(t.x,-1*t.y)):ff(this.long0+Math.atan2(t.x,t.y)):ff(this.long0+Math.atan2(t.x*Math.sin(a),o*this.coslat0*Math.cos(a)-t.y*this.sinlat0*Math.sin(a))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=kd){if(o<=kd)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,n=o*this.cons/(2*this.a*this.k0),i=this.con*mf(this.e,n),e=this.con*ff(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=kd?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/o),e=ff(this.long0+Math.atan2(t.x*Math.sin(s),o*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),i=-1*mf(this.e,Math.tan(.5*(Od+r)));return t.x=e,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(Od+t))*Math.pow((1-e)/(1+e),.5*i)}},Pp={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,n=1/this.rf,s=2*n-Math.pow(n,2),r=this.e=Math.sqrt(s);this.R=this.k0*i*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+r*e)/(1-r*e));this.K=o-this.alpha*a+this.alpha*r/2*h},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+i)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(t.x-this.lambda0),o=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),a=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*o+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,i=t.y-this.y0,n=e/this.R,s=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),a=this.lambda0+o/this.alpha,h=0,l=r,c=-1e3,u=0;Math.abs(l-c)>1e-7;){if(++u>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),c=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=a,t.y=l,t},names:["somerc"]};var Bp=1e-7;const Ep={init:function(){var t,e,i,n,s,r,o,a,h,l,c,u,d,f=0,p=0,m=0,y=0,_=0,g=0,v=0;this.no_off=(d="object"==typeof(u=this).PROJECTION?Object.keys(u.PROJECTION)[0]:u.PROJECTION,"no_uoff"in u||"no_off"in u||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)),this.no_rot="no_rot"in this;var b=!1;"alpha"in this&&(b=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),b&&(v=this.alpha),x&&(f=this.rectified_grid_angle*Nd),b||x)p=this.longc;else if(m=this.long1,_=this.lat1,y=this.long2,g=this.lat2,Math.abs(_-g)<=Bp||(t=Math.abs(_))<=Bp||Math.abs(t-Od)<=Bp||Math.abs(Math.abs(this.lat0)-Od)<=Bp||Math.abs(Math.abs(g)-Od)<=Bp)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>kd?(a=Math.sin(this.lat0),i=Math.cos(this.lat0),t=1-this.es*a*a,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/t,(s=(n=this.B*e/(i*Math.sqrt(t)))*n-1)<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(pf(this.e,this.lat0,a),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=s=1),b||x?(b?(c=Math.asin(Math.sin(v)/n),x||(f=v)):(c=f,v=Math.asin(n*Math.sin(c))),this.lam0=p-Math.asin(.5*(s-1/s)*Math.tan(c))/this.B):(r=Math.pow(pf(this.e,_,Math.sin(_)),this.B),o=Math.pow(pf(this.e,g,Math.sin(g)),this.B),s=this.E/r,h=(o-r)/(o+r),l=((l=this.E*this.E)-o*r)/(l+o*r),(t=m-y)<-Math.pi?y-=Rd:t>Math.pi&&(y+=Rd),this.lam0=ff(.5*(m+y)-Math.atan(l*Math.tan(.5*this.B*(m-y))/h)/this.B),c=Math.atan(2*Math.sin(this.B*ff(m-this.lam0))/(s-1/s)),f=v=Math.asin(n*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(f),this.cosrot=Math.cos(f),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(Dd-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(Dd+s))},forward:function(t){var e,i,n,s,r,o,a,h,l={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Od)>kd){if(e=.5*((r=this.E/Math.pow(pf(this.e,t.y,Math.sin(t.y)),this.B))-(o=1/r)),i=.5*(r+o),s=Math.sin(this.B*t.x),n=(e*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(n)-1)<kd)throw new Error;h=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*t.x),a=Math.abs(o)<Bp?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+s*this.singam,o)}else h=t.y>0?this.v_pole_n:this.v_pole_s,a=this.ArB*t.y;return this.no_rot?(l.x=a,l.y=h):(a-=this.u_0,l.x=h*this.cosrot+a*this.sinrot,l.y=a*this.cosrot-h*this.sinrot),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l},inverse:function(t){var e,i,n,s,r,o,a,h={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(i=t.y,e=t.x):(i=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),s=.5*((n=Math.exp(-this.BrA*i))-1/n),r=.5*(n+1/n),a=((o=Math.sin(this.BrA*e))*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(a)-1)<kd)h.x=0,h.y=a<0?-Od:Od;else{if(h.y=this.E/Math.sqrt((1+a)/(1-a)),h.y=mf(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(s*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return h.x+=this.lam0,h},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},zp={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<kd)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),n=uf(this.e,e,i),s=pf(this.e,this.lat1,e),r=Math.sin(this.lat2),o=Math.cos(this.lat2),a=uf(this.e,r,o),h=pf(this.e,this.lat2,r),l=pf(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>kd?this.ns=Math.log(n/a)/Math.log(s/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=kd&&(i=df(i)*(Od-2*kd));var n,s,r=Math.abs(Math.abs(i)-Od);if(r>kd)n=pf(this.e,i,Math.sin(i)),s=this.a*this.f0*Math.pow(n,this.ns);else{if((r=i*this.ns)<=0)return null;s=0}var o=this.ns*ff(e-this.long0);return t.x=this.k0*(s*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-s*Math.cos(o))+this.y0,t},inverse:function(t){var e,i,n,s,r,o=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+a*a),i=1):(e=-Math.sqrt(o*o+a*a),i=-1);var h=0;if(0!==e&&(h=Math.atan2(i*o,i*a)),0!==e||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),-9999===(s=mf(this.e,n)))return null}else s=-Od;return r=ff(h/this.ns+this.long0),t.x=r,t.y=s,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},Op={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,i,n,s,r,o,a,h=t.x,l=t.y,c=ff(h-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),n=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),r=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(s)),o=this.n*r,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),t.y=a*Math.cos(o)/1,t.x=a*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,i,n,s,r,o,a,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),r=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/r,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),i=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(e)),t.x=this.long0-i/this.alfa,o=e,a=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(a=1),o=t.y,l+=1}while(0===a&&l<15);return l>=15?null:t},names:["Krovak","krovak"]};function kp(t,e,i,n,s){return t*s-e*Math.sin(2*s)+i*Math.sin(4*s)-n*Math.sin(6*s)}function Np(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Fp(t){return.375*t*(1+.25*t*(1+.46875*t))}function Dp(t){return.05859375*t*t*(1+.75*t)}function Rp(t){return t*t*t*(35/3072)}function Up(t,e,i){var n=e*i;return t/Math.sqrt(1-n*n)}function Zp(t){return Math.abs(t)<Od?t:t-df(t)*Math.PI}function jp(t,e,i,n,s){var r,o;r=t/e;for(var a=0;a<15;a++)if(r+=o=(t-(e*r-i*Math.sin(2*r)+n*Math.sin(4*r)-s*Math.sin(6*r)))/(e-2*i*Math.cos(2*r)+4*n*Math.cos(4*r)-6*s*Math.cos(6*r)),Math.abs(o)<=1e-10)return r;return NaN}const Vp={init:function(){this.sphere||(this.e0=Np(this.es),this.e1=Fp(this.es),this.e2=Dp(this.es),this.e3=Rp(this.es),this.ml0=this.a*kp(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,n=t.x,s=t.y;if(n=ff(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var r=Math.sin(s),o=Math.cos(s),a=Up(this.a,this.e,r),h=Math.tan(s)*Math.tan(s),l=n*Math.cos(s),c=l*l,u=this.es*o*o/(1-this.es);e=a*l*(1-c*h*(1/6-(8-h+8*u)*c/120)),i=this.a*kp(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+a*r/o*c*(.5+(5-h+6*u)*c/24)}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n=t.x/this.a,s=t.y/this.a;if(this.sphere){var r=s+this.lat0;e=Math.asin(Math.sin(r)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(r))}else{var o=jp(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Od)<=kd)return t.x=this.long0,t.y=Od,s<0&&(t.y*=-1),t;var a=Up(this.a,this.e,Math.sin(o)),h=a*a*a/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(o),2),c=n*this.a/a,u=c*c;e=o-a*Math.tan(o)/h*c*c*(.5-(1+3*l)*c*c/24),i=c*(1-u*(l/3+(1+3*l)*l*u/15))/Math.cos(o)}return t.x=ff(i+this.long0),t.y=Zp(e),t},names:["Cassini","Cassini_Soldner","cass"]};function Wp(t,e){var i;return t>1e-7?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e}const Gp={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-Od)<kd?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<kd?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Wp(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,i=[];return i[0]=.3333333333333333*t,e=t*t,i[0]+=.17222222222222222*e,i[1]=.06388888888888888*e,e*=t,i[0]+=.10257936507936508*e,i[1]+=.0664021164021164*e,i[2]=.016415012942191543*e,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Wp(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,n,s,r,o,a,h,l,c,u=t.x,d=t.y;if(u=ff(u-this.long0),this.sphere){if(r=Math.sin(d),c=Math.cos(d),n=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+c*n:1+this.sinph0*r+this.cosph0*c*n)<=kd)return null;e=(i=Math.sqrt(2/i))*c*Math.sin(u),i*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(d+this.lat0)<kd)return null;i=Dd-.5*d,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(u),i*=n}}else{switch(a=0,h=0,l=0,n=Math.cos(u),s=Math.sin(u),r=Math.sin(d),o=Wp(this.e,r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(a=o/this.qp,h=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:l=1+this.sinb1*a+this.cosb1*h*n;break;case this.EQUIT:l=1+h*n;break;case this.N_POLE:l=Od+d,o=this.qp-o;break;case this.S_POLE:l=d-Od,o=this.qp+o}if(Math.abs(l)<kd)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),i=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*a-this.sinb1*h*n):(l=Math.sqrt(2/(1+h*n)))*a*this.ymf,e=this.xmf*l*h*s;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(l=Math.sqrt(o))*s,i=n*(this.mode===this.S_POLE?l:-l)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,s,r,o,a,h,l,c,u=t.x/this.a,d=t.y/this.a;if(this.sphere){var f,p=0,m=0;if((i=.5*(f=Math.sqrt(u*u+d*d)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(i),p=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(f)<=kd?0:Math.asin(d*m/f),u*=m,d=p*f;break;case this.OBLIQ:i=Math.abs(f)<=kd?this.lat0:Math.asin(p*this.sinph0+d*m*this.cosph0/f),u*=m*this.cosph0,d=(p-Math.sin(i)*this.sinph0)*f;break;case this.N_POLE:d=-d,i=Od-i;break;case this.S_POLE:i-=Od}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,d):0}else{if(a=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,d*=this.dd,(o=Math.sqrt(u*u+d*d))<kd)return t.x=this.long0,t.y=this.lat0,t;s=2*Math.asin(.5*o/this.rq),n=Math.cos(s),u*=s=Math.sin(s),this.mode===this.OBLIQ?(a=n*this.sinb1+d*s*this.cosb1/o,r=this.qp*a,d=o*this.cosb1*n-d*this.sinb1*s):(a=d*s/o,r=this.qp*a,d=o*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(r=u*u+d*d))return t.x=this.long0,t.y=this.lat0,t;a=1-r/this.qp,this.mode===this.S_POLE&&(a=-a)}e=Math.atan2(u,d),c=(h=Math.asin(a))+h,i=h+(l=this.apa)[0]*Math.sin(c)+l[1]*Math.sin(c+c)+l[2]*Math.sin(c+c+c)}return t.x=ff(this.long0+e),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function qp(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}const Hp={init:function(){Math.abs(this.lat1+this.lat2)<kd||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=uf(this.e3,this.sin_po,this.cos_po),this.qs1=Wp(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=uf(this.e3,this.sin_po,this.cos_po),this.qs2=Wp(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Wp(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>kd?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=Wp(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*ff(e-this.long0),o=s*Math.sin(r)+this.x0,a=this.rh-s*Math.cos(r)+this.y0;return t.x=o,t.y=a,t},inverse:function(t){var e,i,n,s,r,o;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),s=0,0!==e&&(s=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,i)),r=ff(s/this.ns0+this.long0),t.x=r,t.y=o,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,n,s,r,o=qp(.5*e);if(t<kd)return o;for(var a=t*t,h=1;h<=25;h++)if(o+=r=.5*(s=1-(n=t*(i=Math.sin(o)))*n)*s/Math.cos(o)*(e/(1-a)-i/s+.5/t*Math.log((1-n)/(1+n))),Math.abs(r)<=1e-7)return o;return null}},Yp={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i,n,s,r,o,a,h=t.x,l=t.y;return n=ff(h-this.long0),e=Math.sin(l),i=Math.cos(l),s=Math.cos(n),(r=this.sin_p14*e+this.cos_p14*i*s)>0||Math.abs(r)<=kd?(o=this.x0+1*this.a*i*Math.sin(n)/r,a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*s)/r):(o=this.x0+this.infinity_dist*i*Math.sin(n),a=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*s)),t.x=o,t.y=a,t},inverse:function(t){var e,i,n,s,r,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),i=Math.sin(s),o=qp((n=Math.cos(s))*this.sin_p14+t.y*i*this.cos_p14/e),r=Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i),r=ff(this.long0+r)):(o=this.phic0,r=0),t.x=r,t.y=o,t},names:["gnom"]},$p={init:function(){this.sphere||(this.k0=uf(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i,n=t.x,s=t.y,r=ff(n-this.long0);if(this.sphere)e=this.x0+this.a*r*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var o=Wp(this.e,Math.sin(s));e=this.x0+this.a*this.k0*r,i=this.y0+this.a*o*.5/this.k0}return t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=ff(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*Od:Od;for(var n,s,r,o,a=Math.asin(.5*e),h=0;h<30;h++)if(s=Math.sin(a),r=Math.cos(a),o=t*s,a+=n=Math.pow(1-o*o,2)/(2*r)*(e/(1-t*t)-s/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),Math.abs(n)<=1e-10)return a;return NaN}(this.e,2*t.y*this.k0/this.a),e=ff(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]},Xp={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,n=ff(e-this.long0),s=Zp(i-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*s,t},inverse:function(t){var e=t.x,i=t.y;return t.x=ff(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=Zp(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Kp={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Np(this.es),this.e1=Fp(this.es),this.e2=Dp(this.es),this.e3=Rp(this.es),this.ml0=this.a*kp(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,n,s=t.x,r=t.y,o=ff(s-this.long0);if(n=o*Math.sin(r),this.sphere)Math.abs(r)<=kd?(e=this.a*o,i=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(r),i=this.a*(Zp(r-this.lat0)+(1-Math.cos(n))/Math.tan(r)));else if(Math.abs(r)<=kd)e=this.a*o,i=-1*this.ml0;else{var a=Up(this.a,this.e,Math.sin(r))/Math.tan(r);e=a*Math.sin(n),i=this.a*kp(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+a*(1-Math.cos(n))}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){var e,i,n,s,r,o,a,h,l;if(n=t.x-this.x0,s=t.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=kd)e=ff(n/this.a+this.long0),i=0;else{var c;for(o=this.lat0+s/this.a,a=n*n/this.a/this.a+o*o,h=o,r=20;r;--r)if(h+=l=-1*(o*(h*(c=Math.tan(h))+1)-h-.5*(h*h+a)*c)/((h-o)/c-1),Math.abs(l)<=kd){i=h;break}e=ff(this.long0+Math.asin(n*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(s+this.ml0)<=kd)i=0,e=ff(this.long0+n/this.a);else{var u,d,f,p,m;for(o=(this.ml0+s)/this.a,a=n*n/this.a/this.a+o*o,h=o,r=20;r;--r)if(m=this.e*Math.sin(h),u=Math.sqrt(1-m*m)*Math.tan(h),d=this.a*kp(this.e0,this.e1,this.e2,this.e3,h),f=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),h-=l=(o*(u*(p=d/this.a)+1)-p-.5*u*(p*p+a))/(this.es*Math.sin(2*h)*(p*p+a-2*o*p)/(4*u)+(o-p)*(u*f-2/Math.sin(2*h))-f),Math.abs(l)<=kd){i=h;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=ff(this.long0+Math.asin(n*u/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]},Jp={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,i=t.x,n=t.y-this.lat0,s=i-this.long0,r=n/zd*1e-5,o=s,a=1,h=0;for(e=1;e<=10;e++)a*=r,h+=this.A[e]*a;var l,c=h,u=o,d=1,f=0,p=0,m=0;for(e=1;e<=6;e++)l=f*c+d*u,d=d*c-f*u,f=l,p=p+this.B_re[e]*d-this.B_im[e]*f,m=m+this.B_im[e]*d+this.B_re[e]*f;return t.x=m*this.a+this.x0,t.y=p*this.a+this.y0,t},inverse:function(t){var e,i,n=t.x,s=t.y,r=n-this.x0,o=(s-this.y0)/this.a,a=r/this.a,h=1,l=0,c=0,u=0;for(e=1;e<=6;e++)i=l*o+h*a,h=h*o-l*a,l=i,c=c+this.C_re[e]*h-this.C_im[e]*l,u=u+this.C_im[e]*h+this.C_re[e]*l;for(var d=0;d<this.iterations;d++){var f,p=c,m=u,y=o,_=a;for(e=2;e<=6;e++)f=m*c+p*u,p=p*c-m*u,m=f,y+=(e-1)*(this.B_re[e]*p-this.B_im[e]*m),_+=(e-1)*(this.B_im[e]*p+this.B_re[e]*m);p=1,m=0;var g=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)f=m*c+p*u,p=p*c-m*u,m=f,g+=e*(this.B_re[e]*p-this.B_im[e]*m),v+=e*(this.B_im[e]*p+this.B_re[e]*m);var b=g*g+v*v;c=(y*g+_*v)/b,u=(_*g-y*v)/b}var x=c,w=u,M=1,S=0;for(e=1;e<=9;e++)M*=x,S+=this.D[e]*M;var T=this.lat0+S*zd*1e5,I=this.long0+w;return t.x=I,t.y=T,t},names:["New_Zealand_Map_Grid","nzmg"]},Qp={init:function(){},forward:function(t){var e=t.x,i=t.y,n=ff(e-this.long0),s=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=s,t.y=r,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=ff(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]},tm={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=yp(this.es)},forward:function(t){var e,i,n=t.x,s=t.y;if(n=ff(n-this.long0),this.sphere){if(this.m)for(var r=this.n*Math.sin(s),o=20;o;--o){var a=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=a,Math.abs(a)<kd)break}else s=1!==this.n?Math.asin(this.n*Math.sin(s)):s;e=this.a*this.C_x*n*(this.m+Math.cos(s)),i=this.a*this.C_y*s}else{var h=Math.sin(s),l=Math.cos(s);i=this.a*_p(s,h,l,this.en),e=this.a*n*l/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i/=this.C_x*(this.m+Math.cos(e)),this.m?e=qp((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=qp(Math.sin(e)/this.n)),i=ff(i+this.long0),e=Zp(e)):(e=gp(t.y/this.a,this.es,this.en),(n=Math.abs(e))<Od?(n=Math.sin(e),i=ff(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-kd<Od&&(i=this.long0)),t.x=i,t.y=e,t},names:["Sinusoidal","sinu"]},em={init:function(){},forward:function(t){for(var e=t.x,i=t.y,n=ff(e-this.long0),s=i,r=Math.PI*Math.sin(i);;){var o=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=o,Math.abs(o)<kd)break}s/=2,Math.PI/2-Math.abs(i)<kd&&(n=0);var a=.900316316158*this.a*n*Math.cos(s)+this.x0,h=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=a,t.y=h,t},inverse:function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=ff(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var s=Math.asin(i);return t.x=n,t.y=s,t},names:["Mollweide","moll"]},im={init:function(){Math.abs(this.lat1+this.lat2)<kd||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Np(this.es),this.e1=Fp(this.es),this.e2=Dp(this.es),this.e3=Rp(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=uf(this.e,this.sinphi,this.cosphi),this.ml1=kp(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<kd?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=uf(this.e,this.sinphi,this.cosphi),this.ml2=kp(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=kp(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,i=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var s=kp(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-s)}var r=this.ns*ff(i-this.long0),o=this.x0+e*Math.sin(r),a=this.y0+this.rh-e*Math.cos(r);return t.x=o,t.y=a,t},inverse:function(t){var e,i,n,s;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var r=0;return 0!==i&&(r=Math.atan2(e*t.x,e*t.y)),this.sphere?(s=ff(this.long0+r/this.ns),n=Zp(this.g-i/this.a),t.x=s,t.y=n,t):(n=jp(this.g-i/this.a,this.e0,this.e1,this.e2,this.e3),s=ff(this.long0+r/this.ns),t.x=s,t.y=n,t)},names:["Equidistant_Conic","eqdc"]},nm={init:function(){this.R=this.a},forward:function(t){var e,i,n=t.x,s=t.y,r=ff(n-this.long0);Math.abs(s)<=kd&&(e=this.x0+this.R*r,i=this.y0);var o=qp(2*Math.abs(s/Math.PI));(Math.abs(r)<=kd||Math.abs(Math.abs(s)-Od)<=kd)&&(e=this.x0,i=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*o):this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/r-r/Math.PI),h=a*a,l=Math.sin(o),c=Math.cos(o),u=c/(l+c-1),d=u*u,f=u*(2/l-1),p=f*f,m=Math.PI*this.R*(a*(u-p)+Math.sqrt(h*(u-p)*(u-p)-(p+h)*(d-p)))/(p+h);r<0&&(m=-m),e=this.x0+m;var y=h+u;return m=Math.PI*this.R*(f*y-a*Math.sqrt((p+h)*(h+1)-y*y))/(p+h),i=s>=0?this.y0+m:this.y0-m,t.x=e,t.y=i,t},inverse:function(t){var e,i,n,s,r,o,a,h,l,c,u,d;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,r=(n=t.x/u)*n+(s=t.y/u)*s,u=3*(s*s/(h=-2*(o=-Math.abs(s)*(1+r))+1+2*s*s+r*r)+(2*(a=o-2*s*s+n*n)*a*a/h/h/h-9*o*a/h/h)/27)/(l=(o-a*a/3/h)/h)/(c=2*Math.sqrt(-l/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,i=t.y>=0?(-c*Math.cos(d+Math.PI/3)-a/3/h)*Math.PI:-(-c*Math.cos(d+Math.PI/3)-a/3/h)*Math.PI,e=Math.abs(n)<kd?this.long0:ff(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(n*n-s*s)+r*r))/2/n),t.x=e,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},sm={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,n,s,r,o,a,h,l,c,u,d,f,p,m,y,_,g,v,b,x,w,M=t.x,S=t.y,T=Math.sin(t.y),I=Math.cos(t.y),A=ff(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=kd?(t.x=this.x0+this.a*(Od-S)*Math.sin(A),t.y=this.y0-this.a*(Od-S)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=kd?(t.x=this.x0+this.a*(Od+S)*Math.sin(A),t.y=this.y0+this.a*(Od+S)*Math.cos(A),t):(g=this.sin_p12*T+this.cos_p12*I*Math.cos(A),_=(y=Math.acos(g))?y/Math.sin(y):1,t.x=this.x0+this.a*_*I*Math.sin(A),t.y=this.y0+this.a*_*(this.cos_p12*T-this.sin_p12*I*Math.cos(A)),t):(e=Np(this.es),i=Fp(this.es),n=Dp(this.es),s=Rp(this.es),Math.abs(this.sin_p12-1)<=kd?(r=this.a*kp(e,i,n,s,Od),o=this.a*kp(e,i,n,s,S),t.x=this.x0+(r-o)*Math.sin(A),t.y=this.y0-(r-o)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=kd?(r=this.a*kp(e,i,n,s,Od),o=this.a*kp(e,i,n,s,S),t.x=this.x0+(r+o)*Math.sin(A),t.y=this.y0+(r+o)*Math.cos(A),t):(a=T/I,h=Up(this.a,this.e,this.sin_p12),l=Up(this.a,this.e,T),c=Math.atan((1-this.es)*a+this.es*h*this.sin_p12/(l*I)),v=0===(u=Math.atan2(Math.sin(A),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(A)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(u)-Math.PI)<=kd?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(A)*Math.cos(c)/Math.sin(u)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),y=h*v*(1-(b=v*v)*(m=(f=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*f)*(1-m)/6+(x=b*v)/8*(p=d*f)*(1-2*m)+(w=x*v)/120*(m*(4-7*m)-3*d*d*(1-7*m))-w*v/48*p),t.x=this.x0+y*Math.sin(u),t.y=this.y0+y*Math.cos(u),t))},inverse:function(t){var e,i,n,s,r,o,a,h,l,c,u,d,f,p,m,y,_,g,v,b,x,w,M;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*Od*this.a)return;return i=e/this.a,n=Math.sin(i),s=Math.cos(i),r=this.long0,Math.abs(e)<=kd?o=this.lat0:(o=qp(s*this.sin_p12+t.y*n*this.cos_p12/e),a=Math.abs(this.lat0)-Od,r=Math.abs(a)<=kd?this.lat0>=0?ff(this.long0+Math.atan2(t.x,-t.y)):ff(this.long0-Math.atan2(-t.x,t.y)):ff(this.long0+Math.atan2(t.x*n,e*this.cos_p12*s-t.y*this.sin_p12*n))),t.x=r,t.y=o,t}return h=Np(this.es),l=Fp(this.es),c=Dp(this.es),u=Rp(this.es),Math.abs(this.sin_p12-1)<=kd?(o=jp(((d=this.a*kp(h,l,c,u,Od))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,h,l,c,u),r=ff(this.long0+Math.atan2(t.x,-1*t.y)),t.x=r,t.y=o,t):Math.abs(this.sin_p12+1)<=kd?(d=this.a*kp(h,l,c,u,Od),o=jp(((e=Math.sqrt(t.x*t.x+t.y*t.y))-d)/this.a,h,l,c,u),r=ff(this.long0+Math.atan2(t.x,t.y)),t.x=r,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),m=Math.atan2(t.x,t.y),f=Up(this.a,this.e,this.sin_p12),y=Math.cos(m),g=-(_=this.e*this.cos_p12*y)*_/(1-this.es),v=3*this.es*(1-g)*this.sin_p12*this.cos_p12*y/(1-this.es),w=1-g*(x=(b=e/f)-g*(1+g)*Math.pow(b,3)/6-v*(1+3*g)*Math.pow(b,4)/24)*x/2-b*x*x*x/6,p=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*y),r=ff(this.long0+Math.asin(Math.sin(m)*Math.sin(x)/Math.cos(p))),M=Math.sin(p),o=Math.atan2((M-this.es*w*this.sin_p12)*Math.tan(p),M*(1-this.es)),t.x=r,t.y=o,t)},names:["Azimuthal_Equidistant","aeqd"]},rm={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,n,s,r,o,a,h=t.x,l=t.y;return n=ff(h-this.long0),e=Math.sin(l),i=Math.cos(l),s=Math.cos(n),((r=this.sin_p14*e+this.cos_p14*i*s)>0||Math.abs(r)<=kd)&&(o=1*this.a*i*Math.sin(n),a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*s)),t.x=o,t.y=a,t},inverse:function(t){var e,i,n,s,r,o,a;return t.x-=this.x0,t.y-=this.y0,i=qp((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(i),s=Math.cos(i),o=this.long0,Math.abs(e)<=kd?(a=this.lat0,t.x=o,t.y=a,t):(a=qp(s*this.sin_p14+t.y*n*this.cos_p14/e),r=Math.abs(this.lat0)-Od,Math.abs(r)<=kd?(o=this.lat0>=0?ff(this.long0+Math.atan2(t.x,-t.y)):ff(this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=a,t):(o=ff(this.long0+Math.atan2(t.x*n,e*this.cos_p14*s-t.y*this.sin_p14*n)),t.x=o,t.y=a,t))},names:["ortho"]};var om={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function am(t,e,i,n){var s;return t<kd?(n.value=om.AREA_0,s=0):(s=Math.atan2(e,i),Math.abs(s)<=Dd?n.value=om.AREA_0:s>Dd&&s<=Od+Dd?(n.value=om.AREA_1,s-=Od):s>Od+Dd||s<=-(Od+Dd)?(n.value=om.AREA_2,s=s>=0?s-Ud:s+Ud):(n.value=om.AREA_3,s+=Od)),s}function hm(t,e){var i=t+e;return i<-Ud?i+=Rd:i>+Ud&&(i-=Rd),i}const lm={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Od-Dd/2?this.face=5:this.lat0<=-(Od-Dd/2)?this.face=6:Math.abs(this.long0)<=Dd?this.face=1:Math.abs(this.long0)<=Od+Dd?this.face=this.long0>0?2:4:this.face=3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,n,s,r,o,a={x:0,y:0},h={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,5===this.face)s=Od-e,i>=Dd&&i<=Od+Dd?(h.value=om.AREA_0,n=i-Od):i>Od+Dd||i<=-(Od+Dd)?(h.value=om.AREA_1,n=i>0?i-Ud:i+Ud):i>-(Od+Dd)&&i<=-Dd?(h.value=om.AREA_2,n=i+Od):(h.value=om.AREA_3,n=i);else if(6===this.face)s=Od+e,i>=Dd&&i<=Od+Dd?(h.value=om.AREA_0,n=-i+Od):i<Dd&&i>=-Dd?(h.value=om.AREA_1,n=-i):i<-Dd&&i>=-(Od+Dd)?(h.value=om.AREA_2,n=-i-Od):(h.value=om.AREA_3,n=i>0?-i+Ud:-i-Ud);else{var l,c,u,d,f,p;2===this.face?i=hm(i,+Od):3===this.face?i=hm(i,+Ud):4===this.face&&(i=hm(i,-Od)),d=Math.sin(e),f=Math.cos(e),p=Math.sin(i),l=f*Math.cos(i),c=f*p,u=d,1===this.face?n=am(s=Math.acos(l),u,c,h):2===this.face?n=am(s=Math.acos(c),u,-l,h):3===this.face?n=am(s=Math.acos(-l),u,-c,h):4===this.face?n=am(s=Math.acos(-c),u,l,h):(s=n=0,h.value=om.AREA_0)}return o=Math.atan(12/Ud*(n+Math.acos(Math.sin(n)*Math.cos(Dd))-Od)),r=Math.sqrt((1-Math.cos(s))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),h.value===om.AREA_1?o+=Od:h.value===om.AREA_2?o+=Ud:h.value===om.AREA_3&&(o+=1.5*Ud),a.x=r*Math.cos(o),a.y=r*Math.sin(o),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,t.x=a.x,t.y=a.y,t},inverse:function(t){var e,i,n,s,r,o,a,h,l,c,u,d,f={lam:0,phi:0},p={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?p.value=om.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(p.value=om.AREA_1,e-=Od):t.x<0&&-t.x>=Math.abs(t.y)?(p.value=om.AREA_2,e=e<0?e+Ud:e-Ud):(p.value=om.AREA_3,e+=Od),l=Ud/12*Math.tan(e),r=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),o=Math.atan(r),(a=1-(n=Math.cos(e))*n*(s=Math.tan(i))*s*(1-Math.cos(Math.atan(1/Math.cos(o)))))<-1?a=-1:a>1&&(a=1),5===this.face)h=Math.acos(a),f.phi=Od-h,p.value===om.AREA_0?f.lam=o+Od:p.value===om.AREA_1?f.lam=o<0?o+Ud:o-Ud:p.value===om.AREA_2?f.lam=o-Od:f.lam=o;else if(6===this.face)h=Math.acos(a),f.phi=h-Od,p.value===om.AREA_0?f.lam=-o+Od:p.value===om.AREA_1?f.lam=-o:p.value===om.AREA_2?f.lam=-o-Od:f.lam=o<0?-o-Ud:-o+Ud;else{var m,y,_;l=(m=a)*m,y=(l+=(_=l>=1?0:Math.sqrt(1-l)*Math.sin(o))*_)>=1?0:Math.sqrt(1-l),p.value===om.AREA_1?(l=y,y=-_,_=l):p.value===om.AREA_2?(y=-y,_=-_):p.value===om.AREA_3&&(l=y,y=_,_=-l),2===this.face?(l=m,m=-y,y=l):3===this.face?(m=-m,y=-y):4===this.face&&(l=m,m=y,y=-l),f.phi=Math.acos(-_)-Od,f.lam=Math.atan2(y,m),2===this.face?f.lam=hm(f.lam,-Od):3===this.face?f.lam=hm(f.lam,-Ud):4===this.face&&(f.lam=hm(f.lam,+Od))}return 0!==this.es&&(c=f.phi<0?1:0,u=Math.tan(f.phi),d=this.b/Math.sqrt(u*u+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),c&&(f.phi=-f.phi)),f.lam+=this.long0,t.x=f.lam,t.y=f.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var cm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],um=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],dm=.8487,fm=1.3523,pm=Fd/5,mm=1/pm,ym=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};const _m={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=ff(t.x-this.long0),i=Math.abs(t.y),n=Math.floor(i*pm);n<0?n=0:n>=18&&(n=17);var s={x:ym(cm[n],i=Fd*(i-mm*n))*e,y:ym(um[n],i)};return t.y<0&&(s.y=-s.y),s.x=s.x*this.a*dm+this.x0,s.y=s.y*this.a*fm+this.y0,s},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*dm),y:Math.abs(t.y-this.y0)/(this.a*fm)};if(e.y>=1)e.x/=cm[18][0],e.y=t.y<0?-Od:Od;else{var i=Math.floor(18*e.y);for(i<0?i=0:i>=18&&(i=17);;)if(um[i][0]>e.y)--i;else{if(!(um[i+1][0]<=e.y))break;++i}var n=um[i],s=5*(e.y-n[0])/(um[i+1][0]-n[0]);s=function(t,e,i,n){for(var s=e;n;--n){var r=t(s);if(s-=r,Math.abs(r)<i)break}return s}((function(t){return(ym(n,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(n,t)}),s,kd,100),e.x/=ym(cm[i],s),e.y=(5*i+s)*Nd,t.y<0&&(e.y=-e.y)}return e.x=ff(e.x+this.long0),e},names:["Robinson","robin"]},gm={init:function(){this.name="geocent"},forward:function(t){return Of(t,this.es,this.a)},inverse:function(t){return kf(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var vm={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const bm={init:function(){if(Object.keys(vm).forEach(function(t){if(void 0===this[t])this[t]=vm[t].def;else{if(vm[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);vm[t].num&&(this[t]=parseFloat(this[t]))}vm[t].degrees&&(this[t]=this[t]*Nd)}.bind(this)),Math.abs(Math.abs(this.lat0)-Od)<kd?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<kd?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,i,n,s,r=Math.sin(t.y),o=Math.cos(t.y),a=Math.cos(t.x);switch(this.mode){case 3:i=this.sinph0*r+this.cosph0*o*a;break;case 2:i=o*a;break;case 1:i=-r;break;case 0:i=r}switch(e=(i=this.pn1/(this.p-i))*o*Math.sin(t.x),this.mode){case 3:i*=this.cosph0*r-this.sinph0*o*a;break;case 2:i*=r;break;case 0:i*=-o*a;break;case 1:i*=o*a}return s=1/((n=i*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-i*this.sg)*this.cw*s,i=n*s,t.x=e*this.a,t.y=i*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,i,n,s={x:t.x,y:t.y};n=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*n,i=this.pn1*t.y*this.cw*n,t.x=e*this.cg+i*this.sg,t.y=i*this.cg-e*this.sg;var r=xp(t.x,t.y);if(Math.abs(r)<kd)s.x=0,s.y=t.y;else{var o,a;switch(a=1-r*r*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/r+r/this.pn1),o=Math.sqrt(1-a*a),this.mode){case 3:s.y=Math.asin(o*this.sinph0+t.y*a*this.cosph0/r),t.y=(o-this.sinph0*Math.sin(s.y))*r,t.x*=a*this.cosph0;break;case 2:s.y=Math.asin(t.y*a/r),t.y=o*r,t.x*=a;break;case 0:s.y=Math.asin(o),t.y=-t.y;break;case 1:s.y=-Math.asin(o)}s.x=Math.atan2(t.x,t.y)}return t.x=s.x+this.long0,t.y=s.y,t},names:["Tilted_Perspective","tpers"]},xm={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,i,n,s,r=t.x,o=t.y;if(r-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var a=this.radius_p/xp(this.radius_p*Math.cos(o),Math.sin(o));if(i=a*Math.cos(r)*Math.cos(o),n=a*Math.sin(r)*Math.cos(o),s=a*Math.sin(o),(this.radius_g-i)*i-n*n-s*s*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-i,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/xp(s,e)),t.y=this.radius_g_1*Math.atan(s/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(s/xp(n,e)))}else"sphere"===this.shape&&(e=Math.cos(o),i=Math.cos(r)*e,n=Math.sin(r)*e,s=Math.sin(o),e=this.radius_g-i,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/xp(s,e)),t.y=this.radius_g_1*Math.atan(s/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(s/xp(n,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,i,n,s,r=-1,o=0,a=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*xp(1,a)):(o=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*xp(1,o));var h=a/this.radius_p;if(e=o*o+h*h+r*r,(n=(i=2*this.radius_g*r)*i-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;s=(-i-Math.sqrt(n))/(2*e),r=this.radius_g+s*r,o*=s,a*=s,t.x=Math.atan2(o,r),t.y=Math.atan(a*Math.cos(t.x)/r),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+a*a)):(o=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+o*o)),e=o*o+a*a+r*r,(n=(i=2*this.radius_g*r)*i-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;s=(-i-Math.sqrt(n))/(2*e),r=this.radius_g+s*r,o*=s,a*=s,t.x=Math.atan2(o,r),t.y=Math.atan(a*Math.cos(t.x)/r)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var wm;Hf.defaultDatum="WGS84",Hf.Proj=zf,Hf.WGS84=new Hf.Proj("WGS84"),Hf.Point=dp,Hf.toPoint=Zf,Hf.defs=af,Hf.nadgrid=function(t,e){var i=new DataView(e),n=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(i),s=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Cf(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(i,n);s.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var r=function(t,e,i){for(var n=[],s=0;s<e.nSubgrids;s++){var r=Pf(t,176,i),o=Bf(t,176,r,i),a=Math.round(1+(r.upperLongitude-r.lowerLongitude)/r.longitudeInterval),h=Math.round(1+(r.upperLatitude-r.lowerLatitude)/r.latitudeInterval);n.push({ll:[Af(r.lowerLongitude),Af(r.lowerLatitude)],del:[Af(r.longitudeInterval),Af(r.latitudeInterval)],lim:[a,h],count:r.gridNodeCount,cvs:Lf(o)})}return n}(i,s,n),o={header:s,subgrids:r};return Tf[t]=o,o},Hf.transform=Vf,Hf.mgrs=ip,Hf.version="__VERSION__",(wm=Hf).Proj.projections.add(vp),wm.Proj.projections.add(Sp),wm.Proj.projections.add(Tp),wm.Proj.projections.add(Cp),wm.Proj.projections.add(Lp),wm.Proj.projections.add(Pp),wm.Proj.projections.add(Ep),wm.Proj.projections.add(zp),wm.Proj.projections.add(Op),wm.Proj.projections.add(Vp),wm.Proj.projections.add(Gp),wm.Proj.projections.add(Hp),wm.Proj.projections.add(Yp),wm.Proj.projections.add($p),wm.Proj.projections.add(Xp),wm.Proj.projections.add(Kp),wm.Proj.projections.add(Jp),wm.Proj.projections.add(Qp),wm.Proj.projections.add(tm),wm.Proj.projections.add(em),wm.Proj.projections.add(im),wm.Proj.projections.add(nm),wm.Proj.projections.add(sm),wm.Proj.projections.add(rm),wm.Proj.projections.add(lm),wm.Proj.projections.add(_m),wm.Proj.projections.add(gm),wm.Proj.projections.add(bm),wm.Proj.projections.add(xm);const Mm=Hf;Mm.defs("EPSG:3035","+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs"),L.GridvizLayer=function(e){e=e||{},this.proj=e.proj||"EPSG:3035",this.app=null,this.gridviz=t,this.onLayerDidMountCallback=e.onLayerDidMountCallback||null,this.onLayerDidMount=function(){this.buildGridVizApp(),this.onLayerDidMountCallback&&this.onLayerDidMountCallback();let t=this._map._container;new ResizeObserver((e=>{t.clientWidth>0&&t.clientHeight>0&&window.requestAnimationFrame((()=>{Array.isArray(e)&&e.length&&(this.app.h===t.clientHeight&&this.app.w===t.clientWidth||(this.app.h=t.clientHeight,this.app.w=t.clientWidth,this.app.cg.h=t.clientHeight,this.app.cg.w=t.clientWidth,this._canvas.setAttribute("width",""+this.app.w),this._canvas.setAttribute("height",""+this.app.h),this.app.redraw()))}))})).observe(t)},this.onLayerWillUnmount=function(){},this.setData=function(t){this.needRedraw()},this.onDrawLayer=function(t){let e=this.leafletToGeoCenter(this._map.getCenter()),i=this.leafletZoomToGridvizZoom();this.app.setGeoCenter({x:e[0],y:e[1]}),this.app.setZoomFactor(i),this.app.redraw()},this.geoCenterToLeaflet=function(t,e){let i=Mm(this.proj,"WGS84",[t,e]);return[i[1],i[0]]},this.leafletToGeoCenter=function(t){return Mm(this.proj,[t.lng,t.lat])},this.leafletZoomToGridvizZoom=function(){return this.getMetresPerPixel()},this.getMetresPerPixel=function(){let t=this._map.getCenter(),e=this._map.latLngToContainerPoint(t),i=[e.x+1,e.y],n=this._map.containerPointToLatLng(e),s=this._map.containerPointToLatLng(i),r=this.leafletToGeoCenter(n);return this.leafletToGeoCenter(s)[0]-r[0]},this.buildGridVizApp=function(){let t=this.leafletToGeoCenter(this._map.getCenter());e.container=e.container||this._canvas.parentElement,this.app=new ql(e.container,{canvas:this._canvas,w:window.innerWidth,h:window.innerHeight,disableZoom:!0,transparentBackground:!0,selectionRectangleColor:e.selectionRectangleColor||"red",selectionRectangleWidthPix:e.selectionRectangleWidthPix||"4",legendDivId:e.legendDivId||"gvizLegend"}).setGeoCenter({x:t[0],y:t[1]})}},L.GridvizLayer.prototype=new Td.CanvasLayer})()})();