!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("proj4"),require("gridviz")):"function"==typeof define&&define.amd?define(["proj4","gridviz"],t):"object"==typeof exports?exports.LeafletGridviz=t(require("proj4"),require("gridviz")):e.LeafletGridviz=t(e.proj4,e.gridviz)}(self,(e,t)=>(()=>{var i={48:t=>{"use strict";t.exports=e},448:e=>{"use strict";e.exports=t},718:()=>{L.DomUtil.setTransform=L.DomUtil.setTransform||function(e,t,i){var n=t||new L.Point(0,0);e.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")},L.GridvizCanvasLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(e){this._map=null,this._canvas=null,this._frame=null,this._delegate=null,this._zooming=!1,L.setOptions(this,e)},delegate:function(e){return this._delegate=e,this},needRedraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this.drawLayer,this)),this},_updatePosition:function(){var e=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,e)},onAdd:function(e){this._map=e,this._canvas=L.DomUtil.create("canvas","leaflet-layer"),this._canvas.style.transformOrigin="0 0",L.DomUtil.addClass(this._canvas,"leaflet-zoom-animated");var t=e.getSize();this._canvas.width=t.x,this._canvas.height=t.y;var i=e.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(i?"animated":"hide"));var n=e.createPane("gridviz");n.style.zIndex=399,n.appendChild(this._canvas),e.on(this.getEvents(),this);var o=this._delegate||this;o.onLayerDidMount&&o.onLayerDidMount(),this._updatePosition(),this._initCanvasLevel(),L.DomUtil.setTransform(this._canvas,L.point(0,0),1),this.needRedraw()},onRemove:function(e){var t=this._delegate||this;t.onLayerWillUnmount&&t.onLayerWillUnmount(),this._frame&&L.Util.cancelAnimFrame(this._frame);var i=e.getPane("gridviz");this._canvas&&this._canvas.parentElement===i&&(i.removeChild(this._canvas),e.off(this.getEvents(),this),this._canvas=null)},_initCanvasLevel:function(){var e=this._map.getZoom(),t=this._map.getCenter(),i=this._map._getTopLeftPoint(t,e).round();this._canvasLevel={zoom:e,origin:i,el:this._canvas}},getEvents:function(){return{resize:this._onLayerDidResize,movestart:this._onMoveStart,moveend:this._onMoveEnd,viewreset:this._onLayerDidMove,zoomstart:this._onZoomStart,zoomanim:this._onAnimZoom,zoomend:this._onZoomEnd}},_onMoveStart:function(e){},_onMoveEnd:function(e){this._onLayerDidMove()},_onLayerDidMove:function(){this._updatePosition(),this.drawLayer()},_onZoomStart:function(){L.DomUtil.setPosition(this._canvas,L.point(0,0)),this._initCanvasLevel()},_onZoomEnd:function(){this._updatePosition(),this._initCanvasLevel()},_onAnimZoom:function(e){var t=this._canvasLevel,i=this._map.getZoomScale(e.zoom,t.zoom),n=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e.center,e.zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(t.el,n,i):L.DomUtil.setPosition(t.el,n)},_onLayerDidResize:function(e){this._canvas.width=e.newSize.x,this._canvas.height=e.newSize.y,this._updatePosition(),L.DomUtil.setTransform(this._canvas,L.point(0,0),1),this._initCanvasLevel(),this.drawLayer()},addTo:function(e){return e.addLayer(this),this},drawLayer:function(){this._zooming||(this.onDrawLayer&&this.onDrawLayer(),this._frame=null)}}),L.gridvizCanvasLayer=function(){return new L.GridvizCanvasLayer}}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var a=n[e]={exports:{}};return i[e](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{"use strict";o.r(a),o.d(a,{default:()=>r,registerGridvizLayer:()=>n});var e=o(48),t=o.n(e),i=o(448);function n(e=L){if(!e)throw new Error("Leaflet L is required");if(!t())throw new Error("proj4 is required");if(!i.Map)throw new Error("gridviz.Map is required");if(!e.GridvizCanvasLayer)throw new Error("L.GridvizCanvasLayer not found. Load ./L.GridvizCanvasLayer.js first.");return e.GridvizLayer=function(e){e=e||{},this.proj=e.proj||"EPSG:3035",this.gridvizMap=null,this.onLayerDidMountCallback=e.onLayerDidMountCallback||null,this.onLayerDidMount=function(){this.buildGridvizMap(),this.onLayerDidMountCallback&&this.onLayerDidMountCallback(this.gridvizMap),this.addResizeObserver()},this.addResizeObserver=function(){const e=this._map,t=e._container;new ResizeObserver(t=>{Array.isArray(t)&&t.length&&(e.invalidateSize({debounceMoveend:!0}),e.once("resize",t=>{const i=t&&t.newSize?t.newSize:e.getSize(),n=0|i.x,o=0|i.y;this.gridvizMap.w===n&&this.gridvizMap.h===o||(this.gridvizMap.w=n,this.gridvizMap.h=o,this.gridvizMap.geoCanvas.w=n,this.gridvizMap.geoCanvas.h=o,this.gridvizMap.geoCanvas.offscreenCanvas.width=n,this.gridvizMap.geoCanvas.offscreenCanvas.height=o,this._canvas.setAttribute("width",""+n),this._canvas.setAttribute("height",""+o),this._updatePosition(),L.DomUtil.setTransform(this._canvas,L.point(0,0),1),this._initCanvasLevel(),this.gridvizMap.redraw(),this.needRedraw())}))}).observe(t)},this.onLayerWillUnmount=function(){this.gridvizMap.destroy()},this.setData=function(e){this.needRedraw()},this.onDrawLayer=function(e){if(this._zooming)return;const t=this.leafletToGeoCenter(this._map.getCenter()),i=this.leafletZoomToGridvizZoom();this.gridvizMap.setView(t[0],t[1],i),this.gridvizMap.redraw()},this.leafletToGeoCenter=function(e){return t()(this.proj,[e.lng,e.lat])},this.leafletZoomToGridvizZoom=function(){return this.getMetresPerPixel()},this.getMetresPerPixel=function(){const e=this._map.getCenter(),t=this._map.latLngToContainerPoint(e),i=[t.x+1,t.y],n=this._map.containerPointToLatLng(t),o=this._map.containerPointToLatLng(i),a=this.leafletToGeoCenter(n);return this.leafletToGeoCenter(o)[0]-a[0]},this.buildGridvizMap=function(){const t=this.leafletToGeoCenter(this._map.getCenter());e.container=e.container||this._canvas.parentElement,this.gridvizMap=new i.Map(e.container,{canvas:this._canvas,w:window.innerWidth,h:window.innerHeight,x:t[0],y:t[1],z:this.leafletZoomToGridvizZoom(),disableZoom:!0,transparentBackground:!0,selectionRectangleColor:e.selectionRectangleColor,selectionRectangleWidthPix:e.selectionRectangleWidthPix,legendContainer:e.legendContainer,tooltip:{parentElement:document.body}})}},e.GridvizLayer.prototype=new e.GridvizCanvasLayer,e.GridvizLayer}o(718),t().defs("EPSG:3035")||t().defs("EPSG:3035","+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs"),"undefined"!=typeof window&&window.L&&!window.L.GridvizLayer&&n(window.L);const r=n})(),a})());